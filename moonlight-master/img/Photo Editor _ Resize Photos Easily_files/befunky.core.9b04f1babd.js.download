(()=>{var Rs=Object.create;var Rn=Object.defineProperty,Ms=Object.defineProperties,Us=Object.getOwnPropertyDescriptor,Ds=Object.getOwnPropertyDescriptors,js=Object.getOwnPropertyNames,pi=Object.getOwnPropertySymbols,Os=Object.getPrototypeOf,gi=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable;var fi=(e,t,n)=>t in e?Rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ze=(e,t)=>{for(var n in t||(t={}))gi.call(t,n)&&fi(e,n,t[n]);if(pi)for(var n of pi(t))Ns.call(t,n)&&fi(e,n,t[n]);return e},Ut=(e,t)=>Ms(e,Ds(t)),Hs=e=>Rn(e,"__esModule",{value:!0});var $o=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var qs=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of js(t))!gi.call(e,o)&&o!=="default"&&Rn(e,o,{get:()=>t[o],enumerable:!(n=Us(t,o))||n.enumerable});return e},Mn=e=>qs(Hs(Rn(e!=null?Rs(Os(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var oa=$o((ir,ar)=>{(function(e,t){typeof ir=="object"&&typeof ar!="undefined"?ar.exports=t():typeof define=="function"&&define.amd?define(t):e.Navigo=t()})(ir,function(){"use strict";var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};function t(){return!(typeof window=="undefined"||!window.history||!window.history.pushState)}function n(c,d,p){this.root=null,this._routes=[],this._useHash=d,this._hash=p===void 0?"#":p,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!d&&t(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",c?this.root=d?c.replace(/\/$/,"/"+this._hash):c.replace(/\/$/,""):d&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function o(c){return c instanceof RegExp?c:c.replace(/\/+$/,"").replace(/^\/+/,"^/")}function r(c){return c.replace(/\/$/,"").split("/").length}function i(c,d){return r(d)-r(c)}function a(c,d){return function(p){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).map(function(m){var g=function(w){var F=[];return{regexp:w instanceof RegExp?w:new RegExp(w.replace(n.PARAMETER_REGEXP,function(b,E,P){return F.push(P),n.REPLACE_VARIABLE_REGEXP}).replace(n.WILDCARD_REGEXP,n.REPLACE_WILDCARD)+n.FOLLOWED_BY_SLASH_REGEXP,n.MATCH_REGEXP_FLAGS),paramNames:F}}(o(m.route)),f=g.regexp,_=g.paramNames,y=p.replace(/^\/+/,"/").match(f),h=function(w,F){return F.length===0?null:w?w.slice(1,w.length).reduce(function(b,E,P){return b===null&&(b={}),b[F[P]]=decodeURIComponent(E),b},null):null}(y,_);return!!y&&{match:y,route:m,params:h}}).filter(function(m){return m})}(c,d)[0]||!1}function l(c,d){var p=d.map(function(g){return g.route===""||g.route==="*"?c:c.split(new RegExp(g.route+"($|/)"))[0]}),m=o(c);return p.length>1?p.reduce(function(g,f){return g.length>f.length&&(g=f),g},p[0]):p.length===1?p[0]:m}function u(c,d,p){var m,g=function(f){return f.split(/\?(.*)?$/)[0]};return p===void 0&&(p="#"),t()&&!d?g(c).split(p)[0]:(m=c.split(p)).length>1?g(m[1]):g(m[0])}function s(c,d,p){if(d&&(d===void 0?"undefined":e(d))==="object"){if(d.before)return void d.before(function(){(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(c(),d.after&&d.after(p))},p);if(d.after)return c(),void(d.after&&d.after(p))}c()}return n.prototype={helpers:{match:a,root:l,clean:o,getOnlyURL:u},navigate:function(c,d){var p;return c=c||"",this._usePushState?(p=(p=(d?"":this._getRoot()+"/")+c.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",p),this.resolve()):typeof window!="undefined"&&(c=c.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+c),this},on:function(){for(var c=this,d=arguments.length,p=Array(d),m=0;m<d;m++)p[m]=arguments[m];if(typeof p[0]=="function")this._defaultHandler={handler:p[0],hooks:p[1]};else if(p.length>=2)if(p[0]==="/"){var g=p[1];e(p[1])==="object"&&(g=p[1].uses),this._defaultHandler={handler:g,hooks:p[2]}}else this._add(p[0],p[1],p[2]);else e(p[0])==="object"&&Object.keys(p[0]).sort(i).forEach(function(f){c.on(f,p[0][f])});return this},off:function(c){return this._defaultHandler!==null&&c===this._defaultHandler.handler?this._defaultHandler=null:this._notFoundHandler!==null&&c===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce(function(d,p){return p.handler!==c&&d.push(p),d},[]),this},notFound:function(c,d){return this._notFoundHandler={handler:c,hooks:d},this},resolve:function(c){var d,p,m=this,g=(c||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(g=g.replace(new RegExp("^/"+this._hash),"/"));var f=function(y){return y.split(/\?(.*)?$/).slice(1).join("")}(c||this._cLoc()),_=u(g,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&_===this._lastRouteResolved.url&&f===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(p=a(_,this._routes))?(this._callLeave(),this._lastRouteResolved={url:_,query:f,hooks:p.route.hooks,params:p.params,name:p.route.name},d=p.route.handler,s(function(){s(function(){p.route.route instanceof RegExp?d.apply(void 0,p.match.slice(1,p.match.length)):d(p.params,f)},p.route.hooks,p.params,m._genericHooks)},this._genericHooks,p.params),p):this._defaultHandler&&(_===""||_==="/"||_===this._hash||function(y,h,w){if(t()&&!h||!y.match(w))return!1;var F=y.split(w);return F.length<2||F[1]===""}(_,this._useHash,this._hash))?(s(function(){s(function(){m._callLeave(),m._lastRouteResolved={url:_,query:f,hooks:m._defaultHandler.hooks},m._defaultHandler.handler(f)},m._defaultHandler.hooks)},this._genericHooks),!0):(this._notFoundHandler&&s(function(){s(function(){m._callLeave(),m._lastRouteResolved={url:_,query:f,hooks:m._notFoundHandler.hooks},m._notFoundHandler.handler(f)},m._notFoundHandler.hooks)},this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),typeof window!="undefined"&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var c=this;typeof document!="undefined"&&this._findLinks().forEach(function(d){d.hasListenerAttached||(d.addEventListener("click",function(p){if((p.ctrlKey||p.metaKey)&&p.target.tagName.toLowerCase()=="a")return!1;var m=c.getLinkPath(d);c._destroyed||(p.preventDefault(),c.navigate(m.replace(/\/+$/,"").replace(/^\/+/,"/")))}),d.hasListenerAttached=!0)})},generate:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=this._routes.reduce(function(m,g){var f;if(g.name===c)for(f in m=g.route,d)m=m.toString().replace(":"+f,d[f]);return m},"");return this._useHash?this._hash+p:p},link:function(c){return this._getRoot()+c},pause:function(){var c=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];this._paused=c,this._historyAPIUpdateMethod=c?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(c){return c===void 0?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=c,c)},disableIfAPINotAvailable:function(){t()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(c){return c.getAttribute("href")},hooks:function(c){this._genericHooks=c},_add:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return typeof c=="string"&&(c=encodeURI(c)),this._routes.push((d===void 0?"undefined":e(d))==="object"?{route:c,handler:d.uses,name:d.as,hooks:p||d.hooks}:{route:c,handler:d,hooks:p}),this._add},_getRoot:function(){return this.root!==null?this.root:(this.root=l(this._cLoc().split("?")[0],this._routes),this.root)},_listen:function(){var c=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if(typeof window!="undefined"&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var d=this._cLoc(),p=void 0,m=void 0;(m=function(){p=c._cLoc(),d!==p&&(d=p,c.resolve()),c._listeningInterval=setTimeout(m,200)})()}},_cLoc:function(){return typeof window!="undefined"?window.__NAVIGO_WINDOW_LOCATION_MOCK__!==void 0?window.__NAVIGO_WINDOW_LOCATION_MOCK__:o(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var c=this._lastRouteResolved;c&&c.hooks&&c.hooks.leave&&c.hooks.leave(c.params)}},n.PARAMETER_REGEXP=/([:*])(\w+)/g,n.WILDCARD_REGEXP=/\*/g,n.REPLACE_VARIABLE_REGEXP="([^/]+)",n.REPLACE_WILDCARD="(?:.*)",n.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",n.MATCH_REGEXP_FLAGS="",n})});var gr=$o((Cf,da)=>{var aa=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],ur=aa.join(","),dr=typeof Element=="undefined"?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function pr(e,t){t=t||{};var n=e.ownerDocument||e,o=[],r=[],i=new uo(n),a=e.querySelectorAll(ur);t.includeContainer&&dr.call(e,ur)&&(a=Array.prototype.slice.apply(a),a.unshift(e));var l,u,s;for(l=0;l<a.length;l++)u=a[l],!!sa(u,i)&&(s=ca(u),s===0?o.push(u):r.push({documentOrder:l,tabIndex:s,node:u}));var c=r.sort(Ql).map(function(d){return d.node}).concat(o);return c}pr.isTabbable=Yl;pr.isFocusable=Kl;function sa(e,t){return!(!la(e,t)||oc(e)||ca(e)<0)}function Yl(e,t){if(!e)throw new Error("No node provided");return dr.call(e,ur)===!1?!1:sa(e,t)}function la(e,t){return t=t||new uo(e.ownerDocument||e),!(e.disabled||tc(e)||t.isUntouchable(e))}var Jl=aa.concat("iframe").join(",");function Kl(e,t){if(!e)throw new Error("No node provided");return dr.call(e,Jl)===!1?!1:la(e,t)}function ca(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?ec(e)?0:e.tabIndex:t}function Ql(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex}function Zl(e,t){for(var n=0,o=e.length;n<o;n++)if(t(e[n]))return e[n]}function ec(e){return e.contentEditable==="true"}function ua(e){return e.tagName==="INPUT"}function tc(e){return ua(e)&&e.type==="hidden"}function nc(e){return ua(e)&&e.type==="radio"}function oc(e){return nc(e)&&!ic(e)}function rc(e){for(var t=0;t<e.length;t++)if(e[t].checked)return e[t]}function ic(e){if(!e.name)return!0;var t=e.ownerDocument.querySelectorAll('input[type="radio"][name="'+e.name+'"]'),n=rc(t);return!n||n===e}function uo(e){this.doc=e,this.cache=[]}uo.prototype.hasDisplayNone=function(t,n){if(t.nodeType!==Node.ELEMENT_NODE)return!1;var o=Zl(this.cache,function(i){return i===t});if(o)return o[1];n=n||this.doc.defaultView.getComputedStyle(t);var r=!1;return n.display==="none"?r=!0:t.parentNode&&(r=this.hasDisplayNone(t.parentNode)),this.cache.push([t,r]),r};uo.prototype.isUntouchable=function(t){if(t===this.doc.documentElement)return!1;var n=this.doc.defaultView.getComputedStyle(t);return this.hasDisplayNone(t,n)?!0:n.visibility==="hidden"};da.exports=pr});var va=$o((yn,Fr)=>{(function(e,t){typeof yn=="object"&&typeof Fr=="object"?Fr.exports=t():typeof define=="function"&&define.amd?define("Fuse",[],t):typeof yn=="object"?yn.Fuse=t():e.Fuse=t()})(yn,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(o,r,i){n.o(o,r)||Object.defineProperty(o,r,{enumerable:!0,get:i})},n.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},n.t=function(o,r){if(1&r&&(o=n(o)),8&r||4&r&&typeof o=="object"&&o&&o.__esModule)return o;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:o}),2&r&&typeof o!="string")for(var a in o)n.d(i,a,function(l){return o[l]}.bind(null,a));return i},n.n=function(o){var r=o&&o.__esModule?function(){return o.default}:function(){return o};return n.d(r,"a",r),r},n.o=function(o,r){return Object.prototype.hasOwnProperty.call(o,r)},n.p="",n(n.s=0)}([function(e,t,n){function o(c){return(o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}function r(c,d){for(var p=0;p<d.length;p++){var m=d[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(c,m.key,m)}}var i=n(1),a=n(7),l=a.get,u=(a.deepValue,a.isArray),s=function(){function c(g,f){var _=f.location,y=_===void 0?0:_,h=f.distance,w=h===void 0?100:h,F=f.threshold,b=F===void 0?.6:F,E=f.maxPatternLength,P=E===void 0?32:E,T=f.caseSensitive,$=T!==void 0&&T,N=f.tokenSeparator,j=N===void 0?/ +/g:N,G=f.findAllMatches,H=G!==void 0&&G,z=f.minMatchCharLength,J=z===void 0?1:z,X=f.id,ue=X===void 0?null:X,Q=f.keys,pe=Q===void 0?[]:Q,ne=f.shouldSort,ve=ne===void 0||ne,_e=f.getFn,he=_e===void 0?l:_e,se=f.sortFn,ce=se===void 0?function(M,Z){return M.score-Z.score}:se,fe=f.tokenize,me=fe!==void 0&&fe,De=f.matchAllTokens,C=De!==void 0&&De,B=f.includeMatches,L=B!==void 0&&B,R=f.includeScore,S=R!==void 0&&R,x=f.verbose,U=x!==void 0&&x;(function(M,Z){if(!(M instanceof Z))throw new TypeError("Cannot call a class as a function")})(this,c),this.options={location:y,distance:w,threshold:b,maxPatternLength:P,isCaseSensitive:$,tokenSeparator:j,findAllMatches:H,minMatchCharLength:J,id:ue,keys:pe,includeMatches:L,includeScore:S,shouldSort:ve,getFn:he,sortFn:ce,verbose:U,tokenize:me,matchAllTokens:C},this.setCollection(g),this._processKeys(pe)}var d,p,m;return d=c,(p=[{key:"setCollection",value:function(g){return this.list=g,g}},{key:"_processKeys",value:function(g){if(this._keyWeights={},this._keyNames=[],g.length&&typeof g[0]=="string")for(var f=0,_=g.length;f<_;f+=1){var y=g[f];this._keyWeights[y]=1,this._keyNames.push(y)}else{for(var h=null,w=null,F=0,b=0,E=g.length;b<E;b+=1){var P=g[b];if(!P.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var T=P.name;if(this._keyNames.push(T),!P.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var $=P.weight;if($<0||$>1)throw new Error('"weight" property in key must bein the range of [0, 1)');w=w==null?$:Math.max(w,$),h=h==null?$:Math.min(h,$),this._keyWeights[T]=$,F+=$}if(F>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(g){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{limit:!1};this._log(`---------
Search pattern: "`.concat(g,'"'));var _=this._prepareSearchers(g),y=_.tokenSearchers,h=_.fullSearcher,w=this._search(y,h);return this._computeScore(w),this.options.shouldSort&&this._sort(w),f.limit&&typeof f.limit=="number"&&(w=w.slice(0,f.limit)),this._format(w)}},{key:"_prepareSearchers",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",f=[];if(this.options.tokenize)for(var _=g.split(this.options.tokenSeparator),y=0,h=_.length;y<h;y+=1)f.push(new i(_[y],this.options));return{tokenSearchers:f,fullSearcher:new i(g,this.options)}}},{key:"_search",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=arguments.length>1?arguments[1]:void 0,_=this.list,y={},h=[];if(typeof _[0]=="string"){for(var w=0,F=_.length;w<F;w+=1)this._analyze({key:"",value:_[w],record:w,index:w},{resultMap:y,results:h,tokenSearchers:g,fullSearcher:f});return h}for(var b=0,E=_.length;b<E;b+=1)for(var P=_[b],T=0,$=this._keyNames.length;T<$;T+=1){var N=this._keyNames[T];this._analyze({key:N,value:this.options.getFn(P,N),record:P,index:b},{resultMap:y,results:h,tokenSearchers:g,fullSearcher:f})}return h}},{key:"_analyze",value:function(g,f){var _=this,y=g.key,h=g.arrayIndex,w=h===void 0?-1:h,F=g.value,b=g.record,E=g.index,P=f.tokenSearchers,T=P===void 0?[]:P,$=f.fullSearcher,N=f.resultMap,j=N===void 0?{}:N,G=f.results,H=G===void 0?[]:G;(function z(J,X,ue,Q){if(X!=null){if(typeof X=="string"){var pe=!1,ne=-1,ve=0;_._log(`
Key: `.concat(y===""?"--":y));var _e=$.search(X);if(_._log('Full text: "'.concat(X,'", score: ').concat(_e.score)),_.options.tokenize){for(var he=X.split(_.options.tokenSeparator),se=he.length,ce=[],fe=0,me=T.length;fe<me;fe+=1){var De=T[fe];_._log(`
Pattern: "`.concat(De.pattern,'"'));for(var C=!1,B=0;B<se;B+=1){var L=he[B],R=De.search(L),S={};R.isMatch?(S[L]=R.score,pe=!0,C=!0,ce.push(R.score)):(S[L]=1,_.options.matchAllTokens||ce.push(1)),_._log('Token: "'.concat(L,'", score: ').concat(S[L]))}C&&(ve+=1)}ne=ce[0];for(var x=ce.length,U=1;U<x;U+=1)ne+=ce[U];ne/=x,_._log("Token score average:",ne)}var M=_e.score;ne>-1&&(M=(M+ne)/2),_._log("Score average:",M);var Z=!_.options.tokenize||!_.options.matchAllTokens||ve>=T.length;if(_._log(`
Check Matches: `.concat(Z)),(pe||_e.isMatch)&&Z){var Y={key:y,arrayIndex:J,value:X,score:M};_.options.includeMatches&&(Y.matchedIndices=_e.matchedIndices);var oe=j[Q];oe?oe.output.push(Y):(j[Q]={item:ue,output:[Y]},H.push(j[Q]))}}else if(u(X))for(var Be=0,Pe=X.length;Be<Pe;Be+=1)z(Be,X[Be],ue,Q)}})(w,F,b,E)}},{key:"_computeScore",value:function(g){this._log(`

Computing score:
`);for(var f=this._keyWeights,_=!!Object.keys(f).length,y=0,h=g.length;y<h;y+=1){for(var w=g[y],F=w.output,b=F.length,E=1,P=0;P<b;P+=1){var T=F[P],$=T.key,N=_?f[$]:1,j=T.score===0&&f&&f[$]>0?Number.EPSILON:T.score;E*=Math.pow(j,N)}w.score=E,this._log(w)}}},{key:"_sort",value:function(g){this._log(`

Sorting....`),g.sort(this.options.sortFn)}},{key:"_format",value:function(g){var f=[];if(this.options.verbose){var _=[];this._log(`

Output:

`,JSON.stringify(g,function(T,$){if(o($)==="object"&&$!==null){if(_.indexOf($)!==-1)return;_.push($)}return $},2)),_=null}var y=[];this.options.includeMatches&&y.push(function(T,$){var N=T.output;$.matches=[];for(var j=0,G=N.length;j<G;j+=1){var H=N[j];if(H.matchedIndices.length!==0){var z={indices:H.matchedIndices,value:H.value};H.key&&(z.key=H.key),H.hasOwnProperty("arrayIndex")&&H.arrayIndex>-1&&(z.arrayIndex=H.arrayIndex),$.matches.push(z)}}}),this.options.includeScore&&y.push(function(T,$){$.score=T.score});for(var h=0,w=g.length;h<w;h+=1){var F=g[h];if(this.options.id&&(F.item=this.options.getFn(F.item,this.options.id)[0]),y.length){for(var b={item:F.item},E=0,P=y.length;E<P;E+=1)y[E](F,b);f.push(b)}else f.push(F.item)}return f}},{key:"_log",value:function(){var g;this.options.verbose&&(g=console).log.apply(g,arguments)}}])&&r(d.prototype,p),m&&r(d,m),c}();e.exports=s},function(e,t,n){function o(u,s){for(var c=0;c<s.length;c++){var d=s[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}var r=n(2),i=n(3),a=n(6),l=function(){function u(p,m){var g=m.location,f=g===void 0?0:g,_=m.distance,y=_===void 0?100:_,h=m.threshold,w=h===void 0?.6:h,F=m.maxPatternLength,b=F===void 0?32:F,E=m.isCaseSensitive,P=E!==void 0&&E,T=m.tokenSeparator,$=T===void 0?/ +/g:T,N=m.findAllMatches,j=N!==void 0&&N,G=m.minMatchCharLength,H=G===void 0?1:G,z=m.includeMatches,J=z!==void 0&&z;(function(X,ue){if(!(X instanceof ue))throw new TypeError("Cannot call a class as a function")})(this,u),this.options={location:f,distance:y,threshold:w,maxPatternLength:b,isCaseSensitive:P,tokenSeparator:$,findAllMatches:j,includeMatches:J,minMatchCharLength:H},this.pattern=P?p:p.toLowerCase(),this.pattern.length<=b&&(this.patternAlphabet=a(this.pattern))}var s,c,d;return s=u,(c=[{key:"search",value:function(p){var m=this.options,g=m.isCaseSensitive,f=m.includeMatches;if(g||(p=p.toLowerCase()),this.pattern===p){var _={isMatch:!0,score:0};return f&&(_.matchedIndices=[[0,p.length-1]]),_}var y=this.options,h=y.maxPatternLength,w=y.tokenSeparator;if(this.pattern.length>h)return r(p,this.pattern,w);var F=this.options,b=F.location,E=F.distance,P=F.threshold,T=F.findAllMatches,$=F.minMatchCharLength;return i(p,this.pattern,this.patternAlphabet,{location:b,distance:E,threshold:P,findAllMatches:T,minMatchCharLength:$,includeMatches:f})}}])&&o(s.prototype,c),d&&o(s,d),u}();e.exports=l},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(o,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:/ +/g,a=new RegExp(r.replace(n,"\\$&").replace(i,"|")),l=o.match(a),u=!!l,s=[];if(u)for(var c=0,d=l.length;c<d;c+=1){var p=l[c];s.push([o.indexOf(p),p.length-1])}return{score:u?.5:1,isMatch:u,matchedIndices:s}}},function(e,t,n){var o=n(4),r=n(5);e.exports=function(i,a,l,u){for(var s=u.location,c=s===void 0?0:s,d=u.distance,p=d===void 0?100:d,m=u.threshold,g=m===void 0?.6:m,f=u.findAllMatches,_=f!==void 0&&f,y=u.minMatchCharLength,h=y===void 0?1:y,w=u.includeMatches,F=w!==void 0&&w,b=c,E=i.length,P=g,T=i.indexOf(a,b),$=a.length,N=[],j=0;j<E;j+=1)N[j]=0;if(T!==-1){var G=o(a,{errors:0,currentLocation:T,expectedLocation:b,distance:p});if(P=Math.min(G,P),(T=i.lastIndexOf(a,b+$))!==-1){var H=o(a,{errors:0,currentLocation:T,expectedLocation:b,distance:p});P=Math.min(H,P)}}T=-1;for(var z=[],J=1,X=$+E,ue=1<<($<=31?$-1:30),Q=0;Q<$;Q+=1){for(var pe=0,ne=X;pe<ne;)o(a,{errors:Q,currentLocation:b+ne,expectedLocation:b,distance:p})<=P?pe=ne:X=ne,ne=Math.floor((X-pe)/2+pe);X=ne;var ve=Math.max(1,b-ne+1),_e=_?E:Math.min(b+ne,E)+$,he=Array(_e+2);he[_e+1]=(1<<Q)-1;for(var se=_e;se>=ve;se-=1){var ce=se-1,fe=l[i.charAt(ce)];if(fe&&(N[ce]=1),he[se]=(he[se+1]<<1|1)&fe,Q!==0&&(he[se]|=(z[se+1]|z[se])<<1|1|z[se+1]),he[se]&ue&&(J=o(a,{errors:Q,currentLocation:ce,expectedLocation:b,distance:p}))<=P){if(P=J,(T=ce)<=b)break;ve=Math.max(1,2*b-T)}}if(o(a,{errors:Q+1,currentLocation:b,expectedLocation:b,distance:p})>P)break;z=he}var me={isMatch:T>=0,score:J===0?.001:J};return F&&(me.matchedIndices=r(N,h)),me}},function(e,t){e.exports=function(n,o){var r=o.errors,i=r===void 0?0:r,a=o.currentLocation,l=a===void 0?0:a,u=o.expectedLocation,s=u===void 0?0:u,c=o.distance,d=c===void 0?100:c,p=i/n.length,m=Math.abs(s-l);return d?p+m/d:m?1:p}},function(e,t){e.exports=function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=[],i=-1,a=-1,l=0,u=n.length;l<u;l+=1){var s=n[l];s&&i===-1?i=l:s||i===-1||((a=l-1)-i+1>=o&&r.push([i,a]),i=-1)}return n[l-1]&&l-i>=o&&r.push([i,l-1]),r}},function(e,t){e.exports=function(n){for(var o={},r=n.length,i=0;i<r;i+=1)o[n.charAt(i)]=0;for(var a=0;a<r;a+=1)o[n.charAt(a)]|=1<<r-a-1;return o}},function(e,t){var n=function(a){return Array.isArray?Array.isArray(a):Object.prototype.toString.call(a)==="[object Array]"},o=function(a){return a==null?"":function(l){if(typeof l=="string")return l;var u=l+"";return u=="0"&&1/l==-1/0?"-0":u}(a)},r=function(a){return typeof a=="string"},i=function(a){return typeof a=="number"};e.exports={get:function(a,l){var u=[];return function s(c,d){if(d){var p=d.indexOf("."),m=d,g=null;p!==-1&&(m=d.slice(0,p),g=d.slice(p+1));var f=c[m];if(f!=null)if(g||!r(f)&&!i(f))if(n(f))for(var _=0,y=f.length;_<y;_+=1)s(f[_],g);else g&&s(f,g);else u.push(o(f))}else u.push(c)}(a,l),u},isArray:n,isString:r,isNum:i,toString:o}}])})});window.BeFunky=window.BeFunky||{};BeFunky.editorExternalImage=null;BeFunky.projectToOpenInSection={editor:void 0,collage:void 0,designer:void 0};BeFunky.onDocumentReady(()=>{setTimeout(()=>{if(BeFunky.isCreateRoute()&&window.$googleDriveState==null){let e=document.getElementById("chrome-extension-button");if(!e)return;e.addEventListener("click",t=>{let n=document.getElementById("chrome-extension-button").getAttribute("data-url");n!=null&&n.length>0&&(window.bf_eventTrack("EXTERNAL","CHROME_EXTENSION","OPEN"),setTimeout(()=>{try{try{setApplicationMode("photoeditor")}catch(o){}if(n.includes("http"))try{BFN.BfnService.ToJsUrlUploader(n,null,!0,"chrome_extension")}catch(o){}else{n=n.split(",")[1];try{BFN.BfnService.ToJsBase64Uploader(n,void 0,"chrome_extension")}catch(r){}}}catch(o){}},1500))})}},0)});BeFunky.signOut=e=>{e=e||n(),BeFunky.callSignOutAPI().then(()=>{t(e)}).catch(o=>{o!=="request_failed"&&BeFunky.throwError("Sign-out failed:",o),t(`${BeFunky.Params.siteUrl}sign-out/?next=${encodeURIComponent(e)}`)});function t(o){BeFunky.removeLocal("latest_user_email"),window.onbeforeunload=null,window.location.href=o}function n(){if(BeFunky.isInstalled())return BeFunky.getDashboardUrlInLanguage();let o=BeFunky.LanguageManager.language[window.isAppOpen?"app":"site"],r=o!=="en"&&BeFunky.LanguageManager.siteLanguages.includes(o)?`${o}/`:"";return`${BeFunky.Params.siteUrl}${r}`}};BeFunky.callSignOutAPI=function(){return BeFunky.requestAPI("auth/sign-out",{},{showLoadScreen:!0}).then(e=>{if(e.data!=="success")throw"invalid_response"}).catch(e=>{if(e!=="not_logged_in")throw e})};BeFunky.updateLanguage=e=>BeFunky.requestAPI("auth/update-language",{lang:e}).then(t=>{if(t.data!=="success")throw"invalid_response"}).catch(t=>{BeFunky.logError("Unable to change language",t)});Object.assign(BeFunky.Params,{nextBillingDateMonthly:mi(Ws()),nextBillingDateAnnual:mi(Vs())});function Ws(){let e=new Date;return e.setMonth(e.getMonth()+1),e}function Vs(){let e=new Date;return e.setFullYear(e.getFullYear()+1),e}function mi(e){let t=`${e.getMonth()+1}`,n=`${e.getDate()}`,o=e.getFullYear();return t.length<2&&(t=`0${t}`),n.length<2&&(n=`0${n}`),[t,n,o].join("")}BeFunky.getDefaultUser=()=>({email:"",username:"",language:"",isNewUser:!1,pl:""});BeFunky.User=BeFunky.getDefaultUser();var Io=!1,hi=!0;BeFunky.log=(...e)=>{Io&&console.log(...e)};BeFunky.logWarning=(...e)=>{(Io||hi)&&console.warn(...e)};BeFunky.logError=(...e)=>{(Io||hi)&&console.error(...e)};BeFunky.throwError=(e,...t)=>{if(!(e instanceof Error||window.DOMError&&e instanceof DOMError))try{e=new Error(e)}catch(n){e=new Error(`Unknown error ${typeof e}`)}BeFunky.logError(`Sending ${e.name} to Sentry:`,e.message,...t),BeFunky.Params.IS_LC?setTimeout(()=>{throw e},0):Sentry.captureException(e)};BeFunky.reportWarning=(e,...t)=>{console.warn(e,...t),Sentry.withScope(n=>{n.setLevel("warning"),Sentry.captureException(new Error(e))})};BeFunky.reportUserAction=e=>{console.log("User action:",e)};BeFunky.loggingFlags=(getCookie("logging_flags")||"").split(",").map(e=>e.trim()).filter(Boolean);var yi={_default:"mediumslateblue",autosave:"darkturquoise",editor_image:"turquoise",canvas_interaction:"burlywood",app_action:"darkslateblue",selection_interaction:"darkturquoise",app_history:"darkorchid",paint_history:"darkred"};BeFunky.logFeature=(e,...t)=>{if(!BeFunky.loggingFlags.includes(e))return;let o=`color: white; background: ${yi[e]||yi._default}; border-radius: 3px; padding: 2px 4px`;console.log(`%c${e}`,o,...t)};BeFunky.isTextBoxFocused=()=>{let e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&["text","number","search","email","password","tel","url","time","date","datetime-local","month","week"].includes(e.type)};BeFunky.debounce=(e,t,n=!1)=>{let o;return function(){let r=this,i=arguments,a=n&&!o,l=function(){o=null,a||e.apply(r,i)};t==="raf"?(cancelAnimationFrame(o),o=requestAnimationFrame(l)):t==="ric"?(cancelIdleCallback(o),o=requestIdleCallback(l)):(clearTimeout(o),o=setTimeout(l,t)),a&&e.apply(r,i)}};BeFunky.throttle=(e,t)=>{let n,o,r;return function(){let i=this,a=arguments;n?(clearTimeout(o),o=setTimeout(()=>{Date.now()-r>=t&&(e.apply(i,a),r=Date.now())},t-(Date.now()-r))):(e.apply(i,a),r=Date.now(),n=!0)}};BeFunky.throttleRAF=e=>{let t=!1;return function(...n){let o=this;t||(t=!0,requestAnimationFrame(()=>{e.apply(o,n),t=!1}))}};BeFunky.randomString=e=>{let t="",n="abcdefghijklmnopqrstuvwxyz0123456789",o=n.length;for(let r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*o));return t};BeFunky.hash=e=>{let t=0,n=0,o=e.length;for(;n<o;)t=(t<<5)-t+e.charCodeAt(n++)<<0;return t+2147483647+1};BeFunky.getType=function(e){let t=Object.prototype.toString.call(e).slice(8,-1);return t!=="Object"?t:e&&e.constructor&&e.constructor.name?e.constructor.name:"Object"};BeFunky.waitUntil=function({condition:e,onSuccess:t,onTimeout:n,interval:o=200,maxAttempts:r=10}){if(![e,t,n].every(u=>typeof u=="function"))throw new Error("3 functions must be provided to BeFunky.waitUntil");let a=0;l();function l(){if(e())return t();if(a>=r)return n();a++,setTimeout(l,o)}};BeFunky.getSvgHtml=function(e,{classes:t="icon",style:n}={}){if(typeof t!="string")throw new Error(`Invalid SVG class: ${BeFunky.getType(t)}`);return`
    <svg class="${t}" ${n?`style="${n}"`:""}>
        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#${e}"></use>
    </svg>
    `.trim()};BeFunky.once=function(e,t){let n;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}};BeFunky.isLoggedIn=()=>!!window.latestUserData.email;BeFunky.isPlus=()=>window.latestUserData.pl==="1";BeFunky.isStripeUser=()=>window.latestUserData.is_strp===1;BeFunky.callbackTimeout=function(e,t=3e3){let n=!1,o=!1,r=Date.now(),i=()=>{n||(n=!0,o&&console.log(`Callback for ${e} was eventually called after ${Date.now()-r}ms`))};return setTimeout(()=>{n||(o=!0,BeFunky.throwError(`Callback for ${e} still not called after ${t}ms`))},t),i};BeFunky.stringValue=function(e){let t=BeFunky.getType(e),n=e;if(e instanceof Error||window.DOMError&&e instanceof DOMError)t=e.name||t,n=e.message;else if(e instanceof Blob)n=`{ size: ${BeFunky.formatBytes(e.size)}, type: ${e.type} }`;else if(e instanceof Event)n=`{ type: ${e.type}, target: ${e.target}, currentTarget: ${e.currentTarget} }`;else if(typeof e=="object")try{n=JSON.stringify(e)}catch(o){}else typeof n=="string"?n=`"${n}"`:n=`${n}`;return n.length>100&&(n=`${n.slice(0,100)}...`),`${t}: ${n}`};var To=[],Gs=BeFunky.debounce(()=>{requestIdleCallback(()=>{BeFunky.waitUntil({condition:()=>window.ga,onSuccess:()=>{console.log(`Sending ${To.length} user timing(s)`),To.splice(0).forEach(e=>window.ga("send","timing",...e))},onTimeout:()=>BeFunky.throwError("Unable to track user timings"),interval:500,maxAttempts:20})})},2e3);BeFunky.trackUserTiming=function(e,t,n){let o=Date.now(),r=!1;return(i=Date.now()-o)=>{r||(r=!0,!(i<=1)&&(!BeFunky.Params.enableUserTimings||e==="Background Removal"&&(console.log(`-- ${e} timing : ${t} ${n} : ${i}`),To.push([e,t,i,n]),Gs())))}};BeFunky.setLocal=function(e,t){try{return localStorage.setItem(e,t),!0}catch(n){return!1}};BeFunky.getLocal=function(e){try{return localStorage.getItem(e)}catch(t){return}};BeFunky.removeLocal=function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}};BeFunky.setLocalSession=function(e,t){try{return sessionStorage.setItem(e,t),!0}catch(n){return!1}};BeFunky.getLocalSession=function(e){try{return sessionStorage.getItem(e)}catch(t){return}};BeFunky.getUrlParameter=function(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))};BeFunky.isCreateRoute=(e=window.location.href)=>["create","es/crear","pt/criar","de/erstellen","fr/creer"].some(n=>e.startsWith(`/${n}`)||e.startsWith(`${BeFunky.Params.siteUrl}${n}`));BeFunky.isDashboard=(e=window.location.href)=>{let{siteUrl:t,pwaStartUrl:n}=BeFunky.Params,o=e.replace(t,"/"),r=n.replace(t,"/");return new RegExp(`^/(${BeFunky.LanguageManager.siteLanguages.join("|")})/`).test(o)&&(o=o.slice(3)),o.startsWith(r)};BeFunky.getDashboardUrlInLanguage=(e=BeFunky.LanguageManager.language.site)=>{BeFunky.LanguageManager.siteLanguages.includes(e)||(e="en");let{siteUrl:t,pwaStartUrl:n}=BeFunky.Params;if(e==="en")return n;let o=n.replace(t,"/");return`${t}${e}${o}`};BeFunky.shouldOpenInBrowserNotPWA=e=>!(/\/my-account|\/myphotos/.test(e)||BeFunky.isDashboard(e)||BeFunky.isCreateRoute(e));var zs=(e,t,n)=>{if(!t||t.length!==3)throw"Invalid linkHTML translation";e==="SUPPORT"&&(e="https://support.befunky.com/hc/en-us/requests/new"),typeof n!="boolean"&&(n=BeFunky.isInstalled()&&BeFunky.shouldOpenInBrowserNotPWA(e));let[o,r,i]=t,a=Object.keys(r).length?BeFunky.LanguageManager.getString(o,i):BeFunky.LanguageManager.getStringReplacements(o,r,i);return`<a href="${e}" ${n?'target="_blank" rel="noopener"':""}>${a}</a>`};BeFunky.toLinkHTML=(e,t)=>(n,o)=>zs(e,[n,{},o],t);BeFunky.formatBytes=(e,t=1)=>{if(!e)return"0 Bytes";let n=e/1024,o=n/1024,r=o/1024;return r>1?`${r.toFixed(1)} GB`:o>1?`${o.toFixed(1)} MB`:`${n.toFixed(t)} KB`};BeFunky.usingServiceWorker=()=>Boolean(navigator.serviceWorker&&navigator.serviceWorker.controller);BeFunky.addToServiceWorkerCache=(e,t,n=!0)=>{if(BeFunky.usingServiceWorker())return o();n&&BeFunky.waitUntil({condition:()=>BeFunky.usingServiceWorker(),onTimeout:()=>{},onSuccess:o,maxAttempts:10,interval:1e3});function o(){navigator.serviceWorker.controller.postMessage({type:"ADD_TO_CACHE",cacheName:e,url:t})}};BeFunky.addPassiveListener=(e,t,n)=>{e.addEventListener(t,n,{passive:!0})};BeFunky.removePassiveListener=(e,t,n)=>{e.removeEventListener(t,n,{passive:!0})};BeFunky.isRetina=function(){let e=`
        (-webkit-min-device-pixel-ratio: 1.5),
        (min--moz-device-pixel-ratio: 1.5),
        (-o-min-device-pixel-ratio: 3/2),
        (min-resolution: 1.5dppx)`;if(window.devicePixelRatio>=1.5||window.matchMedia&&window.matchMedia(e).matches){if("chrome"in window){let t=window.outerWidth,n=window.innerWidth,o=t/n;if(o>1.02)return window.devicePixelRatio/o>=1.5}return!0}return!1};BeFunky.setupInfiniteScroll=function(e,{threshold:t=800}={}){let n,o,r;return{listenForScroll:a,recalculateScrollPosition:i};function i(){o=void 0,typeof r=="function"&&r()}function a(l,u){n||(n=e());let s=BeFunky.randomString(5);r&&BeFunky.removePassiveListener(n,"scroll",r),r=BeFunky.throttle(()=>{if(s!==r.id)return;if(l()){BeFunky.removePassiveListener(n,"scroll",r);return}o||(o={scrollHeight:n.scrollHeight,offsetHeight:n.offsetHeight});let{scrollHeight:c,offsetHeight:d}=o,{scrollTop:p}=n,m=c-d-p;if(!c&&!d){o=void 0;return}m<=t&&(BeFunky.removePassiveListener(n,"scroll",r),u())},50),r.id=s,o=void 0,requestAnimationFrame(()=>{l()||(BeFunky.addPassiveListener(n,"scroll",r),r())})}};BeFunky.listenForScroll=function(e,t){let n,o=!1,r=BeFunky.throttle(i,16);return BeFunky.addPassiveListener(e,"scroll",r),r(),{recalculateScrollPosition:a,teardown:l};function i(){if(o)return;n||(n={scrollHeight:e.scrollHeight,offsetHeight:e.offsetHeight});let{scrollHeight:u,offsetHeight:s}=n,{scrollTop:c}=e;if(!u&&!s){n=void 0;return}t({scrollHeight:u,offsetHeight:s,scrollTop:c})}function a(){n=void 0,r()}function l(){o=!0,BeFunky.removePassiveListener(e,"scroll",r)}};BeFunky.addParamsToURL=(e,t,n=!0)=>{let o=e.split("?")[0].split("#")[0],r=Object.entries(t),i=r.length?`?${r.map(([a,l])=>`${a}=${n?encodeURIComponent(l):l}`).join("&")}`:"";return`${o}${i}`};BeFunky.escapeHTML=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");BeFunky.randomIntForUser=()=>{let e=parseInt(BeFunky.getLocal("random-1-100"));return Number.isNaN(e)&&(e=t(1,100),BeFunky.setLocal("random-1-100",e.toString())),e;function t(n,o){return Math.floor(Math.random()*(o-n+1)+n)}};BeFunky.setSentryTag=(e,t)=>{Sentry.configureScope(n=>{n.setTag(e,t)})};BeFunky.wait=(e,t)=>{if(!e.every(i=>["raf","ric"].includes(i)||typeof i=="number"))throw new Error("Invalid timer in timerQueue");let n=()=>{};return o(0),()=>n();function o(i){if(i>=e.length)return t();let a=e[i];["raf","ric"].includes(a)?n=r()[a](()=>o(++i)):n=r().timeout(()=>o(++i),a)}function r(){return{raf:i=>{let a=requestAnimationFrame(i);return()=>cancelAnimationFrame(a)},ric:i=>{let a=requestIdleCallback(i);return()=>cancelIdleCallback(a)},timeout:(i,a)=>{let l=setTimeout(i,a);return()=>clearTimeout(l)}}}};BeFunky.withLoadScreen=function(e,t=!0){return new Promise((n,o)=>{let r=!1;return BeFunky.showLoadScreen({onCancel:t?()=>{r=!0,o("cancelled_by_user")}:void 0}),e.then(i=>{r||BeFunky.hideLoadScreen(),n(i)},i=>{r||BeFunky.hideLoadScreen(),o(i)})})};var{userAgent:Le}=navigator;BeFunky.isEdge=/Edge?\/\d+/.test(Le);BeFunky.isSafari=/^((?!chrome|android).)*safari/i.test(Le);var _i=BeFunky.isSafari?Le.match(/version\/([\d.]+)? safari/i):null;BeFunky.safariVersion=_i?parseFloat(_i[1]):0;BeFunky.isFirefox=/firefox/i.test(Le);var ki=BeFunky.isFirefox?Le.match(/ firefox\/([\d.]+)/i):null;BeFunky.firefoxVersion=ki?parseInt(ki[1]):0;BeFunky.isOpera=/Opera|OPR\//.test(Le);BeFunky.isChromium=Boolean(window.chrome);BeFunky.isChrome=BeFunky.isChromium&&!BeFunky.isOpera&&!BeFunky.isEdge;BeFunky.isChromeOnIOS=/CriOS/.test(Le);var wi=BeFunky.isChromium?Le.match(/ chrome\/([\d.]+)/i):null;BeFunky.chromiumVersion=wi?parseInt(wi[1]):0;BeFunky.isMac=navigator.platform.includes("Mac");BeFunky.isSafariMojave=BeFunky.isSafari&&/Mac OS X 10_14/.test(Le);BeFunky.isAndroid=/(android)/i.test(Le);BeFunky.isIPadOS=navigator.maxTouchPoints>1&&(BeFunky.isMac&&BeFunky.safariVersion>=13||/ipad.*os[_ ]1[3-9]/i.test(Le)||BeFunky.isMac&&BeFunky.isChromeOnIOS);BeFunky.isTablet=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(Le)||BeFunky.isIPadOS;BeFunky.isIOS=/iPad|iPhone|iPod/.test(navigator.platform)||BeFunky.isIPadOS;BeFunky.isWindows=navigator.platform.includes("Win");BeFunky.isChromeOS=/\bCrOS\b/.test(Le);BeFunky.isDropShadowSupported=!(BeFunky.isChromium&&/Mac OS X 10_(10|11)/.test(Le));var Xs=BeFunky.isChromium&&BeFunky.chromiumVersion<=86;BeFunky.isImageBitmapSupported="createImageBitmap"in window&&!Xs&&!BeFunky.isSafari;BeFunky.deviceCategory="desktop";BeFunky.isTablet?BeFunky.deviceCategory="tablet":(BeFunky.isAndroid||BeFunky.isIOS||/mobile/i.test(Le))&&(BeFunky.deviceCategory="mobile");BeFunky.testingFlags=(getCookie("testing_flags")||"").split(",").map(e=>e.trim()).filter(Boolean);BeFunky.testingFlags.length&&console.log("Testing Flags:",BeFunky.testingFlags);var Zt;vi()?(Zt=!0,BeFunky.setLocalSession("is_standalone_mode","yes")):Zt=BeFunky.getLocalSession("is_standalone_mode")==="yes";BeFunky.isTWA=Ys();var bi=Js();BeFunky.isInstalled=()=>Zt||vi()||BeFunky.isTWA||bi;BeFunky.platform="browser";BeFunky.isTWA?BeFunky.platform="play_store":bi?BeFunky.platform="microsoft_store":BeFunky.isInstalled()&&(BeFunky.platform="desktop");function vi(){return Boolean(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)}function Ys(){let e;if(window.location.href.startsWith(BeFunky.Params.pwaStartUrl)&&window.location.hash==="#play-store-twa"?(e=!0,BeFunky.setLocalSession("is_play_store_twa","yes")):e=BeFunky.getLocalSession("is_play_store_twa")==="yes",e){let t={StandaloneMode:Zt,ChromeOS:BeFunky.isChromeOS,getDigitalGoodsService:"getDigitalGoodsService"in window},n=Object.entries(t).filter(([,o])=>!o).map(([o])=>o);n.length&&(e=!1,BeFunky.isChromeOS&&BeFunky.reportWarning(`Play Store TWA detection failed: ${n.join(", ")}`))}return e}function Js(){let e;if(document.referrer==="app-info://platform/microsoft-store"?(e=!0,BeFunky.setLocalSession("is_ms_store_pwa","yes")):e=BeFunky.getLocalSession("is_ms_store_pwa")==="yes",e){let t={StandaloneMode:Zt,Windows:BeFunky.isWindows,Edge:BeFunky.isEdge},n=Object.entries(t).filter(([,o])=>!o).map(([o])=>o);n.length&&BeFunky.reportWarning(`Microsoft Store PWA detection issue: ${n.join(", ")}`)}return e}var Un=(e,t)=>[...e].filter(n=>n instanceof HTMLElement).map(n=>t(n)),Dn=(e,t)=>t(e);NodeList.prototype.setStyles=HTMLCollection.prototype.setStyles=function(e){return Un(this,t=>Object.assign(t.style,e)),this};HTMLElement.prototype.setStyles=function(e){return Dn(this,t=>Object.assign(t.style,e)),this};HTMLElement.prototype.setLang=function(e,t,n){let o=typeof t=="object"?t:void 0;if(n||(n=typeof t=="string"?t:"app"),!BeFunky.LanguageManager)return BeFunky.throwError("setLang called too early"),this;if(this.onLanguageUpdate&&(this.onLanguageUpdate=void 0),o)return this.setAttribute("data-lang",e),BeFunky.LanguageManager.registerElement(this,o,n),this;let r=e;return/^[a-z0-9_!]+$/.test(e)&&(this.setAttribute("data-lang",e),r=BeFunky.LanguageManager.getString(e,n)),this.nodeName==="INPUT"||this.nodeName==="TEXTAREA"?this.setAttribute("placeholder",r):r.includes("<")?this.innerHTML=r:this.textContent=r,this};HTMLElement.prototype.closestParent=function(e){if(e(this))return this;if(!!this.parentElement)return this.parentElement.closestParent(e)};HTMLElement.prototype.hasClass=function(e){return this.classList.contains(e)};HTMLElement.prototype.setClass=function(e){return this.className=e,this};NodeList.prototype.addClass=HTMLCollection.prototype.addClass=function(e){return Un(this,t=>t.classList.add(e)),this};HTMLElement.prototype.addClass=function(e){return Dn(this,t=>t.classList.add(e)),this};NodeList.prototype.removeClass=HTMLCollection.prototype.removeClass=function(e){return Un(this,t=>t.classList.remove(e)),this};HTMLElement.prototype.removeClass=function(e){return Dn(this,t=>t.classList.remove(e)),this};function Fi(e,t){return n=>{typeof t!="boolean"&&(t=!n.classList.contains(e)),t?n.classList.add(e):n.classList.remove(e)}}NodeList.prototype.toggleClass=HTMLCollection.prototype.toggleClass=function(e,t){return Un(this,Fi(e,t)),this};HTMLElement.prototype.toggleClass=function(e,t){return Dn(this,Fi(e,t)),this};Array.prototype.unique=function(){let e=this.concat();for(let t=0;t<e.length;++t)for(let n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e};Array.prototype.shuffle=function(){for(let e,t,n=this.length;n;e=parseInt(Math.random()*n),t=this[--n],this[n]=this[e],this[e]=t);return this};Array.prototype.isIdenticalTo=function(e){if(!Array.isArray(e)||this.length!==e.length)return!1;for(let t=0,n=this.length;t<n;t++)if(Array.isArray(this[t])&&Array.isArray(e[t])){if(!this[t].isIdenticalTo(e[t]))return!1}else if(this[t]!==e[t])return!1;return!0};var Dt=Boolean(window.PointerEvent),Bi=performance.now(),Ks=function(e){if(window.preventPointerMoveThrottling)return;let t=performance.now();t-Bi<16?(e.stopImmediatePropagation(),e.preventDefault()):Bi=t};document.addEventListener(Dt?"pointermove":"mousemove",Ks,!0);BeFunky.pointerover=Dt?"pointerover":"mouseover";BeFunky.pointerout=Dt?"pointerout":"mouseout";BeFunky.pointerdown=Dt?"pointerdown":"mousedown";BeFunky.pointermove=Dt?"pointermove":"mousemove";BeFunky.pointerup=Dt?"pointerup":"mouseup";BeFunky.pointercancel="pointercancel";var Ao={},Pt=null;Object.defineProperty(BeFunky,"globalPointerCoords",{get(){return Pt&&(Ao.x=window.isAppOpen?Pt.pageX:Pt.clientX,Ao.y=window.isAppOpen?Pt.pageY:Pt.clientY),Ao}});Object.defineProperty(BeFunky,"globalPointerEvent",{get(){return Pt}});var Ro=e=>{Pt=e};document.addEventListener(BeFunky.pointerdown,Ro,!0);document.addEventListener(BeFunky.pointermove,Ro,!0);document.addEventListener(BeFunky.pointerup,Ro,!0);BeFunky.isPointerDown=!1;document.addEventListener(BeFunky.pointerdown,e=>{e.isTrusted&&(BeFunky.isPointerDown=!0)},!0);document.addEventListener(BeFunky.pointerup,e=>{e.isTrusted&&(BeFunky.isPointerDown=!1)},!0);document.addEventListener("touchstart",e=>{e.isTrusted&&(BeFunky.isPointerDown=!0)},!0);document.addEventListener("touchend",e=>{e.isTrusted&&(BeFunky.isPointerDown=!1)},!0);if(BeFunky.isChromeOnIOS){let e=window.innerWidth,t=window.innerHeight;window.addEventListener("resize",()=>{e=window.innerWidth,t=window.innerHeight}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{e===window.innerWidth&&t===window.innerHeight||window.dispatchEvent(new Event("resize"))},200)})}BeFunky.isOnline=()=>BeFunky.testingFlags.includes("simulate_offline")?Math.random()>.8:navigator.onLine!==!1;var Pi=()=>{},at;BeFunky.whenOnline=function(){if(BeFunky.isOnline())return Promise.resolve();if(at)return at;let e=!0;BeFunky.logError("User is offline"),setTimeout(()=>{e&&(Pi=BeFunky.acknowledge("user_offline",{isCritical:!0}))},100),at=window.deferredPromise();let t=Date.now();return at.then(n=>{e=!1;let o=Date.now()-t;Pi(),n==="browser"&&(BeFunky.logError(`Browser back online after ${o}`),at=void 0),n==="offline_test"&&(BeFunky.reportWarning("Browser offline but /offline-test/ worked",{latency:o}),setTimeout(()=>{at=void 0},1e3*60))}),Qs(at),Zs(at),at};function Qs(e){window.addEventListener("online",function t(){window.removeEventListener("online",t),e.resolve("browser")})}function Zs(e){let t=new XMLHttpRequest;t.open("GET",`${BeFunky.Params.siteUrl}offline-test/?nocache=${Math.random().toString().split(".")[1]}`),t.onload=function(){this.responseText==="online"&&e.resolve("offline_test")},t.send()}BeFunky.inFlightRequests={};BeFunky.request=function(e,t,n){let{headers:o={},responseType:r="json",method:i="GET",body:a=null,downloadProgressHandler:l,uploadProgressHandler:u,responseHeadersHandler:s,fallbackURLs:c=[],promptToRetryIfOffline:d=!0,logErrorMessage:p=!1}=t,m=typeof t.withCredentials=="boolean"?t.withCredentials:i==="POST";if(!["","arraybuffer","blob","document","json","text"].includes(r))throw new Error(`Invalid responseType: ${BeFunky.stringValue(r)}`);if(!["GET","POST"].includes(i))throw new Error(`Invalid method: ${BeFunky.stringValue(r)}`);if(c.length&&(l||u))throw new Error("Cannot use progress w/ fallbackURLs b/c multiple XHR objects are created");if(Array.isArray(c)&&c.length){let h=n;n=w=>{if(w.hasOwnProperty("error")){BeFunky.logError(`Failed to fetch URL: ${e.split("/").pop()}. Attempting next fallback URL.`,w);let F=t.fallbackURLs.shift();w.offlineRetryCancelled&&(t.promptToRetryIfOffline=!1),BeFunky.request(F,t,h)}else h(w)}}let g=new XMLHttpRequest,{inFlightRequests:f}=BeFunky;g.onload=function(){delete f[e];let{response:h}=this,{status:w}=this;if(r==="json")try{h=JSON.parse(this.responseText)}catch(P){h=null}if(w<200||w>=400){if(h&&typeof h.error=="string")return p&&h.message&&BeFunky.logError("API error name & message:",h.error,h.message),n({error:h.error});if(h&&h.error&&h.error.code&&h.error.message)return n({error:h.error});if(r==="blob"&&h instanceof Blob)return b(h);let P=["","text","json"].includes(r)?this.responseText:h;BeFunky.throwError(`Unexpected ${w} error from ${F()}`,P),n({error:"invalid_response"})}else{if(r==="json"&&!h)return BeFunky.throwError(`Got invalid JSON from ${F()}`,e,this.responseText),n({error:"invalid_response"});h&&h.error&&BeFunky.throwError("Status code does not match response",JSON.stringify({url:e,status:w,response:h})),n({response:h})}function F(){let P=e;return P.startsWith(BeFunky.Params.siteUrl)&&(P=P.replace(BeFunky.Params.siteUrl,"/")),P=P.split("?")[0].split("#")[0],P.length>50&&(P=`${P.slice(0,50)}...`),P}function b(P){E(P).then(T=>{let{error:$}=JSON.parse(T);if(typeof $!="string")throw"no_error_string";return $}).then(T=>n({error:T}),()=>{BeFunky.throwError(`Unexpected ${w} error from ${F()}`,P),n({error:"invalid_response"})})}function E(P){return new Promise((T,$)=>{if(setTimeout(()=>$("timeout"),1e3),typeof P.text=="function")return P.text().then(T,$);let N=new FileReader;N.onload=()=>T(N.result),N.onerror=j=>$(j),N.readAsText(P)})}},typeof s=="function"&&(g.onreadystatechange=function(){if(this.readyState===this.HEADERS_RECEIVED){let h=g.getAllResponseHeaders().trim().split(/[\r\n]+/),w={};h.forEach(F=>{let b=F.split(": "),E=b.shift();w[E]=b.join(": ")}),s(w)}}),g.onerror=_(),g.onabort=_(),g.ontimeout=_();function _(){return function(h){if(delete f[e],d&&!BeFunky.isOnline()&&BeFunky.usingServiceWorker()){console.log("Request failed while offline",{reason:h.type,url:e,errorEvent:h}),el(()=>BeFunky.request(e,t,n),()=>n({error:"request_failed",offlineRetryCancelled:!0}));return}n({error:"request_failed"})}}l&&BeFunky.addProgressHandler(g,l),u&&BeFunky.addProgressHandler(g,u,!0),g.withCredentials=m,g.open(i,e,!0),r!=="json"&&(g.responseType=r),Object.entries(o).forEach(([h,w])=>{g.setRequestHeader(h,w)}),g.wasAborted=!1,g.wasSent=!1;let y=g.abort;return g.abort=function(){g.wasSent?(g.wasAborted=!0,y.call(g)):g.wasAborted||(g.wasAborted=!0,g.onabort())},!BeFunky.isOnline()&&!BeFunky.usingServiceWorker()?BeFunky.whenOnline().then(()=>{g.wasAborted||(g.wasSent=!0,g.send(a))}):(g.wasSent=!0,g.send(a)),f[e]=g,g};var ht=null;function el(e,t){if(ht){ht.confirmHandlers.push(e),ht.cancelHandlers.push(t);return}ht={confirmHandlers:[e],cancelHandlers:[t]},BeFunky.confirm("user_offline",{confirmText:"try_again",onConfirm:()=>{ht.confirmHandlers.forEach(n=>n()),ht=null},onCancel:()=>{ht.cancelHandlers.forEach(n=>n()),ht=null}})}BeFunky.requestAPI=function(e,t={},n={}){let o,r=new Promise((i,a)=>{e.endsWith("/")||(e+="/");let l=`${BeFunky.Params.siteUrl}api/${e}`,u;if(e.startsWith("get/")){let c=Object.entries(t).map(([d,p])=>`${d}=${encodeURIComponent(p)}`).join("&");c&&(l+=`?${c}`),u={method:"GET"}}else{let c=getCsToken();t.CSRFtoken=c,u={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":c,"X-User-Email":window.latestUserData.email||""},body:Object.entries(t).map(([d,p])=>`${d}=${encodeURIComponent(p)}`).join("&")}}let s=Object.assign({},u,n);n.showLoadScreen&&(typeof n.showLoadScreen=="object"?BeFunky.showLoadScreen(n.showLoadScreen):BeFunky.showLoadScreen()),o=BeFunky.request(l,s,({error:c,response:d})=>{if(n.showLoadScreen&&BeFunky.hideLoadScreen(),["already_logged_in","not_logged_in","wrong_user"].includes(c)?BeFunky.UserManager.checkUserToken(c,"API"):BeFunky.UserManager.resetPolling(),c)return a(c);if(!d||!d.data)return a("invalid_response");i(d)})});return r.request=o,r};BeFunky.addProgressHandler=function(e,t,n=!1){!n&&e&&e.onprogress===null?e.onprogress=o:n&&e&&e.upload&&e.upload.onprogress===null&&(e.upload.onprogress=o);function o(r){r&&r.lengthComputable&&t(r.loaded,r.total)}};BeFunky.failureReason=function(e){return typeof e!="string"?`Unknown request error: ${BeFunky.getType(e)}`:e==="not_logged_in"&&BeFunky.isLoggedIn()?BeFunky.LanguageManager.getString("acknowledge_session_expired"):e==="invalid_token"?BeFunky.LanguageManager.getString("error_invalid_csrf_token"):e==="quota_exceeded"?BeFunky.LanguageManager.getString("error_invalid_response"):/^[a-z0-9_]+$/.test(e)?BeFunky.LanguageManager.getString(`error_${e}`):`Error: ${e}`};BeFunky.loadScriptWithXHR=function(e){return new Promise((t,n)=>{BeFunky.request(e,{responseType:"text"},({error:o,response:r})=>{if(o)return n(o);let i=document.createElement("script"),a=document.getElementsByTagName("script")[0].parentElement;i.text=r,a.appendChild(i),t()})})};BeFunky.createFormData=function(e){let t=new FormData;return Object.entries(e).forEach(([n,o])=>{t.append(n,o)}),t};BeFunky.uploadFileToS3=function(e,{bucket:t,contentType:n,fileName:o,progressHandler:r}){let i={cancelUpload:()=>{BeFunky.throwError("cancelUpload called too soon")}},a=new Promise((s,c)=>{l().then(u).then(s,c)});return a.cancelUpload=()=>i.cancelUpload(),a;function l(){let s={bucket:t,content_type:n};o&&(s.filename=o);let c=BeFunky.requestAPI("direct-upload",s);return i.cancelUpload=()=>c.request.abort(),c.then(d=>{let{url:p,inputs:m}=d.data;if(!p||!m)throw"invalid_response";return{url:p,inputs:m}})}function u({url:s,inputs:c}){let d={method:"POST",body:BeFunky.createFormData(Object.assign({},c,{file:e})),withCredentials:!1,responseType:"text",uploadProgressHandler:r};return new Promise((p,m)=>{let g=BeFunky.request(s,d,({error:f,response:_})=>{if(f)return m(f);let y;try{let h=new window.DOMParser().parseFromString(_,"text/xml");if(y={url:decodeURIComponent(h.querySelector("Location").textContent),name:decodeURIComponent(h.querySelector("Key").textContent)},!y.url||!y.name)throw"missing_data"}catch(h){return BeFunky.throwError("Invalid XML response from S3",h,_),m("invalid_response")}return p(y)});i.cancelUpload=()=>g.abort()})}};BeFunky.loadScript=(e,t=()=>!1)=>new Promise((n,o)=>{if(t())return n();let r=document.createElement("script");r.src=e,r.onload=()=>n(),r.onerror=()=>{BeFunky.logError("Failed to load script:",e),o("request_failed")};let i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)});var Si=new WeakMap,st=e=>(...t)=>{let n=e(...t);return Si.set(n,!0),n},St=e=>typeof e=="function"&&Si.has(e);var Mo=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0;var en=(e,t,n=null)=>{for(;t!==n;){let o=t.nextSibling;e.removeChild(t),t=o}};var Ne={},jn={};var Ze=`{{lit-${String(Math.random()).slice(2)}}}`,Uo=`<!--${Ze}-->`,Li=new RegExp(`${Ze}|${Uo}`),jt="$lit$",On=class{constructor(t,n){this.parts=[],this.element=n;let o=[],r=[],i=document.createTreeWalker(n.content,133,null,!1),a=0,l=-1,u=0,{strings:s,values:{length:c}}=t;for(;u<c;){let d=i.nextNode();if(d===null){i.currentNode=r.pop();continue}if(l++,d.nodeType===1){if(d.hasAttributes()){let p=d.attributes,{length:m}=p,g=0;for(let f=0;f<m;f++)Ci(p[f].name,jt)&&g++;for(;g-- >0;){let f=s[u],_=Nn.exec(f)[2],y=_.toLowerCase()+jt,h=d.getAttribute(y);d.removeAttribute(y);let w=h.split(Li);this.parts.push({type:"attribute",index:l,name:_,strings:w}),u+=w.length-1}}d.tagName==="TEMPLATE"&&(r.push(d),i.currentNode=d.content)}else if(d.nodeType===3){let p=d.data;if(p.indexOf(Ze)>=0){let m=d.parentNode,g=p.split(Li),f=g.length-1;for(let _=0;_<f;_++){let y,h=g[_];if(h==="")y=et();else{let w=Nn.exec(h);w!==null&&Ci(w[2],jt)&&(h=h.slice(0,w.index)+w[1]+w[2].slice(0,-jt.length)+w[3]),y=document.createTextNode(h)}m.insertBefore(y,d),this.parts.push({type:"node",index:++l})}g[f]===""?(m.insertBefore(et(),d),o.push(d)):d.data=g[f],u+=f}}else if(d.nodeType===8)if(d.data===Ze){let p=d.parentNode;(d.previousSibling===null||l===a)&&(l++,p.insertBefore(et(),d)),a=l,this.parts.push({type:"node",index:l}),d.nextSibling===null?d.data="":(o.push(d),l--),u++}else{let p=-1;for(;(p=d.data.indexOf(Ze,p+1))!==-1;)this.parts.push({type:"node",index:-1}),u++}}for(let d of o)d.parentNode.removeChild(d)}},Ci=(e,t)=>{let n=e.length-t.length;return n>=0&&e.slice(n)===t},Do=e=>e.index!==-1,et=()=>document.createComment(""),Nn=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var tn=class{constructor(t,n,o){this.__parts=[],this.template=t,this.processor=n,this.options=o}update(t){let n=0;for(let o of this.__parts)o!==void 0&&o.setValue(t[n]),n++;for(let o of this.__parts)o!==void 0&&o.commit()}_clone(){let t=Mo?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),n=[],o=this.template.parts,r=document.createTreeWalker(t,133,null,!1),i=0,a=0,l,u=r.nextNode();for(;i<o.length;){if(l=o[i],!Do(l)){this.__parts.push(void 0),i++;continue}for(;a<l.index;)a++,u.nodeName==="TEMPLATE"&&(n.push(u),r.currentNode=u.content),(u=r.nextNode())===null&&(r.currentNode=n.pop(),u=r.nextNode());if(l.type==="node"){let s=this.processor.handleTextExpression(this.options);s.insertAfterNode(u.previousSibling),this.__parts.push(s)}else this.__parts.push(...this.processor.handleAttributeExpressions(u,l.name,l.strings,this.options));i++}return Mo&&(document.adoptNode(t),customElements.upgrade(t)),t}};var nl=` ${Ze} `,Ot=class{constructor(t,n,o,r){this.strings=t,this.values=n,this.type=o,this.processor=r}getHTML(){let t=this.strings.length-1,n="",o=!1;for(let r=0;r<t;r++){let i=this.strings[r],a=i.lastIndexOf("<!--");o=(a>-1||o)&&i.indexOf("-->",a+1)===-1;let l=Nn.exec(i);l===null?n+=i+(o?nl:Uo):n+=i.substr(0,l.index)+l[1]+l[2]+jt+l[3]+Ze}return n+=this.strings[t],n}getTemplateElement(){let t=document.createElement("template");return t.innerHTML=this.getHTML(),t}};var Hn=e=>e===null||!(typeof e=="object"||typeof e=="function"),jo=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),nn=class{constructor(t,n,o){this.dirty=!0,this.element=t,this.name=n,this.strings=o,this.parts=[];for(let r=0;r<o.length-1;r++)this.parts[r]=this._createPart()}_createPart(){return new yt(this)}_getValue(){let t=this.strings,n=t.length-1,o="";for(let r=0;r<n;r++){o+=t[r];let i=this.parts[r];if(i!==void 0){let a=i.value;if(Hn(a)||!jo(a))o+=typeof a=="string"?a:String(a);else for(let l of a)o+=typeof l=="string"?l:String(l)}}return o+=t[n],o}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},yt=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==Ne&&(!Hn(t)||t!==this.value)&&(this.value=t,St(t)||(this.committer.dirty=!0))}commit(){for(;St(this.value);){let t=this.value;this.value=Ne,t(this)}this.value!==Ne&&this.committer.commit()}},_t=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(et()),this.endNode=t.appendChild(et())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=et()),t.__insert(this.endNode=et())}insertAfterPart(t){t.__insert(this.startNode=et()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;St(this.__pendingValue);){let n=this.__pendingValue;this.__pendingValue=Ne,n(this)}let t=this.__pendingValue;t!==Ne&&(Hn(t)?t!==this.value&&this.__commitText(t):t instanceof Ot?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):jo(t)?this.__commitIterable(t):t===jn?(this.value=jn,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let n=this.startNode.nextSibling;t=t==null?"":t;let o=typeof t=="string"?t:String(t);n===this.endNode.previousSibling&&n.nodeType===3?n.data=o:this.__commitNode(document.createTextNode(o)),this.value=t}__commitTemplateResult(t){let n=this.options.templateFactory(t);if(this.value instanceof tn&&this.value.template===n)this.value.update(t.values);else{let o=new tn(n,t.processor,this.options),r=o._clone();o.update(t.values),this.__commitNode(r),this.value=o}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let n=this.value,o=0,r;for(let i of t)r=n[o],r===void 0&&(r=new _t(this.options),n.push(r),o===0?r.appendIntoPart(this):r.insertAfterPart(n[o-1])),r.setValue(i),r.commit(),o++;o<n.length&&(n.length=o,this.clear(r&&r.endNode))}clear(t=this.startNode){en(this.startNode.parentNode,t.nextSibling,this.endNode)}},qn=class{constructor(t,n,o){if(this.value=void 0,this.__pendingValue=void 0,o.length!==2||o[0]!==""||o[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=n,this.strings=o}setValue(t){this.__pendingValue=t}commit(){for(;St(this.__pendingValue);){let n=this.__pendingValue;this.__pendingValue=Ne,n(this)}if(this.__pendingValue===Ne)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=Ne}},Wn=class extends nn{constructor(t,n,o){super(t,n,o);this.single=o.length===2&&o[0]===""&&o[1]===""}_createPart(){return new on(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},on=class extends yt{},Ei=!1;(()=>{try{let e={get capture(){return Ei=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();var Vn=class{constructor(t,n,o){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=n,this.eventContext=o,this.__boundHandleEvent=r=>this.handleEvent(r)}setValue(t){this.__pendingValue=t}commit(){for(;St(this.__pendingValue);){let i=this.__pendingValue;this.__pendingValue=Ne,i(this)}if(this.__pendingValue===Ne)return;let t=this.__pendingValue,n=this.value,o=t==null||n!=null&&(t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive),r=t!=null&&(n==null||o);o&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=ol(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=Ne}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},ol=e=>e&&(Ei?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var Oo=class{handleAttributeExpressions(t,n,o,r){let i=n[0];return i==="."?new Wn(t,n.slice(1),o).parts:i==="@"?[new Vn(t,n.slice(1),r.eventContext)]:i==="?"?[new qn(t,n.slice(1),o)]:new nn(t,n,o).parts}handleTextExpression(t){return new _t(t)}},No=new Oo;function Ho(e){let t=qo.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},qo.set(e.type,t));let n=t.stringsArray.get(e.strings);if(n!==void 0)return n;let o=e.strings.join(Ze);return n=t.keyString.get(o),n===void 0&&(n=new On(e,e.getTemplateElement()),t.keyString.set(o,n)),t.stringsArray.set(e.strings,n),n}var qo=new Map;var Wo=new WeakMap,Lt=(e,t,n)=>{let o=Wo.get(t);o===void 0&&(en(t,t.firstChild),Wo.set(t,o=new _t(Object.assign({templateFactory:Ho},n))),o.appendInto(t)),o.setValue(e),o.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.2.1");var kt=(e,...t)=>new Ot(e,t,"html",No);var Vo=new WeakMap,Gn=st(e=>t=>{let n=Vo.get(t);if(e===void 0&&t instanceof yt){if(n!==void 0||!Vo.has(t)){let o=t.committer.name;t.committer.element.removeAttribute(o)}}else e!==n&&t.setValue(e);Vo.set(t,e)});var xi=new WeakMap,$i=st(e=>t=>{if(!(t instanceof yt)||t instanceof on||t.committer.name!=="style"||t.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");let{committer:n}=t,{style:o}=n.element,r=xi.get(t);r===void 0&&(o.cssText=n.strings.join(" "),xi.set(t,r=new Set)),r.forEach(i=>{i in e||(r.delete(i),i.indexOf("-")===-1?o[i]=null:o.removeProperty(i))});for(let i in e)r.add(i),i.indexOf("-")===-1?o[i]=e[i]:o.setProperty(i,e[i])});var rn,Ii=0;function Go(e){rn=e}function zo(){rn=null,Ii=0}function Ti(){return Ii++}var zn=Symbol("haunted.phase"),an=Symbol("haunted.hook"),Xo=Symbol("haunted.update"),Yo=Symbol("haunted.commit"),lt=Symbol("haunted.effects"),Ct=Symbol("haunted.layoutEffects"),sn="haunted.context";var Xn=class{constructor(t,n){this.update=t,this.host=n,this[an]=new Map,this[lt]=[],this[Ct]=[]}run(t){Go(this);let n=t();return zo(),n}_runEffects(t){let n=this[t];Go(this);for(let o of n)o.call(this);zo()}runEffects(){this._runEffects(lt)}runLayoutEffects(){this._runEffects(Ct)}teardown(){this[an].forEach(n=>{typeof n.teardown=="function"&&n.teardown()})}};var il=Promise.resolve().then.bind(Promise.resolve());function Ai(){let e=[],t;function n(){t=null;let o=e;e=[];for(var r=0,i=o.length;r<i;r++)o[r]()}return function(o){e.push(o),t==null&&(t=il(n))}}var al=Ai(),Ri=Ai(),Nt=class{constructor(t,n){this.renderer=t,this.host=n,this.state=new Xn(this.update.bind(this),n),this[zn]=null,this._updateQueued=!1}update(){this._updateQueued||(al(()=>{let t=this.handlePhase(Xo);Ri(()=>{this.handlePhase(Yo,t),Ri(()=>{this.handlePhase(lt)})}),this._updateQueued=!1}),this._updateQueued=!0)}handlePhase(t,n){switch(this[zn]=t,t){case Yo:this.commit(n),this.runEffects(Ct);return;case Xo:return this.render();case lt:return this.runEffects(lt)}this[zn]=null}render(){return this.state.run(()=>this.renderer.call(this.host,this.host))}runEffects(t){this.state._runEffects(t)}teardown(){this.state.teardown()}};var sl=(e="")=>e.replace(/-+([a-z])?/g,(t,n)=>n?n.toUpperCase():"");function Mi(e){class t extends Nt{constructor(r,i,a){super(r,a||i);this.frag=i}commit(r){e(r,this.frag)}}function n(o,r,i){let a=(i||r||{}).baseElement||HTMLElement,{observedAttributes:l=[],useShadowDOM:u=!0,shadowRootInit:s={}}=i||r||{};class c extends a{constructor(){super();u===!1?this._scheduler=new t(o,this):(this.attachShadow(ze({mode:"open"},s)),this._scheduler=new t(o,this.shadowRoot,this))}static get observedAttributes(){return o.observedAttributes||l||[]}connectedCallback(){this._scheduler.update()}disconnectedCallback(){this._scheduler.teardown()}attributeChangedCallback(g,f,_){if(f===_)return;let y=_===""?!0:_;Reflect.set(this,sl(g),y)}}function d(m){let g=m,f=!1;return Object.freeze({enumerable:!0,configurable:!0,get(){return g},set(_){f&&g===_||(f=!0,g=_,this._scheduler.update())}})}let p=new Proxy(a.prototype,{getPrototypeOf(m){return m},set(m,g,f,_){let y;return g in m?(y=Object.getOwnPropertyDescriptor(m,g),y&&y.set?(y.set.call(_,f),!0):(Reflect.set(m,g,f,_),!0)):(typeof g=="symbol"||g[0]==="_"?y={enumerable:!0,configurable:!0,writable:!0,value:f}:y=d(f),Object.defineProperty(_,g,y),y.set&&y.set.call(_,f),!0)}});return Object.setPrototypeOf(c.prototype,p),c}return n}var Ae=class{constructor(t,n){this.id=t,this.state=n}};function ll(e,...t){let n=Ti(),o=rn[an],r=o.get(n);return r||(r=new e(n,rn,...t),o.set(n,r)),r.update(...t)}function He(e){return ll.bind(null,e)}function Yn(e){return He(class extends Ae{constructor(t,n,o,r){super(t,n);e(n,this)}update(t,n){this.callback=t,this.values=n}call(){(!this.values||this.hasChanged())&&this.run(),this.lastValues=this.values}run(){this.teardown(),this._teardown=this.callback.call(this.state)}teardown(){typeof this._teardown=="function"&&this._teardown()}hasChanged(){return!this.lastValues||this.values.some((t,n)=>this.lastValues[n]!==t)}})}function Jo(e,t){e[lt].push(t)}var Ko=Yn(Jo);var Qo=He(class extends Ae{constructor(e,t,n){super(e,t);this._updater=this._updater.bind(this),this._ranEffect=!1,this._unsubscribe=null,Jo(t,this)}update(e){if(this.state.virtual)throw new Error("can't be used with virtual components");return this.Context!==e&&(this._subscribe(e),this.Context=e),this.value}call(){this._ranEffect||(this._ranEffect=!0,this._unsubscribe&&this._unsubscribe(),this._subscribe(this.Context),this.state.update())}_updater(e){this.value=e,this.state.update()}_subscribe(e){let t={Context:e,callback:this._updater};this.state.host.dispatchEvent(new CustomEvent(sn,{detail:t,bubbles:!0,cancelable:!0,composed:!0}));let{unsubscribe:n=null,value:o}=t;this.value=n?o:e.defaultValue,this._unsubscribe=n}teardown(){this._unsubscribe&&this._unsubscribe()}});function Ui(e){return t=>{let n={Provider:class extends HTMLElement{constructor(){super();this.listeners=new Set,this.addEventListener(sn,this)}disconnectedCallback(){this.removeEventListener(sn,this)}handleEvent(o){let{detail:r}=o;r.Context===n&&(r.value=this.value,r.unsubscribe=this.unsubscribe.bind(this,r.callback),this.listeners.add(r.callback),o.stopPropagation())}unsubscribe(o){this.listeners.delete(o)}set value(o){this._value=o;for(let r of this.listeners)r(o)}get value(){return this._value}},Consumer:e(function({render:o}){let r=Qo(n);return o(r)}),defaultValue:t};return n}}var ln=He(class extends Ae{constructor(e,t,n,o){super(e,t);this.value=n(),this.values=o}update(e,t){return this.hasChanged(t)&&(this.values=t,this.value=e()),this.value}hasChanged(e=[]){return e.some((t,n)=>this.values[n]!==t)}});function cl(e,t){e[Ct].push(t)}var Jn=Yn(cl);var Kn=He(class extends Ae{constructor(e,t,n){super(e,t);this.updater=this.updater.bind(this),typeof n=="function"&&(n=n()),this.makeArgs(n)}update(){return this.args}updater(e){if(typeof e=="function"){let t=e,[n]=this.args;e=t(n)}this.makeArgs(e),this.state.update()}makeArgs(e){this.args=Object.freeze([e,this.updater])}});var Ag=Promise.resolve();var ul=He(class extends Ae{constructor(e,t,n,o,r){super(e,t);this.dispatch=this.dispatch.bind(this),this.currentState=r!==void 0?r(o):o}update(e){return this.reducer=e,[this.currentState,this.dispatch]}dispatch(e){this.currentState=this.reducer(this.currentState,e),this.state.update()}});function Zo({render:e}){let t=Mi(e),n=Ui(t);return{component:t,createContext:n}}var Di=Array.prototype.includes;function ji(){let e=new WeakMap,t=new WeakMap;class n extends Nt{constructor(i,a){super(i,a);this.state.virtual=!0}render(){return this.state.run(()=>this.renderer.apply(this.host,this.args))}commit(i){this.host.setValue(i),this.host.commit()}teardown(){super.teardown();let i=t.get(this);e.delete(i)}}function o(r){function i(...a){return l=>{let u=e.get(l);u||(u=new n(r,l),e.set(l,u),t.set(u,l),er(u,l)),u.args=a,u.update()}}return st(i)}return o}function er(e,t,n=t.startNode){let o=n.parentNode,r=new MutationObserver(i=>{for(let a of i)if(Di.call(a.removedNodes,n)){r.disconnect(),n.parentNode instanceof ShadowRoot?er(e,t):e.teardown();break}else if(Di.call(a.addedNodes,n.nextSibling)){r.disconnect(),er(e,t,n.nextSibling||void 0);break}});r.observe(o,{childList:!0})}var{component:Qn,createContext:dl}=Zo({render:Lt}),pl=ji();var Oi=e=>Boolean(e&&e.getHTML&&e.getTemplateElement),Zn=(e,t,n=!1)=>{if(Array.isArray(e)){let[r,i]=e;return n?BeFunky.LanguageManager.getStringReplacements(r,i,t):hl(r,i,t)}let o=BeFunky.LanguageManager.getString(e,t);return n?o:kt([o])},gl=(e,t)=>Zn(e,"app",t),fl=(e,t)=>Zn(e,"site",t),ml=(e,t)=>Zn(e,"modal",t);function hl(e,t,n){let o=[],r=BeFunky.LanguageManager.getString(e,n),i=r.split(/({{[a-z0-9_!]+}})/i);for(let a=0;a<i.length;a++){let l=i[a];if(l.startsWith("{{")){let u=l.replace(/[{}]/g,""),s=t[u];typeof s=="function"&&(s=s(u,n)),typeof s=="string"?a===0?(i[a]=s+(i[a+1]||""),i.splice(a+1,1)):(i[a-1]=(i[a-1]||"")+s+(i[a+1]||""),i.splice(a,2),a-=1):(Oi(s)||BeFunky.throwError(`Invalid template replacement for {{${u}}} in ${e}: ${BeFunky.getType(s)}`),o.push(s),i.splice(a,1))}}if(t.hasOwnProperty("suffix")&&!r.includes("{{suffix}}")){let a=i.pop(),l=t.suffix;typeof l=="function"&&(l=l("suffix",n)),typeof l!="string"&&BeFunky.throwError(`Invalid suffix for ${e}: ${BeFunky.getType(l)}`,l),i.push(`${a} ${l}`)}return kt(i,...o)}var yl=(e,t)=>{let n=document.createElement("string");return Array.isArray(e)?n.setLang(e[0],e[1],t):n.setLang(e,t),n},_l=st((e,t)=>n=>n.committer.element.setAttributeNS(e,n.committer.name,t)),kl=(e,t="icon",{style:n,tooltip:o}={})=>kt`<svg class="${t}" style=${Gn(n)} data-tooltip=${Gn(o)}>
        <use xlink:href="${_l("http://www.w3.org/1999/xlink",`#${e}`)}"></use>
    </svg>`,wl=(...e)=>{let t=document.createElement("div");return Lt(kt(...e),t),t.firstElementChild},bl=(e,t)=>{let n={},o={};Object.entries(e).forEach(([a,l])=>{n[a]=l,Object.defineProperty(o,a,{get(){return n[a]}})});let r=(a,l)=>{let u=!1,s={};return Object.entries(l).forEach(([c,d])=>{a.hasOwnProperty(c)?d!==a[c]&&(u=!0,s[c]=[a[c],d],a[c]=d):BeFunky.throwError(`Invalid state property "${c}"`,Object.keys(a),Object.keys(l))}),{hasUpdated:u,updates:s}},i=a=>{let{hasUpdated:l,updates:u}=r(n,a);l&&t(u)};return t({}),[o,i]};function vl(e,t,n={}){try{customElements.define(e,Qn(t,ze({useShadowDOM:!1},n)))}catch(o){BeFunky.throwError(o,`Unable to setup <${e}>`)}}var Fl=He(class extends Ae{constructor(e,t,n){super(e,t);this.isTornDown=!1;let{contexts:o}=BeFunky.LanguageManager;if(!o.includes(n))throw new Error(`Invalid useLanguageUpdate context: ${n}. Should be one of these: ${o.join(", ")}.`);this.languageContext=n,this.onLanguageChange=this.onLanguageChange.bind(this),BeFunky.LanguageManager.addLanguageUpdateListener(this.onLanguageChange)}onLanguageChange(e){e.includes(this.languageContext)&&this.state.update()}update(e){this.isTornDown&&(BeFunky.LanguageManager.addLanguageUpdateListener(this.onLanguageChange),this.isTornDown=!1);let t=BeFunky.LanguageManager.language[this.languageContext],n=BeFunky.LanguageManager.loadedLanguages.includes(t);return`${t}-${n}`}teardown(){this.isTornDown=!0,BeFunky.LanguageManager.removeLanguageUpdateListener(this.onLanguageChange)}});BeFunky.lit={isTemplateResult:Oi,icon:kl,elem:wl,html:kt,string:yl,setupState:bl,render:Lt,ifDefined:Gn,styleMap:$i,lang:Zn,appLang:gl,siteLang:fl,modalLang:ml,component:Qn,useState:Kn,useMemo:ln,useEffect:Ko,useLayoutEffect:Jn,useLanguageUpdate:Fl,defineCustomElement:vl};var Ni=class{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.appLanguages=["en","es","pt","fr","de","it","tr","zh","ja","ko","ru","no","ar"],this.siteLanguages=["en","es","pt","fr","de","it"],this.contexts=["app","site","modal"],this.isDocumentReady=!1,BeFunky.onDocumentReady(()=>{this.isDocumentReady=!0}),this.languageData=this.appLanguages.reduce((i,a)=>(i[a]={},i),{}),this.languageUpdateListeners=[],this.loadingPromises={},this.loadedLanguages=[],this.queueLanguageRender=BeFunky.debounce(this.renderLanguageStrings.bind(this),"raf"),this.defaultLanguage="en";let t=getCookie("lang"),n=document.documentElement.lang,o=[t,n,this.defaultLanguage].find(i=>this.appLanguages.includes(i)),r;document.documentElement.getAttribute("data-use-app-lang")==="true"?r=o:r=[n,this.defaultLanguage].find(i=>this.appLanguages.includes(i)),this._language={app:o,site:r,modal:r},this.loadLanguage(r).then(()=>this.queueLanguageRender(),()=>{}),this.loadLanguage(o).then(()=>this.queueLanguageRender(),()=>{}),requestIdleCallback(()=>{[o,r].includes(this.defaultLanguage)||this.loadLanguage(this.defaultLanguage).catch(()=>{}),this.handleBrowserLanguage()})}loadLanguage(t){if(!this.appLanguages.includes(t))throw new Error("Invalid language ID");if(this.loadingPromises[t])return this.loadingPromises[t];let n=`${t}${BeFunky.Params.languageVersions[t]}.json`,o=`${BeFunky.Params.globalAssetsPath}languages/all/${n}`,r=new Promise((i,a)=>{BeFunky.request(o,{},({response:l,error:u})=>{if(u||!l||typeof l!="object")return this.loadingPromises[t]=void 0,BeFunky.logError(`Unable to get translations for language "${t}"`,u||"invalid_response"),a(u||"invalid_response");this.languageData[t]=l,this.loadedLanguages.push(t),i(l)})});return this.loadingPromises[t]=r,r}setLanguage(t,n){if(!this.appLanguages.includes(t))throw new Error("Invalid language ID");if(!Array.isArray(n)||!n.every(r=>this.contexts.includes(r)))throw new Error("Invalid language context");n.forEach(r=>{this._language[r]!==t&&(this._language[r]=t,this.loadLanguage(t).then(()=>this.queueLanguageRender(),()=>{}))});let o=window.isAppOpen?this._language.app:this._language.site;this.language.modal!==o&&(this._language.modal=o,this.loadLanguage(o).then(()=>this.queueLanguageRender(),()=>{})),n.includes("app")&&(window.BFN&&BFN.SettingsManager?BFN.SettingsManager.updateSetting("language",this.language.app):BeFunky.SettingsService&&BeFunky.SettingsService.updateSetting("language",this.language.app),BeFunky.User.language=this.language.app)}handleBrowserLanguage(){if(getCookie("lang"))return;let t;try{t=navigator.language.substr(0,2)}catch(o){}if(!this.appLanguages.includes(t)||t===this.language.app||t===this.language.site)return;let n=async()=>{await this.loadLanguage(t);let o=this.getLanguageNames().find(({id:r})=>r===t).name;o!=="English"&&(o=o.toLowerCase()),BeFunky.showToast({message:this.getStringReplacements("view_in_language",{language:o},t),button:this.getString("change_language",t),onAccept:()=>{BeFunky.LanguageManager.setLanguage(t,["app","site"])}})};BeFunky.isDashboard()||BeFunky.html5app_created?n():window.addEventListener("INIT_COMPLETE",n)}renderLanguageStrings(t){if(!this.isDocumentReady)return this.queueLanguageRender();this.lastRender=this.lastRender||{app:"",site:"",modal:""};let n=[];if(Object.entries(this.lastRender).forEach(([i,a])=>{let l=this.language[i];if(l!==a){if(i==="app"&&!BeFunky.appTemplateInjected||!this.loadedLanguages.includes(l))return;r(o(i),i),this.lastRender[i]=l,n.push(i),i==="app"&&window.BFN&&BFN.appContainer&&BFN.appContainer.removeClass(`app-lang-${a}`).addClass(`app-lang-${l}`)}}),!n.length)return;this.languageUpdateListeners.forEach(i=>{i(n)});function o(i){if(i==="app")return t?[...t.querySelectorAll("[data-lang]")]:[...document.querySelectorAll("#bfn-app [data-lang]")];if(i==="site")return[...document.querySelectorAll("#site_root [data-lang]")];if(i==="modal")return[...document.querySelectorAll(".modal [data-lang], .dialog [data-lang]")]}function r(i,a){i.forEach(l=>{if(typeof l.onLanguageUpdate=="function"){l.onLanguageUpdate();return}let u=l.getAttribute("data-lang");if(u.startsWith("<")){l.innerHTML=u;return}let s=BeFunky.LanguageManager.getString(u,a);l.nodeName==="INPUT"||l.nodeName==="TEXTAREA"?l.setAttribute("placeholder",s):s.includes("<")?l.innerHTML=s:l.textContent=s})}}registerElement(t,n,o){if(!t||!t.dataset.lang)return BeFunky.logError("Element must have a data-lang attribute.");let r=t.dataset.lang;t.onLanguageUpdate=()=>{t.innerHTML=this.getStringReplacements(r,n,o)},t.onLanguageUpdate()}getString(t,n="app"){if(typeof t!="string")return BeFunky.throwError(`${BeFunky.getType(t)} passed to LanguageManger.getString`,t),"";let o;if(this.contexts.includes(n))o=this.language[n];else if(this.appLanguages.includes(n))o=n;else return BeFunky.throwError(`Invalid context/language "${n}" passed to LanguageManger.getString`),"";let r=this.languageData[o][t];if(r)return r;if(o!==this.defaultLanguage){let a=this.languageData[this.defaultLanguage][t];if(a)return a}if(!/^[a-z0-9_!]+$/.test(t))return t;return i();function i(){return t.split("_").map(a=>a==="dlx"?"DLX":a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}}isTranslated(t,n="app"){return!!this.languageData[this.language[n]][t]}getStringReplacements(t,n,o){let r=this.getString(t,o);return Object.keys(n).forEach(i=>{let a=n[i];if(typeof a=="function"&&(a=a(i,o)),typeof a!="string")return BeFunky.throwError(`Invalid string replacement for {{${i}}} in ${t}: ${BeFunky.getType(a)}`,a);r=r.split(`{{${i}}}`).join(a),i==="suffix"&&!r.includes("{{suffix}}")&&(r=`${r} ${a}`)}),r}addLanguageUpdateListener(t){this.languageUpdateListeners.includes(t)||this.languageUpdateListeners.push(t)}removeLanguageUpdateListener(t){let n=this.languageUpdateListeners.indexOf(t);n!==-1&&this.languageUpdateListeners.splice(n,1)}getLanguageNames(){return[{id:"en",name:"English"},{id:"es",name:"Espa\xF1ol"},{id:"fr",name:"Fran\xE7ais"},{id:"de",name:"Deutsch"},{id:"no",name:"Norsk"},{id:"pt",name:"Portugu\xEAs"},{id:"it",name:"Italiano"},{id:"tr",name:"T\xFCrk\xE7e"},{id:"ru",name:"P\u0443\u0441\u0441\u043A\u0438\u0439"},{id:"zh",name:"\u4E2D\u6587\uFF08\u7B80\u4F53\uFF09"},{id:"ja",name:"\u65E5\u672C\u8A9E"},{id:"ko",name:"\uD55C\uAD6D\uC5B4"},{id:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629/\u0639\u0631\u0628\u064A"}]}handleUserUpdateLanguage(t){this.setLanguage(t,["app"]),window.BFN&&BFN.BfnService&&BFN.BfnService.track("CREATE","LANGUAGE",this.language.app.toUpperCase())}get language(){return this._language}};BeFunky.LanguageManager=new Ni;var Hi=["#E14A43","#FB9F39","#F5E949","#B7D93F","#67C369","#6A91CD","#966DB8","#CF6399"],qi=[0,2,4,6,1,3,5,7],tt=24,eo=Math.sqrt(Math.pow(tt,2)/2);function Bl(){Pl.call(this),Sl.call(this),Ll.call(this)}function Pl(){this.animationFactor=0,this.running=!1,this.active=!1,this.show=Cl.bind(this),this.hide=El.bind(this),this.style.position="relative",this.style.pointerEvents="none",this.style.width=`${tt*2}px`,this.style.height=`${tt*2}px`,this.style.display="none"}function Sl(){this.bladeContainer=document.createElement("div"),this.bladeContainer.style.position="absolute",this.bladeContainer.style.left=`${tt}px`,this.bladeContainer.style.top=`${tt}px`,this.appendChild(this.bladeContainer)}function Ll(){this.bladeHolders=[];for(let e=0;e<qi.length;e++){let t=qi[e],n=Hi[t],o=t/Hi.length*(Math.PI*2),r=document.createElement("div");r.id=`blade_holder_${t}`,r.style.position="absolute",r.style.left=`${Math.cos(o)*tt-Math.cos(o+Math.PI/2)*(tt/1.5)}px`,r.style.top=`${Math.sin(o)*tt-Math.sin(o+Math.PI/2)*(tt/1.5)}px`,this.bladeContainer.appendChild(r),this.bladeHolders.push(r);let i=document.createElement("div");i.id=`blade_${t}`,i.style.position="absolute",i.style.transform=`rotate(${o*(180/Math.PI)}deg)`,r.appendChild(i);let a=document.createElement("div");a.id=`blade_graphic_${t}`,a.style.position="absolute",a.style.backgroundColor="rgba(0,0,0,0)",a.style.transform="rotate(-45deg)",a.style.left=`-${eo}px`,a.style.bottom=`-${tt+eo}px`,a.style.border=`${eo+1}px solid rgba(0,0,0,0)`,a.style.borderTop=`${eo+1}px solid ${n}`,a.style.opacity=.8,i.appendChild(a)}}function Cl(){this.style.display="block",this.bladeContainer.classList.add("animate-iris-blade-container");for(let e=0;e<this.bladeHolders.length;e++)this.bladeHolders[e].classList.add("animate-iris-blade-holder")}function El(){this.style.display="none",this.bladeContainer.classList.remove("animate-iris-blade-container");for(let e=0;e<this.bladeHolders.length;e++)this.bladeHolders[e].classList.remove("animate-iris-blade-holder")}function Wi(e){Bl.call(e)}var{containerElement:to,irisElement:Vi,messageElement:tr}=Al(),Gi="load-screen--active",Ht=!1,zi=!1,no="",Xi,oo=!1,nr,Et,Yi;function xl({message:e="",showIris:t=!0,progress:n="",isCancellable:o=!0,onCancel:r}={}){Ht=!0;let i="";e&&(i+=Qi(e)),typeof n=="number"&&(n=`${n}%`),typeof n=="string"&&n&&(i+=` <strong class="load-screen__progress">${n}</strong>`),tr.innerHTML=i,no=e,Ki(t),!e&&!t&&BeFunky.throwError("Please specify a message when hiding the load screen iris"),to.addClass(Gi);let a=Date.now();Yi={lastProgressTime:a,lastProgressValue:0,loadSpeed:0,lastDisplayTime:a,lastDisplayValue:0,animationFrame:null},Il(o,r)}function Ji(){!Ht||(Ht=!1,to.removeClass(Gi),tr.innerHTML="",no="",Ki(!1),typeof Et=="function"&&Et())}function $l(e,t,n=0){if(!a())return;if(t=Math.round(t),Number.isNaN(t)||t<0||t>100)return BeFunky.throwError("Invalid load screen percentage",t);let o=Yi;cancelAnimationFrame(o.animationFrame);let r=Date.now();o.loadSpeed=(t-o.lastProgressValue)/(r-o.lastProgressTime),o.lastProgressValue=t,o.lastProgressTime=r,o.lastDisplayValue||(o.lastDisplayTime=r),i();function i(){o.animationFrame=requestAnimationFrame(()=>{if(!a())return;let l=Date.now(),u=Math.min(1,Math.round(o.loadSpeed*(l-o.lastDisplayTime))),s=Math.min(o.lastProgressValue,Math.max(n,o.lastDisplayValue+u));s>o.lastDisplayValue&&(tr.innerHTML=`${Qi(e)} <strong class="load-screen__progress">${s}%</strong>`,o.lastDisplayValue=s,o.lastDisplayTime=l),s<o.lastProgressValue&&i()})}function a(){return Ht&&e===no}}function Ki(e){zi!==e&&(zi=e,e?Vi.show():Vi.hide())}function Il(e,t){clearTimeout(Xi),oo=!1,e&&(Xi=setTimeout(()=>{oo=!0,nr=t},typeof t=="function"?500:1500))}function Tl(e){let t=()=>BeFunky.confirm("confirm_cancel",{onConfirm:()=>{Et=void 0,Ji(),typeof nr=="function"&&nr()},onCancel:()=>{Et=void 0},confirmText:"yes",cancelText:"no"});e.addEventListener("click",()=>{!oo||(Et=t())}),document.addEventListener("keyup",n=>{if(!Ht||Et||n.which!==27)return;let o=BeFunky.getModal();o&&o.isDialog||(n.stopImmediatePropagation(),!!oo&&(Et=t()))})}function Al(){let e=document.createElement("div").setClass("load-screen");e.id="load_screen_root";let t=document.createElement("div").addClass("load-screen__iris");Wi(t);let n=document.createElement("div").addClass("load-screen__message");return e.appendChild(t),e.appendChild(n),BeFunky.onDocumentReady(()=>{e.parentElement||document.body.appendChild(e)}),Tl(e),{containerElement:e,irisElement:t,messageElement:n}}function Rl(e){e!==to.parentElement&&e.appendChild(to)}function Ml(){return no}function Ul(){return Ht}function Qi(e){try{return BeFunky.LanguageManager.getString(e)}catch(t){return e}}BeFunky.showLoadScreen=xl;BeFunky.hideLoadScreen=Ji;BeFunky.moveLoadScreen=Rl;BeFunky.updateLoadScreenProgress=$l;BeFunky.getLoadScreenMessage=Ml;BeFunky.isLoadScreenActive=Ul;var{isTemplateResult:Zi,render:Dl,html:or,elem:ea,siteLang:rr,icon:jl}=BeFunky.lit,ro=ea`<div class="notifications" style="display: none"><div class="notifications__inner"></div></div>`,io=ro.firstElementChild,Ol=BeFunky.once(()=>{let e=document.querySelector(".section");e?e.insertBefore(ro,e.firstChild):BeFunky.reportWarning("Failed to append notifications container b/c section was not found")});BeFunky.showNotification=function({message:e,button:t,isDismissable:n=!0,onDismiss:o,type:r="error"}){let i=BeFunky.createNotification({message:e,button:t,isDismissable:n,onDismiss:o,type:r});return Nl(i),window.scrollTo(0,0),()=>na(i)};BeFunky.createNotification=function({message:e,button:t,isDismissable:n=!0,onDismiss:o,type:r="error"}){if(!ta(e)&&!Zi(e))throw new Error("Invalid message");if(t&&!ta(t.text))throw new Error("Invalid button");if(!["error","warning","success"].includes(r))throw new Error("Invalid type");t&&typeof t.onClick!="function"&&(t.onClick=()=>{}),typeof o!="function"&&(o=()=>{});let i=ea`<div class=${`notification notification--${r}`}></div>`;return a(),BeFunky.LanguageManager.addLanguageUpdateListener(a),i.onTeardown=()=>{BeFunky.LanguageManager.removeLanguageUpdateListener(a)},i;function a(){Dl(l(),i)}function l(){return or`
            <div class="notification__content">
                <p class="notification__message">${Zi(e)?e:rr(e)}</p>
                ${t?u():""}
            </div>
            ${n?s():""}
        `}function u(){return or`<button class="button button--xs button--white-outline-notheme notification__button" @click=${t.onClick}>
            ${rr(t.text)}
        </button>`}function s(){return or`<button @click=${()=>{o(),na(i)}} class="button button--transparent button--icon button--xs notification__close" aria-label=${rr("dismiss",!0)}>
            ${jl("cancel-icon","icon icon--14")}
        </button>`}};function ta(e){return!!(typeof e=="string"&&e.length||Array.isArray(e)&&typeof e[0]=="string"&&e[0].length)}function Nl(e){Ol(),io.insertBefore(e,io.firstChild),ro.setStyles({display:""})}function na(e){!e||(e.onTeardown(),io.removeChild(e),io.firstElementChild||ro.setStyles({display:"none"}))}var ra=Mn(oa()),xt=BeFunky.Params.siteUrl.replace(/\/$/,""),ao=new ra.default(xt),cn=0,sr=!1,lr=!1,cr=!1;BeFunky.initialRoute=Xl();var so=Hl(BeFunky.initialRoute);BeFunky.sessionRoutes=[BeFunky.initialRoute];BeFunky.ignoreDeepLinkAction=!1;var lo={"/create/":nt,"/es/crear/":nt,"/pt/criar/":nt,"/de/erstellen/":nt,"/fr/creer/":nt,"/create/:deepLink/":nt,"/es/crear/:deepLink/":nt,"/pt/criar/:deepLink/":nt,"/de/erstellen/:deepLink/":nt,"/fr/creer/:deepLink/":nt};ao.hooks({before(e,t){let n=cn===0,o=window.location.href.replace(xt,"");console.log("Handling route:",cn,o,t||""),cn++,n||(lr?BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1]=o:BeFunky.sessionRoutes.push(o),Wl(o)),BeFunky.ignoreDeepLinkAction=sr,BeFunky.isCreateRoute()||Gl(),cr?(BeFunky.throwError("Attempting to resolve a route while another is in process",BeFunky.sessionRoutes),e(!1)):(cr=!0,e())},after(){cr=!1}});ao.notFound(ql);setTimeout(()=>{Object.keys(lo).forEach(e=>ia(e)),ao.on(lo).resolve(),Vl()},0);BeFunky.pushRoute=de;BeFunky.getCurrentRoute=wt;function Ce(e,t){if(ia(e,!0),cn===0)lo[e]=t;else throw new Error(`Route registered too late: ${e}`)}function ia(e,t=!1){if(!e||!e.startsWith("/")||!e.endsWith("/"))throw new Error(`Invalid route key "${e}"`);if(t&&lo[e])throw new Error(`Duplicate route key "${e}"`)}function de(e,t=!1){if(e=e.replace(/\/?(\?|#|$)/,"/$1"),e.startsWith("/")||(e=`/${e}`),e===wt())return BeFunky.reportWarning(`Duplicate route pushed: ${e}`);let n=Boolean(BeFunky.isCreateRoute()&&BeFunky.isCreateRoute(e));lr=t||n,sr=!1,ao.navigate(e),sr=!0}function wt(){return BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1]}function Hl(e){let t=document.querySelector('link[rel="canonical"]');return t&&t.href?t.href.replace(xt,""):(BeFunky.logWarning("Unable to get canonical tag for this page"),e)}function nt(e){let t=e&&e.deepLink?e.deepLink:"";if(!window.isAppOpen){if(BeFunky.myPhotosPage&&BeFunky.myPhotosPage.imageToEdit){let n=BeFunky.myPhotosPage.imageToEdit;return BeFunky.myPhotosPage.imageToEdit="",window.openUploadPanel({type:"photoeditor",img:n,ignoreExistingProject:!0})}window.openUploadPanel(t)}}function ql(){if(cn===0)return;let e=co(window.location.href);e!==co(BeFunky.initialRoute)&&e!==co(so)&&(console.log("Reloading page to force browser to navigate to server-side route:",window.location.href),window.location.reload())}function Wl(e){window.ga?(window.ga("set","page",e),lr||window.ga("send","pageview")):BeFunky.logError("Unable to track client-side route in Google Analytics",{route:e})}function Vl(){[...document.querySelectorAll("a[data-route]")].filter(t=>t.href.startsWith(xt)).forEach(t=>{t.addEventListener("click",n=>{if(n.preventDefault(),t.offsetParent===null){BeFunky.logError("Ignoring data-route link click b/c it's hidden");return}e(t),de(t.href.replace(xt,""))})});function e(t){let{href:n}=t;if(!n||!BeFunky.isCreateRoute(n))return;let r=co(n).split("/").pop(),i;if(["create","crear","criar","erstellen","creer"].includes(r))i="PHOTO-EDITOR";else if(window.deepLinkRouteData[r])i=window.deepLinkRouteData[r].trackingID;else{BeFunky.throwError("Unsure how to track deep link button click",r,n);return}let a,l=document.getElementById("site_nav");l&&l.contains(t)&&(a="HEADER"),BeFunky.trackDeepLink(i,a)}}function Gl(){if(!window.isAppOpen)return;let e=BeFunky.LanguageManager.isTranslated("confirm_hide")?BeFunky.LanguageManager.getString("confirm_hide"):"Are you sure you would like to hide the application?";if(window.confirm(e))zl(),window.hideEditor(!1),BeFunky.webglContextWasLost&&window.location.reload();else{let n=window.location.href;window.history.forward(),setTimeout(()=>{n===window.location.href&&(console.log("Using Back instead of Forward to return to app"),window.history.back())},100)}}function zl(){let e=BeFunky.getModal(),t=0;for(;e;){if(BeFunky.closeModal(e.modalID),console.log("Closed modal:",e.modalID),t++,t>10){BeFunky.throwError("Unexpected number of modals");break}e=BeFunky.getModal()}}function co(e){let t=e.replace(xt,"").split("?")[0].split("#")[0].replace(/\/$/,"");return t.startsWith("/")?t:`/${t}`}function Xl(){let e=window.location.href.replace(xt,"");if(e.includes("//")){let t=window.location.href.replace(e,"");e=e.replace(/\/+/g,"/"),window.history.replaceState({},"",t+e),BeFunky.logError("Removed duplicate slash from URL. Referrer = ",document.referrer)}return e}var ba=Mn(gr());var un=(...e)=>BeFunky.logFeature("pricing",...e),fr;async function pa(){if(fr)return fr;let e;try{if(e=await window.getDigitalGoodsService("https://play.google.com/billing"),!e)throw new Error("service_unavailable")}catch(t){throw BeFunky.reportWarning(`Digital goods service not working: ${t.name}: ${t.message}`),t}return fr=e,e}function ga({month:e,year:t}){return un("Fetching currency & value from DigitalGoodsService..."),pa().then(n=>n.getDetails([e.id,t.id])).then(([n,o])=>{un("Set currency & value on price pair for Play Store",{monthlyPrice:e,yearlyPrice:t},{monthlyPriceDetails:n,yearlyPriceDetails:o}),Object.assign(e,{currency:n.price.currency.toLowerCase(),value:n.price.value}),Object.assign(t,{currency:o.price.currency.toLowerCase(),value:o.price.value})})}async function po(){if(BeFunky.isPlus())return;un("Checking existing purchases...");let t=await(await pa()).listPurchases();if(t.length===0)return;un("Existing purchases:",{existingPurchases:t});let n;try{n=await BeFunky.requestAPI("transaction/check-purchase-token",{purchaseToken:t[0].purchaseToken});let{data:{email:o,status:r}}=n;if(!o||!["free","plus","trialing"].includes(r))throw"invalid_response";return un("Got BeFunky user for purchase:",n),{email:o,status:r}}catch(o){o!=="request_failed"&&o!=="not_found"&&BeFunky.reportWarning("Failed to check purchase token",o,n)}}var qt=(...e)=>BeFunky.logFeature("pricing",...e),fa=BeFunky.Params.play_store_prices.filter(e=>e.active),ma=BeFunky.Params.prices.filter(e=>e.active),mr="US",go=getCookie("ui_country");function ct(){return go||mr}var Fe="PENDING",ac=lc().then(e=>{Fe=e}),ha="year",ya=[];function ut(){return ha}function dn(e){if(!["month","year"].includes(e))throw new Error(`Invalid recurring value: ${BeFunky.stringValue(e)}`);ha=e,ya.forEach(t=>t(e))}function pn(e){ya.push(e)}function _a(){if(Fe==="PENDING"){BeFunky.throwError("getPrices() called too early");return}return Fe||BeFunky.throwError("No month/year price group found",Fe),Fe}function gn(){return ac.then(()=>_a())}function hr(e){let t=_a();if(t)return t[e]}function qe(e,t){let{unit_amount:n,value:o,currency:r}=e;return new Intl.NumberFormat([t],{style:"currency",currency:r,currencyDisplay:"symbol"}).format(o||n/100)}function yr(){gn().then(({month:e,year:t})=>{let n=[e.country,e.currency,e.unit_amount,t.unit_amount].join("_").toUpperCase();window.bf_eventTrack("PROMOTION","UPGRADE_PLUS",n)})}BeFunky.trackPricesViewed=yr;function _r(){let e;try{e=JSON.parse(BeFunky.getLocal("user_promo"))}catch(t){}if(e&&typeof e.code=="string"&&e.country&&e.expires>Date.now())return e}var kr=["US","GB","AU","CA"];function fn(e,t=!1,n=!0){if(e!==ct())throw new Error(`Mismatched free trial country: ${e}`);if(n&&!kr.includes(e))throw new Error(`Invalid free trial country: ${e}`);let o=30;BeFunky.setLocal("user_trial",JSON.stringify({country:e,expires:Date.now()+1e3*60*60*24*o,enablePaywall:t})),ho(!0,t)}function sc(){let e;try{e=JSON.parse(BeFunky.getLocal("user_trial"))}catch(t){}if(e&&e.country&&e.expires>Date.now())return e}var fo=BeFunky.platform==="play_store",mo=!1,ka=[];function mn(){return fo}function ho(e,t){qt(`${e?"Enabling":"Disabling"} free trial`),qt(`${t?"Enabling":"Disabling"} paywall`),fo=Boolean(e),mo=Boolean(t),ka.forEach(n=>n(fo,mo))}function wr(e,t=!0){ka.push(e),t&&e(fo,mo)}BeFunky.getFreeTrialEnabled=mn;BeFunky.isPaywallEnabled=()=>mo;BeFunky.onFreeTrialEnabledChange=wr;BeFunky.isInDemoMode=()=>navigator.languages&&navigator.languages.some(e=>e.startsWith("x-dm-country-"))||BeFunky.testingFlags.includes("chromeos_store_demo_mode");BeFunky.acknowledgeDemoMode=()=>{BeFunky.acknowledge("demo_mode_dialog_body",{heading:"demo_mode_dialog_heading"})};function hn(e){let t=ma.find(o=>o.country===e&&o.recurring==="month"),n=ma.find(o=>o.country===e&&o.recurring==="year");if(t&&n)return{month:t,year:n};if(BeFunky.Params.eurozoneCountries.includes(e))return hn("eurozone")}function lc(){return BeFunky.platform==="play_store"?(Fe={month:fa.find(e=>e.recurring==="month"),year:fa.find(e=>e.recurring==="year")},ga(Fe).catch(e=>{BeFunky.throwError(e,"Failed to update Google Play prices")}).then(()=>(BeFunky.onLoad(()=>{po().then(({email:e,status:t}={})=>{e&&t&&BeFunky.UserManager.handlePlayStoreUser(e,t,"initial")})}),Fe))):Promise.resolve().then(()=>{let e=_r();if(e&&(Fe=hn(e.country),Fe))return qt("Set price pair from promo in LocalStorage",Fe),Fe;BeFunky.removeLocal("user_promo");let t=Boolean(BeFunky.User.subscr_count),n=sc();return n&&!t&&(Fe=hn(n.country),Fe)?(qt("Set price pair from trial in LocalStorage",Fe),ho(!0,n.enablePaywall),Fe):(BeFunky.removeLocal("user_trial"),BeFunky.removeLocal("user_price"),Fe=br(),Fe)})}function br(){let e;return go&&(e=hn(go),e)?(qt(`Set price pair for user's country ${go}`,e),e):(e=hn(mr),qt(`Set price pair for fallback country ${mr}`,e),e)}function wa(e){if(!Array.isArray(e)||e.length!==2||!e.every(r=>cc(r)))return;let t=e.map(r=>BeFunky.Params.prices.find(i=>i.id===r)).filter(Boolean),n=t.find(r=>r.recurring==="month"),o=t.find(r=>r.recurring==="year");if(!(!n||!o))return{month:n,year:o}}function cc(e){return BeFunky.Params.prices.some(t=>t.id===e)}function uc(){let e=document.querySelector(".site-nav");t(),BeFunky.addPassiveListener(window,"scroll",t);function t(){e.toggleClass("site-nav--scrolling",window.scrollY>0)}}function dc(){let e=document.getElementById("site_root"),t=document.querySelector(".site-nav__dropdown-root"),n=document.querySelector(".site-nav__dropdown-bg"),o=document.querySelector(".site-nav__dropdown-container"),r=document.querySelector(".site-nav__dropdown-arrow"),i=Array.from(document.querySelectorAll(".site-nav__item[data-dropdown]")),a=Array.from(document.querySelectorAll(".site-nav__dropdown-section[data-dropdown]")),l=[],u=!1;i.forEach(g=>{let f=g.getAttribute("data-dropdown"),_=a.find(w=>w.getAttribute("data-dropdown")===f);if(!_)return BeFunky.throwError(`Unable to find dropdown section: "${f}"`);let y=_.firstElementChild,h={index:l.length,name:f,opener:g,section:_,content:y,arrowOffset:parseInt(_.getAttribute("data-arrow-offset"))||-8};l.push(h),g.addEventListener("mouseenter",()=>{c(h)}),g.addEventListener("click",()=>{BeFunky.handleNextFocus(g,0,!1)}),g.delegateFocus=w=>{c(h);let F=(0,ba.default)(y);return w===-1?F[F.length-1]:F[0]},y.addClass("focus-avoid"),y.exitFocusTrap=w=>{y.addClass("focus-avoid"),BeFunky.handleNextFocus(g,w),u===h&&d()},g.setAttribute("aria-haspopup",!0),g.setAttribute("aria-expanded",!1)});let s=BeFunky.debounce(m,"ric");BeFunky.onLoad(s),window.addEventListener("resize",s),BeFunky.LanguageManager.addLanguageUpdateListener(g=>{g.includes("site")&&s()}),m(),BeFunky.measureSiteNavDropdowns=s;function c(g,f=!1){if(u===g&&!f)return;if(u&&u!==g&&(u.opener.setAttribute("aria-expanded",!1),u.content.addClass("focus-avoid"),u=g,t.removeClass("site-nav__dropdown-root--disable-transitions")),!u){u=g,t.addClass("site-nav__dropdown-root--disable-transitions"),c(g,!0),document.addEventListener("mouseover",p),document.addEventListener("touchstart",p);return}u=g;let _=Math.round(g.openerMidX-g.contentWidth/2+g.xOffset),y=Math.round(g.openerMidX+g.arrowOffset);r.setStyles({transform:`translateX(${y}px)`}),o.setStyles({transform:`translateX(${_}px)`,width:`${g.contentWidth}px`,height:`${g.contentHeight}px`}),n.setStyles({transform:`translateX(${_}px)`,width:`${g.contentWidth}px`,height:`${g.contentHeight}px`}),l.forEach(({index:h,section:w})=>{let F;h<g.index?F="left":h===g.index?F="active":F="right",w.setClass(`site-nav__dropdown-section site-nav__dropdown-section--${F}`)}),g.opener.setAttribute("aria-expanded",!0),t.removeClass("site-nav__dropdown-root--inactive"),g.content.removeClass("focus-avoid")}function d(){!u||(u.opener.setAttribute("aria-expanded",!1),u.content.addClass("focus-avoid"),u=!1,t.addClass("site-nav__dropdown-root--inactive"),document.removeEventListener("mouseover",p),document.removeEventListener("touchstart",p))}function p(g){i.includes(g.target)||t.contains(g.target)||!e.contains(g.target)&&!window.isAppOpen||g.type==="mouseover"&&u&&u.content.contains(document.activeElement)||d()}function m(){window.isAppOpen||window.webgl_is_supported&&BeFunky.isCreateRoute()||(t.setStyles({transform:"none",transition:"none"}),window.requestAnimationFrame(()=>{l.forEach(g=>{let f=window.innerWidth,_=g.content.getBoundingClientRect(),y=g.opener.getBoundingClientRect(),h=y.left+y.width/2,w=h-_.width/2,F=h+_.width/2,b=f-F,E=48,P=0;w<E?b>E*2?P=E-w:P=(f-_.width)/2-w:b<E&&(P=b-E),Object.assign(g,{contentWidth:_.width,contentHeight:_.height,openerMidX:h,xOffset:P})}),t.setStyles({transform:"",transition:""}),u&&c(u,!0)}))}}function pc(){let e=document.querySelector(".site-nav__popup-root"),t=document.querySelector(".site-nav__hamburger"),n=document.querySelector(".site-nav__popup-close"),o=document.querySelectorAll(".site-nav__popup-accordion"),r=document.getElementById("site_root");t.addEventListener("click",s=>{s.stopPropagation(),a()}),n.addEventListener("click",l),e.addEventListener("click",s=>s.stopPropagation()),[...o].forEach(s=>{s.addEventListener("click",()=>u(s))});let i=!1;function a(){i||(i=!0,e.addClass("site-nav__popup-root--active"),r.addClass("site-root--site-nav-popup-active"),document.addEventListener("click",l))}function l(){!i||(i=!1,e.removeClass("site-nav__popup-root--active"),r.removeClass("site-root--site-nav-popup-active"),document.removeEventListener("click",l))}function u(s){let c="site-nav__popup-accordion--open",d=s.hasClass(c);o.removeClass(c),d||s.addClass(c)}}function gc(){[document.querySelector(".site-nav__dropdown-link--sign-out"),document.querySelector(".site-nav__popup-button--sign-out")].forEach(t=>{let n=window.location.href,o=["/myphotos","/my-account"];n.endsWith("/")&&o.every(r=>!n.includes(r))&&(t.href+=`?next=${encodeURIComponent(n)}`)})}function fc(){let e=BeFunky.isCreateRoute()&&BeFunky.Params.canUseWebapp,t=window.innerWidth<768;e||t?setTimeout(n,2e3):n();function n(){[...document.querySelectorAll(".site-nav__dropdown-image")].forEach(o=>window.loadLazyImage(o))}}BeFunky.updateSiteNavForUser=function({username:e,email:t,isPlus:n}={}){let o=document.getElementById("site_nav");if(!o)return;if(!t){o.addClass("site-nav--not-signed-in").removeClass("site-nav--signed-in").removeClass("site-nav--user-is-plus");return}let r=document.querySelector(".site-nav__user-circle"),i=[...document.querySelectorAll(".site-nav__user-email")],a=i.map(u=>u.parentElement);e=e||"",r.textContent=e.slice(0,1).toUpperCase()||"?",a.forEach(u=>{u.title=t}),i[0].textContent=l(t,21),i[1].textContent=l(t,27),o.removeClass("site-nav--not-signed-in").addClass("site-nav--signed-in").toggleClass("site-nav--user-is-plus",n),window.innerWidth>767&&BeFunky.measureSiteNavDropdowns();function l(u,s){let c=u.length-s;if(c<=0)return u;if(c>0){let d=Math.round(s*.618),[p,m]=u.split("@");if(m.length<=d)return`${p.slice(0,p.length-c-1)}...@${m}`;if(p.length<d){let y=m.slice(0,m.length-c-1);return`${p}@${y}...`}let g=Math.ceil(c/2),f=p.slice(0,p.length-g-1),_=m.slice(0,m.length-g-1);return`${f}...@${_}...`}}};BeFunky.onDocumentReady(()=>{let e=document.getElementById("site_root");!e||(uc(),dc(),pc(),gc(),fc(),window.onUserStatusChange(t=>{if(!t.email)return BeFunky.updateSiteNavForUser();let{user_name:n,email:o,pl:r}=t;BeFunky.updateSiteNavForUser({username:n,email:o,isPlus:r==="1"})}),wr(t=>{e.querySelector(".site-nav__upgrade-button").setLang(t?"start_free_trial":"upgrade","site")}))});function mc(){let e=BeFunky.isDashboard()?t():[...document.querySelectorAll(".site-footer__language-choice a")];n(),BeFunky.LanguageManager.addLanguageUpdateListener(o=>{o.includes("site")&&n()}),e.forEach(o=>{o.addEventListener("click",r=>{r.preventDefault();let i=o.getAttribute("data-choose-lang");if(!BeFunky.LanguageManager.appLanguages.includes(i))return BeFunky.throwError("Language link missing valid language ID",i);let a=o.href.split("?")[0].split("#")[0],l=window.location.href.split("?")[0].split("#")[0],u=a!==l,s=!1;if(BeFunky.updateLanguage(i).then(()=>{u&&c()}),u){BeFunky.showLoadScreen();let d=1500;setTimeout(()=>{BeFunky.throwError(`Language change timed out after ${d}ms`),setTimeout(c,50)},d)}BeFunky.LanguageManager.setLanguage(i,["app","site"]);function c(){s||(s=!0,window.location.href=o.href)}})});function t(){let o=document.querySelector(".site-footer__language-choice");for(;o.firstElementChild&&o.firstElementChild.nodeName==="A";)o.removeChild(o.firstElementChild);let r=BeFunky.LanguageManager.getLanguageNames().map(({id:i,name:a})=>{let l=document.createElement("a");return l.textContent=a,l.setAttribute("data-choose-lang",i),l.href=BeFunky.getDashboardUrlInLanguage(i),l});return r.forEach(i=>o.appendChild(i)),r}function n(){let o=e.find(r=>r.getAttribute("data-choose-lang")===BeFunky.LanguageManager.language.site);o&&(document.querySelector(".site-footer__current-language").textContent=o.textContent)}[...document.querySelectorAll("#get_started_modal .button")].forEach(o=>{o.addEventListener("click",()=>BeFunky.closeModal("get_started_modal"))})}BeFunky.onDocumentReady(()=>{!document.getElementById("site_root")||requestIdleCallback(()=>mc())});var{html:vr,lang:hc,icon:yc,defineCustomElement:_c,ifDefined:kc,useEffect:wc,useLanguageUpdate:bc}=BeFunky.lit,Wt=Bc();_c("panel-header",vc,{observedAttributes:["lang-id","modifier","clue-id","buttons"]});function vc({langId:e,modifier:t,buttons:n="",isPlus:o=!1,clueId:r,buttonPosition:i={},_priorButtons:a={}}){let l=this;l.toggleButtons||(this.classList.add("panel-header",`panel-header--${t}`),Object.defineProperty(l,"toggleButtons",{get(){return(F,b)=>{l.buttons=Fc(l.buttons,F,b)}}})),bc("app");let{left:u,right1:s,right2:c}=h(n);return wc(()=>{l._priorButtons={left:u,right1:s,right2:c}},[n]),d();function d(){return vr`
            ${u?p("left",u):""}
            <h3 class=${w("panel-header__text",[t,f()])}>
                <string>${hc(e||"")}</string>
                ${o&&!BeFunky.isPlus()?vr`<span class="panel-header__plus-badge badge badge--plus hide-if-premium"></span>`:""}
            </h3>
            ${p("right1",s)}
            ${p("right2",c)}
        `}function p(F,b){let E=[w("button",["icon","sm",F==="left"?"grey-200":"transparent"]),w("panel-header__button",[b?"":"hidden",t,b,F,_(F,!b)]),b?"":"focus-avoid"].join(" "),P=b?"":a[F];return vr`
            <button @click=${y} .buttonData=${Wt[b]} class=${E} data-tooltip=${kc(g(b))}>${m(F,b||P)}</button>`}function m(F,b){if(!b)return"";let E=Wt[b].icon,P=Wt[b].iconSize;return yc(E,`icon ${P!=="default"?"icon--18 ":""}icon--${b}`,{style:F==="right2"?"backface-visibility: hidden;":""})}function g(F){if(!!F)return Wt[F].tooltip}function f(){return s&&c?"":s||c?"wider-1x":"wider-2x"}function _(F,b){if(F==="left")return"";if(F==="right2"&&b)return"move-1x";if(F==="right1"&&b)return c?"move-1x":"move-2x";if(F==="right1"&&!c)return"move-1x"}function y(F){let{event:b,eventBubbles:E=!1}=F.target.buttonData;l.dispatchEvent(new Event(b,{bubbles:E})),b==="HELP"&&r&&BFN.HelpClueManager.toggle(r)}function h(F){let b={left:"",right1:"",right2:""},E;return window.BFN&&(E=BFN.cluesToHideOnTablet.find(P=>P===r)),F.split(",").map(P=>P.trim()).filter(P=>{if(E&&P==="help"&&BeFunky.isTablet)return!1;let T=P==="batch_add"||P==="batch_remove";return BeFunky.isChromeOnIOS&&T?!1:P}).forEach(P=>{let T=Wt[P];if(T){let $=i[P]||T.position;b[$]=P}}),b}function w(F,b=[]){return[F,...b.filter(Boolean).map(E=>`${F}--${E}`)].join(" ")}}function Fc(e="",t,n=!0){let o=e.split(",").map(l=>l.trim()).filter(Boolean),r=[],i=[];return Object.entries(t).forEach(([l,u])=>{Wt[l]||BeFunky.logError(`Invalid button: ${l}`),u?r.push(l):i.push(l)}),(n?[...o,...r]:[...r,...o]).filter(l=>!i.includes(l)).unique().join(",")}function Bc(){return{help:{icon:"info-icon",event:"HELP",position:"right1"},close:{icon:"cancel-icon",iconSize:"default",event:"CLOSE",eventBubbles:!0,position:"right2"},select:{icon:"select-all-icon",tooltip:"select_all",event:"SELECT",position:"right1"},deselect:{icon:"deselect-all-icon",tooltip:"deselect_all",event:"DESELECT",position:"right2"},batch_add:{icon:"batch-processing-icon",tooltip:"batch_tool_add",event:"BATCH",position:"right1"},batch_remove:{icon:"batch-processing-selected-icon",tooltip:"batch_tool_remove",event:"BATCH",position:"right1"},back:{icon:"arrow-icon",iconSize:"default",event:"BACK",position:"left"},view_all:{icon:"pop-out-icon",iconSize:"default",tooltip:"view_all",event:"VIEW_ALL",position:"right2"}}}var Fa=Mn(va());BeFunky.autocomplete=(e,{inputElement:t,options:n,minValueLength:o=2,allowEmpty:r=!1,generateItem:i,onSelect:a=()=>{}})=>function(){this.setClass("autocomplete scrollable-content"),t.hasAutocomplete=!0;let l=n.slice().filter(s=>typeof s.label=="string"&&s.label.length);this.init=function(){this.currentValue="",this._currentOption=void 0,this.noResultsText="No results",this.ignoreNextTextUpdate=!1,t.setAttribute("autocomplete","off"),l.forEach(m=>{m.element=this.createItem(m)});let s={shouldSort:!0,includeScore:!0,includeMatches:!0,threshold:.2,location:0,distance:100,maxPatternLength:32,minMatchCharLength:o,keys:["label"]};this.fuse=new Fa.default(n,s);let c=25,d=BeFunky.debounce(this.handleTextUpdate.bind(this),c);t.addEventListener("change",d),t.addEventListener("keyup",d),t.addEventListener("focus",this.handleTextUpdate.bind(this)),t.addEventListener("blur",m=>{let g=m.relatedTarget||m.explicitOriginalTarget;if(g!==void 0||!BeFunky.isSafari){this.contains(g)||(this.hide(),this.ignoreNextTextUpdate=!0,setTimeout(()=>{this.ignoreNextTextUpdate=!1},500));return}setTimeout(()=>{BeFunky.waitUntil({condition:()=>!this.isHovered,onTimeout:()=>{},onSuccess:()=>{document.activeElement!==t&&!this.contains(document.activeElement)&&this.hide()},interval:200,maxAttempts:15})},200)});let p={callback:u,condition:m=>m.hasClass("autocomplete__item")||m.hasAutocomplete};BeFunky.addArrowKeyHandler(p),t.addEventListener("keydown",m=>{m.key!=="Enter"||m.keyCode!==13||(this.handleTextUpdate(),!(this.currentValue.length<o)&&this.currentOption&&(m.preventDefault(),this.selectOption(this.currentOption)))}),this.addEventListener("click",m=>{let g=m.target;!g||!g.hasClass("autocomplete__item")||this.selectOption(g.option)}),this.addEventListener("focusout",m=>{let g=m.relatedTarget||m.explicitOriginalTarget||document.activeElement;(!g||g!==t&&!this.contains(g))&&this.hide()}),this.isHovered=!1,this.addEventListener("mouseenter",()=>{this.isHovered=!0}),this.addEventListener("mouseleave",()=>{this.isHovered=!1})},this.show=function(){this.addClass("autocomplete--active"),this.style.setProperty("--scrollable-content-width",`${this.getBoundingClientRect().width-16}px`)},this.hide=function(){this.removeClass("autocomplete--active")},this.updateOptions=function(){let s=this.currentValue.length;if(s<o&&!(s===0&&r))return this.hide();let c=s?this.fuse.search(this.currentValue).filter(({score:p})=>p<.5):[];if(i&&(!c.length||c[0].score>0)){let p=this.createItemFromUserInput();p&&(p.index===-1?c.push(p):c.splice(p.index,0,p))}let d=document.createDocumentFragment();if(c.length)c.forEach(({item:p,matches:m,isGenerated:g})=>{if(!g){let f=0,_=p.label;m[0]&&m[0].indices.forEach(([y,h])=>{_=`${_.slice(0,f+y)}<span>${p.label.slice(y,h+1)}</span>${p.label.slice(h+1)}`,f+=13}),p.element.innerHTML=_}d.appendChild(p.element)}),this.currentOption=c[0].item;else{let p=this.createItem({label:this.noResultsText});p.addClass("autocomplete__item--no-results"),d.appendChild(p),this.currentOption=void 0}for(;this.firstElementChild;)this.removeChild(this.firstElementChild);this.appendChild(d),this.show()},this.createItemFromUserInput=function(){let{html:s,index:c}=i(this.currentValue)||{};if(!s)return;let d={label:this.currentValue};return d.element=this.createItem(d),d.element.innerHTML=s,{isGenerated:!0,index:c,item:{label:this.currentValue,element:d.element}}},this.createItem=function(s){let c=document.createElement("button");return c.className="button button--transparent button--fullwidth button--left-align autocomplete__item",c.type="button",c.option=Object.assign({},s),c.textContent=s.label,c.addEventListener("focus",()=>{this.currentOption=s}),c},this.selectOption=function(s){let c=s.label;c!==this.noResultsText&&(this.hide(),this.ignoreNextTextUpdate=!0,setTimeout(()=>{this.ignoreNextTextUpdate=!1},500),t.value=c,a(s))},this.handleTextUpdate=function(){if(this.ignoreNextTextUpdate){this.ignoreNextTextUpdate=!1;return}let s=t.value.trim();if(s===this.currentValue)return document.activeElement!==t?void 0:s.length>=o?this.show():!s.length&&r?this.show():void 0;this.currentValue=s,this.updateOptions()};function u(s,c,d){if(c==="left"||c==="right")return!0;if(d.type==="keydown")return;if(s.hasClass("autocomplete__item")){let g=c==="up"?s.previousElementSibling:s.nextElementSibling;if(g)g.focus();else if(c==="up"){let f=s.parentElement.previousElementSibling;f&&f.nodeName==="INPUT"&&f.focus()}return}if(c!=="down")return;let m=s.nextElementSibling.children;m.length>=2&&m[1].focus()}Object.defineProperty(this,"currentOption",{set(s){if(this._currentOption!==s){if(this._currentOption&&this._currentOption.element.removeClass("button--selected"),!s){this._currentOption=void 0;return}if(!s.element||typeof s.label!="string")throw"Invalid currentOption";this._currentOption=s,this._currentOption.element.addClass("button--selected")}},get(){return this._currentOption}}),this.init()}.bind(e)();var{html:Pc,useState:Sc,defineCustomElement:Lc,lang:Cc}=BeFunky.lit;Lc("textarea-counter",Ec,{observedAttributes:["maxlength","placeholder"]});function Ec({maxlength:e="500",placeholder:t=""}){let[n,o]=Sc(0),r=parseInt(e)||500;return this.hasOwnProperty("value")||Object.defineProperty(this,"value",{get(){let l=this.querySelector("textarea");return l===null?"":l.value},set(){}}),i();function i(){let l=BeFunky.debounce(a,100),u=n>=r,s="textarea focus-initially text-area__text-limit",c="text-sm text-area__char-count text-area__char-count--limit";return Pc`
            <div class="text-area">
                <textarea
                    class=${u?s:"textarea focus-initially"}
                    maxlength=${r}
                    placeholder=${Cc(t,"app",!0)}
                    @change=${l}
                    @keyup=${l}
                    @blur=${l}></textarea>
                    <p class=${u?c:"text-sm text-area__char-count"}>
                        ${`${n} / ${r}`}
                    </p>
            </div>`}function a(l){o(l.target.value.length)}}BeFunky.contextMenu=(e,t,{hideOnClick:n=!0,onHide:o,offset:r,targetEvents:i=["click",BeFunky.pointerup],hoverOffEventTarget:a}={})=>function(){this.setAttribute("class","context-menu context-menu--hidden"),this.setStyles({visibility:"hidden"}),this.offsetX=parseInt(r&&r.x)||0,this.offsetY=parseInt(r&&r.y)||0,this.hoverOffEventTarget=a||BFN.appContainer;let l=(s,c,{onClick:d,hasDivider:p,children:m,translate:g=!0,shortcutText:f},_=!1)=>{BeFunky.isTablet&&(f=void 0);let y="button button--transparent button--fullwidth context-menu__item";p&&(y+=" context-menu__item--has-divider"),f&&(y+=" context-menu__item--has-shortcut"),m&&(y+=" button--has-icon context-menu__item--has-children"),_&&(y+=" context-menu__item--is-child");let h=document.createElement("div");h.className=y;let w=document.createElement("string");if(g?w.setLang(c):w.innerHTML=c,h.appendChild(w),f&&h.appendChild(BFN.shortcutString(f)),h.contextMenuItemName=c,h.addEventListener("click",F=>{F.stopPropagation(),typeof d=="function"&&!h.hasAttribute("disabled")&&(d(F),n&&this.hide())}),m){h.insertAdjacentHTML("beforeend",`<svg class="icon icon--chevron-right">
                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#chevron-icon"></use>
                </svg>
            `);let F=Object.keys(m);h.contextMenuItemChildren=F;let b=document.createElement("div").addClass("context-menu__children");h.appendChild(b),F.forEach(E=>l(b,E,m[E],!0))}s.appendChild(h)},u=document.createDocumentFragment();Object.keys(t).forEach(s=>l(u,s,t[s])),this.appendChild(u),this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.enabled=!0,this.visible=!1,this.lastShownTime=0,this.getItems(),this.target=this._target=null,this.oncontextmenu=()=>!1,this.addEventListener(BeFunky.pointerdown,s=>s.stopPropagation())},this.getItems=function(){this.items={},[...this.children].forEach(s=>{if(this.items[s.contextMenuItemName]=s,s.contextMenuItemChildren){let{children:c}=s.lastElementChild;s.contextMenuItemChildren.forEach((d,p)=>{if(this.items[d])throw`Duplicate context menu item name: ${d}`;this.items[d]=c[p]})}})},this.show=(s,c)=>{this.visible=!0;let d=this.getBoundingClientRect(),p=Math.round(s+d.width),m=Math.round(c+d.height),g=window.innerWidth,f=window.innerHeight;p>g&&(s-=d.width),m>f&&(c-=d.height),s=Math.round(s),c=Math.round(c),this.setStyles({transform:`translateX(${s}px) translateY(${c}px)`,visibility:""}),this.removeClass("context-menu--hidden"),this.addEventListener(BeFunky.pointerover,this.stopPropagation),this.hoverOffEventTarget.addEventListener(BeFunky.pointerover,this.hide),document.addEventListener("keydown",_=>{[16,17,91,93].includes(_.keyCode)||this.hide()}),this.addEventListener("click",this.hide),this.dispatchEvent(new Event("SHOW")),[...this.querySelectorAll(".context-menu__children")].forEach(_=>{let y=_.getBoundingClientRect(),h=Math.round(y.left+y.width),w=Math.round(y.top+y.height);h>g&&_.addClass("context-menu__children--left-side"),w>f&&_.setStyles({transform:`translateY(${f-w}px)`})}),this.lastShownTime=Date.now()},this.hide=s=>{!this.visible||(this.visible=!1,typeof o=="function"&&o(s,Date.now()-this.lastShownTime),this.addClass("context-menu--hidden"),[...this.querySelectorAll(".context-menu__children")].forEach(c=>{c.removeClass("context-menu__children--left-side"),c.setStyles({transform:""})}),this.removeEventListener(BeFunky.pointerover,this.stopPropagation),this.hoverOffEventTarget.removeEventListener(BeFunky.pointerover,this.hide),document.removeEventListener("keydown",this.hide),this.removeEventListener("click",this.hide),this.dispatchEvent(new Event("HIDE")),BeFunky.wait([150,"raf"],()=>{this.visible||this.setStyles({visibility:"hidden"})}))},this.showButton=s=>{this.items[s].removeClass("context-menu__item--hidden")},this.hideButton=s=>{this.items[s].addClass("context-menu__item--hidden")},this.toggleButton=(s,c)=>{c?this.showButton(s):this.hideButton(s)},this.updateChildren=(s,c)=>{let d=this.items[s];if(!d)throw`Invalid context menu item name: ${s}`;if(!d.contextMenuItemChildren)throw`Context menu item ${s} does not support children`;let p=d.lastElementChild,m=Object.keys(c);p.innerHTML="",p.contextMenuItemChildren=m,m.forEach(g=>l(p,g,c[g])),this.getItems()},this.handleTargetClick=BeFunky.debounce(s=>{this.enabled&&this.show(s.pageX+this.offsetX,s.pageY-window.scrollY+this.offsetY)},0),this.stopPropagation=s=>s.stopPropagation(),Object.defineProperty(this,"target",{set(s){if(this.target!==s){if(!(s instanceof HTMLElement)){BeFunky.logError("Context menu target must be HTML Element");return}this._target&&i.forEach(c=>{this._target.removeEventListener(c,this.handleTargetClick)}),this._target=s,i.forEach(c=>{this._target.addEventListener(c,this.handleTargetClick)})}},get(){return this._target}}),this.init()}.bind(e)();var{html:Xe,useLanguageUpdate:xc,lang:yo,defineCustomElement:$c,useState:Ba,useEffect:Ic}=BeFunky.lit;$c("plus-pricing",Tc,{observedAttributes:["context"]});function Tc({context:e="site",showTotalAnnualPrice:t=!0}){let[n,o]=Ba(null),[r,i]=Ba(ut());Ic(()=>{this.addClass("plus-pricing"),gn().then(d=>{o(d)}),pn(i)},[]),xc(e);let a=n?c():0;return l();function l(){return Xe`
        <label class=${`plus-pricing__card ${r==="year"?"plus-pricing__card--selected":""}`} tabindex="0">
            <input type="radio" name="plan" value="yearly" .checked=${r==="year"} @change=${()=>dn("year")}>
            ${n?s(n.year,!0):u()}
            ${t?Xe`<span class="plus-pricing__description">${yo(["billed_annually",{price:n?`<strong>${qe(n.year,BeFunky.LanguageManager.language[e])}</strong>`:"..."}],e)}</span>`:Xe`<span class="plus-pricing__description">${yo("billed_annually_per_month")}</span>`}
            ${a>0?Xe`<span class="plus-pricing__most-popular">${yo(["save_percent",{percent:a.toString()}],e)}</span>`:""}
        </label>
        <label class=${`plus-pricing__card ${r==="month"?"plus-pricing__card--selected":""}`} tabindex="0">
            <input type="radio" name="plan" value="monthly" .checked=${r==="month"} @change=${()=>dn("month")}>
            ${n?s(n.month):u()}
            <span class="plus-pricing__description">${yo("billed_monthly",e)}</span>
        </label>`}function u(){return Xe`<div class="plus-pricing__price"><div class="loading-spinner"></div></div>`}function s(d,p=!1){switch(p&&d.recurring==="year"&&(d=g(d)),d.currency){case"usd":{let[_,y]=m();return f("$",_,y)}case"gbp":{let[_,y]=m();return f("\xA3",_,y)}case"eur":{let[_,y]=m();return f("\u20AC",_,y)}case"mxn":{let[_,y]=m();return f("$",_,y!=="00"?y:"","MXN")}case"isk":case"nok":{let[_,y]=m();return Xe`
                <div class="plus-pricing__price">
                    <span class="plus-pricing__currency">Kr. </span>
                    <span class="plus-pricing__large-amount">${_}</span>
                    <span class="plus-pricing__small-amount"><sup style="text-decoration: underline">${y}</sup></span>
                </div>
                `}case"cad":{let[_,y]=m();return f("$",_,y,"CAD")}case"aud":{let[_,y]=m();return f("A$",_,y)}default:if(d.unit_amount)BeFunky.throwError(`Unhandled currency: ${d.currency}`);else{let _=qe(d,BeFunky.LanguageManager.language[e]),y=_.split(/\d/),h=y[0],w=y[y.length-1],F=_.slice(h.length);F=F.slice(0,F.length-w.length);let b=F.match(/^(.+)([.,])(\d\d)$/);if(b){let[,E,P,T]=b;return f(h,E,T,w,P)}return Xe`
                    <div class="plus-pricing__price">
                        ${h?Xe`<span class="plus-pricing__currency">${h}</span>`:""}
                        <span class="plus-pricing__large-amount">${F}</span>
                        ${w?Xe`<span class="plus-pricing__currency" style="margin: 0 0 0 4px">${w}</span>`:""}
                    </div>
                    `}}function m(){return d.unit_amount?(d.unit_amount/100).toFixed(2).split("."):parseFloat(d.value).toFixed(2).split(".")}function g(){return d.unit_amount?Object.assign({},d,{unit_amount:parseInt(d.unit_amount)/12}):Object.assign({},d,{value:(parseFloat(d.value)/12).toString()})}function f(_,y,h,w,F="."){return Xe`
            <div class="plus-pricing__price">
                <span class="plus-pricing__currency">${_}</span>
                <span class="plus-pricing__large-amount">${y}</span>
                ${h?Xe`<span class="plus-pricing__small-amount">${F}${h}</span>`:""}
                ${w?Xe`<span class="plus-pricing__currency" style="margin: 0 0 0 4px">${w}</span>`:""}
            </div>
            `}}function c(){if(n.month.unit_amount){let p=n.month.unit_amount*12;return Math.floor(100*(p-n.year.unit_amount)/p)}let d=parseFloat(n.month.value)*12;return Math.floor(100*(d-parseFloat(n.year.value))/d)}}function _n(e){let t=!1;BeFunky.showLoadScreen({onCancel:()=>{t=!0,BeFunky.throwError("User cancelled load screen while waiting on Stripe JS")}}),delete window.stripe_load_error,console.log("Loading Stripe JS..."),window.loadAndInitStripe(),BeFunky.waitUntil({condition:()=>window.stripe||window.stripe_load_error||t,onSuccess:()=>{if(!t){if(BeFunky.hideLoadScreen(),window.stripe)return e();n()}},onTimeout:()=>{t||(BeFunky.hideLoadScreen(),n())},interval:200,maxAttempts:25});function n(){if(BeFunky.throwError("Failed to load or initialize Stripe"),t)return;let o=BeFunky.isOnline()?["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}]:"user_offline",r=BeFunky.isOnline()?`${BeFunky.Params.globalImagesPath}illustrations/paper-refresh.svg`:`${BeFunky.Params.globalImagesPath}illustrations/warning.svg`;BeFunky.acknowledge(o,{imageUrl:r})}}var{html:Ee,elem:_o,icon:Br,useLanguageUpdate:Ac,modalLang:Re,defineCustomElement:Rc,useState:bt,useEffect:Pr}=BeFunky.lit,Pa=(...e)=>BeFunky.logFeature("payment",...e),kn={},dt={number:_o`<div id="payment_modal_card_number" class="form-field__input payment-modal__card-number"><span>${Re("loading")}</span></div>`,expiry:_o`<div id="payment_modal_card_expiry" class="form-field__input payment-modal__card-expiry"></div>`,cvc:_o`<div id="payment_modal_card_cvc" class="form-field__input payment-modal__card-cvc"></div>`,wallet:_o`<div></div>`},Me={number:null,expiry:null,cvc:null,wallet:null},xe={};function Mc({mode:e,email:t,initialPromoCode:n,onPaymentSubmit:o}){if(!["charge","update","update_from_payflow","free_trial"].includes(e))throw new Error(`Invalid payment form mode: ${e}`);let[r,i]=bt(ut()),[a,l]=bt(),[u,s]=bt(typeof window.stripe=="object"),[c,d]=bt({}),[p,m]=bt(""),[g,f]=bt(n),[_,y]=bt(!1),[h,w]=bt(!1);Object.assign(xe,{displayError:me,clearError:fe,getSharedSubmitData:he,onPaymentSubmit:o,prices:a,recurring:r,setCardType:m,setWalletAvailable:w}),Pa("Render",{recurring:r,prices:a,isStripeLoaded:u,errors:c,cardType:p,promoCode:g,isValidatingPromo:_,isWalletAvailable:h});let F=["update","update_from_payflow"].includes(e),b=h&&!F,E=e==="charge"&&typeof n=="string",P=E&&kn[g]===!0,T=P||e==="free_trial";return Pr(()=>{gn().then(B=>{l(B)}),pn(i)},[]),Pr(()=>{if(!u)_n(()=>s(!0));else if(u&&a){let B=Uc();Dc(B),BeFunky.Params.isBeta&&jc(B)}},[u,a]),Pr(()=>{E&&n?C(n):E||f()},[n]),Ac("modal"),$();function $(){return Ee`
        ${N()}
        ${F?"":Ee`<plus-pricing context="modal"></plus-pricing>`}
        <div class="centered-modal__column">
            <form id="payment_modal_form" @submit=${_e}>
                ${j()}
                ${G()}
                ${z()}
                ${J()}
                ${E?X():""}
                ${F?"":ue()}
                ${Q()}
            </form>
            <p class="payment-modal__footer">
                ${Br("lock-icon","icon",{style:"margin-top: -4px;"})}
                <string>${Re("payment_modal_digicert")}</string>
            </p>
        </div>
        `}function N(){return F?Ee`<h2 class="centered-modal__heading h3">${Re("payment_modal_heading_update")}</h2>`:e==="free_trial"?Ee`
                <h2 class="centered-modal__heading h3">${Re("payment_modal_heading_7_day_trial")}</h2>
                <p class="centered-modal__column centered-modal__subheading text-lg">${Re("payment_modal_subheading_trial")}
            `:Ee`<h2 class="centered-modal__heading h3">${Re("payment_modal_heading")}</h2>`}function j(){return c.form?Ee`<div class="form-errors">
            <div class="form-errors__container">
                <p>${Re(c.form)}</p>
            </div>
            <button @click=${()=>fe("form")} class="button button--icon button--xs form-errors__close-button">
                ${Br("cancel-icon","icon icon--14")}
            </button>
        </div>`:""}function G(){return Ee`
        <div class="form-field payment-modal__wallet" style=${`display: ${b?"":"none"}`}>
            ${dt.wallet}
            <div class="payment-modal__wallet-divider">
                <hr>
                <span data-lang="or_pay_with_card"></span>
            </div>
        </div>`}function H(B){let L=c[B]?Re(c[B]):"";return Ee`<p class="form-field__error">${L}</p>`}function z(){let B=BeFunky.debounce(pe,100);return Ee`
        <div class="form-field">
            <label class="form-field__label" for="payment_modal_card_holder_name">${Re("payment_modal_cc_name")}</label>
            <input
                type="text"
                name="cc-holdername"
                class=${`form-field__input ${c.name?"form-field__input--invalid":""}`}
                id="payment_modal_card_holder_name"
                data-bf="confirm-upgrade__cc-holdername"
                autocomplete="cc-name"
                @change=${B}
                @keyup=${B}
                @blur=${B}
            >
            ${H("name")}
        </div>`}function J(){return["number","expiry","cvc"].forEach(B=>{c[B]&&dt[B].addClass("form-field__input--invalid")}),Ee`
        <div class="form-field">
            <label class="form-field__label" for="payment_modal_card_inputs">${Re("payment_modal_cc_info")}</label>
            <fieldset class="form-field__fieldset" id="payment_modal_card_inputs">
                ${dt.number}
                ${H("number")}
                <div id="payment_modal_card_type" class="payment-modal__card-type">${p?Ee`<img alt=${p} src=${`${BeFunky.Params.globalAssetsPath}icons/credit-cards/cc-${p}.svg`} />`:""}</div>

                <div class="payment-modal__field-container">
                    ${dt.expiry}
                    ${H("expiry")}

                    ${dt.cvc}
                    ${H("cvc")}
                </div>
            </fieldset>
        </div>`}function X(){let B=BeFunky.debounce(ne,100),L=_||P?"payment-modal__promo-button button button--md button--selected":"payment-modal__promo-button button button--md button--grey-outline";return Ee`
        <div class="form-field payment-modal__promo">
            <label class="form-field__label" for="payment_modal_promo_inputs">${Re("promo_code")}</label>
            <fieldset class="form-field__fieldset" id="payment_modal_promo_inputs">
                <input
                    type="text"
                    name="promo-code"
                    class=${`form-field__input payment-modal__promo-input ${c.promo?"form-field__input--invalid":""}`}
                    id="payment_modal_promo"
                    value=${n}
                    @change=${B}
                    @keyup=${B}
                    @blur=${B}
                >
                ${H("promo")}

                <button @click=${ve} type="button" id="payment_modal_apply_promo" class=${L} .disabled=${_||Boolean(c.promo)}>
                    <span>${Re(P?"promo_applied":"apply_promo")}</span>
                    ${P?Br("checkmark-icon","icon payment-modal__promo-checkmark"):""}
                    ${_?Ee`<span id="payment_modal_promo_spinner" class="loading-spinner payment-modal__promo-spinner"></span>`:""}
                </button>
            </fieldset>
        </div>`}function ue(){if(!a)return"";let B=r==="month"?"billing_summary_monthly":"billing_summary_annual";T&&(B+="_trial");let L={amount:()=>`<strong>${qe(a[r],BeFunky.LanguageManager.language.modal)}</strong>`,renewal_policy:BeFunky.toLinkHTML(`${BeFunky.Params.siteUrl}renewal-policy/`,!0)};return Ee`<p class="payment-modal__billing-summary">${Re([B,L])}</p>`}function Q(){let B="submit_payment";return T&&(B="start_free_trial"),F&&(B="update"),Ee`<button type="submit" class="button button--fullwidth button--xl button--blue" data-bf="confirm-upgrade__submit">${Re(B)}</button>`}function pe(B){let L=B.target;se(L)?fe("name"):me("name","error_blank_name")}function ne(B){let L=B.target;ce(L)?fe("promo"):me("promo","error_invalid_promo_code"),f(L.value)}function ve(){let B=document.getElementById("payment_modal_promo").value.trim();C(B)}function _e(B){B.preventDefault(),c.form&&fe("form");let L=document.getElementById("payment_modal_card_holder_name"),R=L.value.trim();if(c.name||!R){L.dispatchEvent(new Event("change"));return}!Me.number||o(ze({cardHolderName:R,stripeElement:Me.number},he()))}function he(){return{email:t,mode:e,recurring:r,displayError:me,clearInputs:De,promoCode:P?g:void 0}}function se(B){let L=B.value.replace(/[\d@~`#$%^&*()\\/<>!+=:;"{}[\]|?]/g,"");return B.value=L,L.length>=3}function ce(B){let L=B.value.replace(/[^a-z0-9-]/g,"");return B.value=L,L?L.length>=10&&kn[L]!==!1:!0}function fe(B){if(!c.hasOwnProperty(B))return;let L=Object.assign({},c);delete L[B],d(L)}function me(B,L){let R=typeof L=="string"&&/^[a-z0-9_]+$/.test(L)?BeFunky.LanguageManager.getString(L,"modal"):L;["name","number","expiry","cvc","promo","form"].includes(B)||BeFunky.throwError(`Invalid field name: ${B}`),d(Object.assign({},c,{[B]:R})),console.log(`Payment error displayed ${B==="form"?"on form":`on ${B} field`}: "${R}"`)}function De(){document.getElementById("payment_modal_card_holder_name").value="",Me.number.clear(),Me.expiry.clear(),Me.cvc.clear()}function C(B){kn.hasOwnProperty(B)||(y(!0),BeFunky.requestAPI("transaction/validate-promo-code",{promo_code:B}).then(({data:L})=>{if(L!=="success")throw"invalid_response";kn[B]=!0}).catch(L=>{L==="invalid_promo_code"?(kn[B]=!1,me("promo","error_invalid_promo_code")):me("promo",BeFunky.failureReason(L))}).then(()=>{y(!1)}))}}function Uc(){let e=["bg","cs","da","de","el","en","es","et","fi","fr","hu","id","it","ja","lt","lv","ms","mt","nb","nl","pl","pt","ro","ru","sk","sl","sv","tr","zh"],t=BeFunky.LanguageManager.language.modal,n=e.includes(t)?t:"auto";return window.stripe.elements({locale:n,fonts:[{cssSrc:"https://fonts.googleapis.com/css2?family=Mulish:wght@400&display=swap"}]})}function Dc(e){let t={style:{base:{color:"#1D1B2F",fontWeight:400,fontFamily:"Mulish, Avenir Next, Trebuchet MS, system-ui, sans-serif",fontSize:"16px",fontSmoothing:"antialiased",lineHeight:"24px","::placeholder":{color:"#84809D"}},invalid:{color:"#1D1B2F"}},classes:{focus:"form-field__input--focused",invalid:"form-field__input--invalid"}};Me.number=e.create("cardNumber",t),Me.number.mount(dt.number),Me.number.on("change",({brand:n,error:o})=>{n&&xe.setCardType(n==="unknown"?"":n),o?xe.displayError("number",o.message):xe.clearError("number")}),Me.expiry=e.create("cardExpiry",t),Me.expiry.mount(dt.expiry),Me.expiry.on("change",({error:n})=>{n?xe.displayError("expiry",n.message):xe.clearError("expiry")}),Me.cvc=e.create("cardCvc",t),Me.cvc.mount(dt.cvc),Me.cvc.on("change",({error:n})=>{n?xe.displayError("cvc",n.message):xe.clearError("cvc")})}function jc(e){let t=window.stripe.paymentRequest(Ut(ze({},o()),{country:ct(),requestPayerName:!0,requestPayerEmail:!0})),n=e.create("paymentRequestButton",{paymentRequest:t});t.canMakePayment().then(r=>{Pa("canMakePayment",r),r?(xe.setWalletAvailable(!0),n.mount(dt.wallet),t.on("paymentmethod",i=>{i&&i.paymentMethod&&xe.onPaymentSubmit(ze({paymentRequestPaymentMethod:i.paymentMethod,paymentRequestCompleteFunction:i.complete},xe.getSharedSubmitData()))})):xe.setWalletAvailable(!1)}),pn(()=>{Promise.resolve().then(()=>{t.update(o())})});function o(){let r=xe.prices[xe.recurring],{unit_amount:i,currency:a}=r;return{currency:a,total:{label:xe.recurring==="month"?"BeFunky Plus Monthly":"BeFunky Plus Annual",amount:i}}}}Rc("payment-form",Mc);BeFunky.html5app_created=!1;BeFunky.originalPageTitle=document.title;BeFunky.appContainer=document.getElementById("bfn-app");BeFunky.appTemplate=null;BeFunky.appTemplateInjected=Boolean(BeFunky.appContainer.firstElementChild);BeFunky.readyHtml5App=()=>{if(BeFunky.html5app_created||!BeFunky.Params.canUseWebapp)return;if(BeFunky.appTemplateInjected){let{type:n}=window.currentDeepLinkParameters;return n!=="collage"&&n!=="designer"&&(BeFunky.cleanupEnterAppImmediately(),BeFunky.showLoadScreen(),document.getElementById("appViewport").addClass("show-drag-drop-area--initial"),document.getElementById("canvas_drag_drop_area").addClass("drag-drop-area--initial")),BeFunky.appContainer.addClass(`app-lang-${BeFunky.LanguageManager.language.app}`),e()}BeFunky.showLoadScreen(),BeFunky.waitUntil({condition:()=>BeFunky.appTemplate!==null&&BeFunky.appTemplateInjected===!1,onSuccess:()=>{let n=BeFunky.appTemplate.content;BeFunky.appTemplateInjected=!0,BeFunky.LanguageManager.renderLanguageStrings(n),BeFunky.appContainer.addClass(`app-lang-${BeFunky.LanguageManager.language.app}`).appendChild(n),BeFunky.cleanupEnterAppImmediately(),e()},onTimeout:()=>{console.log("BeFunky.appTemplate",BeFunky.appTemplate),console.log("BeFunky.appTemplateInjected",BeFunky.appTemplateInjected),navigator.connection&&console.log("Connection info:",["downlink","effectiveType","rtt"].map(o=>`	${o}: ${navigator.connection[o]}`).join("	")),BeFunky.throwError("Unable to inject bfn-app template in #bfn-app DIV."),BeFunky.hideLoadScreen()},interval:100,maxAttempts:300});function e(n=!1){n&&(window.appBundleLoaded||t("bundle",()=>window.scriptHasLoaded("app")),window.PIXI||t("scripts",()=>window.scriptHasLoaded("scripts"))),BeFunky.waitUntil({condition:()=>window.PIXI&&window.BFN&&window.BFN.readyApp,onSuccess:()=>{n||(BeFunky.trackUserTiming("App Init","app_bundle","network")(Math.round(window.appBundleLoadTime)),BeFunky.trackUserTiming("App Init","scripts_js","network")(Math.round(window.scriptsLoadTime)));let o=()=>{BFN.readyApp(()=>{BeFunky.html5app_created=!0})};if(!BeFunky.Params.isAdmin||!window.adminScriptsPromise)return o();window.adminScriptsPromise.then(()=>{window.dispatchEvent(new Event("BEFORE_INIT")),o()})},onTimeout:()=>{if(console.log("typeof PIXI = ",typeof window.PIXI),console.log("typeof BFN = ",typeof window.BFN),window.BFN&&console.log("typeof BFN.readyApp = ",typeof window.BFN.readyApp),console.log("window.appBundleLoaded = ",window.appBundleLoaded),navigator.connection&&console.log("Connection info:",["downlink","effectiveType","rtt"].map(r=>`	${r}: ${navigator.connection[r]}`).join("	")),!n)return BeFunky.throwError("Unable to initialize WebGL app. Attempting to load scripts with XHR..."),e(!0);BeFunky.throwError("Unable to initialize WebGL app."),BeFunky.hideLoadScreen(),BeFunky.acknowledge(["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}],{onAcknowledge:()=>window.location.reload(),imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-refresh.svg`})},interval:10,maxAttempts:3e3})}function t(n,o){let i=document.querySelector(`script[src*="/${n}."]`).src;BeFunky.loadScriptWithXHR(i).then(()=>{o(),BeFunky.throwError(`Successfully loaded ${n} with XHR`,i)}).catch(a=>{BeFunky.throwError(`Unable to load ${n} with XHR`,a,i)})}};var wn=BeFunky.appTemplateInjected?Promise.resolve():void 0;BeFunky.loadAppHTML=()=>wn||(wn=new Promise((e,t)=>{let n=`${BeFunky.Params.globalAssetsPath}html/bfn-app-min${BeFunky.Params.BFN_APP_HTML_VERSION}.txt`,o={responseType:"text"};BeFunky.request(n,o,({error:r,response:i})=>{if(r||!i||!i.length)return BeFunky.logError("Unable to download app HTML txt file",n,r||BeFunky.stringValue(i)),wn=void 0,t(r);BeFunky.Params.IS_LC&&(i=i.replace(/ src="\/images\//g,` src="${BeFunky.Params.globalImagesPath}`)),BeFunky.appTemplate=document.createElement("template"),BeFunky.appTemplate.innerHTML=i,e()})}),wn);setTimeout(()=>{if(window.webgl_is_supported){let e=BeFunky.trackUserTiming("App Init","app_html","network");BeFunky.loadAppHTML().then(()=>{e()},t=>{BeFunky.throwError("App could not start up b/c HTML failed to load",t)})}},0);window.isAppOpen=!1;BeFunky.siteScrollY=0;window.openApp=()=>{if(!BeFunky.Params.canUseWebapp){BeFunky.logError("App not opened b/c device is mobile");return}if(BeFunky.sessionRoutes.length===1&&BeFunky.isCreateRoute(BeFunky.sessionRoutes[0])?BeFunky.siteScrollY=0:BeFunky.siteScrollY=window.pageYOffset||0,window.isAppOpen){BeFunky.logError("openApp called unnecessarily b/c WebGL app is already open");return}window.isAppOpen=!0,BeFunky.moveModalRoot(BeFunky.appContainer),BeFunky.moveLoadScreen(BeFunky.appContainer);let e=document.getElementById("site_root")||document.getElementById("wrapper");e.setStyles({display:"none"}),[...e.querySelectorAll('video, iframe[src^="https://player.vimeo.com"]')].forEach(t=>{t.nodeName==="VIDEO"?t.pause():t.contentWindow.postMessage(JSON.stringify({method:"pause"}),"*")}),document.body.addClass("prevent-body-scroll").addClass("app-is-open"),BeFunky.updateThemeColor("app"),BeFunky.LanguageManager.setLanguage(BeFunky.LanguageManager.language.app,["modal"]),BeFunky.appContainer.setStyles({display:""}).removeClass("bfn--hidden"),BeFunky.readyHtml5App()};BeFunky.cleanupEnterAppImmediately=()=>{let e=document.getElementById("app_loading_overlay");e&&(e.setStyles({display:"none"}),requestIdleCallback(()=>{e.parentElement&&e.parentElement.removeChild(e)}))};window.setApplicationMode=e=>{(!e||typeof e!="string")&&(e="photoeditor"),BeFunky.html5app_created&&BFN.AppModel.applicationModeChange(e)};window.currentDeepLinkParameters={type:"photoeditor"};window.openUploadPanel=e=>{let{type:t="photoeditor",img:n,template:o,tag:r,ignoreExistingProject:i=!1,availability:a}=window.deepLinkRouteData[e]||e||{};if(!BeFunky.Params.canUseWebapp){BeFunky.logError("Deep link to app not opened b/c device is mobile"),BeFunky.handleMobileUserAttemptToOpenApp(a),BeFunky.leaveCreateRoute();return}if(BeFunky.isTablet&&!window.webgl_is_supported){BeFunky.logError("Tablet failed WebGL test"),BeFunky.handleMobileUserAttemptToOpenApp(a),BeFunky.leaveCreateRoute();return}if(window.failed_webgl_tests.length&&!window.has_acknowledged_webgl_issue&&window.webgl_is_supported){window.has_acknowledged_webgl_issue=!0;let u=window.failed_webgl_tests,s={failingTests:u,hasUsedAppBefore:Boolean(getCookie("gl_sprt")==="1"||BeFunky.getLocal("__IndexedDB_version"))};if(u.includes("no_high_perf_canvas")&&!BeFunky.isTablet){let c=`
                <p data-lang="acknowledge_perf_issue">${BeFunky.LanguageManager.getString("acknowledge_perf_issue")}</p>
                <p>${BeFunky.toLinkHTML(BeFunky.getArticleForPerfIssue(),!0)("learn_more","app")}</p>
            `;BeFunky.acknowledge(c,{isCritical:!0}),BeFunky.logWarning("User entered app without high perf canvas",window.webglUnmaskedRenderer,JSON.stringify(s))}else BeFunky.reportWarning(`User entered app after WebGL test failed ${window.failed_webgl_tests[0]}`,JSON.stringify(s))}let l=!BeFunky.html5app_created&&BeFunky.Params.openurl?BeFunky.Params.openurl:n;if(window.currentDeepLinkParameters={type:t,template:o,tag:r,img:l,ignoreExistingProject:i},window.webgl_is_supported){BeFunky.setupPaywallOnce(),window.openApp(),window.applyDeepLinkParameters();return}BeFunky.acknowledge(BeFunky.webGLTestResultsTemplate(window.failed_webgl_tests,!1)),BeFunky.leaveCreateRoute(),window.failed_webgl_tests.length||BeFunky.throwError("failed_webgl_tests inaccurate")};BeFunky.getArticleForPerfIssue=()=>BeFunky.isChromium?BeFunky.isOpera?"https://support.befunky.com/hc/en-us/articles/360045634352#h_opera":BeFunky.isEdge?"https://support.befunky.com/hc/en-us/articles/360054839372":"https://support.befunky.com/hc/en-us/articles/360054508232":BeFunky.isFirefox?"https://support.befunky.com/hc/en-us/articles/360054510672":BeFunky.isSafari?"https://support.befunky.com/hc/en-us/articles/360045634352#h_safari":"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-browser-is-unable-to-run-befunky";BeFunky.setupPaywallOnce=BeFunky.once(()=>{if(!BeFunky.isNewUserEligibleForFreeTrial||![["/features/photo-to-art/","/create/photo-to-art/"],["/features/photo-to-cartoon/","/create/photo-to-cartoon/"],["/features/background-remover/","/create/background-remover/"],["/features/digital-art/","/create/digital-art/"],["/features/photo-enhancer/","/create/photo-enhancer/"],["/features/graphic-designer/","/create/designer/"],["/features/card-maker/","/create/card-maker/"],["/features/brochure-maker/","/create/brochure-maker/"],["/features/poster-maker/","/create/poster-maker/"],["/features/banner-maker/","/create/banner-maker/"]].some(r=>BeFunky.sessionRoutes.map(n).isIdenticalTo(r)))return;fn(ct(),!0),bf_eventTrack("ONBOARDING_7DAY_TRIAL_SAVE","TRIAL OFFERED",o(BeFunky.initialRoute));function n(r){return r.split(/[?#]/)[0]}function o(r){return r.split(/[?#]/)[0].split("/").filter(Boolean).pop()}});BeFunky.leaveCreateRoute=()=>{setTimeout(()=>{BeFunky.isCreateRoute()&&(BeFunky.sessionRoutes.length>1?window.history.back():de(so)),BeFunky.updateThemeColor("site"),BeFunky.measureSiteNavDropdowns&&BeFunky.measureSiteNavDropdowns(),BeFunky.appContainer.style.display!=="none"&&!BeFunky.appContainer.hasClass("bfn--hidden")&&window.hideEditor()},0)};BeFunky.handleMobileUserAttemptToOpenApp=e=>{let t=e==="web_mobile_apps",n=e==="web_visionn_app"&&BeFunky.isIOS;if(t||n){let a=document.createElement("div");a.appendChild(document.createElement("p").setLang("try_mobile_app","site")),a.appendChild(document.createElement("p").setLang("edits_on_the_go","site"));let l=BeFunky.isIOS?"open_app_store":"open_play_store";return BeFunky.confirm(a,{confirmText:l,onConfirm:()=>{window.open(i(),"_blank")}})}let o=document.createElement("div");o.appendChild(document.createElement("p").setLang("accessible_from_desktop","site")),o.appendChild(document.createElement("p").setLang("great_mobile_app","site"));let r=BeFunky.isIOS?"open_app_store":"open_play_store";return BeFunky.confirm(o,{confirmText:r,onConfirm:()=>{window.open(i(),"_blank")}});function i(){return n?"https://itunes.apple.com/app/apple-store/id1142803226?mt=8":BeFunky.isIOS?"https://itunes.apple.com/us/app/befunky-photo-editor/id442716817?mt=8":`https://play.google.com/store/apps/details?id=air.com.befunky.${/mobile/i.test(navigator.userAgent)?"BeFunkyPhotoEditor":"BeFunkyPad"}`}};BeFunky.trackDeepLink=function(e,t){if(typeof e!="string")return BeFunky.throwError(`Invalid action: ${BeFunky.getType(e)}`,e);if(BeFunky.Params.canUseWebapp||(e=`${e}_${BeFunky.isIOS?"IOS":"ANDROID"}`),!t){let n=[...BeFunky.sessionRoutes].reverse().find(o=>!BeFunky.isCreateRoute(o));if(!n){console.log("Session routes:",JSON.stringify(BeFunky.sessionRoutes)),BeFunky.throwError("Unable to find non-create route to track Deep Link button click");return}n==="/"?t="HOME":t=n.split("?")[0].split("#")[0].replace(/(^\/)|(\/$)/g,"").replace(/\//g,"_").toUpperCase()}window.bf_eventTrack("EXTERNAL",e,t)};window.hideEditor=(e=!0)=>{if(BeFunky.appContainer.addClass("bfn--hidden"),BeFunky.moveModalRoot(document.body),BeFunky.moveLoadScreen(document.body),(document.getElementById("site_root")||document.getElementById("wrapper")).setStyles({display:""}),BeFunky.updateThemeColor("site"),BeFunky.befunkyPopupDivOpened!==!0&&document.body.removeClass("prevent-body-scroll"),document.body.removeClass("app-is-open"),window.isAppOpen=!1,document.title=BeFunky.originalPageTitle,BeFunky.LanguageManager.setLanguage(BeFunky.LanguageManager.language.site,["modal"]),(window.webgl_is_supported||!e)&&BeFunky.isCreateRoute()){let n=[...BeFunky.sessionRoutes].slice(1).reverse().find(o=>!BeFunky.isCreateRoute(o));typeof n=="string"?de(n):de(so)}return window.scrollTo?window.scrollTo(0,BeFunky.siteScrollY):document.documentElement.scrollTop=BeFunky.siteScrollY,BeFunky.measureSiteNavDropdowns&&BeFunky.measureSiteNavDropdowns(),BeFunky.setSentryTag("app_section","site"),!1};window.applyDeepLinkParameters=()=>{let{type:e,img:t,ignoreExistingProject:n}=window.currentDeepLinkParameters;if(console.log("Entering app w/ deep link parameters:",window.currentDeepLinkParameters),t){let o=n?"befunky":"sample";BeFunky.editorExternalImage={ignoreExistingProject:n,loadImage:()=>{BFN.BfnService.ToJsUrlUploader(t,null,!0,o)}}}window.setApplicationMode(e)};document.addEventListener("visibilitychange",()=>{let e=new Date,t=`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`;BeFunky.Params.IS_LC||console.log(`Tab ${document.visibilityState} at ${t}`)});{let e;BeFunky.updateThemeColor=function(t){if(e=e||document.head.querySelector('meta[name="theme-color"]'),!e)return;let n;t==="app"?n=window.BFN&&BFN.getTheme&&BFN.getTheme()==="light"?"#F8F8FB":"#1C1D26":n=e.getAttribute("default-value")||"#FAFAFA",e.setAttribute("content",n)}}window.createJavascriptElements=(e,t)=>{let n=(o,r,i,a,l)=>{let u=document.createElement("script");u.type="text/javascript",u.async=t==null,u.src=o,r&&(u.id=r),i&&u.setAttribute(i,a),l!=null&&(u.onreadystatechange=l,u.onload=l),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(u)};e!=null&&n(e,null,null,null,t)};window.isEmailAddress=e=>/^[\w-+]+(\.[\w-+]+)*@([\w-]+\.)+[a-zA-Z]{2,10}$/.test(e);window.parseXml=e=>new window.DOMParser().parseFromString(e,"text/xml");window.azrc={isFunction(e){return toString.call(e)==="[object Function]"},isArray(e){return toString.call(e)==="[object Array]"},isPlainObject(e){if(!e||toString.call(e)!=="[object Object]"||e.nodeType||e.setInterval||e.constructor&&!hasOwnProperty.call(e,"constructor")&&!hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1;let t;for(t in e);return t===void 0||hasOwnProperty.call(e,t)},extend(){let e,t,n,o,r,i,a=arguments[0]||{},l=1,u=arguments.length,s=!1;for(typeof a=="boolean"&&(s=a,a=arguments[1]||{},l=2),typeof a!="object"&&!window.azrc.isFunction(a)&&(a={}),u===l&&(a=this,--l);l<u;l++)if((e=arguments[l])!=null)for(t in e)n=a[t],o=e[t],a!==o&&(s&&o&&(window.azrc.isPlainObject(o)||(r=window.azrc.isArray(o)))?(r?(r=!1,i=n&&window.azrc.isArray(n)?n:[]):i=n&&window.azrc.isPlainObject(n)?n:{},a[t]=window.azrc.extend(s,i,o)):o!==void 0&&(a[t]=o));return a}};BeFunky.ConvertToBool=e=>e!=""&&(e=="1"||e=="true"||e==!0||e=="yes");BeFunky.shareLink=(e,t,n,o,r)=>{let i=e.toUpperCase()==="PINTEREST"?`http://pinterest.com/pin/create/button/?url=${t}&description=${o}&media=${n}`:e.toLocaleUpperCase()==="TWITTER"?`${BeFunky.Params.siteUrl}tweetSend.php?url=${t}&imgtitle=${o}`:`https://www.facebook.com/dialog/share?app_id=120991377944644&display=popup&href=${t}`;if(r)try{window.openCustomPopup(i)}catch(a){}else{let a="ok";BeFunky.confirm(["open_share_popup",{ok:BeFunky.LanguageManager.getString(a)}],{onConfirm:()=>{window.openCustomPopup(i)},confirmText:a})}};BeFunky.befunkyPopupDivOpened=!1;var Sr=[];BeFunky.befunkyPopupContainerOpen=(e,t,n=!0)=>{let o=e.replace("#",""),r=document.getElementById(o);if(t||(t={}),Sr.includes(o)||Sr.push(o),n){let u=BeFunky.getModal(),s=u?u.modalElement.id:void 0;if(Sr.includes(s)){BeFunky.preventModalDispose=!0,BeFunky.closeModal(s),BeFunky.preventModalDispose=!1;let c=document.getElementById("modal_root");c.addClass("modal-root--disable-transitions"),requestAnimationFrame(()=>{c.removeClass("modal-root--disable-transitions")})}}BeFunky.befunkyPopupDivOpened=!0;let i=t.addCaptcha&&r.querySelector(".captcha"),a=()=>{if(!i)return;let u=r.querySelector("[type=submit]");u.disabled=!0,BeFunky.renderOrResetCaptcha(i,()=>{u.disabled=!1})},l=()=>{!i||!i.parentElement||i.parentElement.replaceChild(document.createElement("div").addClass("captcha"),i)};BeFunky.openModal(r,{onOpen:()=>{a()},onClose:()=>{l(),Oc(r),BeFunky.preventModalDispose?BeFunky.befunkyPopupDivOpened=!1:Sa(),typeof r.onModalClose=="function"&&r.onModalClose(),t.onClose&&t.onClose()},addLightThemeClass:!0,addCloseButton:typeof t.addCloseButton=="boolean"?t.addCloseButton:!0,closeOnClickOutside:typeof t.closeOnClickOutside=="boolean"?t.closeOnClickOutside:!0,size:t.size||"large",isCritical:!!t.isCritical,destroyOnClose:!!t.destroyOnClose})};BeFunky.befunkyPopupContainerClose=()=>{if(BeFunky.befunkyPopupDivOpened){let e=BeFunky.getModal(),t=e?e.modalElement.id:void 0;t&&BeFunky.closeModal(t);let n=document.getElementById("modal_root");n.addClass("modal-root--disable-transitions"),requestAnimationFrame(()=>{n.removeClass("modal-root--disable-transitions"),Sa()})}return!1};function Sa(){BeFunky.isLoggedIn()&&typeof BeFunky.LoginPanelObj.onLogin=="function"?BeFunky.LoginPanelObj.onLogin():!BeFunky.isLoggedIn()&&typeof BeFunky.LoginPanelObj.onCloseWithoutLogin=="function"&&BeFunky.LoginPanelObj.onCloseWithoutLogin(),BeFunky.befunkyPopupDivOpened=!1,BeFunky.LoginPanelObj.onLogin=!1,BeFunky.LoginPanelObj.onCloseWithoutLogin=!1}function Oc(e){let t=e.querySelector(".form-errors");t&&(t.innerHTML=""),e.querySelectorAll(".form-field__input--invalid").removeClass("form-field__input--invalid")}var La=class{constructor(){window.onUserStatusChange(this.handleUserDataChange.bind(this)),this.listenForUserChangesInOtherTabs(),this.setupPolling(),this.closeWarningDialog=()=>{},this.playStorePlusUserExists=!1}listenForUserChangesInOtherTabs(){window.addEventListener("storage",t=>{if(t.key!=="latest_user_email")return;let{error:n,emailInBrowser:o,debugData:r}=this.detectUserChangeInDifferentTab()||{};if(!n){this.closeWarningDialog();return}this.decodeUserToken().then(i=>{let a=i?Object.assign({},i,{email:this.anonymizeEmail(i.email)}):"(no_user)";return n==="not_logged_in"&&i||o&&o!==i.email?BeFunky.throwError("LocalStorage does not match Fastly",a,r):this.handleUserSessionError({error:n,userData:i})}).catch(i=>{i==="request_failed"?BeFunky.logError(`/check-user/ polling failed: ${i}`):BeFunky.reportWarning(`/check-user/ polling failed: ${i}`,i)})})}setupPolling(){this.pollingTimeout=null,this.pollingInterval=1e3*60*60,this.resetPolling()}resetPolling(){clearTimeout(this.pollingTimeout),this.pollingTimeout=setTimeout(this.checkUserToken.bind(this),this.pollingInterval)}checkUserToken(t,n){clearTimeout(this.pollingTimeout),this.decodeUserToken().then(o=>{if(t==="already_logged_in"&&o&&BeFunky.isLoggedIn())return;let r;if(o&&!BeFunky.isLoggedIn()?r="already_logged_in":!o&&BeFunky.isLoggedIn()?r="not_logged_in":o.email&&window.latestUserData.email&&o.email!==window.latestUserData.email&&(r="wrong_user"),t&&t!==r){if(!o&&t==="not_logged_in"&&!BeFunky.isLoggedIn())return;let i=o?Object.assign({},o,{email:this.anonymizeEmail(o.email)}):"(no_user)";BeFunky.throwError(`User session errors do not match. Fastly = "${r}", ${n} = "${t}"`,i);return}r&&this.handleUserSessionError({error:r,userData:o})}).catch(o=>{o==="request_failed"?BeFunky.logError(`/check-user/ polling failed: ${o}`):BeFunky.reportWarning(`/check-user/ polling failed: ${o}`,o)}).then(()=>{this.resetPolling()})}decodeUserToken(){return new Promise((t,n)=>{let o=`${BeFunky.Params.siteUrl}check-user/`,r={method:"POST"};BeFunky.request(o,r,({error:i,response:a})=>{if(i==="not_logged_in")return t(!1);if(a&&a.email)return t(a);n(i||"invalid_response")})})}detectUserChangeInDifferentTab(){let t=window.latestUserData.email,n=BeFunky.getLocal("latest_user_email"),o=t?`Logged in as ${this.anonymizeEmail(t)}`:"Logged out",r=n?`Logged in as ${this.anonymizeEmail(n)}`:n===null?"Logged out":"Unknown",i=`[In this tab: ${o}] vs [In browser: ${r}]`;if(!t&&n)return{error:"already_logged_in",emailInThisTab:t,emailInBrowser:n,debugData:i};if(t&&n===null)return{error:"not_logged_in",emailInThisTab:t,emailInBrowser:n,debugData:i};if(t&&n&&t!==n)return{error:"wrong_user",emailInThisTab:t,emailInBrowser:n,debugData:i}}anonymizeEmail(t){return`${t.slice(0,2)}...@${t.slice(t.indexOf("@")+1,t.indexOf("@")+3)}...`}handleUserSessionError({error:t,userData:n}){this.closeWarningDialog();let o=window.latestUserData.email;if(t==="already_logged_in"){this.closeWarningDialog=BeFunky.confirm("user_already_logged_in",{confirmText:["continue_as_user",{username:n.user_name||n.email}],onConfirm:()=>{BeFunky.requestAPI("auth/status",{},{showLoadScreen:!0}).then(({data:r})=>{r.email?window.updateUserStatus(r):BeFunky.throwError("/status/ missing email",r)}).catch(r=>{BeFunky.reportWarning(`/status/ failed when handling session error: ${r}`)}).then(()=>{BeFunky.hideLoadScreen()})},onCancel:()=>{}});return}if(t==="not_logged_in"){window.updateUserStatus({error:"not_logged_in"}),this.handleClientSideLogout(),this.closeWarningDialog=BeFunky.acknowledge(["user_not_logged_in_refresh",{email:o}]);return}if(t==="wrong_user"){this.closeWarningDialog=BeFunky.acknowledge(["user_not_logged_in_refresh",{email:o}]);return}BeFunky.throwError("Unhandled user session error",t)}handleClientSideLogout(){if(BeFunky.User=BeFunky.getDefaultUser(),window.BFN&&BFN.BfnService&&BFN.BfnService.updateUserData)try{BFN.BfnService.updateUserData()}catch(t){BeFunky.throwError("updateUserData error after client-side logout",t)}}handleUserDataChange(t){if(!t.email)return;let{user_name:n,email:o,pl:r,btknid:i,language:a,register_date:l,register_from:u,login_date:s,login_count:c,newUser:d,isMailVerified:p,plan_type:m,subscr_date:g,subscr_count:f,subscr_amount:_,subscr_first_date:y,subscr_ltv:h,subscr_usr:w,subscr_tusr:F,subscription_status:b,trial_source:E,payment_type:P,can_change_user_name:T,is_subscribe_newsletter:$,is_beta_user:N=0,options:j,luk:G}=t;if(BeFunky.User.email=o,BeFunky.User.username=n,BeFunky.User.pl=r,t.btknid&&(BeFunky.Params.btknid=i,BeFunky.Params.isBetaUser=N===1,BeFunky.User.language=a,BeFunky.User.register_date=l,BeFunky.User.register_from=u,BeFunky.User.login_date=s,BeFunky.User.login_count=parseInt(c),BeFunky.User.isNewUser=BeFunky.ConvertToBool(d),BeFunky.User.options=j,BeFunky.User.subscription_status=b,BeFunky.User.trial_source=E,BeFunky.User.payment_type=P,BeFunky.User.can_change_user_name=BeFunky.ConvertToBool(T),BeFunky.User.is_subscribe_newsletter=BeFunky.ConvertToBool($),BeFunky.User.isMailVerified=p==="1",BeFunky.Params.isMailVerified=p==="1",BeFunky.User.plan_type=m,BeFunky.User.subscr_date=g,BeFunky.User.subscr_count=f,BeFunky.User.subscr_amount=_,BeFunky.User.subscr_first_date=y,BeFunky.User.subscr_ltv=h,BeFunky.User.subscr_usr=w,BeFunky.User.subscr_tusr=F),a&&a!==BeFunky.LanguageManager.language.app)try{BeFunky.LanguageManager.setLanguage(a,["app"]),window.BFN&&BFN.SettingsManager&&(BFN.SettingsManager.remoteSettings.language=a)}catch(H){BeFunky.throwError(H,n,BeFunky.stringValue(a))}if(mn()&&f&&(ho(!1,!1),BeFunky.removeLocal("user_trial")),window.BFN&&BFN.BfnService)try{BFN.BfnService.updateUserData()}catch(H){BeFunky.throwError("updateUserData error",H)}BeFunky.setSentryTag("plus",BeFunky.isPlus()),Sentry.configureScope(H=>{G&&H.setUser({id:G})}),setTimeout(()=>{["free","plus"].includes(b)&&BeFunky.SettingsService.getUserSettings(({settings:H})=>{H.trialing==="trialing"&&BeFunky.SettingsService.updateSetting("trialing",b).then(()=>{let z=parseInt(m)>0?"YEARLY":"MONTHLY",J=E==="chromeos_perk_two_trial"?"TRIAL_CONVERSION":E.toUpperCase();b==="free"?bf_eventTrack(J,z,"TRIAL CANCELLED"):b==="plus"&&(bf_eventTrack(J,z,"TRIAL SUCCEEDED"),bf_eventTrack("CONVERSION",z,"CREDITCARD"))})})})}handlePlayStoreUser(t,n,o){if(t===BeFunky.User.email||n==="free"||BeFunky.isPlus())return;if(this.playStorePlusUserExists=!0,o==="upgrade")return r();o==="initial"&&(BeFunky.isDashboard()||window.isAppOpen)&&r();function r(){return window.BFN&&BFN.ProjectManager&&BFN.ProjectManager.autoSave&&BFN.ProjectManager.autoSave[BFN.AppModel.sectionID].lastSaveLocation==="memory"?BeFunky.acknowledge(["chromeos_prompt_sign_in_plus",{email:t}]):BeFunky.confirm(["chromeos_prompt_sign_in_plus",{email:t}],{confirmText:["sign_in_as",{email:t}],onConfirm:()=>{BeFunky.setLocalSession("next_sign_in_email",t),BeFunky.signOut(`${BeFunky.Params.siteUrl}sign-in/`)},focusConfirmButton:!1})}}};BeFunky.UserManager=new La;BeFunky.captchaWidget=null;BeFunky.renderOrResetCaptcha=(e,t=()=>{})=>{if(!e)return BeFunky.throwError("Unable to find captcha container"),t();Ca(()=>{if(e.firstElementChild)return window.grecaptcha.reset(),t();let n=BeFunky.Params.IS_LC?"6LePbqoUAAAAAITuugtKJnS15GkfdP5MZGInsrk8":"6LcXOpkUAAAAAOKNQzyDv-gS8Nu6cTgwW6m3sXQu";return BeFunky.captchaWidget=window.grecaptcha.render(e,{sitekey:n,hl:BeFunky.LanguageManager.language[window.isAppOpen?"app":"site"],size:"invisible",callback(o){o!==""&&(BeFunky.invisibleCaptchaHandler(o),console.log("User successfully completed captcha"))}}),t()})};BeFunky.getCaptchaResponse=()=>{try{return window.grecaptcha.getResponse(BeFunky.captchaWidget)}catch(e){}return""};BeFunky.invisibleCaptchaHandler=()=>{typeof BeFunky.executeCaptchaCallback=="function"&&(BeFunky.executeCaptchaCallback(),BeFunky.executeCaptchaCallback=null)};BeFunky.executeCaptchaCallback=null;BeFunky.executeCaptcha=e=>{if(BeFunky.executeCaptchaCallback=e,window.grecaptcha.execute(BeFunky.captchaWidget),window.innerHeight<650){let n;BeFunky.waitUntil({condition:()=>(n=n||t(),!!n),onTimeout:()=>{},onSuccess:()=>{let{top:o}=n.parentElement.getBoundingClientRect();n.parentElement.setStyles({maxHeight:`calc(100vh - ${o}px)`,overflowY:"auto"})},interval:300,maxAttempts:15})}function t(){return[...document.querySelectorAll('iframe[title^="recaptcha"]')].find(o=>{try{return o.parentElement.parentElement.style.visibility!=="hidden"}catch(r){}return!1})}};function Ca(e,t=!1){if(r())return e();let n=`https://www.google.com/recaptcha/api.js?${new URLSearchParams({h1:BeFunky.LanguageManager.language[window.isAppOpen?"app":"site"],render:"explicit"}).toString()}`;BeFunky.loadScript(n).then(()=>{BeFunky.waitUntil({condition:r,interval:100,maxAttempts:50,onSuccess:e,onTimeout:o})},o);function o(i){t?BeFunky.throwError(`Unable to load Google ReCAPTCHA: ${i}`,{grecaptcha:window.grecaptcha}):BeFunky.befunkyPopupDivOpened&&!BeFunky.isLoggedIn()&&BeFunky.confirm("error_request_failed",{confirmText:"try_again",onConfirm:()=>{r()?e():Ca(e,!0)},onCancel:()=>{r()&&e()}})}function r(){return window.grecaptcha&&typeof window.grecaptcha.render=="function"}}BeFunky.closeAccount=e=>{let t={closeKey:e};BeFunky.requestAPI("auth/close-account",t,{showLoadScreen:!0}).then(n=>{if(n.data!=="success")throw"invalid_response";BeFunky.showLoadScreen({message:"closing_account",progress:0}),setTimeout(BeFunky.updateAccountCloseStatus,2555)}).catch(n=>{BeFunky.throwError("Unable to close account",JSON.stringify({error:n})),Ea()})};var ko=!1,Lr=0;BeFunky.updateAccountCloseStatus=()=>{ko||(ko=!0,BeFunky.requestAPI("auth/close-account-status",{}).then(e=>{ko=!1;let t=parseInt(e.data.stepPercentageComplete)||0;if(t?Lr=t:Lr++,BeFunky.showLoadScreen({message:"closing_account",progress:Lr}),parseInt(e.data.isFinished)===1){BeFunky.hideLoadScreen(),BeFunky.acknowledge("account_deleted",{onAcknowledge:()=>{BeFunky.signOut()},imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/photo-project-shredder.svg`});return}setTimeout(BeFunky.updateAccountCloseStatus,100)}).catch(e=>{ko=!1,BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get account close status",JSON.stringify({error:e})),Ea()}))};function Ea(){let{elem:e,lang:t}=BeFunky.lit;BeFunky.acknowledge(e`
    <div>
        <p>${t("error_close_account","site")}</p>
        <p>${t(["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}],"site")}</p>
    </div>`)}window.getSystemInformation=e=>{let t=`${BeFunky.Params.globalAssetsPath}js/ua-parser-0.7.22.min.js`,n=()=>Boolean(window.UAParser);return BeFunky.loadScript(t,n).then(()=>new UAParser().getResult()).then(o=>{if(delete o.ua,delete o.cpu,o.wbglts=window.webglTextureSize||-1,o.wbglcts=window.webglCombinedTextureUnits||-1,o.wbglumr=window.webglUnmaskedRenderer||-1,o.screen=window.screen?`${screen.width} x ${screen.height}`:"",o.viewport=`${window.innerWidth} x ${window.innerHeight}`,o.appType="HTML5",o.performance_issue=window.webGLPerformanceIssue||"Not checked",e){let r=i=>JSON.stringify(i).replace(/"([:,])"/g,"$1 ").replace(/"/g,"");return Object.entries(o).map(([i,a])=>`--${i.toUpperCase()}: ${r(a)}`).join(", ")}return o})};var{html:Qe,setupState:Nc,render:xa,lang:vt,icon:Hc}=BeFunky.lit;function Ye(e,t,{formClass:n="form-modal__form"}={}){t=Object.assign({title:"test",notification:"",button:"submit",context:"site",confirmation:"",fields:[{name:"test",label:"label",maxLength:100,errorMessage:"error_message",isValid:!0,type:"text",sanitize:f=>f,validate:()=>!0}],onSubmit:console.log,submissionErrors:[]},t);let r=!1,i=BeFunky.debounce(()=>{xa(s(),e),r||(r=!0,g(e))},"raf"),[a,l]=Nc(t,i);BeFunky.LanguageManager.addLanguageUpdateListener(i);let u=Math.floor(Math.random()*1e6);return{teardown:()=>xa(Qe``,e),setFormState:l};function s(){return a.confirmation?c():Qe`
        <h3 class="h5">${vt(a.title,a.context)}</h3>
        <form class=${n} @submit=${p}>
            ${a.notification?Qe`
                <p class="form-modal__notification">${vt(a.notification,a.context)}</p>
            `:""}
            ${a.submissionErrors.length?Qe`
                <div class="form-errors">
                    <div class="form-errors__container">
                    ${a.submissionErrors.map(f=>Qe`<div>${vt(f,a.context)}</div>`)}
                    </div>
                    <button @click=${d} type="button" class="button button--icon button--xs form-errors__close-button">
                        ${Hc("cancel-icon","icon icon--14")}
                    </button>
                </div>
            `:""}
            ${a.fields.map(({name:f,label:_,type:y="text",errorMessage:h="",maxLength:w,isValid:F,sanitize:b,fieldType:E="input",initialValue:P=""})=>{let T;typeof b=="function"&&(T=BeFunky.debounce(N=>{N.target.value=b(N.target.value)},100));let $;return E==="input"&&($=T?Qe`
                    <input
                        class="${`form-field__input ${F===!1?"form-field__input--invalid":""}`}"
                        value=${P}
                        id=${m(f)}
                        name=${f}
                        type=${y}
                        maxLength=${w}
                        required
                        @change=${T}
                        @keyup=${T}
                        @blur=${T}
                    >
                `:Qe`
                    <input
                        class="${`form-field__input ${F===!1?"form-field__input--invalid":""}`}"
                        id=${m(f)}
                        name=${f}
                        type=${y}
                        maxLength=${w}
                        required
                    >
                `),E==="textarea"&&($=T?Qe`
                    <textarea
                        class="${`form-field__textarea ${F===!1?"form-field__textarea--invalid":""}`}"
                        id=${m(f)}
                        name=${f}
                        type=${y}
                        required
                        rows="8"
                        cols="50"
                        @change=${T}
                        @keyup=${T}
                        @blur=${T}
                    ></textarea>
                `:Qe`
                    <textarea
                        class="${`form-field__textarea ${F===!1?"form-field__textarea--invalid":""}`}"
                        id=${m(f)}
                        name=${f}
                        type=${y}
                        required
                        rows="8"
                        cols="50"
                    ></textarea>
                `),Qe`
                    <div class="form-field">
                        <label class="form-field__label" for=${m(f)}>${vt(_,a.context)}</label>
                        ${$}
                        <p class="form-field__error">${vt(h,a.context)}</p>
                    </div>
                `})}
            <button class="button button--blue button--md" type="submit">${vt(a.button,a.context)}</button>
        </form>
        `}function c(){return Qe`
            <h3 class="h5">${vt(a.title,a.context)}</h3>
            <p class="form-modal__confirmation">${vt(a.confirmation,a.context)}</p>
        `}function d(){l({submissionErrors:[]})}function p(f){f.preventDefault();let _=a.fields.map(({name:h})=>h).reduce((h,w)=>(h[w]=document.getElementById(m(w)).value,h),{}),y=a.fields.map(h=>{let w=typeof h.validate!="function"||h.validate(_[h.name],_);return Object.assign({},h,{isValid:w})});l({fields:y}),y.every(h=>h.isValid)&&a.onSubmit(_)}function m(f){return`input_${u}_${f.replace(/^[^a-z]+|[^\w:.-]+/gi,"")}`}function g(f){let _=f.querySelectorAll("input");for(let y=0;y<_.length;y++)if(_[y].offsetParent){_[y].focus();break}}}function qc(e){let t=document.createElement("div").setClass("modal form-modal");return t.id=`modal_form_${e}`,t}function Wc(e,t){BeFunky.openModal(e,{addCloseButton:!0,size:"extra-small",destroyOnClose:!0,onClose:t})}BeFunky.formModal=Ye;BeFunky.createFormModalContainer=qc;BeFunky.openFormModal=Wc;window.webgl_is_supported=!1;window.graphic_black_list=[];window.failed_webgl_tests=[];Vc();BeFunky.runWebGLTests=Cr;BeFunky.webGLTestResultsTemplate=Qc;BeFunky.checkWebGLSupport=$a;function Vc(){BeFunky.Params.canUseWebapp&&$a(),/(Windows 7|Windows NT 6.1)/.test(navigator.userAgent||"")||window.webglTextureSize<=4096||!BeFunky.isRetina()?window.bfn_resolution=1:window.bfn_resolution=2}function $a(){let{results:e,canvasContext:t}=Cr(),n=e.filter(i=>!i.hasPassed).map(i=>i.name);if(window.failed_webgl_tests=n,requestIdleCallback(()=>Gc(n)),window.webgl_is_supported=zc(n),!window.webgl_is_supported){BeFunky.logError("WebGL test failed",window.failed_webgl_tests);let i=n.includes("no_webgl_canvas")?"no_webgl_canvas":n[0];window.bf_eventTrack("EXTERNAL","WEBGL_DISABLED_REASON",i.toUpperCase());return}window.FixedPixiPaddingSize=8;let o=4096;window.BfnmaxImageSize=o-window.FixedPixiPaddingSize,window.webglCombinedTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let r=window.webglTextureSize>window.BfnmaxImageSize&&window.webglCombinedTextureUnits>79?8192:Math.min(4096,window.webglTextureSize)||4096;window.BfnmaxImageSize=Math.min(window.BfnmaxImageSize,r-window.FixedPixiPaddingSize),console.log("Max Image Size Set:",window.BfnmaxImageSize,"Max Image Size that BeFunky can support:",r),window.bf_eventTrack("EXTERNAL","WEBGL_GRAPHIC",window.webglUnmaskedRenderer||"(unknown)"),navigator.deviceMemory&&window.bf_eventTrack("EXTERNAL","DEVICE_MEMORY",navigator.deviceMemory)}function Gc(e){if(BeFunky.testingFlags.includes("disable_webgl_performance_check")||e.includes("no_webgl_canvas"))return;let t=!e.includes("no_high_perf_canvas"),n=window.webglUnmaskedRenderer||"(unknown)",o;try{o=JSON.parse(BeFunky.getLocal("last_renderer"))}catch(r){}if(BeFunky.setLocal("last_renderer",JSON.stringify({isHighPerformance:t,renderer:n})),o&&o.isHighPerformance!==t){let r=t?"WEBGL_PERF_FIXED":"WEBGL_PERF_BROKEN",i=n===o.renderer?`SAME: ${n}`:`${o.renderer} \u2192 ${n}`;bf_eventTrack("EXTERNAL",r,i),t?BeFunky.logWarning("WebGL performance was fixed",i):BeFunky.logWarning("WebGL performance got worse:",i)}}function zc(e){return BeFunky.setSentryTag("high_perf_canvas",!e.includes("no_high_perf_canvas")),e.length?e.length===1&&e[0]==="no_high_perf_canvas"&&!BeFunky.isTablet?(BeFunky.logWarning("Allowing desktop user to use app w/ low perf canvas"),!0):Xc()&&!e.includes("no_webgl_canvas")?(BeFunky.reportWarning(`Enabling WebGL even though test failed: ${e[0]}`,{failingTests:e}),!0):(setCookie("gl_sprt","0",365),!1):(setCookie("gl_sprt","1",365),!0)}function Xc(){let e=getCookie("gl_sprt"),t=BeFunky.getLocal("__IndexedDB_version");return Boolean(BeFunky.Params.canUseWebapp&&(e==="1"||t))}function Cr(){let e=[],t=(a,l)=>{e.push({name:a,hasPassed:!l})},n=navigator.userAgent||"";t("old_windows_version",/(Windows NT 5.1|Windows NT 5.2|Windows NT 6.0|Windows XP)/.test(n)),t("old_mac_version",Kc(n)),t("old_browser_version",!Yc());let o;if(BeFunky.testingFlags.includes("disable_webgl_performance_check")?window.webGLPerformanceIssue=Jc():(o=Ia(!0),t("no_high_perf_canvas",!(o instanceof WebGLRenderingContext)),window.webGLPerformanceIssue=o instanceof WebGLRenderingContext?"No":"Yes"),o||(o=Ia(!1),t("no_webgl_canvas",!(o instanceof WebGLRenderingContext))),!o)return{results:e,canvasContext:o};let r=o.getExtension("OES_standard_derivatives");window.webglTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),t("no_oes_standard_derivatives",!r),t("small_texture_size",window.webglTextureSize<4096);let i=o.getExtension("WEBGL_debug_renderer_info");if(i){let a=BeFunky.Params.isAdmin?getCookie("webglUnmaskedRenderer"):!1,l=o.getParameter(i.UNMASKED_RENDERER_WEBGL);if(window.webglUnmaskedRenderer=a||l,window.webglUnmaskedRenderer&&window.webglUnmaskedRenderer.includes("SwiftShader")){window.webGLPerformanceIssue="Yes";let u=e.find(({name:s})=>s==="no_high_perf_canvas");u&&(u.hasPassed=!1)}}return{results:e,canvasContext:o}}function Yc(){return!(BeFunky.isChromium&&BeFunky.chromiumVersion<55||BeFunky.isFirefox&&BeFunky.firefoxVersion<52||BeFunky.isSafari&&BeFunky.safariVersion<11)}function Ia(e){try{let t=document.createElement("canvas"),n={failIfMajorPerformanceCaveat:e,alpha:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0};return t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}catch(t){BeFunky.logError("getCanvasContext failed:",typeof t,t instanceof Error,t instanceof Event),BeFunky.throwError(t)}return null}function Jc(e){try{e||(e=document.createElement("canvas"));let t={failIfMajorPerformanceCaveat:!0},n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!n)return"Yes";if(typeof n.getContextAttributes().failIfMajorPerformanceCaveat=="undefined")return"Not implemented"}catch(t){}return"No"}function Kc(e){if(/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/.test(e)){let t=/10[._\d]+/.exec(e);if(t){let n=t[0];/[_]/.test(n)&&(n=n.split("_").join("."));let o=n.split(".");if(o[1]&&parseInt(o[1])<10)return!0}}return!1}function Qc(e,t=!0){e=e||Cr().results.filter(p=>!p.hasPassed).map(p=>p.name);let{html:n,lang:o}=BeFunky.lit,i=[{errors:["old_windows_version"],message:"error_old_windows",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-operating-system-is-out-of-date"},{errors:["old_mac_version"],message:"error_old_mac",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-operating-system-is-out-of-date"},{errors:["old_browser_version"],message:"error_old_browser",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-browser-is-out-of-date"},{errors:["no_oes_standard_derivatives","small_texture_size"],message:"acknowledge_cant_run_app",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-computer-doesnt-meet-the-minimum-requirements"},{errors:["no_webgl_canvas"],message:n`
                <p style="margin-bottom: 0.5rem">${o("acknowledge_cant_run_app")}</p>
                <ul>
                    <li>${o("verify_hardware_acceleration")}</li>
                    <li>${o("restart_browser")}</li>
                    ${BeFunky.isWindows?n`<li>${o("update_gpu_driver")}</li>`:""}
                </ul>
            `,link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-browser-is-unable-to-run-befunky"},{errors:["no_high_perf_canvas"],message:"acknowledge_perf_issue",link:BeFunky.getArticleForPerfIssue(),type:"warning"}].map(p=>Ut(ze({},p),{errors:p.errors.filter(m=>e.includes(m))})).filter(p=>p.errors.length);if(t)return n`
        <p>${o("checked_your_computer")}</p>
        ${e.length?l(i[0]):a()}
        ${e.length?"":n`<p style="margin-bottom: 0.5rem">${o("contact_our_support_team")}</p>`}
        <button @click=${u} class="button button--blue">${o("contact_support_heading")}</button>
        `;if(e.length)return l(i[0]);return n`
    ${a()}
    <p style="margin-bottom: 0.5rem">${o("contact_our_support_team")}</p>
    <button @click=${u} class="button button--blue">${o("contact_support_heading")}</button>`;function a(){let p=BeFunky.createNotification({message:"computer_meets_the_requirements",type:"success",isDismissable:!1});return p.setStyles({margin:"0 0 1.5rem 0",fontSize:"inherit"}),p}function l({message:p,link:m,type:g="error"}){let f=BeFunky.createNotification({message:p,type:g,isDismissable:!1,button:{text:"learn_more",onClick:()=>window.open(m,"_blank")}});return f.setStyles({margin:"0 0 1.5rem 0",fontSize:"inherit"}),f}function u(){let p=s("support"),m=BeFunky.isLoggedIn()?BeFunky.User.email:"",g;window.getSystemInformation(!0).then(y=>{g=y});let{teardown:f,setFormState:_}=Ye(p,{title:"contact_support_heading",fields:[{name:"email",label:"email",type:"text",initialValue:m,errorMessage:"error_invalid_email",validate:window.isEmailAddress,sanitize:y=>y.trim()},{name:"comment",label:"comment",fieldType:"textarea",type:"text"}],button:"submit",onSubmit:({email:y,comment:h})=>{let w=h,F="Compatibility Check Results",b=`${g} 

----WEBGL INFO----

${d()}`;BeFunky.requestAPI("auth/send-feedback",{email:y,subject:F,message:w,system_info:b},{showLoadScreen:!0}).then(E=>{if(E.data!=="success")throw"invalid_response";_({confirmation:"contact_support_thanks"})}).catch(E=>{BeFunky.logError("Unable to send compatibility check support email",E),_({submissionErrors:[BeFunky.failureReason(E)]})})}});c(p,f)}function s(p){let m=document.createElement("div").setClass("modal form-modal");return m.id=`modal_form_${p}`,m}function c(p,m){BeFunky.openModal(p,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:m})}function d(){return e.length===0?"Passed all WebGL tests":e.length===1?`Failed one WebGL test: ${e[0]}`:`Failed ${e.length} WebGL tests: ${e.join(", ")}`}}window.googleAuth2=null;window.DRV_CLIENT_ID="303057181160-pvs0ajfctrvv15i4rmirjsve2plp8m92.apps.googleusercontent.com";window.DRV_SCOPES="https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.file";window.DRV_ACCESS=null;window.DRV_ACCESS_TIME=null;window.DRV_FLASH_CALLBACK=null;window.DRV_CLIENT_VERSION="v3";window.googleDrivePickerOpenerButton=document.createElement("button");var $t=window.$googleDriveState?deferredPromise():void 0,Je=(...e)=>BeFunky.logFeature("google_drive",...e);BeFunky.onDocumentReady(()=>{let e=document.querySelector(".googleDriveLoginBtn");if(e&&e.addEventListener("click",()=>{driveInmediateDisplay()}),window.googleDrivePickerOpenerButton.id="___googleDrivePickerOpenerButton",window.googleDrivePickerOpenerButton.addEventListener("click",()=>{if(window.driveApiLoadedCallback!==null){try{window.driveApiLoadedCallback()}catch(t){}window.driveApiLoadedCallback=null}}),$googleDriveState){try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(t){}BeFunky.editorExternalImage={ignoreExistingProject:!0,loadImage:()=>{BeFunky.showLoadScreen(),$t.then(t=>{downloadDriveFile(t)}).catch(t=>{BeFunky.logError("Failed to load Drive image:",t),BeFunky.hideLoadScreen()}).then(()=>{$t=void 0})}}}});window.onDrvApiLoad=()=>{Je("onDrvApiLoad");let e=()=>{console.log("GOOGLE client init"),gapi.client.init({apiKey:"AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw"}).then(()=>{dv_handleAuthResult()})},t=()=>{let o=gapi.auth2.getAuthInstance().currentUser.get(),r=o.getAuthResponse().access_token,i=o.getAuthResponse().id_token;i&&i.length>0&&r&&r.length>0&&(DRV_ACCESS=r,gapi.load("client",e))},n=()=>{gapi.auth2.getAuthInstance().signIn().then(()=>{console.log("GOOGLE signed in"),t()}).catch(o=>{console.error("Google sign-in failed",o),BeFunky.hideLoadScreen()})};gapi.load("auth2",{callback:()=>{gapi.auth2.init({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES}).then(()=>{gapi.auth2.getAuthInstance().isSignedIn.get()===!0?t():BeFunky.confirm("google_drive_access",{onConfirm:n,onCancel:()=>{BeFunky.logError("User cancelled Drive access")},confirmText:"ok",cancelText:"cancel"})}).catch(o=>{console.error("Google auth2.init failed",o),BeFunky.hideLoadScreen()})}})};window.googleDriveCallbackCheck=()=>{let e=!1;try{window.addEventListener("focus",n=>{e=!0},!1)}catch(n){}let t=setInterval(()=>{DRV_ACCESS!==null?window.clearInterval(t):e!==!1&&(window.clearInterval(t),DRV_ACCESS===null&&(DRV_FLASH_CALLBACK!==null?dv_handleAuthResult(null):notApiLoadedGoToApp()))},1e3)};window.driveInmediateDisplay=e=>{if(!(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")){window.driveApiLoadedCallback=function(){window.driveInmediateDisplay(e)};try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(t){}return}if(DRV_FLASH_CALLBACK=e!==null?e:null,$googleDriveState!=null)try{document.getElementById("dynamic-content-state").style.display="none"}catch(t){}if(DRV_ACCESS===null)gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},dv_handleAuthResult),DRV_FLASH_CALLBACK!==null&&googleDriveCallbackCheck();else if(DRV_FLASH_CALLBACK!=null&&DRV_ACCESS!==null)if(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")gapi.client.load("drive",window.DRV_CLIENT_VERSION,driveClientLoaded);else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(t){}};window.dv_handleAuthResult=e=>{Je("dv_handleAuthResult",{authResult:e,DRV_ACCESS});let t=null;if(!e&&DRV_ACCESS!==null)t=DRV_ACCESS;else try{t=e.access_token?e.access_token:null}catch(n){}if(t!==null)if(DRV_ACCESS=t,$googleDriveState!=null,typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")Je("call gapi.client.load()"),gapi.client.load("drive",window.DRV_CLIENT_VERSION,driveClientLoaded);else{Je("create JS with onDrvApiLoad");try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(n){}}else{if($googleDriveState!=null)try{document.getElementById("dynamic-content-state").style.display="block",document.querySelector("#dynamic-content-state #loader").style.display="none",document.querySelector("#dynamic-content-state .message-box").style.display="block"}catch(n){}sendToFlashFromDrvParams()}window.driveApiLoadedCallback!==null&&window.googleDrivePickerOpenerButton.click()};window.driveClientLoaded=()=>{Je("driveClientLoaded"),!DRV_FLASH_CALLBACK&&$googleDriveState!=null&&(bf_eventTrack("EXTERNAL","GOOGLE_DRIVE","OPEN"),checkDriveFile($googleDriveState)),sendToFlashFromDrvParams()};window.sendToFlashFromDrvParams=()=>{if(DRV_FLASH_CALLBACK!==null){let e="https://www.googleapis.com/upload/drive/v3/files";if(DRV_ACCESS!=null)try{BFN.BfnService.callbackFromJs(e,DRV_ACCESS)}catch(t){}else try{BFN.BfnService.callbackFromJs()}catch(t){}DRV_FLASH_CALLBACK=null}};window.checkDriveFile=e=>{Je("checkDriveFile",e);try{BeFunky.showLoadScreen();let t=window.DRV_CLIENT_VERSION==="v3"?"id,webContentLink,mimeType,resourceKey":"id,downloadUrl,mimeType";gapi.client.drive.files.get({fileId:e,fields:t}).execute(o=>{Je("checkDriveFile response",o),$t?o.error?(Je("driveImageReadyPromise rejected"),$t.reject(o.error)):(Je("driveImageReadyPromise resolved"),$t.resolve(o)):downloadDriveFile(o)})}catch(t){BeFunky.hideLoadScreen(),$t&&$t.reject(t)}};window.downloadDriveFile=e=>{Je("downloadDriveFile",e);try{if(e===null){BeFunky.hideLoadScreen();return}let t=typeof e.downloadUrl!="undefined"?e.downloadUrl:typeof e.webContentLink!="undefined"?e.webContentLink:!1;if(t){window.DRV_CLIENT_VERSION==="v3"&&(t=`https://www.googleapis.com/drive/v3/files/${e.id}?alt=media`);let n=gapi.auth.getToken().access_token,{mimeType:o}=e;if(n!=null){let r={responseType:"blob",headers:{Authorization:`Bearer ${n}`}};return e.resourceKey&&(r.headers["X-Goog-Drive-Resource-Keys"]=e.resourceKey),BeFunky.request(t,r,({response:i,error:a})=>{if(a&&(BeFunky.throwError("Unable to download Drive image",a),BeFunky.hideLoadScreen()),window.$googleDriveState){let l=window.location.href;if(l.includes("?state="))try{window.history.replaceState({},"",l.split("?state=")[0])}catch(u){BeFunky.throwError(u)}}BFN.PhotoEditorModel.loadBase64OrBlob(i),BFN.BfnService.track("CREATE","UPLOAD","DRIVE"),BFN.BfnService.trackMediaOpened("image","drive")})}}}catch(t){BeFunky.hideLoadScreen()}};window.insertDriveFile=(e,t)=>{Je("insertDriveFile",e,t);let n=r=>{if(Je("drv_pickerFolderCallback",r),r[google.picker.Response.ACTION]==google.picker.Action.PICKED){openApp();let i=r[google.picker.Response.DOCUMENTS][0].id;if(i!=null){let a="-------314159265358979323846",l=`\r
--${a}\r
`,u=`\r
--${a}--`,s={title:t,name:t,mimeType:"image/jpeg",parents:[i]},c=`${l}Content-Type: application/json\r
\r
${JSON.stringify(s)}${l}Content-Type: image/jpeg\r
Content-Transfer-Encoding: base64\r
\r
${e}${u}`,d=gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":`multipart/mixed; boundary="${a}"`},body:c}),p=m=>{try{BFN.BfnService.callbackDriveInsertFile()}catch(g){}};d.execute(p)}}else if(r[google.picker.Response.ACTION]==google.picker.Action.CANCEL){notApiLoadedGoToApp();try{BFN.BfnService.callbackDriveInsertFile("cancel")}catch(i){}}},o=()=>{if(drv_pickerApiLoaded!==!1&&DRV_ACCESS!==null){let r=new google.picker.DocsView().setIncludeFolders(!0).setMimeTypes("application/vnd.google-apps.folder").setSelectFolderEnabled(!0);new google.picker.PickerBuilder().setAppId("303057181160").setOAuthToken(DRV_ACCESS).setTitle("Select a Folder").addView(r).setDeveloperKey("AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw").setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback(n).build().setVisible(!0)}else notApiLoadedGoToApp()};drv_pickerApiLoaded!==!1&&DRV_ACCESS!==null?o():drv_pickerApiLoaded===!1&&DRV_ACCESS!==null?gapi.load("picker",{callback:function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=o,window.googleDrivePickerOpenerButton.click()}}):drvImmediatTryed==!1&&(drvImmediatTryed=!0,document.body.addClass("prevent-body-scroll"),gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},r=>{if(r&&!r.error){DRV_ACCESS=r.access_token;try{DRV_ACCESS_TIME=new Date().getTime()}catch(i){}gapi.load("picker",{callback:function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=o,window.googleDrivePickerOpenerButton.click()}})}}),googleDriveCallbackCheck())};window.drv_pickerApiLoaded=!1;window.drvImmediatTryed=!1;window.driveApiLoadedCallback=null;window.drv_OpenPicker=()=>{if(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")drv_pickerApiLoaded!==!1&&DRV_ACCESS!==null?drv_createPicker():drv_pickerApiLoaded===!1&&DRV_ACCESS!==null?gapi.load("picker",{callback:onDrvPickerApiLoad}):drvImmediatTryed==!1&&(drvImmediatTryed=!0,document.body.addClass("prevent-body-scroll"),gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},handleDrvApiAuthResultImmediate),googleDriveCallbackCheck());else{window.driveApiLoadedCallback=window.drv_OpenPicker;try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(e){}}};window.handleDrvApiAuthResultImmediate=e=>{e&&!e.error&&(DRV_ACCESS=e.access_token,gapi.load("picker",{callback:onDrvPickerApiLoad}))};window.onDrvPickerApiLoad=()=>{drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=drv_createPicker,window.googleDrivePickerOpenerButton.click()};window.drv_createPicker=()=>{if(drv_pickerApiLoaded&&DRV_ACCESS){let e=new google.picker.View(google.picker.ViewId.DOCS);e.setMimeTypes("image/png,image/jpeg,image/jpg"),new google.picker.PickerBuilder().setAppId("303057181160").setOAuthToken(DRV_ACCESS).addView(e).addView(new google.picker.DocsUploadView).setDeveloperKey("AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw").setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback(drv_pickerCallback).build().setVisible(!0)}else notApiLoadedGoToApp()};window.notApiLoadedGoToApp=()=>{drvImmediatTryed=!1,openApp()};window.gaDriveScrollHandler=()=>{window.scrollTo(0,0)};window.drv_pickerCallback=e=>{if(e.action==google.picker.Action.PICKED){let t=e.docs[0].id;if(window.removeEventListener("scroll",window.gaDriveScrollHandler),t!==null){try{openApp()}catch(n){}if(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")gapi.client.load("drive",window.DRV_CLIENT_VERSION,()=>{try{BFN.PhotoEditorModel.confirmEditorLoadImage(()=>{checkDriveFile(t)})}catch(n){checkDriveFile(t)}});else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch(n){}}}else if(e.action.toLowerCase()!==google.picker.Action.LOADED){window.removeEventListener("scroll",window.gaDriveScrollHandler);try{openApp()}catch(t){}}else window.addEventListener("scroll",window.gaDriveScrollHandler)};var Er=!1,bn=!1;BeFunky.loginWithGoogle=()=>{window.location.hostname==="localhost"?document.domain="localhost":document.domain="befunky.com",BeFunky.showLoadScreen(),window.openCustomPopup(`${BeFunky.Params.siteUrl}GoogleLogin.php?__optkn=${getCsToken()}`,BeFunky.attemptGoogleLogin)};BeFunky.attemptGoogleLogin=e=>{if(!e||e==="cancel"){Er||BeFunky.hideLoadScreen();return}let{id:t,name:n,email:o,profile_image:r}=e;Er=!0,BeFunky.handleSocialLogin("google",{id:t,name:n,email:o,profile_image:r}).catch(()=>{}).then(()=>{Er=!1,BeFunky.hideLoadScreen()})};BeFunky.onLoad(()=>{if(BeFunky.isLoggedIn()||BeFunky.isSafari||BeFunky.isIOS)return;let e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.onload=()=>{!window.google||(google.accounts.id.initialize({client_id:"303057181160-pvs0ajfctrvv15i4rmirjsve2plp8m92.apps.googleusercontent.com",prompt_parent_id:"g_id_onload",callback:window.handleGoogleLoginPrompt}),google.accounts.id.prompt())},document.head.appendChild(e)});window.handleGoogleLoginPrompt=e=>{if(BeFunky.isLoggedIn()||BeFunky.isSafari||BeFunky.isIOS||!window.google)return;if(bn){BeFunky.logWarning("Ignoring duplicate one-tap callback",e);return}if(BeFunky.isLoggedIn())return;console.log("One tap callback",e);let{credential:t}=e;if(!t)return;bn=!0;let n=!1;BeFunky.showLoadScreen({onCancel:()=>{n=!0}}),BeFunky.requestAPI("verify-google-id-token",{id_token:t}).then(o=>{let{id:r,name:i,email:a,profile_image:l}=o.data;if(console.log("One tap user data",o.data),n){bn=!1;return}BeFunky.handleSocialLogin("google",{id:r,name:i,email:a,profile_image:l}).catch(u=>{BeFunky.reportWarning("Social login failed after one-tap",u)}).then(()=>{BeFunky.hideLoadScreen(),bn=!1})},o=>{BeFunky.reportWarning("Failed to verify google id token",o),BeFunky.hideLoadScreen(),bn=!1})};window.loadDropBoxImage=(e,t)=>{let n=new Image;n.setAttribute("crossOrigin","Anonymous"),n.onload=function(){let o=document.createElement("CANVAS"),r=o.getContext("2d");o.height=this.height,o.width=this.width,r.drawImage(this,0,0);let i=o.toDataURL("image/png");i=i.replace("image/jpeg;",""),i=i.replace("image/png;",""),i=i.replace("data:base64,",""),o=null,r=null,n=null;try{BFN.BfnService.ToJsBase64Uploader(i,t,"dropbox")}catch(a){}},n.src=e};window.dropboxApiLoaded=!1;window.dropboxApiRequested=!1;function xr(e){if(typeof Dropbox!="undefined"){window.dropboxApiLoaded=!0,e!==null&&e();return}dropboxApiRequested==!1&&(window.dropboxApiRequested=!0,function(t,n,o,r,i){let a,l=t.getElementsByTagName(n)[0];t.getElementById(o)||(a=t.createElement(n),a.id=o,r&&a.setAttribute(r,i),a.src="https://www.dropbox.com/static/api/2/dropins.js",l.parentNode.insertBefore(a,l))}(document,"script","dropboxjs","data-app-key","xcse408r9ipxqtk")),setTimeout(()=>{xr(e)},555)}window.dBoxOpenPicker=()=>{let e=document.getElementById("dropbox-btn");if(e!=null&&(e.removeEventListener("click",window.dBoxOpenPicker),e.removeEventListener("click",window.dBoxSaveFileHandler)),window.dropboxApiLoaded==!1){let n=document.getElementById("dropbox-btn");n==null&&(n=document.createElement("button"),n.setAttribute("style","display:none"),n.id="dropbox-btn",document.body.appendChild(n)),n.addEventListener("click",window.dBoxOpenPicker),xr(()=>{n.click()});return}document.body.addClass("prevent-body-scroll");let t={success(n){try{setApplicationMode("photoeditor")}catch(o){}openApp();try{loadDropBoxImage(n[0].link,n[0].name)}catch(o){}},cancel(){openApp()},linkType:"direct",multiselect:!1,extensions:[".jpg",".jpeg",".png",".bmp",".gif"]};Dropbox.choose(t)};window.dBoxSaveFileHandler=()=>{let e=document.getElementById("dropbox-btn");e!=null&&(e.removeEventListener("click",window.dBoxOpenPicker),e.removeEventListener("click",window.dBoxSaveFileHandler)),window.dBoxSaveFile(window.dBoxSaveFileObj.url,window.dBoxSaveFileObj.filename)};window.dBoxSaveFileObj={url:"",filename:""};window.dBoxSaveFile=(e,t)=>{window.dBoxSaveFileObj={url:e,filename:t};let n=document.getElementById("dropbox-btn");if(n!=null&&(n.removeEventListener("click",window.dBoxOpenPicker),n.removeEventListener("click",window.dBoxSaveFileHandler)),window.dropboxApiLoaded==!1){n==null&&(n=document.createElement("button"),n.setAttribute("style","display:none"),n.id="dropbox-btn",document.body.appendChild(n)),n.addEventListener("click",window.dBoxSaveFileHandler),xr(()=>{n.click()});return}document.body.addClass("prevent-body-scroll");let o=!1,r=!1,i=null;if(Dropbox.isBrowserSupported()){let a={success(){o=!0;try{BFN.BfnService.handlerDropBoxInsert("success")}catch(l){}},progress(l){r==!1&&(r=!0,i=setTimeout(()=>{if(i!=null&&(clearTimeout(i),i=null),o==!1)try{BFN.BfnService.handlerDropBoxInsert("cancel")}catch(u){}},2e4))},cancel(){o=!0,i!=null&&(clearTimeout(i),i=null);try{BFN.BfnService.handlerDropBoxInsert("cancel")}catch(l){}},error(l){o=!0,i!=null&&(clearTimeout(i),i=null);try{BFN.BfnService.handlerDropBoxInsert("error")}catch(u){}}};Dropbox.save(e,t,a)}else try{BFN.BfnService.handlerDropBoxInsert("error")}catch(a){}};BeFunky.handleSocialLogin=function(e,t){return new Promise((n,o)=>{if(!["google","facebook"].includes(e))return o(`Invalid social provider: ${e}`);let{id:r,email:i,name:a,gender:l,user_birthday:u,access_token:s}=t,c={user_id:r,sntype:e==="google"?"GOOGLE":"FACEBOOK",email:i,CSRFtoken:getCsToken(),screenname:a,gender:l||"",user_birthday:u||"",access_token:s||""};BeFunky.requestAPI("auth/sn-login",c).then(d=>{let p=["true",!0].includes(d.data.newUser)?"_NEW":"";return window.bf_eventTrack("EXTERNAL","SIGNIN_SOCIAL",e.toUpperCase()+p),BeFunky.onLoginSuccess(d.data),n(d.data)}).catch(d=>{if(d==="already_logged_in")return BeFunky.handleAlreadyLoggedInError(i).then(p=>{BeFunky.onLoginSuccess(p),n(p)}).catch(p=>{if(p==="different_user_logged_out")BeFunky.logError("Attempting sign in again now that existing user has been signed out"),BeFunky.handleSocialLogin(e,t).then(n,o);else throw d});throw d}).catch(d=>(BeFunky.logError("Social login failed:",d),o(d)))})};window.openCustomPopup=(e,t)=>{let n=750,o=600;e.includes("weheartit.com")&&(o=800);let r=screen.width/2-n/2,i=screen.height/2-o/2,a=null;try{a=window.open(e,"APP",`top=${i},left=${r},width=${n},height=${o},resizable=1`);try{a.focus()}catch(u){}}catch(u){t&&t("cancel");return}l();function l(){a==null||a.closed?t&&t("cancel"):setTimeout(l,500)}};var Ta=class{constructor(){this.mightBeAuthorized=Boolean(getCookie("PHPSESSID"))}login(t=!0){return new Promise((n,o)=>{let r=()=>{this.loginSuccess&&this.loginSuccess("cancel"),this.loginSuccess=i=>{if(i==="cancel")return o("cancelled_by_user");this.mightBeAuthorized=!0,n()},window.location.hostname==="localhost"?document.domain="localhost":document.domain="befunky.com",window.openCustomPopup(`${BeFunky.Params.siteUrl}api/google-photos/token/?__optkn=${getCsToken()}`,window.BeFunky.GooglePhotosManager.loginSuccess)};if(!t)return r();BeFunky.confirm("google_photos_access",{onConfirm:r,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/gear.svg`,onCancel:()=>o("cancelled_by_user"),confirmText:"ok",cancelText:"cancel"})})}requestGooglePhotosAPI(t,n){return BeFunky.requestAPI(t,n,{logErrorMessage:!0}).catch(o=>{if(o!=="no_access_token")throw o;return this.mightBeAuthorized=!1,this.login().then(()=>this.requestGooglePhotosAPI(t,n))})}getAlbums(){return this.requestGooglePhotosAPI("google-photos/albums").then(({data:t})=>{if(!Array.isArray(t))throw"invalid_response";return t})}getAlbumMedia(t,n=""){return this.requestGooglePhotosAPI("google-photos/search-media",{album_id:t,next_page:n}).then(o=>{if(!Array.isArray(o.data))throw"invalid_response";return{mediaItems:o.data,nextPageToken:o.next_page}})}getMediaItem(t){return this.requestGooglePhotosAPI("google-photos/get-media-item",{id:t}).then(({data:n})=>{if(!n.id)throw"invalid_response";return n})}getAllMedia(t=""){return this.requestGooglePhotosAPI("google-photos/list-all-media",{next_page:t}).then(n=>{if(!Array.isArray(n.data))throw"invalid_response";return{mediaItems:n.data,nextPageToken:n.next_page}})}createAlbum(t){return this.requestGooglePhotosAPI("google-photos/create-album",{title:t}).then(({data:n})=>{if(!n.album_id)throw"invalid_response";return n})}uploadMedia(t,n,o){let r=()=>BeFunky.uploadFileToS3(t,{bucket:"artsyupload",blob:t,contentType:t.type||"image/jpeg"}),i=a=>{let l={image_url:a,file_name:n};return o&&(l.album_id=o),this.requestGooglePhotosAPI("google-photos/upload-media",l)};return r().then(({url:a})=>i(a))}downloadGooglePhoto(t){return Promise.all([o(),n()]).catch(r=>{BeFunky.logError("Google Photo baseUrl may have expired. Refreshing metadata...",r);let i=t.id.replace("google_photos_","");return this.getMediaItem(i).then(a=>{let[l]=this.mediaItemsToImageObjects([a]);return(t.imageWidth!==l.imageWidth||t.imageHeight!==l.imageHeight)&&BeFunky.throwError("Google Photos image dimensions changed",t,l),t.thumbURL=l.thumbURL,t.imageURL=l.imageURL,Promise.all([o(),n()])})});function n(){return new Promise((r,i)=>{BFN.RequestUtils.getBlob(`${BeFunky.Params.uplUri}/loadImage.php?c=${encodeURIComponent(t.imageURL)}`,({blob:a,error:l})=>{if(l)return i(l);r(a)})})}function o(){return new Promise((r,i)=>{BFN.RequestUtils.getBase64(`${BeFunky.Params.uplUri}/loadImage.php?c=${encodeURIComponent(t.thumbURL)}`,({error:a,base64:l})=>{if(a)return i(a);r(l)})})}}mediaItemsToImageObjects(t){let n=BeFunky.isRetina()?300:200;return t.filter(({mimeType:o,width:r,height:i})=>/^image\//.test(o)&&r&&i).map(o=>{let r,i,a,l=o.width/o.height,u=BFN.maxImageSize;return o.width<u&&o.height<u?(r=`${o.baseUrl}=w${o.width}`,i=o.width,a=o.height):l>=1?(r=`${o.baseUrl}=w${u}`,i=u,a=Math.round(u/l)):(r=`${o.baseUrl}=h${u}`,i=Math.round(u*l),a=u),{id:`google_photos_${o.id}`,imageURL:r,imageWidth:i,imageHeight:a,thumbURL:`${o.baseUrl}=h${n}`,thumbWidth:Math.round(n*l),thumbHeight:n}})}disconnect(){return BeFunky.requestAPI("google-photos/disconnect",{},{showLoadScreen:!0}).then(t=>{if(t.data!=="success")throw"invalid_response"}).catch(t=>{throw BeFunky.reportWarning(`Google Photos disconnect failed: ${t}`),t})}};BeFunky.GooglePhotosManager=new Ta;var Zc=1e3*30,eu=1e3*60*60*6,Aa=BeFunky.Params.IS_LC?Zc:eu,Ra=0,Ma=()=>{},$r=BeFunky.debounce(e=>{window.swIndicator&&window.swIndicator.update(e,Ar,Ra>0)},0),Ir=BeFunky.debounce(e=>{["installing","waiting","active"].map(t=>e[t]).filter(Boolean).forEach(t=>{t.version?$r(e):ja(t).then(()=>$r(e))})},50);window.addEventListener("appinstalled",()=>{window.bf_eventTrack("EXTERNAL","PWA","Installed"),wo()});var Tr=window.matchMedia("(display-mode: standalone)");Tr.addEventListener?Tr.addEventListener("change",wo):Tr.addListener(wo);wo();Oa();"serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",Oa),BeFunky.onLoad(()=>{!window.webgl_is_supported||tu()}),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),BeFunky.beforeInstallPromptEvent=e}));function tu(){navigator.serviceWorker.register(`${BeFunky.Params.siteUrl}service-worker.js`).then(e=>{We("Registration",Ft(e)),window.swReg=e,e.addEventListener("updatefound",()=>{nu(e.installing,e),e.installing.addEventListener("statechange",()=>Ir(e))}),e.waiting&&(Ua(e.waiting,e),e.waiting.addEventListener("statechange",()=>Ir(e))),e.active&&!BeFunky.usingServiceWorker()&&(We("Asking to be claimed after hard refresh"),e.active.postMessage({type:"CLAIM_CLIENTS"})),setTimeout(()=>Ar(e,Aa),Aa),Ir(e)}).catch(e=>{e.name!=="AbortError"&&e.name!=="SecurityError"&&BeFunky.reportWarning(`Unable to register service worker: ${e.name}`,e)})}function We(...e){BeFunky.logFeature("service_worker",...e)}function nu(e,t){e.addEventListener("statechange",function n(o){o.target.state==="installed"&&(e.removeEventListener("statechange",n),Ua(e,t))})}function Ua(e,t){t.installing||t.waiting!==e||ja(e).then(n=>{if(t.installing||t.waiting!==e){We(`Aborted update to version ${n}`,Ft(t));return}if(n===BeFunky.Params.serviceWorkerVersion){We(`Activating version ${n} since it matches page`,Ft(t)),Ma(),setTimeout(()=>{Da(e,t,!1)},1e3);return}We(`Ready to update to version ${n} if it's the latest`,Ft(t)),Ar(t).then(()=>{t.installing||t.waiting!==e||!BeFunky.isInstalled()||(We(`Showing reload toast for ${n}`,Ft(t)),Ma=BeFunky.showToast({message:"new_version_available",button:"refresh",onAccept:()=>{t.waiting?Da(t.waiting,t):t.active===e?(We("Reloading page after SW activated in different tab... "),Rr()):BeFunky.throwError("Unexpected SW state")},onDismiss:()=>{We("Dismissed service worker update")}}))})})}function Ft(e){return{installing:e.installing?e.installing.version||!0:!1,waiting:e.waiting?e.waiting.version||!0:!1,active:e.active?e.active.version||!0:!1}}function Ar(e,t){let n=typeof t!="number";return We(n?"Checking for updated SW once":`Polling for updated SW every ${t/1e3}s`),o();function o(){return r(1),e.update().catch(a=>{BeFunky.logError("Unable to check for new SW",a,Ft(e))}).then(()=>{r(-1),n||i()})}function r(a){Ra+=a,$r(e)}function i(){setTimeout(()=>{We("Polling for new SW..."),requestIdleCallback(o)},t)}}function Da(e,t,n=!0){if(!n){e.postMessage({type:"SKIP_WAITING"});return}BeFunky.showLoadScreen(),BeFunky.whenOnline().then(()=>{e.postMessage({type:"SKIP_WAITING"});let o=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{We("New service worker activated",Ft(t)),BeFunky.hideLoadScreen(),!o&&(o=!0,Rr())}),setTimeout(()=>{o||(o=!0,BeFunky.reportWarning("SKIP_WAITING timed out after 5s",Ft(t)),Rr())},5e3)})}function ja(e){return e.version?Promise.resolve(e.version):ou(e,{type:"GET_VERSION"}).then(t=>(t.version||BeFunky.throwError("Unable to get service worker version",t),e.version=t.version,t.version))}function ou(e,t){return new Promise(n=>{let o=new MessageChannel;o.port1.onmessage=function(r){n(r.data)},e.postMessage(t,[o.port2])})}function Rr(){if(!window.BFN||!BFN.ProjectManager||BFN.ProjectManager.isFullyAutoSaved())We("Reloading page..."),window.location.reload();else{let t=`padding: 0 4px; border: 1px solid; border-radius: 3px; opacity: 0.8; margin: 0 2px;${BeFunky.isMac?"":"letter-spacing: -0.5px;"}`;BeFunky.acknowledge(["save_then_refresh",{shortcut:`<string style="${t}">${e("R")}</string>`}])}function e(t){let n="\u2009";return[BeFunky.isMac?"\u2318":"Ctrl",...t.split("")].join(BeFunky.isMac?n:`${n}+${n}`)}}function Oa(){BeFunky.setSentryTag("sw",BeFunky.usingServiceWorker())}function wo(){ru(),BeFunky.isInstalled()&&BeFunky.onDocumentReady(()=>{requestIdleCallback(()=>iu())})}function ru(){BeFunky.setSentryTag("installed",BeFunky.isInstalled()?"pwa":!1)}var Na=!1;function iu(){if(Na)return;Na=!0,[document.querySelector(".site-nav__logo"),document.querySelector(".site-footer__logo")].filter(Boolean).forEach(t=>{t.href=BeFunky.getDashboardUrlInLanguage()});let e=document.querySelector(".site-footer__link[data-lang=visionn]");e&&e.setStyles({display:"none"}),[...document.querySelectorAll("a")].filter(t=>BeFunky.shouldOpenInBrowserNotPWA(t.href)&&t.getAttribute("target")!=="_blank").forEach(t=>{t.setAttribute("target","_blank")})}var Ha=class{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.modal=null}openProjectModal(){if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();this.modal=this.modal||BeFunky.createProjectManagerModal(),this.modal.open()}openUserSavedProject(t,n){let o=BeFunky.getModal("project_manager"),r=o&&o.isVisible;return BFN.SavedProjectService.fetchBFD(t.fileurl).then(i=>{r&&BeFunky.closeModal("project_manager");let a=t.filename?t.filename.replace(/\.bfd$/i,""):void 0;return BFN.ProjectManager.confirmAndOpenProject(i,{filename:a,source:"befunky",thumbnail:n||this.getThumbURL(t,308)})}).catch(i=>(r&&this.openProjectModal(),i==="user_not_plus"&&BeFunky.openTeaserModal("plus_templates"),Promise.reject(i)))}getThumbURL(t,n){if(!t.thumburl)return BeFunky.throwError("User-saved project missing thumburl",t),"";let o={auto:"webp",width:r(n*(BeFunky.isRetina()?1.5:1))};return BeFunky.addParamsToURL(t.thumburl,o);function r(i){return Math.ceil(i/50)*50}}openProjectFromOutsideOfApp(t){let n=BeFunky.getModal("project_manager"),o=n&&n.isVisible,r=t.project_type;if(!["editor","collage","designer"].includes(r))return BeFunky.throwError("Invalid project_type",r);BeFunky.projectToOpenInSection[r]={projectName:t.filename,behavior:"ask_user",loadProject:async()=>{let a=await BFN.SavedProjectService.fetchBFD(t.fileurl),l=t.filename?t.filename.replace(/\.bfd$/i,""):void 0;return BFN.ProjectManager.confirmAndOpenProject(a,{filename:l,source:"befunky",skipConfirmation:!0})},getNewProjectThumbnail:()=>({image:BeFunky.SavedProjectManager.getThumbURL(t,308)})},de({editor:"/create/",collage:"/create/collage/",designer:"/create/designer/"}[r]),o&&BeFunky.closeModal("project_manager")}};BeFunky.SavedProjectManager=new Ha;var au={37:"left",39:"right",38:"up",40:"down"},Vt=[];BeFunky.addArrowKeyHandler=e=>{if(typeof e.callback!="function"||typeof e.condition!="function"){BeFunky.throwError("invalid arrow key handler",e);return}Vt.includes(e)||Vt.push(e)};BeFunky.removeArrowKeyHandler=e=>{if(typeof e.callback!="function"||typeof e.condition!="function"){BeFunky.throwError("invalid arrow key handler",e);return}!Vt.includes(e)||Vt.splice(Vt.indexOf(e),1)};document.addEventListener("keydown",qa);document.addEventListener("keyup",qa);function qa(e){if(BeFunky.isLoadScreenActive())return;let t=au[e.keyCode];if(!t)return;let n=document.activeElement;if(!n)return;let o=Vt.find(({condition:r})=>r(n));!o||o.callback(n,t,e)||(e.stopImmediatePropagation(),e.preventDefault())}var Wa=class{constructor(){this.imagesPerPage=50,this.resetImageData()}resetImageData(){this.imageData={totalImages:null,fetchedImages:[],startPhotos:0,startLayers:0}}getPhotosAndLayers(t=1,n){if(!BeFunky.isLoggedIn())return n({error:"not_logged_in"});let{totalImages:o,fetchedImages:r}=this.imageData,i=t*this.imagesPerPage>r.length&&o>r.length;if(o==null||i)return this.getImagesFromAPI({startPhotos:this.imageData.startPhotos,startLayers:this.imageData.startLayers},({error:u,data:s,totalImages:c,startPhotos:d,startLayers:p})=>{if(u)return n({error:u});this.imageData={totalImages:c,fetchedImages:r.concat(s),startPhotos:d,startLayers:p},this.getPhotosAndLayers(t,n)});let a=(t-1)*this.imagesPerPage,l=a+this.imagesPerPage;return n({data:r.slice(a,l),totalPages:Math.ceil(o/this.imagesPerPage)})}getImagesFromAPI({startPhotos:t=0,startLayers:n=0}={},o){let r={start_images:t,start_layers:n,end:100};BeFunky.requestAPI("photo/library-images",r).then(i=>{let{data:a,total:l,start_images:u,start_layers:s}=i;if(!Array.isArray(a)||typeof l!="number"||typeof u!="number"||typeof s!="number")throw"invalid_response";if(a.length===0)throw"no_results";let c=a.map(d=>{let m=d.type==="befunky_layers"?"befunky_layer":"befunky_photo",g=d.url.endsWith(".png");return{id:`${m}_${d.id}`,date:d.dateCreated,imageURL:BeFunky.addParamsToURL(d.url,{io:"off"}),isTransparent:g,getImageURL:y=>f(d.url,y),thumbURL:f(d.url,108),thumbWidth:200,thumbHeight:200,title:d.title};function f(y,h){let w={auto:"webp",width:_(h*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(y,w)}function _(y){return Math.ceil(y/50)*50}});return o({data:c,totalImages:l,startPhotos:u,startLayers:s})}).catch(i=>o({error:i}))}};BeFunky.ImagesService=new Wa;var Va=class{constructor(){this.facebookAppID="120991377944644",this.scopes="email,public_profile,user_photos",this.fields="id,name,email,gender,birthday",this.loadSdkPromise=null,this.hasBeenAuthorized=!1}loadSdk(){return this.loadSdkPromise?this.loadSdkPromise:(this.loadSdkPromise=deferredPromise(),document.getElementById("facebook-jssdk")||BeFunky.onDocumentReady(()=>{let t=document.createElement("div");t.id="fb-root",document.body.appendChild(t),window.fbAsyncInit=()=>{FB.init({appId:this.facebookAppID,cookie:!0,version:"v9.0"}),this.loadSdkPromise.resolve()},function(n,o,r){if(n.getElementById(r))return;let i=n.createElement(o),a=n.getElementsByTagName(o)[0];i.id=r,i.src="https://connect.facebook.net/en_US/sdk.js",i.onerror=()=>{BeFunky.logError(`Failed to load Facebook SDK${BeFunky.isFirefox?" b/c Firefox Private browsing":""}`),this.loadSdkPromise.reject("sdk_did_not_load"),this.loadSdkPromise=null,i.parentNode.removeChild(i)},a.parentNode.insertBefore(i,a)}.call(this,document,"script","facebook-jssdk")}),this.loadSdkPromise)}getAccessToken(t){let n=this.scopes;if(t&&!n.split(",").includes(t))throw new Error(`Unsupported scope: ${t}`);return this.loadSdk().then(()=>new Promise((l,u)=>{if(window.location.protocol!=="https:")return BeFunky.logError("FB.getLoginStatus not called b/c this is a non-SSL page"),u("unknown");FB.getLoginStatus(({status:s,authResponse:c})=>{if(s==="connected")return l({accessToken:c.accessToken});l(o())},!0)})).then(l=>(this.hasBeenAuthorized=!0,t&&!Array.isArray(l.grantedScopes)?r().then(u=>({accessToken:l.accessToken,grantedScopes:u})):l)).then(l=>t&&!i(l.grantedScopes)?a():l);function o(l=!1){let u={scope:n,return_scopes:!0};l&&(u.auth_type="rerequest");let s=!1,c=()=>{s=!0};return new Promise((d,p)=>{window.addEventListener("blur",c),g();let m=setTimeout(()=>{s||BeFunky.acknowledge(["browser_block_social_login",{provider:"Facebook"}],{onAcknowledge:g,buttonText:"try_again"})},200);function g(){FB.login(({status:f,authResponse:_})=>{if(window.removeEventListener("blur",c),clearTimeout(m),f==="connected"){let{accessToken:y,grantedScopes:h}=_;return d({accessToken:y,grantedScopes:h})}return p(f)},u)}})}function r(){return new Promise((l,u)=>{FB.api("/me/permissions",s=>{if(Array.isArray(s.data)){let d=s.data.filter(({status:p})=>p==="granted").map(({permission:p})=>p).join(",");return console.log("Granted scopes:",d),l(d)}let c;try{c=JSON.stringify(s)}catch(d){}BeFunky.throwError("Unable to get granted scopes from FB API",c||s),u("invalid_response")})})}function i(l){return l.split(",").includes(t)}function a(){return new Promise((l,u)=>{let s=`facebook_access_${t}`;BeFunky.LanguageManager.isTranslated(s)||(s=`Please allow BeFunky to access your Facebook ${t.replace(/_/g," ")}.`),BeFunky.confirm(s,{onConfirm:()=>{o(!0).then(c=>{if(i(c.grantedScopes))return l(c);u(`${t}_scope_declined`)}).catch(u)},onCancel:()=>{u(`${t}_scope_declined`)},confirmText:"continue"})})}}getUserData(){return this.getAccessToken("email").then(({accessToken:t})=>new Promise((n,o)=>{FB.api("/me",{fields:this.fields},r=>{if(r.error)return o(r.error);r.access_token=t,n(r)})}))}loginWithFacebook(){return this.getUserData().then(t=>!t.email||!t.email.length?(BeFunky.confirm("facebook_email_login_failed",{onConfirm:()=>{BeFunky.openLoginPanel("REGISTER",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)},onCancel:()=>{window.open("https://www.facebook.com/","_blank")},confirmText:"register_with_email",cancelText:"go_to_facebook"}),Promise.reject("missing_email")):BeFunky.handleSocialLogin("facebook",t))}getPhotoAlbums(){return this.getAccessToken("user_photos").then(({accessToken:o})=>new Promise((r,i)=>{let l=`https://graph.facebook.com/v3.2/me?${["fields=albums.fields(name,photos.fields(picture,images).limit(100))",`access_token=${o}`].join("&")}`,u={headers:{"Content-Type":"application/x-www-form-urlencoded"}};BeFunky.request(l,u,({response:s,error:c})=>{if(c)return i(c);if(!s||!s.albums||!Array.isArray(s.albums.data))return i("invalid_response");let d=s.albums.data.filter(({photos:m})=>m&&m.data&&m.data.length);if(!d.length)return i("no_results");let p=d.map(({id:m,name:g,photos:f})=>{let _={id:m,name:g,nextPageURL:f.paging.next};return _.images=f.data.map(n).filter(Boolean),_});r(Promise.all(p.map(t)))})}),o=>(BeFunky.logError("Unable to get Facebook access token:",o),Promise.reject("invalid_access_token")));function t(o){return o.nextPageURL?new Promise(r=>{BeFunky.request(o.nextPageURL,{},({response:i,error:a})=>a||!i||!Array.isArray(i.data)?(BeFunky.throwError("Unable to get next page of Facebook album results",{error:a,response:i}),r(o)):(o.images=[...o.images,...i.data.map(n).filter(Boolean)],o.nextPageURL=i.paging.next,r(t(o))))}):o}function n(o){if(!o||!o.images||!o.images.length)return;let r=o.images.slice().sort((u,s)=>u.width>s.width?1:-1),i=r[r.length-1],a=275,l=r.find(u=>u.height>=a)||i;return{id:`facebook_${o.id}`,imageURL:i.source,imageWidth:i.width,imageHeight:i.height,thumbURL:l.source,thumbWidth:l.width,thumbHeight:l.height}}}};BeFunky.FacebookAuth=new Va;var Ga=class{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){}isValid(t,n){let o=/^[0-9A-F]{6}$/i,r={autosave:i=>["yes","no","ask"].includes(i),language:i=>BeFunky.LanguageManager.appLanguages.includes(i),artsy_fav:i=>Array.isArray(i)&&i.every(a=>typeof a=="string"),effects_fav:i=>Array.isArray(i)&&i.every(a=>typeof a=="string"),texture_fav:i=>Array.isArray(i)&&i.every(a=>typeof a=="string"),batch_processing_fav:i=>Array.isArray(i)&&i.every(a=>typeof a=="string"),fonts_fav:i=>Array.isArray(i)&&i.every(a=>typeof a=="string"),fonts_added:i=>Array.isArray(i)&&i.every(a=>a.type&&a.name&&(a.weights||a.weight&&a.fileName)),colors_recent:i=>Array.isArray(i)&&i.every(a=>o.test(a)),color_library:i=>Array.isArray(i)&&i.every(a=>typeof a.name=="string"&&Array.isArray(a.colors)&&a.colors.every(l=>o.test(l))&&a.colors.length<=100),watermarks:i=>Array.isArray(i)&&i.every(a=>a&&typeof a=="object"),use_case:i=>typeof i=="string",snapping:i=>["yes","no"].includes(i),display_distances:i=>["yes","no"].includes(i),guides:i=>["yes","no"].includes(i),dismissed_messages:i=>Array.isArray(i)&&i.every(a=>typeof a=="string"),trialing:i=>["trialing","plus","free",""].includes(i),theme_color:i=>["dark","light"].includes(i),canvas_bg_color:i=>["dark","light"].includes(i)};return r[t]?Boolean(r[t](n)):null}validateSettings(t,n=!1){let o={},r=n?"fetched from API":"specified by client";return!t||typeof t!="object"?(BeFunky.throwError(`Invalid settings ${r}. settings type = ${BeFunky.getType(t)}`),o):(Object.entries(t).forEach(([a,l])=>{let u=this.isValid(a,l);if(u===null){BeFunky.logError(`Unrecognized Setting "${a}" ${r}`);return}u?o[a]=t[a]:BeFunky.throwError(`Invalid settings ${r}. id = ${a}, value = ${l} (${BeFunky.getType(l)})`)}),o)}getUserSettings(t){let n=o=>{let r;o===""?(BeFunky.logError("No settings fetched from API"),r={}):r=this.validateSettings(o,!0),t({settings:r})};window.initialUserStatus.then(()=>{window.latestUserData.options?n(window.latestUserData.options):BeFunky.requestAPI("auth/get-user-options").then(o=>{if(typeof o.data!="object")throw"invalid_response";n(o.data)}).catch(o=>{t({error:o})})})}updateSetting(t,n){return new Promise((o,r)=>{if(window.BFN&&BFN.SettingsManager)return BFN.SettingsManager.updateSetting(t,n),o();this.updateUserSettings({[t]:n},({error:i})=>{i?r(i):o()})})}updateUserSettings(t,n){let o=this.validateSettings(t,!1);if(!Object.keys(o).length)return n({error:"No valid settings provided"});let r=JSON.stringify({data:o}),i=btoa(encodeURIComponent(r));BeFunky.requestAPI("auth/update-user-options",{data:i}).then(a=>{if(a.data!=="success")throw"invalid_response";if(BeFunky.isLoggedIn())try{Object.keys(o).includes("use_case")&&typeof o.use_case!="undefined"&&o.use_case.length>0&&typeof window.bfn_mp!="undefined"&&window.bfn_mp.identifier!==0&&typeof mixpanel!="undefined"&&mixpanel.people.set({"Use Case":o.use_case})}catch(l){}window.latestUserData.options&&Object.assign(window.latestUserData.options,o),n({success:!0})}).catch(a=>{n({error:a})})}};BeFunky.SettingsService=new Ga;var za=class{constructor(){this.init()}init(){this.resetProjectData()}resetProjectData(){this.projectData={allProjectsFetched:!1,totalProjects:null,fetchedProjects:[]}}getFirst100Projects(){let{allProjectsFetched:t,fetchedProjects:n}=this.projectData;return t||n.length>=100?Promise.resolve(n.slice(0,100)):BeFunky.requestAPI("photo/projects/get",{start:0,end:100}).then(o=>{let r=o.data,i=parseInt(o.total);return Array.isArray(r)?!i||!r.length?Promise.reject("no_results"):(i<=100?(this.projectData.allProjectsFetched=!0,this.projectData.fetchedProjects=r,this.projectData.totalProjects=i):this.projectData.fetchedProjects.length||(this.projectData.allProjectsFetched=!1,this.projectData.fetchedProjects=r,this.projectData.totalProjects=i),r):Promise.reject("invalid_response")})}getAllProjects(){let{allProjectsFetched:t,fetchedProjects:n}=this.projectData;return t?Promise.resolve(n):BeFunky.requestAPI("photo/projects/get",{all:1}).then(o=>{let r=o.data,i=parseInt(o.total);return Array.isArray(r)?!i||!r.length?Promise.reject("no_results"):(this.projectData.fetchedProjects=r,this.projectData.allProjectsFetched=!0,this.projectData.totalProjects=i,r):Promise.reject("invalid_response")})}searchProjects(t){let n={all:1,keyword:t};return BeFunky.requestAPI("photo/projects/get",n).then(o=>{let r=o.data,i=parseInt(o.total);return Array.isArray(r)?!i||!r.length?Promise.reject("no_results"):r:Promise.reject("invalid_response")})}async deleteProject(t,n=!1){if(!BeFunky.isLoggedIn())throw"not_logged_in";let o={template:t};if((await BeFunky.requestAPI("photo/projects/delete",o,{showLoadScreen:n})).data!=="success")throw"invalid_response";let i=this.projectData.fetchedProjects.findIndex(({id:a})=>a===t);i!==-1&&(this.projectData.fetchedProjects.splice(i,1),this.projectData.totalProjects&&this.projectData.totalProjects--)}};BeFunky.SavedProjectFetcher=new za;function su(){if(!navigator.cookieEnabled)return;let e=window.getCookie("new_country");if(!e||(BeFunky.requestAPI("auth/update-country",{iso:e}).then(r=>{r.data!=="success"&&BeFunky.logError("Unable to update user country",r),window.setCookie("new_country","",-1)}).catch(r=>{BeFunky.logError("Unable to update user country",r)}),!BeFunky.Params.canUseWebapp)||BeFunky.getFreeTrialEnabled()||BeFunky.platform==="play_store")return;if(lu()){fn(ct(),!0,!1),bf_eventTrack("ONBOARDING_7DAY_TRIAL_SAVE","TRIAL OFFERED",o(BeFunky.initialRoute));return}if(!kr.includes(e))return;if(!["/features/collage-maker/","/features/crop-photo/"].includes(n(BeFunky.initialRoute))){BeFunky.isNewUserEligibleForFreeTrial=!0;return}fn(e,!1),bf_eventTrack("ONBOARDING_7DAY_TRIAL","TRIAL OFFERED",o(BeFunky.initialRoute));function n(r){return r.split(/[?#]/)[0]}function o(r){return r.split(/[?#]/)[0].split("/").filter(Boolean).pop()}}BeFunky.onLoad(su);function lu(){let e=`${BeFunky.Params.siteUrl.slice(0,-1)}${BeFunky.initialRoute}`,t=new URLSearchParams(new URL(e).search);return t.get("utm_source")==="google"&&t.get("utm_medium")==="cpc"}var Xa=class{constructor(){this.init()}init(){this.cachedFolders=null}encodeSpecialChars(t){return btoa(encodeURIComponent(t))}getFolders(){return this.cachedFolders?Promise.resolve(this.cachedFolders.slice()):BeFunky.requestAPI("photo/projects/folder/get/").then(({data:t})=>{if(!t)throw"invalid_response";return this.cachedFolders=t.slice(),t})}createFolder(t){let n=this.encodeSpecialChars(t);return BeFunky.requestAPI("photo/projects/folder/add/",{name:n},{showLoadScreen:!0}).then(({data:o})=>{if(!o.name||!o.folderId)throw"invalid_response";return this.cachedFolders&&this.cachedFolders.unshift(o),o})}addProjectsToFolder(t,n){return BeFunky.requestAPI("photo/projects/set-folder/",{folder:t>0?t:"not_set",projects:n.join(",")},{showLoadScreen:!0}).then(({data:o})=>{if(o!=="success")throw"invalid_response";return o})}renameFolder(t,n){let o=this.encodeSpecialChars(n);return BeFunky.requestAPI("photo/projects/folder/update/",{folder:t,name:o},{showLoadScreen:!0}).then(({data:r})=>{if(!r.name||!r.folderId)throw"invalid_response";return this.cachedFolders&&(this.cachedFolders.find(i=>i.folderId===t).name=r.name),r})}deleteFolder(t,n){return BeFunky.requestAPI("photo/projects/folder/delete/",{folder:t,is_delete_projects:n?1:0},{showLoadScreen:!0}).then(({data:o})=>{if(o!=="success")throw"invalid_response";if(this.cachedFolders){let r=this.cachedFolders.findIndex(i=>i.folderId===t);r!==-1&&this.cachedFolders.splice(r,1)}return o})}};BeFunky.ProjectFolderService=new Xa;BeFunky.openThankYouPanel=e=>{BeFunky.openNebulaDialog({heading:"thank_you_heading",body:["thank_you_body",{collection_of_tutorials:BeFunky.toLinkHTML(`${BeFunky.Params.blogUrl}tutorials/`,!0)}],buttons:[{href:`${BeFunky.Params.blogUrl}befunky-plus/`,text:"learn_more",type:["blue"],focusInitially:!0}],imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/card-confetti.jpg`,modalOptions:{addCloseButton:!0,addLightThemeClass:!0,onClose:e}})};BeFunky.openWelcomePanel=()=>{let{html:e,modalLang:t}=BeFunky.lit,n=cu(),o=()=>e`
        <p>${t("welcome_features")}</p>
        <ul>
            ${n.map(r=>e`<li>${t(r)}</li>`)}
        </ul>
        <p>${t("welcome_upgrade")}</p>
    `;BeFunky.openNebulaDialog({heading:"welcome_heading",body:o,buttons:[{text:"learn_more",type:["blue"],focusInitially:!0,onClick:()=>BeFunky.openPricingModal()}],imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/confetti.jpg`,modalOptions:{addCloseButton:!0,addLightThemeClass:!0}})};function cu(){let e={default:["pricing_modal_background_heading","pricing_modal_cutout_heading","pricing_modal_batch_heading","welcome_features_cartoons"],collage:["welcome_collage_1","welcome_collage_2","welcome_features_graphics"],designer:["welcome_designer_1","welcome_designer_2","welcome_features_graphics"]};return window.BFN&&BFN.AppModel&&BFN.AppModel.viewingCollage?e.collage:window.BFN&&BFN.AppModel&&BFN.AppModel.viewingDesigner?e.designer:e.default}var uu={displayError(e,t){let n=Ya(e);if(!n.firstElementChild){let r=document.createElement("div").addClass("form-errors__container");n.appendChild(r);let i=document.createElement("button").setClass("button button--icon button--xs form-errors__close-button");i.innerHTML=BeFunky.getSvgHtml("cancel-icon",{classes:"icon icon--14"}),i.addEventListener("click",()=>{n.innerHTML=""}),n.appendChild(i)}let o=document.createElement("div");Array.isArray(t)?o.setLang(...t):o.setLang(t),n.firstElementChild.appendChild(o)},clearError(e){Ya(e).innerHTML=""}};function Ya(e){return e instanceof HTMLElement?e.querySelector(".form-errors"):document.querySelector(`${e} .form-errors`)}var It=uu;BeFunky.LoginPanelObj={onLogin:!1,onClose:!1};var Mr=BeFunky.getLocal("skip_captcha_token"),ot=!Mr;ot||console.log("Captcha disabled for testing");BeFunky.openLoginPanel=(e,t=!1,n=!1)=>{if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();switch(BeFunky.LoginPanelObj.onLogin=t,BeFunky.LoginPanelObj.onCloseWithoutLogin=n,e){case"SIGNIN":BeFunky.befunkyPopupContainerOpen("#sign_in_modal",{addCaptcha:ot}),BeFunky.FacebookAuth.loadSdk().catch(o=>{o==="sdk_did_not_load"&&BeFunky.isFirefox&&(document.getElementById("sign_in_modal_facebook").disabled=!0)});break;case"REGISTER":BeFunky.befunkyPopupContainerOpen("#register_modal",{addCaptcha:ot}),BeFunky.FacebookAuth.loadSdk().catch(o=>{o==="sdk_did_not_load"&&BeFunky.isFirefox&&(document.getElementById("register_modal_facebook").disabled=!0)});break;case"FORGETPASS":BeFunky.befunkyPopupContainerOpen("#reset_password_modal",{addCaptcha:ot});break}};function Ur(){let e=document.getElementById("sign_in_form"),t=document.getElementById("sign_in_form_email"),n=document.getElementById("sign_in_form_password"),o=!1;It.clearError(e),e.querySelectorAll(".form-field__input").removeClass("form-field__input--invalid");let r=t.value=t.value.trim();window.isEmailAddress(r)===!1&&(t.addClass("form-field__input--invalid"),o=!0),n.value.length<=2&&(n.addClass("form-field__input--invalid"),o=!0);let i="";if(ot&&(i=BeFunky.getCaptchaResponse(),i===""&&(BeFunky.executeCaptcha(Ur),o=!0)),o)return;let a={userEmail:r,userPassBa:btoa(encodeURIComponent(n.value)),captcha_response:i};BeFunky.requestAPI("auth/login",a,{showLoadScreen:!0,headers:Dr()}).then(l=>{BeFunky.onLoginSuccess(l.data)}).catch(l=>{if(l==="already_logged_in")return BeFunky.handleAlreadyLoggedInError(r).then(BeFunky.onLoginSuccess);throw l}).catch(l=>{if(l==="different_user_logged_out")return BeFunky.logError("Attempting sign in again now that existing user has been signed out"),Ur();typeof l=="string"?BeFunky.logError("Unable to sign in user:",l):BeFunky.throwError(l,"Unable to sign in user"),ot&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));let u={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",different_user_logged_in:["error_please_refresh",{contact_support:`<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">${BeFunky.LanguageManager.getString("contact_support")}</a>`}],invalid_email:"error_email_password"};It.displayError(e,u[l]||"error_invalid_response")})}function Ja(){let e=document.getElementById("register_form"),t=document.getElementById("register_form_email"),n=document.getElementById("register_form_confirm_email"),o=document.getElementById("register_form_password"),r=!1;It.clearError(e),e.querySelectorAll(".form-field__input").removeClass("form-field__input--invalid");let i=t.value=t.value.trim(),a=n.value=n.value.trim();window.isEmailAddress(i)===!1&&(t.addClass("form-field__input--invalid"),r=!0),a!==i&&(n.addClass("form-field__input--invalid"),r=!0),o.value.length<6&&(o.addClass("form-field__input--invalid"),r=!0);let l="";if(ot&&(l=BeFunky.getCaptchaResponse(),l===""&&(BeFunky.executeCaptcha(Ja),r=!0)),r)return;let u={_email_:i,_email_again:a,_pass_ba_:btoa(encodeURIComponent(o.value)),captcha_response:l,em_effects:0,em_articles:1};BeFunky.requestAPI("auth/register",u,{showLoadScreen:!0,headers:Dr()}).then(s=>{BeFunky.onLoginSuccess(s.data)}).catch(s=>{typeof s=="string"?BeFunky.logError("Unable to register user:",s):BeFunky.throwError(s,"Unable to register user"),ot&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));let c={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",already_logged_in:["error_please_refresh",{contact_support:`<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">${BeFunky.LanguageManager.getString("contact_support")}</a>`}],invalid_email:"error_email_already_in_use"};It.displayError(e,c[s]||"error_invalid_response")})}function Ka(){let e=document.getElementById("reset_password_form"),t=document.getElementById("reset_password_form_email"),n=!1;It.clearError(e),e.querySelectorAll(".form-field__input").removeClass("form-field__input--invalid");let o=t.value=t.value.trim();window.isEmailAddress(o)===!1&&(t.addClass("form-field__input--invalid"),n=!0);let r="";if(ot&&(r=BeFunky.getCaptchaResponse(),r===""&&(BeFunky.executeCaptcha(Ka),n=!0)),n)return;let i={_email_:o,captcha_response:r};BeFunky.requestAPI("auth/forget-pass",i,{showLoadScreen:!0,headers:Dr()}).then(a=>{if(a.data!=="success")throw"invalid_response";BeFunky.acknowledge(["reset_password_email_sent",{email:`<strong>${o}</strong>`}],{onAcknowledge:()=>{BeFunky.befunkyPopupContainerClose()},imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`})}).catch(a=>{BeFunky.logError("Unable to reset password:",a),a==="already_logged_in"&&BeFunky.throwError(a,"Unable to reset password"),ot&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));let l={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",already_logged_in:["error_please_refresh",{contact_support:`<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">${BeFunky.LanguageManager.getString("contact_support")}</a>`}],operation_failed:"error_email_not_registered"};It.displayError(e,l[a]||"error_invalid_response")})}BeFunky.onLoginSuccess=function(e){window.updateUserStatus(e);let t=BeFunky.User.language;t&&t!==BeFunky.LanguageManager.language.site&&(BeFunky.LanguageManager.siteLanguages.includes(t)||BeFunky.isDashboard())&&document.documentElement.getAttribute("data-use-app-lang")==="true"&&BeFunky.LanguageManager.setLanguage(t,["site"]);let{onLogin:n}=BeFunky.LoginPanelObj;if(typeof n=="function"){n(),BeFunky.LoginPanelObj.onLogin=!1;let o=BeFunky.getModal();o&&["sign_in_modal","register_modal"].includes(o.modalID)&&BeFunky.closeModal(o.modalID)}else BeFunky.User.isNewUser?(BeFunky.befunkyPopupContainerClose(),BeFunky.openWelcomePanel()):(BeFunky.befunkyPopupContainerClose(),BeFunky.sessionRoutes.length===1&&BeFunky.Params.isHomepage&&!BeFunky.isDashboard()&&BeFunky.Params.canUseWebapp&&window.webgl_is_supported&&!window.onbeforeunload&&(window.location.href=BeFunky.getDashboardUrlInLanguage(BeFunky.User.language)))};du();function du(){document.getElementById("sign_in_modal_google").addEventListener("click",e),document.getElementById("sign_in_modal_facebook").addEventListener("click",t),document.getElementById("sign_in_form").addEventListener("submit",n=>{n.preventDefault(),Ur()}),document.getElementById("sign_in_modal_create_account").addEventListener("click",n=>{n.preventDefault(),BeFunky.openLoginPanel("REGISTER",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)}),document.getElementById("sign_in_modal_forgot_password").addEventListener("click",n=>{n.preventDefault(),BeFunky.openLoginPanel("FORGETPASS",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)}),document.getElementById("register_modal_google").addEventListener("click",e),document.getElementById("register_modal_facebook").addEventListener("click",t),document.getElementById("register_form").addEventListener("submit",n=>{n.preventDefault(),Ja()}),document.getElementById("register_modal_has_account").addEventListener("click",n=>{n.preventDefault(),BeFunky.openLoginPanel("SIGNIN",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)}),document.getElementById("reset_password_form").addEventListener("submit",n=>{n.preventDefault(),Ka()}),document.getElementById("reset_password_modal_sign_in").addEventListener("click",n=>{n.preventDefault(),BeFunky.openLoginPanel("SIGNIN",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)});function e(){BeFunky.loginWithGoogle()}function t(){BeFunky.showLoadScreen(),BeFunky.FacebookAuth.loginWithFacebook().catch(n=>{BeFunky.logError("Facebook login failed",n)}).then(()=>{BeFunky.hideLoadScreen()})}}BeFunky.handleAlreadyLoggedInError=function(e){return BeFunky.logError('Handling "already_logged_in" API error'),BeFunky.setLocal("already_logged_in_error_time",Date.now()),BeFunky.requestAPI("auth/status",{},{showLoadScreen:!0}).catch(t=>{throw BeFunky.throwError("/status/ failed after already_logged_in sign-in error",t),t}).then(t=>{if(!t.data.email)throw BeFunky.logError("User data missing email: ",JSON.stringify(t.data)),"invalid_response";return e===t.data.email?t.data:(BeFunky.logError(`Logging out existing user "${t.data.email}" so that new user "${e}" can sign in`),BeFunky.callSignOutAPI().then(()=>Promise.reject("different_user_logged_out"),()=>Promise.reject("different_user_logged_in")))})};function Dr(){let e={"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":getCsToken(),"X-User-Email":window.latestUserData.email||""};return Mr&&(e["X-BeFunky-Skip-Captcha"]=Mr),e}var{html:pt,setupState:pu,render:gu,modalLang:Tt,elem:fu}=BeFunky.lit;function jr(e,{onUpgrade:t,onSignIn:n}){let o=e.video?"modal teaser-modal teaser-modal--video":"modal teaser-modal teaser-modal--image",r=fu`<div id="teaser_modal" class=${o}>`,i=!1,a={headingText:"",featureName:"",images:[],showSecondImage:!1,video:"",text:"",learnMoreLink:"",isLoggedIn:!1,imageAspectRatio:void 0},l=BeFunky.debounce(()=>gu(c(),r),"raf"),[u,s]=pu(Object.assign({},a,e),l);return BeFunky.LanguageManager.addLanguageUpdateListener(l),u.images.length===2&&_(),r.teardown=y,r;function c(){let w=`button button--blue ${u.learnMoreLink?"button--lg":"button--xl"} teaser-modal__button`;return pt`
        ${u.video?p():d()}
        <div class="teaser-modal__col-right">
            ${m()}
            <p id="teaser_modal_body">${Tt(u.text)}</p>
            <div class="teaser-modal__buttons">
                <button class=${w} @click=${g}>${Tt(BeFunky.getFreeTrialEnabled()?"start_free_trial":"upgrade_now")}</button>
                ${u.learnMoreLink?pt`<a href=${u.learnMoreLink} class="teaser-modal__learn-link button button--lg button--link" rel="noopener" target="_blank">${Tt("learn_more")}</a>`:""}
            </div>
            ${u.isLoggedIn?"":pt`
            <p class="teaser-modal__sign-in">
                <string>${Tt("teaser_modal_have_an_account")}</string>
                <a @click=${f} href="#">${Tt("sign_in")}</a>
            </p>`}
        </div>
        `}function d(){if(!u.imageAspectRatio)return pt`
            <div class="teaser-modal__image" style=${`background-image: url(${u.images[0]});`}>
                ${u.images[1]?pt`<div class="teaser-modal__fade-in-image" style=${`background-image: url(${u.images[1]}); opacity: ${u.showSecondImage?1:0};`}>`:""}
            </div>`;let w=`position: absolute; ${E(u.images[0])};`,F=u.imageAspectRatio>1?100/u.imageAspectRatio:100*u.imageAspectRatio,b=u.imageAspectRatio>1?`width: 100%; height: ${F}%; left: 0; top: ${(100-F)/2}%; ${w}`:`height: 100%; width: ${F}%; top: 0; left: ${(100-F)/2}%; ${w}`;return pt`
            <div class="teaser-modal__image">
                <div style="${b}">
                ${u.images[1]?pt`<div class="teaser-modal__fade-in-image" style=${`${E(u.images[1])} opacity: ${u.showSecondImage?1:0};`}>`:""}
                </div>
            </div>`;function E(P){return`background: url(${P}) no-repeat center, url('${BeFunky.Params.globalImagesPath}app/checker_pattern.jpg') repeat; background-size: cover, auto;`}}function p(){return pt`
        <div class="teaser-modal__video">
            <video autoplay loop muted>
                <source src=${u.video} type="video/mp4">
            </video>
        </div>`}function m(){return pt`<h2 class="h4">${u.headingText?Tt(u.headingText):Tt(["teaser_modal_heading",{this_feature:()=>BeFunky.LanguageManager.getString(u.featureName)}])}
        </h2>`}function g(){t()}function f(w){w.preventDefault(),n()}function _(){Promise.all(u.images.map(h)).then(()=>{i||setTimeout(w,1500)});function w(){requestAnimationFrame(()=>{i||(s({showSecondImage:!u.showSecondImage}),setTimeout(w,4e3))})}}function y(){i=!0,BeFunky.LanguageManager.removeLanguageUpdateListener(l)}function h(w){return new Promise((F,b)=>{let E=new Image;E.onload=F,E.onerror=b,E.src=w})}}typeof window.enableTeasers=="undefined"&&(window.enableTeasers=!0);var Gt={_default:{featureName:"this_feature",images:["global.jpg"]},paywall:{headingText:"teaser_paywall_heading",text:"teaser_paywall_body",images:["global.jpg"]},artsy:{featureName:"Artsy",text:"teaser_artsy",images:["artsy-before.jpg","artsy-after.jpg"]},background:{featureName:"background",text:"teaser_background",images:["background-before.jpg","background-after.jpg"]},batch_processing:{featureName:"batch_processing",text:"teaser_batch_processing",images:["batch-processing.jpg"]},clarity:{featureName:"clarity",text:"teaser_clarity",images:["clarity-before.jpg","clarity-after.jpg"]},clone:{featureName:"clone",text:"teaser_clone",images:["clone-before.jpg","clone-after.jpg"]},collage_wizard:{featureName:"collage_wizard",text:"teaser_collage_wizard",images:["collage-wizard.jpg"]},color_management:{headingText:"teaser_color_management_heading",text:"teaser_color_management_body",video:"color-library-teaser-compressed.mp4",learnMoreLink:`${BeFunky.Params.siteUrl}learn/improved-color-picker/`},cutout:{featureName:"cutout",text:"teaser_cutout",images:["cutout-before.jpg","cutout-after.jpg"]},designer_templates:{skipTeaser:!0},edit_layer:{featureName:"this_feature",text:"teaser_edit_layer_body",video:"edit-layer-teaser.mp4",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360004850012"},enhance_dlx:{featureName:"Enhance DLX",text:"teaser_enhance_dlx",images:["enhance-DLX-before.jpg","enhance-DLX-after.jpg"]},fill_light:{featureName:"fill_light",text:"teaser_fill_light",images:["fill-light-before.jpg","fill-light-after.jpg"]},font_management:{featureName:"this_feature",text:"teaser_font_management",video:"fonts-teaser-modal-v2.mp4",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-"},funky_focus:{featureName:"funky_focus",text:"teaser_funky_focus",images:["funky-focus-before.jpg","funky-focus-after.jpg"]},glow:{featureName:"glow",text:"teaser_glow",images:["glow-before.jpg","glow-after.jpg"]},lens_flares:{featureName:"lens_flare",text:"teaser_lens_flares",images:["lens-flare-before.jpg","lens-flare-after.jpg"]},photo_effects:{featureName:"photo_effects",text:"teaser_photo_effects",images:["photo-effects.jpg"]},plus_templates:{headingText:"teaser_plus_templates_heading",text:"teaser_plus_templates",images:["plus-templates.jpg"]},replace_color:{featureName:"replace_color",text:"teaser_replace_color",images:["replace-color-before.jpg","replace-color-after.jpg"]},reshape:{featureName:"reshape",text:"teaser_reshape",images:["reshape-before.jpg","reshape-after.jpg"]},save_editor:{headingText:"teaser_save_editor_heading",text:"teaser_save_editor",images:["global.jpg"]},save_collage:{headingText:"teaser_save_collage_heading",text:"teaser_save_collage",images:["collage-wizard.jpg"]},save_designer:{headingText:"pricing_modal_templates_heading",text:"teaser_save_designer",images:["designer-templates.jpg"]},top_nav_bar:{skipTeaser:!0},touchup:{featureName:"touch_up_tools_titlecase",text:"teaser_touchup",images:["touch-up-before.jpg","touch-up-after.jpg"]},vibrance:{featureName:"vibrance",text:"teaser_vibrance",images:["vibrance-before.jpg","vibrance-after.jpg"]},vignette:{featureName:"vignette",text:"teaser_vignette",images:["vignette-before.jpg","vignette-after.jpg"]}},Or;BeFunky.createAndOpenTeaser=(e,t)=>{Gt[e]=t,BeFunky.openTeaserModal(e)};BeFunky.openTeaserModal=(e="_default")=>{if(Gt.hasOwnProperty(e)||(BeFunky.logWarning(`Invalid teaser type "${e}" specified`),e="_default"),Or=e==="batch_processing"?"batch":mu(),!window.enableTeasers||Gt[e].skipTeaser){BeFunky.openPricingModal(Or);return}let{headingText:t,featureName:n,text:o,learnMoreLink:r,imageAspectRatio:i}=Gt[e],{images:a=[],video:l}=Gt[e];a=a.map(c=>c.startsWith("data:")?c:`${BeFunky.Params.globalImagesPath}teasers/${c}`),l=l?`${BeFunky.Params.globalImagesPath}teasers/${l}`:!1;let u=jr({headingText:t,featureName:n,images:a,video:l,learnMoreLink:r,imageAspectRatio:i,text:o||"teaser_default",isLoggedIn:BeFunky.isLoggedIn()},{onUpgrade:()=>BeFunky.openPricingModal(Or),onSignIn:()=>{BeFunky.openLoginPanel("SIGNIN",()=>{BeFunky.openPaymentPanel()})}});document.body.appendChild(u);let s=Gt[e].hasOwnProperty("video")?[1032]:"large";BeFunky.befunkyPopupContainerOpen("#teaser_modal",{size:s,destroyOnClose:!0,onClose:()=>u.teardown()})};function mu(){try{return BFN.AppModel.sectionID}catch(e){BeFunky.logError("Unable to get current app section",e)}return""}var{html:Nr,setupState:hu,render:yu,elem:_u}=BeFunky.lit;function Hr(e){let t=_u`<figure class="announcement__figure"></figure>`,n=!1,o={video:"",images:null,imageIndex:0,isAnimatingNextImage:!1},r=BeFunky.debounce(()=>yu(l(),t),"raf"),[i,a]=hu(Object.assign({},o,e),r);return i.images&&i.images.length>1&&c(),t.teardown=d,t;function l(){return i.video?u():i.images?s():""}function u(){return Nr`
        <div class="announcement__video">
             <video autoplay loop muted>
                <source src=${i.video} type="video/mp4">
            </video>
        </div>`}function s(){let m=i.images[i.imageIndex],g=i.images[p()],f=["announcement__image",m.class].filter(Boolean).join(" "),_=["announcement__image",g.class].filter(Boolean).join(" ");return i.images.length<=1?Nr`
            <div class="announcement__images">
                <img class="announcement__image" alt=${m.alt||""} src=${m.url}>
            </div>`:Nr`
        <div class="announcement__images">
            <img class=${f} alt=${m.alt||""} src=${m.url}>
            <img class=${_} alt=${g.alt||""} src=${g.url} style="${`opacity: ${i.isAnimatingNextImage?1:0}; left: 0; transition: ${i.isAnimatingNextImage&&g.fadeIn?"opacity 1s ease-in-out":"none"}`}">
        </div>`}function c(){let{duration:m}=i.images[i.imageIndex];setTimeout(()=>{if(n)return;i.images[p()].fadeIn?(a({isAnimatingNextImage:!0}),requestAnimationFrame(()=>{setTimeout(g,1e3)})):g()},m*1e3);function g(){n||(a({isAnimatingNextImage:!1,imageIndex:p()}),c())}}function d(){n=!0}function p(){return i.imageIndex<i.images.length-1?i.imageIndex+1:0}}var qr={edit_layer:{headingText:"edit_layer_announcement_header",bodyText:["edit_layer_announcement_body",{done_editing_image:()=>BeFunky.LanguageManager.getString("done_editing_image","modal")}],learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360004850012",video:"edit-layer-announcement-final.mp4"},font_management:{headingText:"font_announcement_title",bodyText:"font_announcement_body",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-",video:"fonts-announcement-modal-v2.mp4"},color_management:{headingText:"color_management_announcement_heading",bodyText:"color_management_announcement_body",learnMoreLink:`${BeFunky.Params.siteUrl}learn/improved-color-picker/`,video:"color-library-announcement.mp4"},curved_text:{headingText:"curved_text_announcement_heading",bodyText:"curved_text_announcement_body",learnMoreLink:`${BeFunky.Params.siteUrl}learn/curved-text/`,confirmText:"try_it_now",cancelText:"ok_got_it",images:[{filename:"curved-text.jpg",alt:"Text curved around circles"}]},pwa:{headingText:"pwa_announcement_headline",bodyText:"pwa_announcement_body",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360051162372",video:"pwa-announcement-modal.mp4",confirmText:"install_now",cancelText:"ask_later"},demo_mode:{headingText:"welcome_to_befunky",bodyText:"demo_mode_announcement_body",images:[{filename:"chrome-demo-welcome.jpg",alt:"Edit photos and create collages and designs with BeFunky"}]}};BeFunky.openAnnouncementModal=(e,{onConfirm:t=()=>{},onCancel:n=()=>{},onAcknowledge:o=()=>{}}={})=>{let{headingText:r,bodyText:i,learnMoreLink:a,confirmText:l,cancelText:u}=qr[e],{video:s,images:c}=qr[e];s=s?`${BeFunky.Params.globalImagesPath}teasers/${s}`:"",c=c?c.map(f=>Ut(ze({},f),{url:`${BeFunky.Params.globalImagesPath}teasers/${f.filename}`})):null;let d=Hr({video:s,images:c}),p=!1,m=!1,g=l&&u?[{text:u,type:"grey-300",onClick:()=>{m=!0},size:"lg"},{text:l,type:["blue","ellipsis"],onClick:()=>{p=!0},size:"lg"}]:[{text:"ok_got_it",type:["blue","ellipsis"],size:"lg"}];a&&g.unshift({text:"learn_more",type:"link",href:a,style:g.length>1?"margin: 0 auto 0 0":"",size:"lg"}),BeFunky.openNebulaDialog({className:"announcement",heading:[r,{"new!":()=>`<span class="announcement__new-text">${BeFunky.LanguageManager.getString("new!")}</span>`}],body:i,figure:d,buttons:g,modalOptions:{size:"medium",addCloseButton:!1,addLightThemeClass:!0,closeOnClickOutside:!0,onClose:()=>{d.teardown(),o(),p?t():n(m)}}})};BeFunky.showAnnouncementOnce=(e,t)=>{if(!qr[e])return BeFunky.throwError("Invalid announcement type",e),Promise.resolve(!1);let n=`${e}_announcement`;return BFN.SettingsManager.getSetting("dismissed_messages").then(o=>o.includes(n)?!1:(BeFunky.openAnnouncementModal(e,t),BFN.SettingsManager.updateSetting("dismissed_messages",[...o,n]),!0))};var bo,ku=BeFunky.once(vu);BeFunky.openPricingModal=()=>{BeFunky.isPlus()||(bo||(BeFunky.showLoadScreen(),bo=wu()),bo.then(()=>{BeFunky.hideLoadScreen();let e=document.getElementById("modal_root"),t=document.getElementById("pricing_modal"),n=t.querySelector(".pricing-table"),o=t.querySelector(".pricing-table__header-row");e.addEventListener("scroll",a,{passive:!0}),window.addEventListener("resize",r);function r(){o.setStyles({width:`${n.scrollWidth-12}px`})}function i(){o.setStyles({opacity:"1",width:"auto","pointer-events":""}),o.removeClass("fixed")}function a(){let l=n.offsetTop,u=n.offsetHeight,s=e.scrollTop;s<l&&i(),s>l&&s<u?(o.addClass("fixed"),o.setStyles({opacity:"1",width:`${n.scrollWidth-12}px`,top:"0","pointer-events":""})):s>l&&o.setStyles({opacity:"0","pointer-events":"none"})}BeFunky.befunkyPopupContainerOpen("#pricing_modal",{onClose:()=>{e.removeEventListener("scroll",a,{passive:!0}),window.removeEventListener("resize",r),i()},size:[1024]}),yr()}).catch(e=>{BeFunky.hideLoadScreen(),typeof e!="string"&&BeFunky.throwError(`Pricing modal error: ${e.name||e}`,e),bo=void 0,BeFunky.closeModal("pricing_modal",!1),BeFunky.confirm(BeFunky.failureReason(e),{confirmText:"try_again",onConfirm:()=>BeFunky.openPricingModal()})}))};function wu(){return bu().then(e=>{ku(e)})}function bu(){let e=`${BeFunky.Params.siteUrl}pricing/`,t={responseType:"document"};return new Promise((n,o)=>{BeFunky.request(e,t,({response:r,error:i})=>{if(i)return i!=="request_failed"&&BeFunky.throwError(`Failed to fetch pricing page: ${i}`,i),o(i);let a;try{if(a=r.body.querySelector("#main-content"),!a)throw"#main-content missing"}catch(l){return BeFunky.throwError("Invalid pricing page response",l,r),o("invalid_response")}n(a.innerHTML)})})}function vu(e){let t=document.getElementById("pricing_modal");t.innerHTML=e,o(),n();function n(){t.querySelectorAll(".pricing-shortcode").forEach(i=>{let a=i.closest(".section");if(a.hasClass("section--first")){a.addClass("section--pricing");let u=a.querySelector(".section__heading");u&&u.addClass("h3"),u&&u.nextElementSibling&&u.nextElementSibling.addClass("text-lg")}let l=i.querySelector(".pricing-shortcode__upgrade");l.addEventListener("click",()=>{window.onClickPrismicButton("pay")}),BeFunky.onFreeTrialEnabledChange(u=>{l.setLang(u?"start_free_trial":"upgrade_now","modal")}),window.onUserStatusChange(()=>{i.toggleClass("pricing-shortcode--is-free",!BeFunky.isPlus()),i.toggleClass("pricing-shortcode--is-plus",BeFunky.isPlus())}),i.style.visibility=""})}function o(){[...t.querySelectorAll("img")].forEach(a=>window.loadLazyImage(a)),[...t.querySelectorAll("a")].forEach(a=>{a.setAttribute("target","_blank"),a.setAttribute("rel","noopener")}),BeFunky.onFreeTrialEnabledChange(a=>{let l=t.querySelectorAll(".pricing-table__upgrade-button"),u=t.querySelector(".section__heading");u.setLang(a?"pricing_modal_trial_heading":"pricing_modal_heading"),u.nextElementSibling.setLang(a?"pricing_modal_trial_subheading":"pricing_modal_subline1"),[...l].forEach(s=>{s.setLang(a?"start_free_trial":"upgrade_now","modal")})});let r=t.querySelectorAll(".pricing-table__sign-in-button"),i=t.querySelectorAll(".pricing-table__upgrade-button");window.onUserStatusChange(()=>{r.setStyles({display:BeFunky.isLoggedIn()?"none":""}),i.setStyles({display:BeFunky.isPlus()?"none":""})})}}var Qa=(...e)=>BeFunky.logFeature("payment",...e);BeFunky.promptUserToUpgradeToYearly=function(e,t){e!==latestUserData.price_id&&(BeFunky.throwError("User data does not match customer info",latestUserData.price_id,e,latestUserData),t&&t());let{month:n,year:o}=wa([latestUserData.price_id,latestUserData.price_pair_id]),r=Object.assign({},o,{unit_amount:o.unit_amount*.9}),i=n.unit_amount,a=i*12-o.unit_amount,l=BeFunky.LanguageManager.language.modal;if(a<0){BeFunky.throwError("Upgrade to yearly provides no savings",{centsSaved:a,currentMonthlyCents:i,newYearlyCents:o.unit_amount}),t&&t();return}let u=a/i,s=u>=1.75&&u<=2.75?"upgrade_yearly_modal_body_2_months":"upgrade_yearly_modal_body";console.log({monthsOfSavings:u,currentMonthlyCents:i});let c={currency:n.currency,unit_amount:a};BeFunky.confirm([s,{amount_saved:qe(c,l),regular_annual_price:qe(o,l),discounted_annual_price:qe(r,l)}],{heading:"upgrade_yearly_modal_heading",confirmText:["upgrade_yearly_modal_confirm",{amount:qe(r,l)}],cancelText:"not_now",imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/piggy-bank.jpg`,onConfirm:()=>{BeFunky.upgradeToYearlyPayNow(o)},onCancel:t})};BeFunky.upgradeToYearlyClose=()=>(BeFunky.befunkyPopupContainerClose(),window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","NOT_NOW"),!1);var vn=()=>{};BeFunky.upgradeToYearlyPayNow=e=>{if(typeof window.stripe!="object")return _n(()=>{BeFunky.upgradeToYearlyPayNow(e)});window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","PAY_NOW");let t=()=>{window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","UPGRADE_SUCCESS"),BeFunky.hideLoadScreen(),vn(),BeFunky.showNotification({message:"upgrade_yearly_success",type:"success"}),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()};BeFunky.showLoadScreen({isCancellable:!1}),BeFunky.requestAPI("transaction/upgrade-to-yearly",{price:e.id}).then(o=>{if(o.data!=="success"&&o.data.code&&o.data.cim)return n(o.data.cim);if(o.data!=="success")throw"invalid_response";t()}).catch(o=>{if(o==="already_yearly"||o==="already_exist")return t();BeFunky.hideLoadScreen(),window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","UPGRADE_FAILURE"),BeFunky.logError("Unable to process payment upgrade to Yearly",o),BeFunky.Params.sendDebugErrors&&o!=="request_failed"&&BeFunky.throwError(`Upgrade to yearly error ${o.code||o}`),vn();let r=o.code?es(o.code).translationID:BeFunky.failureReason(o);vn=BeFunky.showNotification({message:r,type:r==="error_processing_payment"?"warning":"error"})});function n(o){window.stripe.confirmCardPayment(o).then(r=>{let i={confirmed:r.error?"2":"1"};r.error&&BeFunky.logError("3D secure failed with error",r.error),BeFunky.requestAPI("transaction/upgrade-to-yearly",i,{}).then(a=>{if(a.data!=="success")throw"invalid_response";if(!r.error)return t();vn();let l=r.error.message||"error_processing_payment";vn=BeFunky.showNotification({message:l,type:l==="error_processing_payment"?"warning":"error"})}).catch(a=>{BeFunky.throwError("Upgrade to yearly after 3d secure failed",a)}).then(()=>{BeFunky.hideLoadScreen()})})}};BeFunky.openPaymentPanel=(e,t)=>{["charge","free_trial","update","update_from_payflow"].includes(t)||(t=BeFunky.getFreeTrialEnabled()?"free_trial":"charge"),["month","year"].includes(e)||(e=ut());let n=["update","update_from_payflow"].includes(t);if(BeFunky.isPlus()&&!n){let s=BeFunky.getModal(),c=s?s.modalElement.id:void 0;["sign_in_modal","register_modal"].includes(c)&&BeFunky.closeModal(c);return}if(ut()!==e&&dn(e),!BeFunky.isLoggedIn()){BeFunky.openLoginPanel("REGISTER",()=>{t==="free_trial"&&!BeFunky.getFreeTrialEnabled()&&(t="charge"),BeFunky.openPaymentPanel(e,t)});return}if(BeFunky.platform==="play_store")return Fu(hr(e).id);let{render:o,html:r}=BeFunky.lit,i=document.getElementById("payment_modal"),a=BeFunky.User.email||"",{code:l}=_r()||{},u=r`
        <div class="centered-modal__bg centered-modal__bg--orange"></div>
        <payment-form class="centered-modal__content" .mode=${t} .email=${a} .initialPromoCode=${l} .onPaymentSubmit=${Bu}></payment-form>
    `;o(u,i),BeFunky.befunkyPopupContainerOpen("#payment_modal")};async function Fu(e){if(BeFunky.UserManager.playStorePlusUserExists&&typeof await po().then(({email:c,status:d}={})=>{if(c&&d)return BeFunky.UserManager.handlePlayStoreUser(c,d,"upgrade")})=="function")return;let t=[{supportedMethods:"https://play.google.com/billing",data:{sku:e}}],n;try{n=await new PaymentRequest(t).show(),Qa("Got paymentResponse:",n)}catch(s){s.name==="AbortError"||s.message.includes("was cancelled")?BeFunky.logError("User chose not to subscribe",s):BeFunky.throwError(s,"PaymentRequest.show() failed");return}let o=n.details.purchaseToken||n.details.token;console.log("Purchase Token Returned",n.details.purchaseToken),BeFunky.showLoadScreen();let r;try{if(r=(await BeFunky.requestAPI("transaction/g-play-validate",{sku:e,purchaseToken:o})).data,!r)throw"invalid_response";Qa("Verified payment on backend",r)}catch(s){return BeFunky.throwError(`Play Store payment validation failed: ${s.code||s.message||s}`,s),BeFunky.hideLoadScreen(),n.complete("fail")}BeFunky.hideLoadScreen(),await n.complete("success");let i={pl:"1",subscr_usr:1,plan_type:r.plan_type,subscr_amount:r.subscr_amount,subscr_date:r.subscr_date,payment_type:r.payment_type},a=r.trial_started,l=Boolean(a),u=parseInt(r.plan_type)>0?"yearly":"monthly";l?(i.trial_source=a,i.subscription_status="trialing",bf_eventTrack(a.toUpperCase(),u.toUpperCase(),"TRIAL STARTED"),BeFunky.SettingsService.updateSetting("trialing","trialing")):bf_eventTrack("CONVERSION",u.toUpperCase(),"CREDITCARD"),BeFunky.User.subscr_date&&bf_eventTrack("RESUBSCRIBE",u.toUpperCase(),"CREDITCARD"),window.updateUserStatus(Object.assign({},window.latestUserData,i)),Za(),BeFunky.befunkyPopupContainerClose(),BeFunky.openThankYouPanel(),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()}var vo=!1;function Bu({cardHolderName:e,stripeElement:t,email:n,mode:o,recurring:r,displayError:i,clearInputs:a,paymentRequestPaymentMethod:l,paymentRequestCompleteFunction:u,promoCode:s}){if(vo){BeFunky.logError("Already processing payment");return}BeFunky.showLoadScreen({isCancellable:!1}),vo=!0,l?c({error:null,paymentMethod:l}):window.stripe.createPaymentMethod({type:"card",card:t,billing_details:{name:e}}).then(c).catch(p=>{BeFunky.logError("An unexpected payment-related error occurred",p),BeFunky.throwError(p),d(void 0,"Unknown error")});function c({error:p,paymentMethod:m}){if(p){d(p.code,p.message);return}if(!m||!m.id){d(void 0,"Missing Stripe payment method");return}let g="0";try{g=typeof growsumo!="undefined"&&growsumo.data.partner_key&&growsumo.data.partner_key.length>0?growsumo.data.partner_key:"0"}catch(b){}if(g!=="0")try{growsumo.data.email=n,growsumo.data.customer_key=n,growsumo.createSignup()}catch(b){}let f=hr(r);if(!f){d(void 0,"Missing price");return}let _=(parseInt(f.unit_amount)/100).toFixed(2),y=o==="update_from_payflow"?"update-payflow-customer":o==="update"?"update-customer":"create-customer",h,w=r==="year"?"yearly":"monthly";if(o==="charge"||o==="free_trial"||o==="update")h={stripeEmail:n,stripeToken:m.id,holdername:e||"",isGrowsumo:g,handlerType:"subscription_purchase",price:f.id,promo_code:s||"",country:ct(),start_free_trial:o==="free_trial"?1:0,trial_from:BeFunky.isPaywallEnabled()?"save":""};else if(o==="update_from_payflow")h={stripeEmail:n,stripeToken:m.id,nextBillingDate:w==="monthly"?BeFunky.Params.nextBillingDateMonthly:BeFunky.Params.nextBillingDateAnnual,period:w};else return BeFunky.throwError(`Invalid payment mode: ${o}`);BeFunky.Params.return_fail_from_customer===!0&&(h.return_fail_from_customer=1);let F=b=>{if(vo=!1,b&&b.error)return typeof b.error=="string"?d(b.error,BeFunky.failureReason(b.error)):b.error.code==="user_is_plus"?(BeFunky.throwError("Already-plus user filled out payment form"),d(b.error.code,"You are already a BeFunky Plus user")):d(b.error.code,b.error.message,b);if(b&&b.data&&b.data.action_needed&&b.data.cuid){let T=b.data.cuid;h={handlerType:"subscription_purchase_reaction",cuid:T};let $=b.data.action_needed;b.data.action_needed=null,b.data.cuid=null;let N=j=>{j.error?(h={handlerType:"subscription_purchase_reaction_error",cuid:T},BeFunky.requestAPI(`transaction/${y}`,h).then(()=>{},()=>{}),d("handle_card_error",j.error.message,b)):(u&&typeof u=="function"&&(u("success"),u=null),BeFunky.requestAPI(`transaction/${y}`,h).then(()=>{F(b)},G=>{F({error:G})}))};return o==="update"?window.stripe.confirmCardSetup($).then(N):window.stripe.confirmCardPayment($).then(N)}u&&typeof u=="function"&&u("success");let E=Boolean(b&&b.data&&b.data.trial_started);try{E||bf_eventTrack("CONVERSION",w.toUpperCase(),"CREDITCARD"),BeFunky.User.subscr_date&&o==="charge"&&bf_eventTrack("RESUBSCRIBE",w.toUpperCase(),"CREDITCARD")}catch(T){BeFunky.throwError("Unable to track payment conversion",T)}let P={pl:"1",subscr_usr:1};if(o!=="update"&&(b&&b.data&&b.data.plan_type?P.plan_type=b.data.plan_type:w?P.plan_type=w==="yearly"?1:0:BeFunky.throwError("Unable to get plan_type"),b&&b.data&&b.data.subscr_amount?P.subscr_amount=b.data.subscr_amount:w?P.subscr_amount=_:BeFunky.throwError("Unable to get subscr_amount"),b&&b.data&&b.data.subscr_date?P.subscr_date=b.data.subscr_date:window.bfn_mp?P.subscr_date=window.bfn_mp.getISODate():BeFunky.throwError("Unable to get subscr_date"),b&&b.data&&b.data.payment_type&&(P.payment_type=b.data.payment_type),E)){P.subscription_status="trialing";let T=b.data.trial_started;P.trial_source=T;let $=T==="chromeos_perk_two_trial"?"TRIAL_CONVERSION":T.toUpperCase();bf_eventTrack($,w.toUpperCase(),"TRIAL STARTED"),BeFunky.SettingsService.updateSetting("trialing","trialing")}window.updateUserStatus(Object.assign({},window.latestUserData,P)),o!=="update"&&Za();try{BFN.BfnService.updateUserData()}catch(T){}BeFunky.hideLoadScreen(),o==="charge"||o==="free_trial"?(BeFunky.preventModalDispose=!0,BeFunky.closeModal("payment_modal"),BeFunky.preventModalDispose=!1,BeFunky.openThankYouPanel(BeFunky.LoginPanelObj.onCloseWithoutLogin||void 0)):BeFunky.closeModal("payment_modal"),a&&a(),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()};if(BeFunky.Params.IS_LC)return console.log({endpoint:y,params:h}),F({error:"local_dev"});BeFunky.requestAPI(`transaction/${y}`,h).then(b=>{F(b)},b=>{F({error:b})})}function d(p,m,g){BeFunky.hideLoadScreen(),vo=!1;let f=JSON.stringify({code:p,message:m});if(g&&g.error&&g.error.status){let{status:w}=g.error;f=JSON.stringify({code:p,message:m,status:w})}BeFunky.logError("A payment error occurred",f);let{field:_,translationID:y,reportError:h}=es(p);h&&(l?BeFunky.throwError(`Payment wallet error ${p}`):BeFunky.throwError(`Payment error ${p}`)),u&&typeof u=="function"&&u("fail"),i&&i(_,y)}}function Za(){if((window.isMixPanelInit&&typeof mixpanel.identify=="function")===!1&&(console.log(`Mixpanel load: ${window.isMixPanelInit}`),console.log(`Mixpanel identify: ${typeof mixpanel.identify}`),console.log(`Mixpanel pl: ${BeFunky.User.pl}`),console.log(`Mixpanel subscr: ${BeFunky.User.subscr_usr}`),console.log(`Mixpanel plantype: ${BeFunky.User.plan_type}`),BeFunky.throwError("Mixpanel could not track purchase")),typeof window.bfn_mp!="undefined"&&typeof window.mixpanel!="undefined"){let e=!1;if((typeof navigator.doNotTrack!="undefined"&&BeFunky.ConvertToBool(navigator.doNotTrack)===!0||typeof navigator.msDoNotTrack!="undefined"&&BeFunky.ConvertToBool(navigator.msDoNotTrack)===!0||typeof window.doNotTrack!="undefined"&&BeFunky.ConvertToBool(window.doNotTrack)===!0)&&(e=!0),e===!0){console.log("Mixpanel do not track enabled");try{window.bfn_mp.trackingEnabled=!1;let t=window.bfn_mp.track("subscription_started");t||(console.log("bfn_mp.identifier = ",window.bfn_mp.identifier),console.log(`Mixpanel upl: ${BeFunky.User.pl}`),console.log(`Mixpanel subscr: ${BeFunky.User.subscr_usr}`),console.log(`Mixpanel plantype: ${BeFunky.User.plan_type}`));let n={data:{people:t[0]!==null?t[0]:"",super:t[1]!==null?t[1]:"",property:t[2]!==null?t[2]:""}};n=btoa(JSON.stringify(n)),BeFunky.requestAPI("auth/has-opted-out-tracking",{event:"subscription_started",data:n})}catch(t){BeFunky.throwError("Mixpanel has_opted_out_tracking block error: ",t)}}else try{window.bfn_mp.track("subscription_started")}catch(t){}}}function es(e){switch(e){case"invalid_number":case"incorrect_number":case"incomplete_number":return{field:"number",translationID:"error_invalid_number",reportError:!1};case"expired_card":case"invalid_expiry_year_past":return{field:"form",translationID:"error_expired_card",reportError:!1};case"incomplete_expiry":return{field:"expiry",translationID:"error_incomplete_expiry",reportError:!1};case"invalid_expiry_year":return{field:"expiry",translationID:"error_invalid_expiry_year",reportError:!1};case"invalid_expiry_month":return{field:"expiry",translationID:"error_invalid_expiry_month",reportError:!1};case"incomplete_cvc":case"invalid_cvc":case"incorrect_cvc":return{field:"cvc",translationID:"error_invalid_cvc",reportError:!1};case"invalid_promo_code":case"used_before":return{field:"promo",translationID:"error_invalid_promo_code",reportError:!1};case"user_is_plus":return{field:"form",translationID:"error_already_upgraded",reportError:!0};case"subscribed_before":return{field:"form",translationID:["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT",!0)}],reportError:!0};case"authentication_required":case"approve_with_id":case"call_issuer":case"card_not_supported":case"card_velocity_exceeded":case"currency_not_supported":case"do_not_honor":case"do_not_try_again":case"duplicate_transaction":case"fraudulent":case"generic_decline":case"incorrect_pin":case"incorrect_zip":case"insufficient_funds":case"invalid_account":case"invalid_amount":case"invalid_pin":case"issuer_not_available":case"lost_card":case"merchant_blacklist":case"new_account_information_available":case"no_action_taken":case"not_permitted":case"offline_pin_required":case"online_or_offline_pin_required":case"pickup_card":case"pin_try_exceeded":case"reenter_transaction":case"restricted_card":case"revocation_of_all_authorizations":case"revocation_of_authorization":case"security_violation":case"service_not_allowed":case"stolen_card":case"stop_payment_order":case"testmode_decline":case"transaction_not_allowed":case"try_again_later":case"withdrawal_count_limit_exceeded":case"card_declined":return{field:"form",translationID:"error_card_declined",reportError:!0};default:return{field:"form",translationID:"error_processing_payment",reportError:!0}}}var Fn="user_photo_modal",Bn={},Pn=null,Sn=null,Wr=!1,ts=[],Bt,ns,Ln,Vr,Cn,zt;BeFunky.onDocumentReady(()=>{Bt=document.getElementById(Fn),!!Bt&&(ns=Bt.querySelector(".user-photo__image"),Ln=Bt.querySelector(".user-photo__title"),Vr=Bt.querySelector(".user-photo__author"),Cn=Bt.querySelector(".user-photo__report-abuse"),Cn.addEventListener("click",()=>{if(!zt){let t=document.getElementById("user_photo_modal");t&&(zt=t.getAttribute("data-single-image-id"))}if(!zt)return BeFunky.throwError("reportAbuseImageID not found");let e=BeFunky.getModal(Fn);e&&e.isVisible&&BeFunky.closeModal(Fn),Xr(zt)}))});BeFunky.reportAbuse=Xr;BeFunky.openUserPhotoModal=function(e,t,n,o){if(!Bt)return BeFunky.throwError("User Photo Modal not available");BeFunky.openModal(Bt,{onOpen:()=>{Wr=!0,Gr(e,t,o);let r=os(e);r!==wt()&&de(r)},onClose:()=>{Wr=!1,Gr(),n!==wt()&&de(n)},addLightThemeClass:!0,addCloseButton:!0,size:"large",onArrowClick:r=>{let i=r==="left"?Pn:Sn;i&&(Gr(i,t,o),de(os(i)))}})};BeFunky.closeUserPhotoModal=function(){Wr&&BeFunky.closeModal(Fn)};function Gr(e,t,n){if(e){let o=document.querySelector(".user-photo__image-box");o.innerHTML="",Bn.hasOwnProperty(e.imageURL)?o.appendChild(Bn[e.imageURL]):o.appendChild(zr(e)),Ln.textContent=e.title;let i=Ln.innerHTML.replace(/#(\w+)/gi,`<a href="${BeFunky.Params.siteUrl}explore/photos/$1/">#$1</a>`);if(Ln.innerHTML=i||"Untitled",Vr.innerHTML=`by <a href="${BeFunky.Params.siteUrl}gallery/${e.nick}/">${e.nick}</a>`,t){let a=t.indexOf(e);Pn=t[a-1],Sn=t[a+1];let[l,u]=BeFunky.getModal(Fn).arrowButtons;l.disabled=!Pn,u.disabled=!Sn,Pu()}}else ns.src="",Ln.innerHTML="",Vr.innerHTML="",Object.keys(Bn).forEach(o=>{delete Bn[o]});if(Cn.toggleClass("user-photo__report-abuse--hidden",!n),e){zt=e.id.replace("befunky_photo_","");let o=ts.includes(zt);Cn.disabled=o,Cn.setLang(o?"abuse_reported":"report_abuse","site")}}function zr(e){let t=new Image;return t.src=e.imageURL,t.setClass("image-box__image explore-modal__image"),e.isTransparent&&t.addClass("image-box__image--is-transparent"),t.id="explore-image",Bn[t.src]=t,t}function Pu(){requestIdleCallback(()=>{Pn&&zr(Pn),Sn&&zr(Sn)})}function os(e){return`/explore/gallery/${e.id.split("_").pop()}/`}function Xr(e){if(!BeFunky.isLoggedIn())return BeFunky.openLoginPanel("SIGNIN",()=>{BeFunky.befunkyPopupContainerClose(),Xr(e)});if(!(BeFunky.User.isMailVerified!=null?BeFunky.User.isMailVerified:BeFunky.Params.isMailVerified))return BeFunky.confirm("please_verify_email",{onConfirm:BeFunky.sendVerificationEmail,confirmText:"send_verification_email",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`});let n=document.createElement("div");n.appendChild(document.createElement("p").setLang("report_abuse_prompt_1","site")),n.appendChild(document.createElement("p").setLang("report_abuse_prompt_2","site")),BeFunky.confirm(n,{heading:"report_abuse",confirmText:"report",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/flag.svg`,onConfirm:()=>{let o={mode:"reportAbuse",img_key:e};wt().startsWith("/a/")&&(o.is_anonymous=1),BeFunky.requestAPI("photo/report-abuse",o,{showLoadScreen:!0}).then(()=>{ts.push(e)}).catch(r=>{BeFunky.throwError("Unable to Report Abuse on image",r,e)}).then(()=>{BeFunky.acknowledge("report_abuse_thank_you",{heading:"report_abuse_sorry"})})}})}var{html:ge,setupState:Su,render:Yr,modalLang:ye,elem:En,icon:Ve}=BeFunky.lit;BeFunky.createProjectManagerModal=function(){let e=En`<div id="project_manager" class="modal modal--button-sm project-manager bfn"></div>`,t=1600,n=t-17*16-24*2,o={isLoggedIn:!1,searchTerm:"",previousSearch:null,galleryWidth:n,allProjects:[],sortMode:"MODIFIED",orientationMode:"ALL_ORIENTATION",projectTypeMode:"ALL_PROJECTS",viewMode:"THUMBNAIL",projectFolders:[],areProjectFoldersLoading:!1,selectedFolderId:-1,isLoading:!1,message:null,selectedProjectIDs:[]},r=BeFunky.once(O),i=!1,a=En`<div id="context_menu_project_manager"></div>`,l=En`<div id="context_menu_folder_manager"></div>`,u=BeFunky.debounce(()=>{Yr(_(),e),i||K(),r()},"raf"),[s,c]=Su(o,u);BeFunky.LanguageManager.addLanguageUpdateListener(u),window.onUserStatusChange(Be,!1);let d,p=Is(),m=w();y(),h();let g=null,f=null;return Object.assign(e,{open:A}),e;function _(){let k=s.selectedFolderId===-1,v=s.selectedFolderId===0;return ge`
        <panel-header lang-id="project_manager" modifier="modal" buttons="close"></panel-header>
        <div class="modal__body project-manager__body">
            <div class="project-manager__left-panel" clue-id="project_manager">
                <div id="project_manager_placeholder" style="position: relative;"></div>
               <form role="search" class="search-box project-manager__search-box">
                    <input type="search" .disabled=${!s.isLoggedIn} id="project_manager_search" placeholder=${ye("search_all_projects",!0)} class="input project-manager__search-input search-box__input" required>
                    <button type="reset" class="button button--icon button--md button--transparent search-box__clear">
                        ${Ve("cancel-icon","icon icon--10")}
                    </button>
                    <button type="submit" .disabled=${!s.isLoggedIn} class="button button--icon button--md button--white-outline search-box__submit" @click=${_e}>
                        ${Ve("search-icon","icon")}
                    </button>
                </form>
                ${s.isLoggedIn?ge`<button class=${`project-manager__folder button button--grey-200 button--left-align button--fullwidth ${k?"button--selected":""}`} @click=${()=>$e(-1)}>
                    ${ye("all_projects")}
                </button>
                <button class="project-manager__folder button button--grey-200 button--left-align button--fullwidth ${v?"button--selected":""}" .folderId=${0} @click=${()=>$e(0)}>
                    ${ye("unsorted_projects")}
                </button>
                <div class="project-manager__left-panel-buttons scrollable-content">
                    <div class="project-manager__folders-header">
                        <span class="text-sm">${ye("folders")}</span>
                        <button class="button button--icon button--transparent" @click=${Pe}>${Ve("plus-icon","icon")}</button>
                    </div>
                    ${X()}
                </div>`:""}
            </div>
            ${F()}
        </div>
        ${a}
        ${l}
        ${m}
        `}function y(){BeFunky.contextMenu(a,{open:{onClick:()=>B(g)},move:{onClick:()=>L([g])},rename:{onClick:()=>R(g)},delete:{onClick:()=>S([g])}},{hoverOffEventTarget:document})}function h(){BeFunky.contextMenu(l,{delete:{onClick:()=>Ke(f)},rename:{onClick:()=>mt(f)}},{hoverOffEventTarget:document})}function w(){let k=document.createElement("div");return BeFunky.dragScreen(k),k}function F(){return s.isLoggedIn?b():H()}function b(){return ge`
        <div class="project-manager__right-panel">
            ${$()}
            <div class="scrollable-content scrollable-content--modal-right-panel" style=${`--scrollable-content-width: ${s.galleryWidth}px`}>
                ${E()}
            </div>
        </div>
        `}function E(){if(s.viewMode==="THUMBNAIL"||s.isLoading)return H();let k=ci();return k.length?P(k):H()}function P(k){return requestIdleCallback(T),ge`
        <div class="panel-header project-manager__column-header-row" style=${`width: ${s.galleryWidth}px`}>
            <span class="project-manager__column-header-title project-manager__heading-name">${ye("name")}</span>
            <span class="project-manager__column-header-title project-manager__heading-created">${ye("date_created")}</span>
            <span class="project-manager__column-header-title project-manager__heading-modified">${ye("last_modified")}</span>
        </div>
        ${k.map(v=>{let I=s.selectedProjectIDs.includes(v.id),W=s.selectedProjectIDs.length>1;return ge`
                <div class="${`project-manager__project-row ${I?"project-manager__project-row--selected":""}`}" @click=${D=>ce(D,v.id)} style=${`width: ${s.galleryWidth}px`} .draggedProjectId=${v.id}>
                    <button class="${`button button--icon project-manager__circle ${I?"project-manager__circle--selected":""}`}" @click="${D=>me(D,v.id)}">
                        ${Ve("checkmark-icon","icon icon--selected icon--12")}
                    </button>
                    <div class="project-manager__name">
                    <div class="project-manager__project-thumbnail" style="background-image: url(${v.listViewThumbURL})"></div>
                        <span>${v.filename}</span>
                    </div>
                    <span class="project-manager__date-created">${di(v.creationDate)}</span>
                    <span class="project-manager__date-modified">${di(v.modifiedDate)}</span>
                    ${W?"":ge`<button @click=${fe} class="button button--xs button--icon button--white-outline project-manager__edit-button project-manager__edit-button--list-view">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>`}
                </div>
            <div>`})}`}function T(){let k;[...e.querySelectorAll(".project-manager__project-row")].forEach(v=>{k=k||v.parentElement,ve(v,()=>k)})}function $(){if(s.selectedProjectIDs.length>0){let v=s.selectedProjectIDs.length;return ge`
            <div class="project-manager__results-header project-manager__results-header--multiselect">
                <button style="position: absolute" class="button button--icon button--transparent" @click=${()=>c({selectedProjectIDs:[]})}>
                    ${Ve("cancel-icon")}
                </button>
                <string style="position: absolute; margin-left: 2.25rem">${ye([v===1?"projects_selected_single":"projects_selected_multiple",{number:v.toString()}])}</string>
                <button style="margin: 0 0.5rem 0 auto"  class="button button--icon button--grey-200" @click=${()=>L(s.selectedProjectIDs)} data-tooltip="move" data-tooltip-above>
                    ${Ve("open-folder-icon")}
                </button>
                <button style="margin: 0 auto 0 0" class="button button--icon button--grey-200" @click=${()=>S(s.selectedProjectIDs)} data-tooltip="delete" data-tooltip-above>
                    ${Ve("delete-icon")}
                </button>
            </div>
            `}let k;return s.searchTerm?k=ye(["search_results_for",{query:`<strong>${BeFunky.escapeHTML(s.searchTerm)}</strong>`}]):s.selectedFolderId===-1?k=ye("all_projects"):s.selectedFolderId===0?k=ye("unsorted_projects"):k=si(s.selectedFolderId),ge`
            <div class="project-manager__results-header">
                <div class="project-manager__results-container">
                    <h3 class="project-manager__results-heading bold">${k}</h3>
                    ${s.searchTerm?j():""}
                    ${G()}
                </div>
                <div class="project-manager__filters">
                    ${p.map(v=>N(v))}
                </div>
            </div>
        `}function N(k){let{title:v,menuParent:I,menuChildren:W,selectedMode:D}=k;return ge`
        <dropdown-menu
            .menuTitle=${v}
            .mainButton=${I}
            .navItems=${W}
            .disabled=${!s.isLoggedIn}
            .selectedMode=${s[D]}
        ></dropdown-menu>`}function j(){return ge`
            <button class="button button--circle button--white-outline button--icon button--xs project-manager__clear-results" @click=${he} data-tooltip="cancel">
                ${Ve("cancel-icon","icon icon--10")}
            </button>
        `}function G(){if(s.projectTypeMode==="ALL_PROJECTS"&&s.orientationMode==="ALL_ORIENTATION")return;let k={ALL_ORIENTATION:"all_orientations",HORIZONTAL:"horizontal",VERTICAL:"vertical",SQUARE:"square",ALL_PROJECTS:"all_projects",EDITOR:"photo_editor",COLLAGE:"collage_maker",DESIGNER:"graphic_designer"};return ge`
             <div class="project-manager__active-filters">
                ${s.orientationMode!=="ALL_ORIENTATION"?ge`
                <div class="project-manager__active-filter chip">
                    <string>${ye(k[s.orientationMode])}</string>
                    <button class="button button--icon" @click=${se("ALL_ORIENTATION")} data-tooltip="cancel">
                        ${Ve("cancel-icon","icon icon--12")}
                    </button>
                </div>`:""}
                ${s.projectTypeMode!=="ALL_PROJECTS"?ge`
                <div class="project-manager__active-filter chip">
                    <string>${ye(k[s.projectTypeMode])}</string>
                    <button class="button button--icon" @click=${se("ALL_PROJECTS")} data-tooltip="cancel">
                        ${Ve("cancel-icon","icon icon--12")}
                    </button>
                </div>`:""}
            </div>
        `}function H(){let k=ci().map(ae=>ae.imageObject),v=s.selectedProjectIDs.length>0,I=(ae,{isSelected:rt,wasSelectButtonClicked:Te})=>{let it=ae.id;Te||v?c(rt?{selectedProjectIDs:[...s.selectedProjectIDs,it]}:{selectedProjectIDs:s.selectedProjectIDs.filter(An=>An!==it)}):B(it)},W="ontouchstart"in window,D=(ae,{isSelected:rt})=>{let Te=ae.id;c(rt?{selectedProjectIDs:[...s.selectedProjectIDs,Te]}:{selectedProjectIDs:s.selectedProjectIDs.filter(it=>it!==Te)})};return ge`<image-gallery
            class="gallery project-manager__thumbnail-gallery"
            .images=${k}
            .isLoading=${s.isLoading}
            .message=${s.message}
            .emptyState=${k.length?null:ne()}
            .rowHeight=${215}
            .currentWidth=${s.galleryWidth}
            .addItemClass=${()=>"gallery__item--has-content"}
            .onClickItem=${I}
            .onLongPressItem=${W?D:void 0}
            .selectedImageIDs=${s.selectedProjectIDs}
            .extendItemTemplate=${z}
            .setupItemDragging=${J}
            .useSelectButton=${!v}
            .gutterWidth=${8}
            .borderWidth=${1}
        ></image-gallery>`}function z(k){let v=s.selectedProjectIDs.length>1;return ge`
        <div class="gallery__item-content">
            <p class="project-manager__thumbnail-title">${xo(k.id)}</p>
            ${v?"":ge`<button @click=${I=>De(I,k)} class="button button--xs button--icon button--white-outline project-manager__edit-button project-manager__edit-button--thumbnail-view">
                <span></span>
                <span></span>
                <span></span>
            </button>`}
        </div>
        `}function J(k,{id:v}){k.draggedProjectId=v,ve(k,()=>k.parentElement.parentElement)}function X(){return s.areProjectFoldersLoading?ue():Q()}function ue(){return ge`<div class="project-manager__loading">
            <div class="loading-spinner"></div>
                <string>${ye("loading")}</string>
            </div>`}function Q(){let k="project-manager__folder button button--grey-200 button--has-icon button--left-align button--fullwidth",v=`${k} button--selected`,I=li(s.projectFolders);return I.length>0?I.map(({folderId:W,name:D})=>{let ae=W===s.selectedFolderId;return ge`
                    <button class="${ae?v:k}" .folderId=${W} @click=${()=>$e(W)}>
                        ${Ve("save-project-icon","icon")}
                        <string>${D}</string>
                        <div @click=${Se} class="project-manager__folder-ellipsis button button--transparent">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </button>`}):ge`
            <div class="project-manager__empty-state">
                <img src=${BeFunky.Params.globalImagesPath}illustrations/no-folders.svg class="gallery__empty-state-image" alt="no results"/>
                <p class="text-xs">${ye("project_folders_empty")}</p>
            </div>`}function pe(k){let v,I=En`<div id="move_to_folder" class="modal project-manager__move-folder-modal">`,W="project-manager__folder button button--transparent button--has-icon button--left-align button--fullwidth",D=()=>ge`<div>
            <h6 class="project-manager__move-folder-header">${ye("move_to_folder")}</h6>
            <p>${ye("select_your_destination_folder")}</p>
            <div class="scrollable-content project-manager__move-folder-list">
                ${k===0?"":ae(0,ye("unsorted_projects",!0))}
                ${li(s.projectFolders).filter(({folderId:Te})=>Te!==k).map(({folderId:Te,name:it})=>ae(Te,it))}
            </div>
        </div>`;return Yr(D(),I),{dialogContent:I,getSelectedFolderId:()=>v};function ae(Te,it){let An=s.allProjects.filter(As=>As.folderId===Te).length,Ts=ye(An===1?"one_project":["multiple_projects",{number:An.toString()}]);return ge`
            <div class=${`${W} ${Te===v?"button--selected":""}`} @click=${()=>rt(Te)}>
                ${Ve("open-project-icon","icon")}
                <div class="project-manager__folder-name-container">
                    <span class="project-manager__folder-name text-sm">${it}</span>
                    <span class="text-xxs project-manager__folder-count">(${Ts})</span>
                </div>
            </div>`}function rt(Te){v=Te,Yr(D(),I)}}function ne(){if(!s.isLoggedIn)return{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/log-in-befunky-photos.svg`,text:"login_load_projects",buttonAction:$s,buttonText:"sign_in"};if(!s.searchTerm&&!s.allProjects.length)return{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-projects-canvas.svg`,text:"no_saved_projects",linkText:"learn_more",linkHref:"https://support.befunky.com/hc/en-us/articles/360003279091-How-Do-I-Save-My-Project-So-I-Can-Edit-It-Later-"};if(s.searchTerm&&!s.allProjects.length)return{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-search-results-canvas.svg`,text:["no_results_for",{query:`"<strong>${BeFunky.escapeHTML(s.searchTerm)}</strong>"`}]};let k=s.orientationMode!=="ALL_ORIENTATION"||s.projectTypeMode!=="ALL_PROJECTS";return s.selectedFolderId>0&&k&&!s.searchTerm?{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-search-results-canvas.svg`,text:"no_results_in_folder"}:s.selectedFolderId>0&&!s.searchTerm?{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/empty-folder-canvas.svg`,text:"no_saved_projects_in_folder"}:{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-search-results-canvas.svg`,text:"error_no_results"}}function ve(k,v){if(k.hasOwnProperty("dragging"))return;BeFunky.draggableElement(k,v,{dragScreen:m});let I=!1;k.addEventListener("dragstarted",()=>{if(k.pointerDownTarget&&k.pointerDownTarget.hasClass("gallery__select-button")){I=!0,k.cancelDragging();return}if(!s.selectedProjectIDs.length)c({selectedProjectIDs:[k.draggedProjectId]});else if(!s.selectedProjectIDs.includes(k.draggedProjectId)){I=!0,k.cancelDragging();return}I=!1,e.addClass("project-manager--dragging");let W=e.getBoundingClientRect();m.dragOffset={x:W.x,y:W.y};let D=s.selectedProjectIDs.length,ae=D===1?xo(s.selectedProjectIDs[0]):BeFunky.LanguageManager.getStringReplacements("multiple_projects",{number:D.toString()});m.showNode(En`
                <div class="project-manager__ghost">
                    <div class="project-manager__ghost-button button button--md button--has-icon button--selected">
                        ${Ve("save-project-icon")}
                        <string>${ae}</string>
                    </div>
                    ${D>1?ge`
                    <div class="project-manager__ghost-button button button--md button--has-icon button--selected"></div>
                    <div class="project-manager__ghost-indicator">${D}</div>
                    `:""}
                </div>
            `,1)}),k.addEventListener("dragstopped",W=>{if(I)return;e.removeClass("project-manager--dragging");let{folderId:D}=W.detail.dropTarget||{};typeof D=="number"&&D>=0&&(we(D,s.selectedProjectIDs),c({selectedProjectIDs:[]}))})}function _e(k){k&&k.preventDefault();let v=d.value;Qt(v)}function he(){Qt()}function se(k){return function(){let I={ALL_ORIENTATION:"orientationMode",ALL_PROJECTS:"projectTypeMode"}[k];c({[I]:k})}}function ce(k,v){k.target.nodeName!=="BUTTON"&&(s.selectedProjectIDs.length?s.selectedProjectIDs.includes(v)?c({selectedProjectIDs:s.selectedProjectIDs.filter(I=>I!==v)}):c({selectedProjectIDs:[...s.selectedProjectIDs,v]}):B(v)),g=v}function fe(k){a.handleTargetClick(k)}function me(k,v){s.selectedProjectIDs.includes(v)?c({selectedProjectIDs:s.selectedProjectIDs.filter(I=>I!==v)}):c({selectedProjectIDs:[...s.selectedProjectIDs,v]})}function De(k,v){k.stopPropagation(),g=v.id,a.handleTargetClick(k)}function C(k){return function(){c({viewMode:k,selectedProjectIDs:[]})}}function B(k){let v=s.allProjects.find(({id:ae})=>ae===k);if(!window.isAppOpen){BeFunky.SavedProjectManager.openProjectFromOutsideOfApp(v);return}let{renderedWidth:I=0,url:W}=v.imageObject.lastRenderedThumb||{},D=I>=308?W:void 0;BeFunky.SavedProjectManager.openUserSavedProject(v,D).catch(ae=>{ae!=="cancelled_by_user"&&BeFunky.logError("Failed to open user-saved project",ae)})}function L(k){let v=s.projectFolders.length?D():void 0,{dialogContent:I,getSelectedFolderId:W}=pe(v);BeFunky.confirm(I,{onConfirm:async()=>{let ae=W();typeof ae=="number"&&ae>=0&&(await we(ae,k),c({selectedProjectIDs:[]}))},className:"project-manager__move-dialog",confirmText:"move",cancelText:"cancel",size:"extra-small",focusConfirmButton:!1});function D(){let ae=s.allProjects.filter(({id:rt})=>k.includes(rt)).map(({folderId:rt})=>rt).unique();return ae.length===1?ae[0]:void 0}}function R(k){let v=xo(k),I=BeFunky.createFormModalContainer("project_title"),{teardown:W}=BeFunky.formModal(I,{title:"rename_project",fields:[{name:"projectname",label:"project_name",initialValue:v,errorMessage:"error_duplicate_project_name",maxLength:100,validate:D=>!Ss(D),sanitize:D=>D.replace(/^[.\\]+/,"")}],button:"rename",onSubmit:({projectname:D})=>{re(k,D.trim()).then(()=>{BeFunky.closeModal(I)})}},{formClass:"project-manager__rename-input"});BeFunky.openFormModal(I,W)}function S(k){let v=k.length===1?"confirm_delete_one_project":["confirm_delete_multiple_projects",{number:k.length.toString()}];BeFunky.confirm(v,{onConfirm:async()=>{k.length===1?await ie(k[0]):await je(k),c({selectedProjectIDs:[]})},confirmText:"yes",cancelText:"no",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/photo-project-shredder.svg`})}function x(){c({sortMode:"RELEVANT"})}function U(){c({sortMode:"MODIFIED"})}function M(){c({sortMode:"CREATED"})}function Z(){c({sortMode:"NAME"})}function Y(k){return function(){c({orientationMode:k,selectedProjectIDs:[]})}}function oe(k){return function(){c({projectTypeMode:k,selectedProjectIDs:[]})}}function Be(){c({isLoggedIn:BeFunky.isLoggedIn()}),s.isLoggedIn&&(Qt(),ke())}function Pe(){let k=BeFunky.createFormModalContainer("create_folder"),{teardown:v}=BeFunky.formModal(k,{title:"create_folder",fields:[{name:"foldername",label:"folder_name",initialValue:"",maxLength:100,sanitize:I=>I.replace(/^[.\\]+/,"")}],button:"create",onSubmit:({foldername:I})=>{Ie(I.trim()).then(()=>{a.showButton("move"),BeFunky.closeModal(k)})}},{formClass:"project-manager__folder-input"});BeFunky.openFormModal(k,v)}function $e(k){c({selectedFolderId:k,selectedProjectIDs:[]})}function Se(k){k.stopPropagation(),l.handleTargetClick(k),f=k.currentTarget.parentElement.folderId||s.selectedFolderId}function mt(k){let v=si(k),I=BeFunky.createFormModalContainer("folder_title"),{teardown:W}=BeFunky.formModal(I,{title:"rename_folder",fields:[{name:"foldername",label:"folder_name",initialValue:v,maxLength:100,sanitize:D=>D.replace(/^[.\\]+/,"")}],button:"rename",onSubmit:({foldername:D})=>{Ge(k,D.trim()).then(()=>{BeFunky.closeModal(I)})}},{formClass:"project-manager__folder-rename-input"});BeFunky.openFormModal(I,W)}function Ke(k){if(!s.allProjects.find(v=>v.folderId===k)){te(k,!1);return}BeFunky.confirm("confirm_folder_delete_befunky",{onConfirm:()=>{te(k,!0)},onCancel:v=>{!v||te(k,!1)},confirmText:"delete",cancelText:"keep",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/folder-shredder.svg`,addCloseButton:!0})}function A(){BeFunky.openModal(e,{onOpen:()=>{let k=BeFunky.isLoggedIn();if(c({isLoggedIn:k}),s.isLoggedIn){ke(),Qt();return}c({isLoading:!1})},onClose:()=>{c({previousSearch:null})},onWindowResize:({availableWidth:k})=>{c({galleryWidth:n+(k-t)})},size:"xxl"})}function O(){d=document.getElementById("project_manager_search")}function q(k){return{id:k.id,getImageURL:v=>BeFunky.SavedProjectManager.getThumbURL(k,v),thumbWidth:k.width,thumbHeight:k.height,isTransparent:/\.png(\?|$)/.test(k.thumburl)}}function K(){!s.allProjects.length||!s.projectFolders.length||(window.BFN&&window.BFN.HelpClueManager&&BFN.HelpClueManager.show("project_manager",{renderOptions:{side:"left",top:"11.5rem",left:"16rem",zIndex:"1",container:()=>document.getElementById("project_manager_placeholder")}}),i=!0)}async function ke(){c({areProjectFoldersLoading:!0});let k=[];try{k=await BeFunky.ProjectFolderService.getFolders(),c({projectFolders:k})}catch(v){v!=="request_failed"&&(BeFunky.reportWarning(`Failed to fetch project folders: ${v}`,v),c({projectFolders:[]}))}c({areProjectFoldersLoading:!1}),k.length?a.showButton("move"):a.hideButton("move")}function we(k,v){return BeFunky.ProjectFolderService.addProjectsToFolder(k,v).then(()=>{window.UIMessages&&UIMessages.display(v.length===1?"moved_project":"moved_projects"),s.allProjects.filter(I=>v.includes(I.id)).forEach(I=>{I.folderId=k}),c({allProjects:[...s.allProjects]})},I=>Oe(I,"Failed to add projects to folder",k,v))}function te(k,v){return BeFunky.ProjectFolderService.deleteFolder(k,v).then(()=>{let I=s.projectFolders.filter(D=>D.folderId!==k),W=v?s.allProjects.filter(D=>D.folderId!==k):s.allProjects.map(D=>(D.folderId===k&&(D.folderId=0),D));c({projectFolders:I,allProjects:W,selectedProjectIDs:[]}),s.selectedFolderId===k&&c({selectedFolderId:v?-1:0}),s.projectFolders.length===0&&a.hideButton("move")},I=>Oe(I,"Failed to delete folder",k,v))}function Ie(k){return BeFunky.ProjectFolderService.createFolder(k).then(({folderId:v,name:I})=>{let W={folderId:v,name:I};c({projectFolders:[...s.projectFolders,W]})},v=>Oe(v,"Failed to create folder",k))}function Ge(k,v){return BeFunky.ProjectFolderService.renameFolder(k,v).then(({name:I})=>{s.projectFolders.find(W=>W.folderId===k).name=I,c({projectFolders:[...s.projectFolders]})},I=>Oe(I,"Failed to update folder name",k,v))}function re(k,v){let I={project:k,filename:v};return BeFunky.requestAPI("photo/projects/update",I,{showLoadScreen:!0}).then(W=>{if(W.data!=="success")throw"invalid_response";s.allProjects.find(D=>D.id===k).filename=v,c({allProjects:[...s.allProjects]})}).catch(W=>Oe(W,"Failed to project folder name",k,v))}function ie(k){return BeFunky.SavedProjectFetcher.deleteProject(k,!0).then(()=>{ui(k),window.BFN&&BFN.DesignerTemplateManager&&BFN.DesignerTemplateManager.recentProjectsComponent&&BFN.DesignerTemplateManager.recentProjectsComponent.fetchProjects();let v=document.querySelector("dashboard-projects");v&&v.fetchProjects()}).catch(v=>Oe(v,"Failed to delete project",k))}function je(k){return BeFunky.showLoadScreen(),Promise.all(k.map(v=>BeFunky.SavedProjectFetcher.deleteProject(v).then(()=>ui(v),I=>Oe(I,"Failed to delete project",v)))).then(()=>{BeFunky.hideLoadScreen(),window.BFN&&BFN.DesignerTemplateManager&&BFN.DesignerTemplateManager.recentProjectsComponent&&BFN.DesignerTemplateManager.recentProjectsComponent.fetchProjects();let v=document.querySelector("dashboard-projects");v&&v.fetchProjects()})}function Oe(k,v,...I){k!=="request_failed"&&BeFunky.reportWarning(`${v}: ${k}`,...I),UIMessages.display(BeFunky.failureReason(k),2e3)}function Qt(k=""){let v=k.trim();if(d&&(d.value=v),v===s.previousSearch)return;c({isLoading:!0,allProjects:[],searchTerm:v,sortMode:v?"RELEVANT":"MODIFIED",previousSearch:v,message:null,selectedProjectIDs:[]}),Y("ALL_ORIENTATION")(),oe("ALL_PROJECTS")(),(k?BeFunky.SavedProjectFetcher.searchProjects(k):BeFunky.SavedProjectFetcher.getAllProjects()).then(D=>{let ae=Ps(D);c({allProjects:ae,isLoading:!1})}).catch(D=>{c({isLoading:!1,allProjects:[]}),D!=="no_results"&&(BeFunky.logError(D),c({previousSearch:null,message:{isError:!0,text:BeFunky.failureReason(D),buttonText:"try_again",buttonAction:()=>Qt(v)}}))})}function Ps(k){let v=40*(BeFunky.isRetina()?2:1);return k.map(I=>{I.id=I.templateid;let W=I.date.replace(/-/g,"/"),D=I.modified.replace(/-/g,"/");return I.creationDate=new Date(W),I.modifiedDate=new Date(D),I.listViewThumbURL=BeFunky.addParamsToURL(I.thumburl,{width:v,height:v,fit:"crop",auto:"webp"}),I.imageObject=q(I),I})}function Ss(k){return s.allProjects.some(v=>v.filename===k)}function xo(k){return s.allProjects.find(({id:I})=>I===k).filename}function si(k){return s.projectFolders.find(v=>v.folderId===k).name}function li(k){return k.slice().sort((v,I)=>v.name>I.name?1:-1)}function ci(){let k=s.allProjects.filter(Ls()).filter(Es()).filter(Cs()),v=xs();return typeof v=="function"&&k.sort(v),k}function Ls(){let k=s.orientationMode;return k==="HORIZONTAL"?v=>v.width>v.height:k==="VERTICAL"?v=>v.width<v.height:k==="SQUARE"?v=>v.width===v.height:()=>!0}function Cs(){if(s.selectedFolderId===-1)return()=>!0;let k=s.selectedFolderId;return v=>v.folderId===k}function Es(){let k=s.projectTypeMode;if(k==="ALL_PROJECTS")return()=>!0;if(k==="EDITOR")return v=>v.project_type==="editor";if(k==="COLLAGE")return v=>v.project_type==="collage";if(k==="DESIGNER")return v=>v.project_type==="designer"}function xs(){let k=s.sortMode;if(k==="MODIFIED")return(v,I)=>{let W=v.modifiedDate;return I.modifiedDate-W};if(k==="CREATED")return(v,I)=>{let W=v.creationDate;return I.creationDate-W};if(k==="NAME")return(v,I)=>{let W=v.filename.toUpperCase(),D=I.filename.toUpperCase();return W<D?-1:W>D?1:0}}function $s(){BeFunky.openLoginPanel("SIGNIN")}function ui(k){let v=s.allProjects.filter(({id:I})=>I!==k);c({allProjects:v,selectedProjectIDs:[]}),v.length||(c({searchTerm:""}),Y("ALL_ORIENTATION")(),oe("ALL_PROJECTS")(),BeFunky.SavedProjectFetcher.projectData.allProjectsFetched=!1)}function di(k){let v=new Date(k.getTime()),I=v.getTimezoneOffset()/60*-1;v.setHours(v.getHours()+I);let W=BeFunky.LanguageManager.language.modal,D=v.toLocaleString(W,{year:"numeric",month:"numeric",day:"numeric",hour12:!0,hour:"2-digit",minute:"2-digit"});return W==="en"&&(D=D.replace(/-/g,"/").replace(","," at")),D}function Is(){return[{title:"view",menuParent:{iconName:"mosaic-icon"},menuChildren:[{text:"thumbnails",mode:"THUMBNAIL",clickHandler:C("THUMBNAIL"),iconName:"mosaic-icon"},{text:"list_items",mode:"LIST",clickHandler:C("LIST"),iconName:"list-view-icon"}],selectedMode:"viewMode"},{title:"sort_by",menuParent:{iconName:"modified-date-icon"},menuChildren:[{text:"relevancy",mode:"RELEVANT",clickHandler:()=>x(),visibilityFilter:()=>Boolean(s.searchTerm),iconName:"relevancy-icon"},{text:"modified_date",mode:"MODIFIED",clickHandler:()=>U(),iconName:"modified-date-icon"},{text:"creation_date",mode:"CREATED",clickHandler:()=>M(),iconName:"creation-date-icon"},{text:"name",mode:"NAME",clickHandler:()=>Z(),iconName:"capital-letter-icon"}],selectedMode:"sortMode"},{title:"orientation",menuParent:{iconName:"all-orientations-icon"},menuChildren:[{text:"all_orientations",mode:"ALL_ORIENTATION",clickHandler:Y("ALL_ORIENTATION"),iconName:"all-orientations-icon"},{text:"horizontal",mode:"HORIZONTAL",clickHandler:Y("HORIZONTAL"),iconName:"horizontal-results-icon"},{text:"vertical",mode:"VERTICAL",clickHandler:Y("VERTICAL"),iconName:"vertical-results-icon"},{text:"square",mode:"SQUARE",clickHandler:Y("SQUARE"),iconName:"square-results-icon"}],selectedMode:"orientationMode"},{title:"project_type",menuParent:{iconName:"image-icon"},menuChildren:[{text:"all_types",mode:"ALL_PROJECTS",clickHandler:oe("ALL_PROJECTS"),iconName:"all-projects-icon"},{text:"photo_editor",mode:"EDITOR",clickHandler:oe("EDITOR"),iconName:"image-icon"},{text:"collage_maker",mode:"COLLAGE",clickHandler:oe("COLLAGE"),iconName:"layouts-icon"},{text:"graphic_designer",mode:"DESIGNER",clickHandler:oe("DESIGNER"),iconName:"templates-icon"}],selectedMode:"projectTypeMode"}]}};var Jr=!1;if(typeof window!="undefined"){let e={get passive(){Jr=!0}};window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}var rs=typeof window!="undefined"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),Xt=[],Fo=!1,Kr=-1,xn,$n,is=e=>Xt.some(t=>!!(t.options.allowTouchMove&&t.options.allowTouchMove(e))),Bo=e=>{let t=e||window.event;return is(t.target)||t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)},Lu=e=>{if($n===void 0){let t=!!e&&e.reserveScrollBarGap===!0,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&($n=document.body.style.paddingRight,document.body.style.paddingRight=`${n}px`)}xn===void 0&&(xn=document.body.style.overflow,document.body.style.overflow="hidden")},Cu=()=>{$n!==void 0&&(document.body.style.paddingRight=$n,$n=void 0),xn!==void 0&&(document.body.style.overflow=xn,xn=void 0)},Eu=e=>e?e.scrollHeight-e.scrollTop<=e.clientHeight:!1,xu=(e,t)=>{let n=e.targetTouches[0].clientY-Kr;return is(e.target)?!1:t&&t.scrollTop===0&&n>0||Eu(t)&&n<0?Bo(e):(e.stopPropagation(),!0)},as=(e,t)=>{if(!e){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(Xt.some(o=>o.targetElement===e))return;let n={targetElement:e,options:t||{}};Xt=[...Xt,n],rs?(e.ontouchstart=o=>{o.targetTouches.length===1&&(Kr=o.targetTouches[0].clientY)},e.ontouchmove=o=>{o.targetTouches.length===1&&xu(o,e)},Fo||(document.addEventListener("touchmove",Bo,Jr?{passive:!1}:void 0),Fo=!0)):Lu(t)},ss=()=>{rs?(Xt.forEach(e=>{e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),Fo&&(document.removeEventListener("touchmove",Bo,Jr?{passive:!1}:void 0),Fo=!1),Kr=-1):Cu(),Xt=[]};var gt=Du(),Ue=[],le,Qr={"extra-small":[320],small:[464],medium:[624],large:[944],xxl:[1600,1140]},At;Wu();function ls(e,t={}){let{modalElement:n,modalID:o}=Uu(e),r={closeOnClickOutside:!0,closeOnEscape:!0,destroyOnClose:!1,isCritical:!1,isDialog:!1,addLightThemeClass:!1,addCloseButton:!1,onOpen:void 0,onClose:void 0,onWindowResize:void 0,onArrowClick:void 0,size:void 0};typeof t.size=="string"&&(Object.keys(Qr).includes(t.size)?t.size=Qr[t.size]:(BeFunky.throwError(`Invalid modal size: ${t.size} - ${BeFunky.getType(t.size)}`),t.size=void 0)),t=Object.assign({},r,t);let i=Ue.findIndex(({modalID:s})=>s===o),a=i!==-1,l=a?Ue[i]:function(){let{innerContainer:s,outerContainer:c}=Mu(n);return{modalID:o,modalElement:n,isVisible:!0,innerContainer:s,outerContainer:c}}();if(Object.assign(l,t),a&&Ue.splice(i,1),l.isCritical)Ue.push(l);else{let s=Ue.findIndex(({isCritical:c})=>c);s===-1?Ue.push(l):Ue.splice(s,0,l)}l.lastOpened=Date.now(),Nu(l),Vu(l),l.outerContainer.toggleClass("light-theme",Boolean(l.addLightThemeClass)),a?(l.outerContainer.removeClass("modal-root__outer--is-hidden"),l.isVisible=!0):Au(l.outerContainer);let u=Ue.filter(({isVisible:s})=>s);u.forEach(({outerContainer:s},c)=>{s.setStyles({zIndex:c+1}),s.toggleClass("modal-root__outer--is-bottommost",c===0),s.toggleClass("modal-root__outer--is-topmost",c===u.length-1)}),le=u[u.length-1],ds([l]),At=document.activeElement,cs(),typeof l.onOpen=="function"&&l.onOpen(),requestAnimationFrame(()=>{u[u.length-1]===l&&us(l.outerContainer)}),window.zE&&window.zE.hide&&window.zE.hide()}function In(e,t=!0){let n=typeof e=="string"?e:e.id;if(!n)throw new Error("Missing modal ID");let o=Ue.findIndex(({modalID:i})=>i===n);if(o===-1){if(t)throw new Error(`Specified modal ${n} is not on screen`);return}let r=Ue[o];r.outerContainer.addClass("modal-root__outer--is-hidden"),r.isVisible=!1,le=Ue.slice().reverse().find(({isVisible:i})=>i),le&&le.outerContainer.addClass("modal-root__outer--is-topmost"),Zr(r.destroyOnClose)&&(Ue.splice(o,1),Ru(r.outerContainer)),le?le.modalElement.contains(At)&&At.offsetParent?At.focus():us(le.outerContainer):At&&At.offsetParent&&At.focus(),cs(),typeof r.onClose=="function"&&r.onClose()}function $u(e,t,n){e?ls(t,n):In(t)}function Iu(e=void 0){let t=typeof e=="string"?Ue.find(({modalID:n})=>n===e):le;return t?Object.assign({},t):void 0}function Tu(){return!!le}(function(){document.addEventListener("keyup",t=>{if(t.which!==27||!le)return;let{modalID:n,closeOnEscape:o}=le;t.stopImmediatePropagation(),!!Zr(o)&&(In(n),BeFunky.reportUserAction(`User closed ${n} modal by pressing Escape`))})})();(function(){let t=!1;gt.addEventListener(BeFunky.pointerdown,n=>{t=le.outerContainer!==n.target}),gt.addEventListener("click",n=>{if(t||!le)return;let{outerContainer:o,closeOnClickOutside:r,modalID:i}=le;n.target===o&&(Date.now()-le.lastOpened<500||!Zr(r)||(In(i),BeFunky.reportUserAction(`User closed ${i} modal by clicking outside`)))})})();(function(){gt.addEventListener("CLOSE",t=>{let n=t.target.closest(".modal-root__inner"),o=n.firstElementChild;if(n!==le.innerContainer){BeFunky.throwError("CLOSE fired unexpectedly in non-topmost modal",o.id,le.modalElement.id);return}In(o)},!0)})();(function(){window.addEventListener("resize",BeFunky.debounce(()=>ds(Ue.slice()),100))})();function Au(e){gt.appendChild(e)}function Ru(e){gt.removeChild(e)}function cs(){gt.toggleClass("modal-root--is-inactive",!le).toggleClass("modal-root--is-dialog",le&&le.isDialog),!BeFunky.isIPadOS&&(le?as(gt):ss())}function Mu(e){let t=document.createElement("div").setClass("modal-root__outer"),n=document.createElement("div").setClass("modal-root__inner");return t.appendChild(n),n.appendChild(e),{outerContainer:t,innerContainer:n}}function Uu(e){if(e instanceof HTMLElement){if(!e.id)throw new Error("Modal elements must have unique IDs");return{modalElement:e,modalID:e.id}}if(typeof e=="string"){let t=document.getElementById(e);if(!t)throw new Error(`Unable to get modal element with id = ${e}`);return{modalElement:t,modalID:e}}throw new Error(`Invalid modal element or id: ${BeFunky.getType(e)}`)}function Zr(e){return typeof e=="function"&&(e=e()),!!e}function Du(){let e=document.createElement("div").setClass("modal-root modal-root--is-inactive");return e.id="modal_root",BeFunky.onDocumentReady(()=>{e.parentElement||document.body.appendChild(e)}),e}function ju(e){e!==gt.parentElement&&e.appendChild(gt)}function us(e){let t=e.querySelector(".focus-initially");if(t){let n=t.style.transition;t.setStyles({transition:"none"}),BeFunky.focus(t),t.setStyles({transition:n})}else e.setAttribute("tabindex","0"),e.focus(),e.addEventListener("blur",function n(){e.removeEventListener("blur",n),e.removeAttribute("tabindex")})}function Ou(){return{availableWidth:window.innerWidth-32,availableHeight:window.innerHeight-32}}function ds(e){let{availableWidth:t,availableHeight:n}=Ou();e.filter(({isVisible:o,size:r,onWindowResize:i})=>o&&(r||typeof i=="function")).reverse().forEach(({onWindowResize:o,size:r,modalElement:i})=>{if(r){let[a,l]=r,u=Math.min(t,a),s=l?Math.min(n,l):n;i.setStyles({width:`${u}px`,height:l?`${s}px`:""}),typeof o=="function"&&o({availableWidth:u,availableHeight:s});return}typeof o=="function"&&o({availableWidth:t,availableHeight:n})})}function Nu(e){let t=typeof e.onArrowClick=="function",n=Array.isArray(e.arrowButtons);t!==n&&(t?Hu(e):qu(e))}function Hu(e){let t=l=>{let u=document.createElement("div").setClass("modal-root__arrow-container"),s=document.createElement("button").setClass(`modal-root__arrow-button modal-root__arrow-button--${l} button button--icon button--grey-300`);return s.setAttribute("aria-label",BeFunky.LanguageManager.getString(l==="left"?"previous":"next","modal")),s.innerHTML=BeFunky.getSvgHtml("chevron-icon"),s.addEventListener("click",()=>e.onArrowClick(l)),u.appendChild(s),{container:u,button:s}},{button:n,container:o}=t("left"),{button:r,container:i}=t("right");e.arrowButtons=[n,r];let{outerContainer:a}=e;a.insertBefore(o,e.innerContainer),a.appendChild(i)}function qu(e){e.arrowButtons.map(t=>t.parentElement).forEach(t=>{e.outerContainer.removeChild(t)}),delete e.arrowButtons}function Wu(){BeFunky.addArrowKeyHandler({condition:()=>le&&typeof le.onArrowClick=="function",callback:(e,t,n)=>{if(n.type!=="keyup"||t!=="left"&&t!=="right")return;let o=t==="left"?0:1;le.arrowButtons[o].disabled||le.onArrowClick(t)}})}function Vu(e){let t=e.addCloseButton===!0,n=!!e.closeButton;t!==n&&(t?Gu(e):zu(e))}function Gu(e){let t=document.createElement("button").setClass("button button--icon button--transparent button--sm modal-root__close-button");t.setAttribute("aria-label","Close"),t.innerHTML=BeFunky.getSvgHtml("cancel-icon"),t.addEventListener("click",()=>{try{t.dispatchEvent(new Event("CLOSE"))}catch(n){BeFunky.logError("Unable to dispatch event on close button",n)}}),e.closeButton=t,e.innerContainer.appendChild(t)}function zu(e){e.innerContainer.removeChild(e.closeButton),delete e.closeButton}BeFunky.openModal=ls;BeFunky.closeModal=In;BeFunky.toggleModal=$u;BeFunky.getModal=Iu;BeFunky.isModalOpen=Tu;BeFunky.moveModalRoot=ju;BeFunky.getModalSizes=()=>Qr;var{elem:Xu,html:Rt,modalLang:Po,isTemplateResult:Yu,render:Ju}=BeFunky.lit;BeFunky.openNebulaDialog=({heading:e,body:t,buttons:n=[],imageUrl:o,figure:r,className:i="",modalOptions:{size:a,isDialog:l=!0,addCloseButton:u=!1,addLightThemeClass:s=!1,closeOnClickOutside:c=!1,isCritical:d=!1,isForm:p=!1,disableClose:m=!1,onClose:g=()=>{}}={}})=>{let f=Boolean(r||o);a=a||(f?"medium":"small"),f&&a==="small"&&BeFunky.reportWarning("Small dialog used with image",t);let _=["dialog",f?"dialog--has-figure":"",o&&o.includes(".svg")?"dialog--has-illustration":"",i].filter(Boolean).join(" "),y=Xu`<div class=${_}></div>`;F(),BeFunky.LanguageManager.addLanguageUpdateListener(F);let h=y.textContent.replace(/\s+/g," ");console.log("Opening dialog:",h.length>35?`${h.slice(0,35)}...`:h),y.id=`dialog_${BeFunky.hash(h)}`,document.getElementById(y.id)&&BeFunky.throwError("Duplicate dialog already open",h);let w={onClose:()=>{g(),BeFunky.LanguageManager.removeLanguageUpdateListener(F)},destroyOnClose:!0,isCritical:d,size:a,isDialog:l,closeOnClickOutside:c,addCloseButton:u,addLightThemeClass:s};return m&&(Object.assign(w,{onClose:()=>{BeFunky.throwError("User closed dialog which should never be closed",{content:y.textContent}),BeFunky.LanguageManager.removeLanguageUpdateListener(F)},closeOnEscape:!1}),y.addClass("dialog--disable-close")),p&&y.addClass("dialog--has-form"),BeFunky.openModal(y,w),E;function F(){Ju(b(),y)}function b(){return Rt`
        ${r||Ku(o,a)}
        <div class="dialog__body">
            ${e?Rt`<div class="dialog__heading h4">${Po(e)}</div>`:""}
            ${ps(t)}
            <div class="dialog__footer">
                ${n.map(P=>Qu(P,E))}
            </div>
        </div>`}function E(){BeFunky.closeModal(y.id,!1)}};function Ku(e,t){if(e){if(e.includes(".svg"))return Rt`
            <div class="dialog__illustration">
                <div class="dialog__illustration-max-width">
                    <div class="dialog__illustration-image" style=${`background-image: url('${e}')`}>
                </div>
            </div>`;let n=BeFunky.getModalSizes()[t];if(n&&n[0]){let o=n[0];e=BeFunky.addParamsToURL(e,{width:Math.round(o*(BeFunky.isRetina()?1.5:1))})}return Rt`<div class="dialog__image" style=${`background-image: url('${e}')`}></div>`}return""}function Qu({text:e,type:t,size:n="md",focusInitially:o=!1,href:r,style:i="",onClick:a},l){let s=(d=>d.reduce((p,m)=>p.concat(m),[]))(["button",`button--${n}`,"dialog__button",typeof t=="string"?`button--${t}`:"",Array.isArray(t)?t.map(d=>`button--${d}`):"",o?"focus-initially":""]).filter(Boolean);if(r){if(a)throw new Error("onClick not supported by links");return Rt`<a href=${r} rel="noopener" target="_blank" class=${s.join(" ")} style=${i}>${Po(e)}</a>`}return Rt`<button @click=${c} class=${s.join(" ")} style=${i}>${Po(e)}</button>`;function c(d){typeof a=="function"&&a(d),l()}}function ps(e){return e?typeof e=="function"?ps(e()):typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?Rt`<p>${Po(e)}</p>`:e instanceof HTMLElement||Yu(e)?e:(BeFunky.logError("Invalid content passed to dialog",e),""):""}BeFunky.acknowledge=(e,{onAcknowledge:t,buttonText:n="ok_got_it",heading:o,isCritical:r=!1,disableClose:i=!1,size:a,focusButton:l=!0,imageUrl:u=""}={})=>{if(!((typeof e=="string"||Array.isArray(e))&&e.length||e instanceof HTMLElement||BeFunky.lit.isTemplateResult(e)||typeof e=="function"))throw new Error("message required");return BeFunky.openNebulaDialog({heading:o,body:e,imageUrl:u,buttons:[{text:n,type:"blue",focusInitially:l}],modalOptions:{onClose:t,isCritical:r,disableClose:i,size:a}})};BeFunky.confirm=(e,{onConfirm:t,onCancel:n=()=>{},confirmText:o="ok",cancelText:r="cancel",heading:i,isCritical:a=!1,size:l,imageUrl:u=void 0,focusConfirmButton:s=!0,className:c,addCloseButton:d=!1}={})=>{if(!((typeof e=="string"||Array.isArray(e))&&e.length||e instanceof HTMLElement||BeFunky.lit.isTemplateResult(e)||typeof e=="function"))throw new Error("message required");if(typeof t!="function")throw new Error("onConfirm callback required");let m=!1,g=!1,f=()=>{m?t():n(g)},_=[{text:r,type:"grey-300",onClick:()=>{g=!0}},{text:o,type:["blue","ellipsis"],onClick:()=>{m=!0},focusInitially:s}];return BeFunky.openNebulaDialog({heading:i,body:e,buttons:_,imageUrl:u,className:c,modalOptions:{isCritical:a,size:l,imageUrl:u,onClose:f,addCloseButton:d}})};var{elem:Zu,icon:ed,modalLang:ei}=BeFunky.lit,Yt;function td({message:e,button:t,onAccept:n=()=>{},onDismiss:o=()=>{}}){Yt&&So(Yt);let r=Zu`
        <div class="toast">
            <div class="toast__content">
                <string data-lang="${e}">${ei(e)}</string>
                <button class="button button--blue button--xs toast__button" @click=${a} data-lang="${t}">${ei(t)}</button>
            </div>
            <button class="button button--transparent button--icon button--xs toast__close" @click=${l} aria-label="${ei("dismiss",!0)}">${ed("cancel-icon","icon icon--14")}</button>
        </div>
    `;Yt=r,document.body.appendChild(r),document.visibilityState==="visible"?i():document.addEventListener("visibilitychange",function u(){document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",u),i())});function i(){requestAnimationFrame(()=>{requestAnimationFrame(()=>{r===Yt&&r.addClass("toast--is-active")})})}function a(){So(r),n()}function l(){So(r),o()}return()=>So(r)}function So(e){e===Yt&&(Yt=void 0,e.addClass("toast--is-hidden"),setTimeout(()=>{requestAnimationFrame(()=>{e.parentElement.removeChild(e)})},75))}BeFunky.showToast=td;var gs=Mn(gr()),nd=[".navbar",".modal-root__outer","#alternateMenu",".dropdown__list",".preset-menu-item__basic-settings",".preset-menu-item__advanced-settings",".canvas-footer",".site-nav__dropdown-content",".site-nav__popup-root",".focus-trap",".draggable-panel"].join(", "),fs=[".focus-avoid",".popover:not(.active)",".image-manager__images",".tabs__button--active",".control-item-disabled",".autocomplete__item.button--selected:first-child"].join(", ");BeFunky.onDocumentReady(()=>{let e=document.getElementById("bfn-app"),t=document.getElementById("modal_root"),n=document.getElementById("site_root"),o=[e,t,n].filter(Boolean);document.addEventListener("keydown",i=>{r(i)});function r(i){if(!(i.key!=="Tab"&&i.keyCode!==9)){if(!o.some(a=>a.contains(i.target))){requestAnimationFrame(()=>{let a=document.activeElement;o.some(l=>l.contains(a))&&BeFunky.handleNextFocus(a,0)});return}i.preventDefault(),!BeFunky.isPointerDown&&BeFunky.handleNextFocus(i.target,i.shiftKey?-1:1)}}BeFunky.handleNextFocus=(i,a,l=!0)=>{let u=i.closestParent(m=>o.includes(m)||m.matches(nd));if(!u||o.includes(u)&&u.id!=="site_root"||u.matches(fs))return;let s=(0,gs.default)(u);[...u.querySelectorAll(fs)].forEach(m=>{s=s.filter(g=>!m.contains(g)||g===i)});let c=s.indexOf(i);if(s.length===0||s.length===1&&u===s[0]&&a!==0)return;c+=a;let d=c<0||c>s.length-1;if(d&&typeof u.exitFocusTrap=="function")return u.exitFocusTrap(a);d&&(c=c<0?s.length-1:0);let p=s[c];ti(p,a,l)}});function ti(e,t,n,o=!0){if(!e)return;if(typeof e.delegateFocus=="function")return ti(e.delegateFocus(t),t,n);if(!e.focus)return;n&&od(e);let r=e===document.activeElement;r||e.focus(),o&&e.tagName.toLowerCase()==="input"&&!r&&e.select()}function od(e){if(!e._isFocusOutlineVisible){if(e.hasClass("button")){ft(e,()=>e.addClass("button--focus"),()=>e.removeClass("button--focus"));return}if(e.hasClass("color-button")){ft(e,()=>e.addClass("color-button--focus"),()=>e.removeClass("color-button--focus"));return}if(e.nodeName==="A"&&ft(e,()=>e.addClass("link--focus"),()=>e.removeClass("link--focus")),e.hasClass("chip")){ft(e,()=>e.addClass("chip--focus"),()=>e.removeClass("chip--focus"));return}if(e.hasClass("preset-menu-item")){ft(e,()=>e.addClass("preset-menu-item--focus"),()=>e.removeClass("preset-menu-item--focus"));return}if(e.hasClass("gallery__item")){let t=e.closest("image-gallery");if(!t)return;ft(e,()=>{t.focusedItemId=e.imageRef.id},()=>{t.focusedItemId===e.imageRef.id&&(t.focusedItemId="")})}if(e.nodeName==="INPUT"){if(e.type==="checkbox"){let t=e.parentElement;if(t&&t.hasClass("checkbox")){ft(e,()=>t.addClass("checkbox--focus"),()=>t.removeClass("checkbox--focus"));return}let n=e.nextElementSibling;n&&n.hasClass("button--toggle")&&ft(e,()=>n.addClass("button--focus"),()=>n.removeClass("button--focus"));return}if(e.type==="radio"){let t=e.parentElement;if(!t)return;t.hasClass("radio-button")&&ft(e,()=>t.addClass("radio-button--focus-within"),()=>t.removeClass("radio-button--focus-within"))}}}}function ft(e,t,n){e._isFocusOutlineVisible=!0,t(),e.addEventListener("blur",function o(){e.removeEventListener("blur",o),e._isFocusOutlineVisible=!1,n()})}BeFunky.focus=function(e){ti(e,1,!0,!1)};BeFunky.onDocumentReady(()=>{if(window.prismicButtonActions.length){let{action:e,time:t}=window.prismicButtonActions[window.prismicButtonActions.length-1],n=Date.now()-t,o=BeFunky.isChrome?500:1e3;n<o?(console.log(`Handling Prismic button action "${e}" that occurred ${n}ms before befunky.core.js loaded or document was ready:`),ms(e)):BeFunky.logError(`Prismic button action "${e}" ignored b/c it occurred ${n}ms before befunky.core.js loaded or document was ready`)}window.onClickPrismicButton=function(e){ms(e)}});function ms(e){let t={upgrade:()=>{BeFunky.openPricingModal()},register:()=>{BeFunky.openLoginPanel("REGISTER")},sign_in:()=>{BeFunky.openLoginPanel("SIGNIN")},sign_out:()=>{BeFunky.signOut()},pay:()=>{BeFunky.openPaymentPanel(ut())},get_started_header:()=>hs("HEADER"),get_started:()=>hs()};if(t[e])return t[e]();BeFunky.throwError(`Unhandled Prismic button action: "${e}" (${BeFunky.getType(e)})`)}function hs(e){if(!BeFunky.Params.canUseWebapp)return BeFunky.trackDeepLink("GET-STARTED",e),BeFunky.handleMobileUserAttemptToOpenApp("web_mobile_apps");let t=document.getElementById("get_started_modal");[...t.querySelectorAll("img")].forEach(n=>window.loadLazyImage(n)),BeFunky.openModal(t,{size:"large",addCloseButton:!0})}function rd(){let e=Array.from(document.querySelectorAll(".comparison")),t=BeFunky.isIOS||BeFunky.isAndroid,n=t?"touchmove":BeFunky.pointermove,o=window.innerHeight;e.forEach(r=>{let i=r.getBoundingClientRect(),a=r.querySelector(".comparison__image-before-container"),l=r.querySelector(".comparison__handle"),u=Date.now(),s=0,c=!1,d,p=!1,m=h=>{r.toggleClass("comparison--show-text",h)},g=BeFunky.debounce(h=>{let w=100*h/i.width;a.setStyles({width:`${w}%`})},300),f=h=>{let w=typeof h.pageX=="number"?h.pageX:h.touches[0].pageX;h.preventDefault&&i.height<o/2&&h.preventDefault();let F=0,b=i.width,E=Math.max(F,Math.min(b,w-i.x)),P=E-i.width/2,T=Math.abs(E-s);s=E;let $=Date.now(),N=$-u;u=$,T>50&&N>50?(c||(c=!0,cancelAnimationFrame(d),a.setStyles({transition:""}),l.setStyles({transition:""})),d=requestAnimationFrame(G)):(c&&(c=!1,cancelAnimationFrame(d),a.setStyles({transition:"none"}),l.setStyles({transition:"none"})),G());function G(){a.setStyles({width:`${E}px`}),l.setStyles({transform:`translateX(${P}px)`}),g(E)}},_=h=>{p||(p=!0,f(h),m(!0),r.addEventListener(n,f))},y=h=>{!p||(p=!1,m(!1),r.removeEventListener(n,f),h.type===BeFunky.pointerout&&h.pageX&&(i.right<h.pageX||i.left>h.pageX)&&f(h))};t?(r.addEventListener("touchstart",_),r.addEventListener("touchend",y)):(r.addEventListener(BeFunky.pointerdown,_),r.addEventListener(BeFunky.pointerover,h=>{BeFunky&&BeFunky.isPointerDown&&_(h)}),r.addEventListener(BeFunky.pointerup,y),r.addEventListener(BeFunky.pointerout,y)),window.addEventListener("resize",BeFunky.debounce(()=>{i=r.getBoundingClientRect(),o=window.innerHeight;let h=parseFloat(a.style.width)/100*i.width;isNaN(h)||f({pageX:i.x+h})},300))})}BeFunky.onDocumentReady(()=>{rd()});var{html:be,lang:Jt,icon:ni,useEffect:oi,useMemo:id,defineCustomElement:ad,ifDefined:sd}=BeFunky.lit,Tn=(...e)=>BeFunky.logFeature("image_gallery",...e);ad("image-gallery",ld);function ld({onClickItem:e,selectedImageIDs:t,useSelectButton:n=!1,getItemTooltip:o,extendItemTemplate:r,addItemClass:i,rowHeight:a=300,imagePadding:l=0,gutterWidth:u=16,borderWidth:s=0,minItemWidth:c=40,isLoading:d=!1,images:p=[],emptyState:m=null,message:g=null,currentWidth:f=1e3,debug:_=!1,context:y="app",viewport:h,singleRow:w=!1,focusedItemId:F="",_longPressState:b=null,onLongPressItem:E,setupItemDragging:P,_setupItemDraggingRIC:T}){let $=this;oi(()=>this.addClass("gallery"),[]),oi(()=>this.setStyles({width:`${f}px`}),[f]),oi(()=>{T&&(cancelIdleCallback(T),$._setupItemDraggingRIC=void 0),typeof P=="function"&&($._setupItemDraggingRIC=requestIdleCallback(()=>{[...$.querySelectorAll(".gallery__item")].forEach(S=>{S.imageRef&&P(S,S.imageRef)})}))},[P,t,p,a,f,c,u,w]);let N=id(fe,[p,a,f,c,u,w]),j=L(N.map(S=>S.height));return Tn("Render",$.className),G();function G(){return be`
            ${H()}
            ${ue()}
            ${Q()}
            ${pe()}
        `}function H(){return p.length?be`<div
            class="gallery__items"
            style=${`height: ${j}px`}
            @keyup=${ve}
            @click=${ne}
            @pointerdown=${_e}
            @pointermove=${he}
            @pointerup=${se}
            @pointercancel=${se}
        >
            ${N.map(z)}
        </div>`:""}function z(S,x){return be`<div class="gallery__row" style=${`height: ${S.height}px`}>${R(S)?S.items.map(U=>J(U,x)):""}</div>`}function J(S,x){if(S.isBookend)return X(S);let{aspectRatio:U,flex:M,isTransparent:Z,isGraphic:Y,imageRef:oe,isLast:Be}=S,Pe=Array.isArray(t),$e=Pe?t.includes(S.id):!1,Se=r?r(oe):"",mt=["gallery__item",$e?"gallery__item--selected":"",Pe&&!n?"gallery__item--selectable":"",Pe&&n?"gallery__item--selectable-with-button":"",Y?"gallery__item--graphic":"",U>1?"gallery__item--wide":"gallery__item--narrow",i?i(S.imageRef):"",F===S.id?"gallery__item--focused":"",Se?"gallery__item--has-content":""].filter(Boolean).join(" "),Ke=`flex: ${M}; margin: 0 ${Be?0:`${u}px`} ${u}px 0;`;_&&S.color&&(Ke+=`outline: 4px solid ${S.color};`),s&&(Ke+=`border: ${s}px solid var(--border-color);`);let A=S.getImageURL?S.getImageURL(S.width,S.height):S.thumbURL;oe.lastRenderedThumb={url:A,renderedWidth:S.width};let O=`url('${A}') no-repeat center`,q=Y?"contain":"cover";Z&&!Y&&(O+=`, url('${BeFunky.Params.globalImagesPath}app/checker_pattern.jpg') repeat`,q+=", auto");let K=`padding-bottom: ${100/U}%;`,ke="";if(l){let we=`position: absolute; top: ${l}px; right: ${l}px; bottom: ${l}px; left: ${l}px; background: ${O}; background-size: ${q}`;ke=be`<div style=${we}></div>`}else K+=`background: ${O}; background-size: ${q}`;return be`
        <div class=${mt} style=${Ke} .imageRef=${oe} .isSelected=${$e} .renderedImageURL=${A} data-tooltip=${sd(o?o(S.id):void 0)} tabindex="0">
            <div class="gallery__placeholder" style=${K}>${ke}</div>
            ${Y?"":be`<div class="gallery__overlay"></div>`}
            ${Pe&&!n?be`<div class="gallery__outline">${ni("checkmark-icon",`icon ${$e?"icon-selected":"icon-deselected"}`)}</div>`:""}
            ${Pe&&n?be`<div class="gallery__outline"><button class="button gallery__select-button">${ni("checkmark-icon",`icon ${$e?"icon-selected":"icon-deselected"}`)}</button></div>`:""}
            ${_?be`<div style="position: absolute; top: 31.8%; background: var(--secondary-000); color: black; padding: 0 4px;">${x} : ${S.imageIndex} : ${U.toFixed(3)}</div>`:""}
            ${Se}
        </div>`}function X(S){let{aspectRatio:x}=S,U=`flex: ${x}; margin-bottom: ${u}px; ${s?`border: ${s}px solid transparent;`:""}`;return be`<div class="gallery__item gallery__item--bookend" style=${U}></div>`}function ue(){if(!g)return"";let{isError:S,text:x,buttonText:U,buttonAction:M}=g,Z=["gallery__message",S?"gallery__message--is-error":"",f<400?"gallery__message--narrow":""].filter(Boolean).join(" "),Y=p.length?`margin-bottom: ${u}px`:"",oe=`button ${S?"button--xs button--white-outline-notheme":"button--blue"}`;return be`
        <div class=${Z} style=${Y}>
            ${x?be`<string>${Jt(x,y)}</string>`:""}
            ${U&&M?be`<button @click=${M} class=${oe}>${Jt(U,y)}</button>`:""}
        </div>`}function Q(){if(!m||d||p.length)return"";let{icon:S,imageUrl:x,text:U,buttonText:M,buttonAction:Z,linkText:Y,linkHref:oe}=m,Be=Math.round(Math.max(40,Math.min(96,f/10))/8)*8,Pe=["gallery__empty-state",f<400?"gallery__empty-state--narrow":""].filter(Boolean).join(" ");return be`
        <div class=${Pe}>
            ${x?be`<img src=${x} class="gallery__empty-state-image" alt="no results"/>`:""}
            ${S?ni(S,"icon",{style:`width: ${Be}px; height: ${Be}px`}):""}
            ${U?be`<p>${Jt(U,y)}</p>`:""}
            ${M&&Z?be`<button @click=${Z} class="button button--blue">${Jt(M,y)}</button>`:""}
            ${Y&&oe?be`<p><a href=${oe} target="_blank" rel="noopener">${Jt(Y,y)}</a></p>`:""}
        </div>`}function pe(){if(!d)return"";let S=["gallery__loading",p.length?"gallery__loading--below-images":"",f<400?"gallery__loading--narrow":""].filter(Boolean).join(" "),x=p.length?`margin-bottom: ${u}px`:"";return be`
        <div class=${S} style=${x}>
            <div class="loading-spinner"></div> <string>${Jt("loading",y)}</string>
        </div>`}function ne(S){if($._longPressState&&$._longPressState.hasFired)return ce();let x=S.target.closestParent(M=>M===this||M.imageRef);if(!x.imageRef)return;let U=n&&S.target.hasClass("gallery__select-button");e(x.imageRef,{isSelected:!x.isSelected,renderedImageURL:x.renderedImageURL,imageGalleryItem:x,wasSelectButtonClicked:U})}function ve(S){if(S.key!=="Enter")return;let x=S.target;!x.imageRef||x.imageRef.id!==F||e(x.imageRef,{isSelected:!x.isSelected,renderedThumbUrl:x.renderedImageURL,imageGalleryItem:x,wasSelectButtonClicked:!1})}function _e(S){if(!E)return ce();let x=S.target.closestParent(U=>U===this||U.imageRef);if(!x.imageRef)return ce();$._longPressState={startX:S.pageX,startY:S.pageY,hasFired:!1,timeout:setTimeout(()=>{$.onLongPressItem&&($._longPressState.hasFired=!0,$.onLongPressItem(x.imageRef,{isSelected:!x.isSelected,renderedThumbUrl:x.renderedImageURL,imageGalleryItem:x,wasSelectButtonClicked:!1}))},500)}}function he(S){if(!$._longPressState||$._longPressState.hasFired)return;let x=$._longPressState.startX-S.pageX,U=$._longPressState.startY-S.pageY;if(Math.abs(x)>10||Math.abs(U)>10)return ce()}function se(){!$._longPressState||$._longPressState.hasFired||ce()}function ce(){!$._longPressState||(clearTimeout($._longPressState.timeout),$._longPressState=null)}function fe(){if(!p.length)return[];let S=p.map((A,O)=>{let q=me(A);return{id:A.id,aspectRatio:q,flex:q,groupID:A.groupID,imageIndex:O,indexInRow:-1,thumbURL:A.thumbURL,getImageURL:A.getImageURL,isTransparent:A.isTransparent,isGraphic:A.isGraphic,imageRef:A}}),x=S.slice();if(_){let A=x.map(O=>O.groupID).filter(Boolean).unique().reduce((O,q)=>(O[q]=C(80),O),{});x.forEach(O=>{O.color=A[O.groupID]})}let U=[],M;M=Y();for(let A=0;A<x.length;A++){let O=x[A];if(M.items.length===0){oe(O);continue}M.error=M.error||Se(M.aspectRatios);let q=Se([...M.aspectRatios,O.aspectRatio]);if(M.error>=q){oe(O),M.error=q;continue}if(!window.disableSwap&&(Be(A)==="ADDED"&&A++,O=x[A],!O)||w)break;M=Y(),oe(O)}if(Ke(),!w){let A=[];if(U.forEach(O=>{O.items.forEach((q,K)=>{K!==q.indexInRow&&console.error("rows is incorrect",K,q.indexInRow),q.isBookend||A.push(q)})}),x.length!==S.length)console.error("items does not match originalItems length",x.length,S.length);else if(A.length!==x.length)console.error("rows does not match items length",A.length,x.length);else if(!A.isIdenticalTo(x)){console.error("rows does not match items");let O=A.findIndex((q,K)=>q!==x[K]);console.error(O,A[O],x[O],A,x)}}let Z=0;return U.forEach(A=>{A.height=$e(A.aspectRatios)+u,A.rowTopOffset=Z,Z+=A.height;let O=L(A.aspectRatios);A.items.forEach((q,K)=>{O<1&&(q.flex=q.aspectRatio/O),q.height=A.height-u,q.width=q.height*q.flex,q.isFirst=K===0,q.isLast=K===A.items.length-1})}),Tn(U),U;function Y(){let A={items:[],aspectRatios:[],error:0};return U.push(A),A}function oe(A){A.indexInRow=M.items.length,M.items.push(A),M.aspectRatios.push(A.aspectRatio)}function Be(A){let O=x.slice(A,A+10),q=Pe(M.items),K=Pe(O);if(!q.length||!K.length)return;let{error:ke,aspectRatios:we}=M,te={improvement:0,inRow:null,afterRow:null};q.forEach(re=>{K.forEach(ie=>{if(re.groupID!==ie.groupID||re.aspectRatio===ie.aspectRatio)return;let je=we.slice();je.splice(re.indexInRow,1,ie.aspectRatio);let Oe=ke-Se(je);Oe>1&&Oe>te.improvement&&(te.improvement=Oe,te.inRow=re,te.afterRow=ie)})});let Ie=M.items[M.items.length-1];if(Ie.groupID&&K.forEach(re=>{if(Ie.groupID!==re.groupID)return;let ie=[...we,re.aspectRatio],je=ke-Se(ie);je>1&&je>te.improvement&&(te.improvement=je,te.inRow=null,te.afterRow=re)}),te.improvement){let{inRow:re,afterRow:ie}=te;return re?(Tn(`Swapping in row #${U.length-1}`,re.imageIndex,"<->",ie.imageIndex,te),ie.indexInRow=re.indexInRow,M.items.splice(re.indexInRow,1,ie),M.aspectRatios.splice(re.indexInRow,1,ie.aspectRatio),M.error=Se(M.aspectRatios),De(x,re,ie),"SWAPPED"):(Tn(`Adding to row #${U.length-1}`,ie.imageIndex,te),oe(ie),x.splice(x.indexOf(ie),1),x.splice(A,0,ie),"ADDED")}let Ge=U.length-1;for(;Ge>0&&mt(Ge);)Ge--}function Pe(A){return A.filter(O=>O.groupID).filter((O,q,K)=>!K.slice(0,q).find(ke=>ke.groupID===O.groupID&&ke.aspectRatio===O.aspectRatio))}function $e(A){let O=A.length;if(!O)return 0;let q=f-u*(O-1)-s*O*2,K=L(A);return q/K+s*2}function Se(A,O){let q=A.length;if(!q)return 0;let K=a,ke=f-u*(q-1)-s*q*2,we=L(A),te=we/A.length,Ie=ke/we+s*2;if(!w){let re=1.5,ie=2;Math.min(...A)>re&&(K/=Math.min((te+1)/2,ie)),A.length>1&&Math.max(...A)<1/re&&(K*=Math.min((1/te+1)/2,ie))}let Ge=Math.abs(K-Ie);return A.forEach((re,ie)=>{if(O&&ie===q-1)return;let je=ke*re/we;je<c&&(Ge+=(c-je)**2)}),Ge}function mt(A){let O=U[A],q=U[A-1];if(q.items.length===1)return!1;let K=q.items[q.items.length-1],ke=[...O.aspectRatios,K.aspectRatio],we=q.aspectRatios.slice();we.splice(q.items.length-1,1);let te=Se(ke),Ie=Se(we),Ge=O.error-te,re=q.error-Ie,ie=Ge+re;return ie<=10?!1:(Tn(`Moving last item from row #${A} down to start of row #${A}`,{improvement:ie}),q.items.pop(),q.aspectRatios.pop(),q.error=Ie,O.items.unshift(K),O.aspectRatios.unshift(K.aspectRatio),O.error=te,O.items.forEach((je,Oe)=>{je.indexInRow=Oe}),!0)}function Ke(){let A=a,O=U[U.length-2];if(O){let te=Ie=>Ie.reduce((Ge,re)=>Ge+re)/Ie.length;Math.abs(te(O.aspectRatios)-te(M.aspectRatios))<2&&(A=Math.round($e(O.aspectRatios)))}if($e([...M.aspectRatios,0])<A)return;let K=M.aspectRatios.reduce((te,Ie)=>te+Ie,0),ke=M.aspectRatios.length+1,we=(f-u*(ke-1)-s*ke*2)/(A-s*2)-K;we<0||w&&we<1||oe({isBookend:!0,aspectRatio:we},we)}}function me({imageWidth:S,imageHeight:x,thumbWidth:U,thumbHeight:M}){return U/M||S/x||1}function De(S,x,U){let M=S.indexOf(x),Z=S.indexOf(U);S[M]=U,S[Z]=x}function C(S){return`#${B(S)}${B(S)}${B(S)}`}function B(S){return(Math.floor(Math.random()*(256-S))+S).toString(16)}function L(S){return S.reduce((x,U)=>x+U,0)}function R({rowTopOffset:S,height:x}){if(!h)return!0;let[U,M]=h,Z=S+x,Y=1e3;return Z+Y>=U&&Z-Y<=M||S+Y>=U&&S-Y<=M||S-Y<=U&&Z+Y>=M}}BeFunky.draggableElement=(e,t,{fireMoveEvents:n=!1,eventDispatcher:o,dragScreen:r}={})=>function(){this.init=function(){this.dragging=!1,this.oncontextmenu=()=>!1,this.setStyles({touchAction:"none"}),this.addEventListener(BeFunky.pointerdown,this.handlePointerDown),this.pointerDownTarget=null,this.eventDispatcher=o||this,this.debugQueue=[]},this.debug=i=>{this.debugQueue.push(i)},this.handlePointerDown=i=>{if(this.debug(`HPDown-${i.pointerId}`),i.button!==0)return;this.lastX=this.startX=i.pageX,this.lastY=this.startY=i.pageY,this.pointerDownTarget=i.target,this.startScrollTop=t.scrollTop,this.lastScrollTime=Date.now(),this.scrollSpeed=0;let a=this.getBoundingClientRect();this.centerX=a.left+a.width/2,this.centerY=a.top+a.height/2,this.width=a.width,document.addEventListener(BeFunky.pointermove,this.handlePointerMove),document.addEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel),document.addEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel),document.addEventListener("contextmenu",this.handlePointerUpOrCancel)},this.handlePointerMove=i=>{if(this.dragging){if(n){let p=i.pointerType==="touch"?document.elementFromPoint(i.pageX,i.pageY):i.target;this.eventDispatcher.dispatchEvent(new CustomEvent("dragmoved",{detail:{dragTarget:p}}));return}throw console.log("Dragged item:",this.debugQueue?this.debugQueue.join(" "):"empty",this.className),new Error("pointermove should not be fired while dragging")}this.debugQueue[this.debugQueue.length-1]!=="HPMove"&&this.debug("HPMove");let a=i.pageX-this.lastX,l=i.pageY-this.lastY,u=Math.sqrt(Math.pow(a,2)+Math.pow(l,2)),s=Math.abs(l)/u,c=()=>{let p=5,m=this.width*1.75,g=t.scrollTop,f=i.pageX-this.centerX,_=i.pageY-this.centerY+g-this.startScrollTop,y=Math.sqrt(f**2+_**2),h=i.pageX-this.startX,w=i.pageY-this.startY+g-this.startScrollTop,F=Math.sqrt(h**2+w**2);return!(y<p||F<p||y>m||f>0&&i.pageX<this.lastX||f<0&&i.pageX>this.lastX)},d=()=>{this.dragging=!0,this.eventDispatcher.dispatchEvent(new CustomEvent("dragstarted",{detail:{draggedElement:this}})),n||document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),this.debug("startDrag")};if(i.type==="mousemove"||i.pointerType==="mouse"){if(c())return d()}else{if(s<.5&&this.scrollSpeed<.5&&c())return d();let{scrollTop:p}=t,m=this.startScrollTop-(i.pageY-this.startY)-p;t.scrollTop+=m;let g=t.scrollTop!==p,f=Date.now();this.scrollSpeed=g?Math.abs(m)/(f-this.lastScrollTime):0,this.lastScrollTime=f}this.lastX=i.pageX,this.lastY=i.pageY},this.handlePointerUpOrCancel=i=>{if(i.type==="pointerup"?this.debug(`HPUp-${i.pointerId}`):i.type==="pointercancel"?this.debug(`HPCancel-${i.pointerId}`):this.debug(`ContextMenu-${i.pointerId}`),document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel),document.removeEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel),document.removeEventListener("contextmenu",this.handlePointerUpOrCancel),this.pointerDownTarget=null,this.dragging){this.dragging=!1;let a=i.pointerType==="touch"?document.elementFromPoint(i.pageX,i.pageY):i.target,l;window.isAppOpen&&window.BFN&&BFN.Stage&&a===BFN.Stage.view&&(l=BFN.getCanvasCoordinates(i.pageX,i.pageY)),this.eventDispatcher.dispatchEvent(new CustomEvent("dragstopped",{detail:{dropTarget:a,canvasCoordinates:l}}))}},this.cancelDragging=()=>{this.debug("cancelDragging"),document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel),document.removeEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel),document.removeEventListener("contextmenu",this.handlePointerUpOrCancel),this.pointerDownTarget=null,this.dragging&&(this.dragging=!1,this.eventDispatcher.dispatchEvent(new CustomEvent("dragstopped",{detail:{}}))),r.hide()},this._dragging=!1,Object.defineProperty(this,"dragging",{get(){return this._dragging},set(i){i=Boolean(i),i!==this._dragging&&(this._dragging=i,window.BFN&&BFN.appContainer&&BFN.appContainer.toggleClass("bfn--is-dragging",i))}}),this.init()}.bind(e)();BeFunky.dragScreen=e=>function(){this.addClass("drag-screen"),this.innerHTML="<img><div></div>",this.init=function(){this.active=!1,this.image=this.querySelector("img"),this.image.addClass("drag-screen__image"),this.nodeContainer=this.querySelector("div"),this.nodeContainer.setStyles({position:"absolute",left:"0",top:"0"}),this.image.onload=()=>{this.active&&this.addClass("drag-screen--active")},this.dragOffset={x:0,y:0},this.updatePositionThrottled=BeFunky.throttleRAF(this.updatePosition.bind(this))},this.show=function(t,n=.7){if(this.active||!t)return;this.active=!0,window.BFN&&window.isAppOpen&&(BFN.smoothPictureDisabled=!0),document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel,!0),document.addEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel,!0),document.addEventListener("contextmenu",this.handlePointerUpOrCancel,!0);let o=this.image.src;this.image.src=t,this.nodeContainer.innerHTML="",this.image.setStyles({width:BeFunky.isFirefox&&t.startsWith("data:image/svg+xml,")?"100px":""}),this.setStyles({opacity:n}),this.image.src===o&&this.addClass("drag-screen--active")},this.showNode=function(t,n=.7){this.active||!t||(this.active=!0,document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel,!0),document.addEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel,!0),document.addEventListener("contextmenu",this.handlePointerUpOrCancel,!0),this.image.src="",this.image.setStyles({visibility:"hidden"}),this.nodeContainer.appendChild(t),this.setStyles({opacity:n}),this.addClass("drag-screen--active"))},this.hide=function(){this.nodeContainer.innerHTML="",this.image.setStyles({visibility:""}),!!this.active&&(this.active=!1,window.BFN&&window.isAppOpen&&(BFN.smoothPictureDisabled=!1),document.removeEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel,!0),document.removeEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel,!0),document.removeEventListener("contextmenu",this.handlePointerUpOrCancel,!0),this.setStyles({opacity:""}),this.removeClass("drag-screen--active"))},this.updatePosition=function(){let{x:t,y:n}=BeFunky.globalPointerCoords;t-=this.dragOffset.x,n-=this.dragOffset.y,this.setStyles({transform:`translate(${Math.round(t)}px, ${Math.round(n)}px)`})},this.handlePointerMove=()=>{this.updatePositionThrottled()},this.handlePointerUpOrCancel=()=>{this.hide()},this.init()}.bind(e)();var ys=document.getElementById("explore");ys&&cd.call(ys);function cd(){this.init=function(){this.registerRoutes(),this.initPublicAPI(),this.initSearchForm(),this.initGallery()},this.initPublicAPI=function(){this.search=e=>{this.searchInput.value=e,this.loadSearchResults(e,1)},this.openImage=e=>{if(!e)return this.closeModal();let t=this.gallery.images.find(({id:n})=>n===`befunky_photo_${e}`);t?this.openModal(t):BeFunky.logError("Unable to open Explore image",{imageID:e})}},this.registerRoutes=function(){Ce("/explore/",()=>{this.search(""),this.openImage("")}),Ce("/explore/photos/",()=>{this.search(""),this.openImage("")}),Ce("/explore/photos/:keyword/",({keyword:e})=>{this.search(e),this.openImage("")}),Ce("/explore/gallery/:imageID/",({imageID:e})=>{this.openImage(e)})},this.initSearchForm=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.previousSearchQuery=null,this.previousSearchPage=-1,this.clearButton.addEventListener("click",()=>this.searchInput.focus()),this.searchForm.addEventListener("submit",this.handleSearch)},this.initGallery=function(){this.gallery=this.querySelector(".explore__gallery");let e=t=>(this.openModal(t),!1);this.gallery.rowHeight=200,this.gallery.currentWidth=this.getCurrentWidth(),this.gallery.singleRow=!1,this.gallery.onClickItem=e,this.gallery.context="site",this.gallery.borderWidth=1,window.addEventListener("resize",BeFunky.debounce(()=>this.handleGalleryResize(),300))},this.loadSearchResults=function(e,t=1){this.previousSearchQuery===e&&t<=this.previousSearchPage||(this.previousSearchQuery=e,this.previousSearchPage=t,de(e?`/explore/photos/${encodeURIComponent(e)}/`:"/explore/"),t===1&&(this.gallery.images=[]),this.gallery.message="",this.gallery.isLoading=!0,this.toggleInteractivity(!1),ud(e,t,({error:n,images:o})=>{if(e!==this.previousSearchQuery)return;if(this.gallery.isLoading=!1,this.toggleInteractivity(!0),n){BeFunky.logError("Unable to fetch images",n),n==="no_results"?(this.gallery.message="",this.gallery.emptyState={imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/magnifying-glass-frown.svg`,text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:`"<strong>${e}</strong>"`})}):(this.gallery.message={isError:!0,text:BeFunky.failureReason(n),buttonText:"try_again",buttonAction:()=>this.loadSearchResults(e,t)},this.gallery.emptyState="",this.previousSearchPage=this.previousSearchPage-1);return}if(this.gallery.images=[...this.gallery.images,...o],this.gallery.message="",o.length<100)return;let r=()=>this.loadSearchResults(e,t+1);this.gallery.message={buttonText:"load_more",buttonAction:r}}))},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearButton.disabled=!e},this.openModal=e=>{let t=this.previousSearchQuery?`/explore/photos/${this.previousSearchQuery}/`:"/explore/";BeFunky.openUserPhotoModal(e,this.gallery.images,t,!0)},this.closeModal=()=>{BeFunky.closeUserPhotoModal()},this.getCurrentWidth=()=>{return Math.min(1232,window.innerWidth)-e();function e(){return window.innerWidth>=768?96:window.innerWidth>=361?64:32}},this.handleSearch=e=>{e&&e.preventDefault();let t=this.searchInput.value.replace(/[+"<>^%]/gi," ").replace(/ {2,}/g," ").trim();this.searchInput.value=t,this.loadSearchResults(t)},this.handleGalleryResize=()=>{window.isAppOpen||(this.gallery.currentWidth=this.getCurrentWidth())},this.init()}function ud(e,t=1,n){let o={start:100*(t-1),end:100};e&&e.length>0&&(o.keyword=e),BeFunky.requestAPI("photo/explore/",o).then(r=>{if(!Array.isArray(r.data))throw"invalid_response";if(!r.data.length)return n({error:"no_results"});let i=r.data.map(s=>({id:`befunky_photo_${s.id}`,thumbWidth:200,thumbHeight:200,imageURL:a(s.url,880,500),getImageURL:c=>l(s.url,c),nick:s.nick,title:s.title,dateCreated:s.dateCreated,isTransparent:/\.png(\?|$)/.test(s.url)}));return n({images:i});function a(s,c,d){let p={auto:"webp",width:u(c*(BeFunky.isRetina()?1.5:1)),height:u(d*(BeFunky.isRetina()?1.5:1)),fit:"bounds"};return BeFunky.addParamsToURL(s,p)}function l(s,c){let d={auto:"webp",width:u(c*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(s,d)}function u(s){return Math.ceil(s/50)*50}})}var _s=document.getElementById("user_gallery");_s&&dd.call(_s);function dd(){this.init=function(){this.registerRoutes(),this.initPublicAPI(),this.setMetaData(),this.initGallery(),this.initResults()},this.setMetaData=function(){let e=/\/gallery\/([^/]+)/;this.userNickName=window.location.href.match(e)[1],document.querySelector(".user-gallery__username").textContent=this.userNickName},this.initPublicAPI=function(){this.openImage=e=>{if(!e)return this.closeModal();let t=this.gallery.images.find(({id:n})=>n===`befunky_photo_${e}`);t?this.openModal(t):BeFunky.logError("Unable to open Gallery image",{imageID:e})}},this.initGallery=function(){this.gallery=this.querySelector(".user-gallery__gallery");let e=t=>(this.openModal(t),!1);this.gallery.rowHeight=200,this.gallery.currentWidth=this.getCurrentWidth(),this.gallery.singleRow=!1,this.gallery.onClickItem=e,this.gallery.context="site",this.gallery.borderWidth=1,window.addEventListener("resize",BeFunky.debounce(()=>this.handleGalleryResize(),300))},this.initResults=function(){this.loadResults(1)},this.registerRoutes=function(){Ce("/gallery/:nick/",({nick:e})=>{this.openImage()}),Ce("/explore/gallery/:imageID/",({imageID:e})=>{this.openImage(e)})},this.loadResults=function(e=1){e<=this.previousSearchPage||(this.previousSearchPage=e,e===1&&(this.gallery.images=[]),this.gallery.message="",this.gallery.isLoading=!0,pd(this.userNickName,e,({error:t,images:n})=>{if(this.gallery.isLoading=!1,t){BeFunky.logError("Unable to fetch images",t),t==="no_results"?(this.gallery.message="",this.gallery.emptyState={imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/picture-frames.svg`,text:"no_photos"}):(this.gallery.message={isError:!0,text:BeFunky.failureReason(t),buttonText:"try_again",buttonAction:()=>this.loadResults(e)},this.gallery.emptyState="",this.previousSearchPage=this.previousSearchPage-1);return}if(this.gallery.images=[...this.gallery.images,...n],this.gallery.message="",n.length<100)return;let o=()=>this.loadResults(e+1);this.gallery.message={buttonText:"load_more",buttonAction:o}}))},this.openModal=e=>{BeFunky.openUserPhotoModal(e,this.gallery.images,`/gallery/${this.userNickName}/`,!0)},this.closeModal=()=>{BeFunky.closeUserPhotoModal()},this.getCurrentWidth=()=>{return Math.min(1232,window.innerWidth)-e();function e(){return window.innerWidth>=768?96:window.innerWidth>=361?64:32}},this.handleGalleryResize=()=>{window.isAppOpen||(this.gallery.currentWidth=this.getCurrentWidth())},this.init()}function pd(e,t=1,n){let o={start:100*(t-1),end:100,user_nick:e};BeFunky.requestAPI("photo/gallery",o).then(r=>{if(!Array.isArray(r.data))throw"invalid_response";if(!r.data.length)return n({error:"no_results"});let i=r.data.map(s=>({id:`befunky_photo_${s.id}`,thumbWidth:200,thumbHeight:200,imageURL:a(s.url,880,500),getImageURL:c=>l(s.url,c),nick:s.nick,title:s.title,dateCreated:s.dateCreated,isTransparent:/\.png(\?|$)/.test(s.url)}));return n({images:i});function a(s,c,d){let p={auto:"webp",width:u(c*(BeFunky.isRetina()?1.5:1)),height:u(d*(BeFunky.isRetina()?1.5:1)),fit:"bounds"};return BeFunky.addParamsToURL(s,p)}function l(s,c){let d={auto:"webp",width:u(c*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(s,d)}function u(s){return Math.ceil(s/50)*50}}).catch(r=>{if(r==="user_does_not_exist"){window.location.href=`${BeFunky.Params.siteUrl}404/`;return}n({error:r})})}var Lo=window.deferredPromise(),{html:ks,siteLang:gd}=BeFunky.lit;BeFunky.myPhotosPage={openImage:e=>{Lo.then(t=>{if(!t){BeFunky.throwError("MyPhotos page not available");return}BeFunky.myPhotosPage.openImage(e)})},selectFilter:e=>{Lo.then(t=>{if(!t){BeFunky.throwError("MyPhotos page not available");return}BeFunky.myPhotosPage.selectFilter(e)})},imageToEdit:"",isAvailable:!1};var ws=document.getElementById("my_photos");ws?fd.call(ws):Lo.resolve(!1);function fd(){this.init=function(){this.initDefaultValues(),this.registerRoutes(),this.initPublicAPI(),this.initMenuItems(),this.initGallery(),this.initSearchForm()},this.initDefaultValues=function(){this.supportsTouch="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},this.initPublicAPI=function(){BeFunky.myPhotosPage.isAvailable=!0,BeFunky.myPhotosPage.openImage=e=>{if(!e)return this.closeModal();let t=this.gallery.images.find(({id:n})=>n===`befunky_photo_${e}`);t?this.openModal(t):BeFunky.logError("Unable to open Gallery image",{imageID:e})},BeFunky.myPhotosPage.selectFilter=e=>{this.closeModal(),e!==this.previousFilter&&this.loadResults("",e)}},this.initMenuItems=function(){this.menuItems={editTitle:{domId:"edit_title_form",title:()=>"title",onClick:(e,t)=>{let n=kd("edit_title"),o=t.id.replace("befunky_photo_",""),r=`${o}${t.key}`,{teardown:i,setFormState:a}=Ye(n,{title:"edit_title",fields:[{name:"title",label:"title",initialValue:t.title,maxLength:100,errorMessage:"photo_title_length",validate:l=>l.length>=1&&l.length<=100,sanitize:l=>l.replace(/[^a-zA-Z0-9_\s]/g,"")}],button:"update_title",onSubmit:({title:l})=>{md(n,r,l,({error:u,updatedTitle:s})=>{if(u){BeFunky.logError("Unable to set title on photo",u),a({submissionErrors:[BeFunky.failureReason(u)]});return}let c=this.gallery.images.find(({id:d})=>d===`befunky_photo_${o}`);c.title=s,BeFunky.closeModal(n)})}});wd(n,i)}},openInApp:{title:()=>"editor",onClick:(e,t)=>{BeFunky.myPhotosPage.imageToEdit=t.imageURL,de("/create/")}},publicPrivate:{title:e=>e.isPublic===!0?"set_to_private":"set_to_public",onClick:(e,t)=>{e.target.parentElement.focus(),e.target.disabled=!0,hd(t,({error:n,isPublic:o,id:r})=>{if(e.target.disabled=!1,n){BeFunky.logError("Unable to change photo status",n);return}this.previousFilter==="public"||this.previousFilter==="private"?(this.gallery.images=this.gallery.images.filter(i=>i.id!==r),e.target.parentElement.blur()):this.reRenderGalleryPopup()})}},deleteImage:{title:()=>"trash",onClick:(e,t)=>{BeFunky.confirm("delete_this_photo",{onConfirm:()=>{yd(t,({error:n,id:o})=>{if(n){BeFunky.logError("Unable to delete photo",n);return}this.gallery.images=this.gallery.images.filter(r=>r.id!==o),document.activeElement.blur()})},focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/photo-project-shredder.svg`})}}}},this.initGallery=function(){this.gallery=this.querySelector(".my-photos__gallery");let e=t=>{this.openModal(t)};this.gallery.rowHeight=200,this.gallery.currentWidth=this.getCurrentWidth(),this.gallery.singleRow=!1,this.gallery.onClickItem=e,this.gallery.context="site",this.gallery.addItemClass=()=>"gallery__item--has-content",this.gallery.extendItemTemplate=t=>this.photoOptionsTemplate(t),this.gallery.borderWidth=1,window.addEventListener("resize",BeFunky.debounce(()=>this.handleGalleryResize(),300))},this.initSearchForm=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.validFilters=["all","public","private"],this.filterButtons=this.validFilters.reduce((e,t)=>{let n=document.getElementById(`my_photos_filter_${t}`);return e[t]=n,n.addEventListener("click",()=>this.loadResults("",t)),e},{}),this.previousSearchQuery=null,this.previousFilter=null,this.previousSearchPage=-1,this.clearButton.addEventListener("click",()=>{this.loadResults("",this.previousFilter),this.searchInput.focus()}),this.searchForm.addEventListener("submit",this.handleSearch)},this.registerRoutes=function(){Ce("/myphotos/",()=>{BeFunky.myPhotosPage.selectFilter("all")}),Ce("/myphotos/:filter/",({filter:e})=>{BeFunky.myPhotosPage.selectFilter(e)}),Ce("/explore/gallery/:imageID/",({imageID:e})=>{BeFunky.myPhotosPage.openImage(e)})},this.reRenderGalleryPopup=function(){this.gallery.extendItemTemplate=e=>this.photoOptionsTemplate(e)},this.loadResults=function(e,t,n=1){if(this.previousSearchQuery===e&&this.previousFilter===t&&n<=this.previousSearchPage)return;if(!this.validFilters.includes(t)){BeFunky.logError("Invalid MyPhotos filter",{filter:t});return}this.searchInput.value=e;let o=this.filterButtons[t];Object.values(this.filterButtons).forEach(i=>{i.parentElement.toggleClass("active",i===o)}),this.previousSearchQuery=e,this.previousFilter=t,this.previousSearchPage=n;let r=t==="all"?"/myphotos/":`/myphotos/${t}/`;r!==wt()&&de(r),n===1&&(this.gallery.images=[]),this.gallery.message="",this.gallery.isLoading=!0,this.toggleInteractivity(!1),_d(e,t,n,({error:i,images:a})=>{if(e!==this.previousSearchQuery||t!==this.previousFilter)return;if(this.gallery.isLoading=!1,this.toggleInteractivity(!0),i){BeFunky.logError("Unable to fetch images",i),i==="no_results"?(this.gallery.message="",e?this.gallery.emptyState={text:["no_results_for",{query:`"<strong>${e}</strong>"`}],imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/magnifying-glass-frown.svg`}:this.gallery.emptyState={text:"no_befunky_photos",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/picture-frames.svg`}):(this.gallery.message={isError:!0,text:BeFunky.failureReason(i),buttonText:"try_again",buttonAction:()=>this.loadResults(e,t,n)},this.gallery.emptyState="",this.previousSearchPage=this.previousSearchPage-1);return}if(this.gallery.images=[...this.gallery.images,...a],this.gallery.message="",a.length<100)return;let l=()=>this.loadResults(e,t,n+1);this.gallery.message={buttonText:"load_more",buttonAction:l}})},this.photoOptionsTemplate=e=>{let t=["gallery__item-content","my-photos__edit-button",this.supportsTouch?"my-photos__edit-button--always-show":""].filter(Boolean).join(" ");return ks`
        <button class=${t} @click=${n}>
            <span class="my-photos__edit-ellipsis">
                <span></span><span></span><span></span>
            </span>
        </button>
        <div class="my-photos__edit-popup">
            <div class="my-photos__edit-popup-content" tabindex="0" @click=${o=>o.stopPropagation()}>
            ${Object.keys(this.menuItems).map((o,r)=>ks`
                <button class=${`button my-photos__edit-option my-photos__item-${r+1}`} @click=${i=>this.menuItems[o].onClick(i,e)}>
                    ${gd(this.menuItems[o].title(e))}
                </button>`)}
            </div>
        </div>
        `;function n(o){o.stopPropagation(),o.currentTarget.focus()}},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearButton.disabled=!e,Object.values(this.filterButtons).forEach(t=>{t.disabled=!e})},this.openModal=e=>{let t=this.previousFilter==="all"?"/myphotos/":`/myphotos/${this.previousFilter}/`;BeFunky.openUserPhotoModal(e,this.gallery.images,t,!1)},this.closeModal=()=>{BeFunky.closeUserPhotoModal()},this.getCurrentWidth=()=>{return Math.min(1232,window.innerWidth)-e();function e(){return window.innerWidth>=768?96:window.innerWidth>=361?64:32}},this.handleSearch=e=>{e&&e.preventDefault();let t=this.searchInput.value.replace(/[+"<>^%]/gi," ").replace(/ {2,}/g," ").trim();this.searchInput.value=t,this.loadResults(t,"all")},this.handleGalleryResize=()=>{window.isAppOpen||(this.gallery.currentWidth=this.getCurrentWidth())},this.init(),window.initialUserStatus.then(()=>{if(!BeFunky.isLoggedIn()){window.location.href=`${BeFunky.Params.siteUrl}sign-in/?next=${encodeURIComponent(window.location.href)}`;return}Lo.resolve(!0)})}function md(e,t,n,o){let r=n.match(/#(\w+)/gi);r=r!=null?r.join().replace(/#/g,""):"";let i={imgId:t,title:n,tags:r};BeFunky.requestAPI("photo/update-image-info",i,{showLoadScreen:!0}).then(a=>{if(a.data!=="success"||a.message!=="1")throw"invalid_response";o({updatedTitle:a.title})}).catch(a=>{o({error:a})})}function hd(e,t){let{isPublic:n,key:o,id:r}=e;if((BeFunky.User.isMailVerified!=null?BeFunky.User.isMailVerified:BeFunky.Params.isMailVerified)||n){let l={imgId:r.replace("befunky_photo_","")+o,isPublic:n?"0":"1"};BeFunky.requestAPI("photo/update-image-info/",l).then(u=>{if(u.data!=="success"||u.message!=="1")throw"invalid_response";let s=!n;e.isPublic=s,t({isPublic:s,id:r})}).catch(u=>{t({error:u})})}else BeFunky.confirm("photos_public_verify_email",{confirmText:"send_verification_email",onConfirm:BeFunky.sendVerificationEmail,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`}),t({error:"email_not_verified"})}function yd(e,t){let{id:n,key:o}=e,r={imgIds:`${n.replace("befunky_photo_","")+o}`};BeFunky.requestAPI("photo/delete-image/",r,{showLoadScreen:!0}).then(i=>{if(i.data!=="success"||i.message!=="1")throw"invalid_response";t({id:n})}).catch(i=>t({error:i}))}function _d(e,t,n=1,o){let r={start:100*(n-1),end:100};e?r.keyword=e:r.type=t,BeFunky.requestAPI("photo/me/",r).then(i=>{if(!Array.isArray(i.data))throw"invalid_response";if(!i.data.length)throw"no_results";let a=i.data.map(c=>({id:`befunky_photo_${c.id}`,thumbWidth:200,thumbHeight:200,imageURL:l(c.url,880,500),getImageURL:d=>u(c.url,d),key:c.key,nick:c.nick,title:c.title,dateCreated:c.dateCreated,isPublic:c.isPublic==="1",isTransparent:/\.png(\?|$)/.test(c.url)}));return o({images:a});function l(c,d,p){let m={auto:"webp",width:s(d*(BeFunky.isRetina()?1.5:1)),height:s(p*(BeFunky.isRetina()?1.5:1)),fit:"bounds"};return BeFunky.addParamsToURL(c,m)}function u(c,d){let p={auto:"webp",width:s(d*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(c,p)}function s(c){return Math.ceil(c/50)*50}}).catch(i=>{o({error:i})})}function kd(e){let t=document.createElement("div").setClass("modal form-modal");return t.id=`modal_form_${e}`,t}function wd(e,t){BeFunky.openModal(e,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:t})}var{html:ee,setupState:bd,render:vd,siteLang:V,elem:Co}=BeFunky.lit,bs=document.getElementById("my_account");bs&&Fd(bs.querySelector(".my-account__inner"));function Fd(e){let t={email:"",username:"",hasCancelledSubscription:!1,canResubscribe:!1,isLoading:!0,isEmailVerified:!1,isPayPalSubscriber:!1,isPayflowSubscriber:!1,isGooglePlaySubscriber:!1,isSocialUser:!0,isEmailSubscriber:!0,canChangeUsername:!0,canUpgrade:!1,monthlyCouponCode:"",billingCycle:"",nextBillingDate:"",packageName:"",paymentInfo:"",monthlyPriceIdForUpgradeToYearly:"",userPriceId:""},n=BeFunky.debounce(()=>vd(a(),e),"raf"),[o,r]=bd(t,n);BeFunky.LanguageManager.addLanguageUpdateListener(n);let i;BeFunky.isPlus()&&(i=ue()),window.initialUserStatus.then(C=>{let{data:B}=C;if(!BeFunky.isLoggedIn()){window.onbeforeunload=null,window.location.href=`${BeFunky.Params.siteUrl}sign-in/?next=${encodeURIComponent(window.location.href)}`;return}B||console.log("No user data, but user detected as logged in?",JSON.stringify(C));let L=B.isMailVerified==="1";r({email:B.email,username:B.user_name,isEmailVerified:L,canChangeUsername:B.can_change_user_name,isEmailSubscriber:B.is_subscribe_newsletter,isSocialUser:B.isSocialUser===1});let R=BeFunky.getUrlParameter("mv");R?L?ve("email_already_verified"):ne(R):L||G(),i||(i=BeFunky.isPlus()?ue():Promise.reject("not_plus_user")),s(i).then(()=>{r({isLoading:!1})})}),BeFunky.updateMyAccountPageAfterUpgrade=function(){r({isLoading:!0}),s(ue()).then(()=>r({isLoading:!1}))};function a(){let C=o.monthlyPriceIdForUpgradeToYearly&&!o.isPayPalSubscriber&&!o.isPayflowSubscriber&&!o.isGooglePlaySubscriber;return ee`
        <div class="${`my-account__card ${o.isLoading?"my-account__card--loading":""}`}">

            <h2 class="my-account__heading">${V("my_profile")}</h2>
            <div class="my-account__row my-account__row--username">
                <span class="my-account__label">${V("username")}</span>
                <span class="my-account__data">${o.username}</span>
                ${o.canChangeUsername?ee`<button @click=${c} class="button button--link my-account__button">${V("change")}</button>`:""}
            </div>
            <div class="my-account__row my-account__row--email">
                <span class="my-account__label">${V("email")}</span>
                <span class="my-account__data">${o.email}</span>
                <button @click=${d} class="button button--link my-account__button">${V("change")}</button>
            </div>
            <div class="my-account__row my-account__row--password">
                <span class="my-account__label">${V("password")}</span>
                <span class="my-account__data"></span>
                <button @click=${p} class="button button--link my-account__button">${V("change")}</button>
            </div>
        </div>

        <div class="${`my-account__card ${o.isLoading?"my-account__card--loading":""}`}">
            <h2 class="my-account__heading">${V("my_subscription")}</h2>
            <div class="my-account__row subscription-row">
            ${o.hasCancelledSubscription?ee`
                <span>
                    <string>${V("cancelled_subscription")}</string>
                    <br>
                    <string>${V(["previous_plan",{next_billing_date:N(o.nextBillingDate)}])}</string>
                </span>
                ${o.canResubscribe?ee`<button @click=${f} class="button button--link my-account__button">${V("resubscribe")}</button>`:""}
            `:ee`
                <span class="my-account__label">${V("plan")}</span>
                <span class="my-account__data">BeFunky ${o.packageName} ${o.billingCycle}</span>
                ${o.canUpgrade?ee`<button @click=${m} class="button button--blue">${V(mn()?"start_free_trial":"upgrade")}</button>`:""}
                ${C?ee`<button @click=${g} class="button button--blue button--xs">${V("switch_to_annual")}</button>`:""}
            `}
            </div>

            ${o.packageName==="Plus"?ee`
                ${o.hasCancelledSubscription?"":ee`
                    <div class="my-account__row">
                        <span class="my-account__label">${V("next_billing_date")}</span>
                        <span class="my-account__data">${N(o.nextBillingDate)}</span>
                    </div>
                `}
                ${o.isGooglePlaySubscriber?ee`
                    <div class="my-account__row">
                        <a href="https://play.google.com/store/account/subscriptions?package=com.befunky.pwato.tw" class="button button--link my-account__button" target="_blank" rel="noopener">${V("manage_play_subscription")}</a>
                    </div>
                `:ee`
                    <div class="my-account__row my-account__row--credit-card">
                        <span class="my-account__label">${V("billing_method")}</span>
                        <div class="my-account__data">${o.paymentInfo}</div>
                        ${o.isPayPalSubscriber?"":ee`
                        <button @click=${_} class="button button--link my-account__button">${V("change")}</button>
                        `}
                    </div>
                    <div class="my-account__row my-account__row--billing-history">
                        <span class="my-account__label">${V("billing_history")}</span>
                        <button @click=${y} class="button button--link my-account__button">${V("view")}</button>
                    </div>
                `}
                <div class="my-account__row my-account__row--cancel-subscription">
                    ${o.hasCancelledSubscription?"":ee`
                    <button @click=${w} class="button button--grey-outline button--md">${V("cancel_my_subscription")}</button>
                    `}
                </div>
            `:ee`
                    ${BeFunky.isStripeUser()?ee`
                        <div class="my-account__row my-account__row--billing-history">
                            <span class="my-account__label">${V("billing_history")}</span>
                            <button @click=${y} class="button button--link my-account__button">${V("view")}</button>
                        </div>
                    `:""}
            `}
            </div>

            <div class="${`my-account__card ${o.isLoading?"my-account__card--loading":""}`}">
                <h2 class="my-account__heading">${V("email_notifications")}</h2>
                <div id="account_newsletter_subscription" class="my-account__row my-account__row--email-notifications">
                    <span>${V("email_notification_settings")}</span>
                    <button @click=${b} class="button button--link my-account__button">${V("change")}</button>
                </div>
            </div>

            <div class="${`my-account__card my-account__card--delete-account ${o.isLoading?"my-account__card--loading":""}`}">
                ${l()}
            </div>

        </div>
        `}function l(){let C=BeFunky.toLinkHTML("SUPPORT",!0),B=o.packageName==="Plus"&&!o.hasCancelledSubscription?ee`<button class="button button--link" style="padding: 0; display: inline" @click=${w}>${V("cancel_anytime")}</button>`:V("cancel_anytime");return ee`
            <p>${V(["delete_account_contact_support",{contact_support:C}])}</p>
            <p>${V(["delete_account_info_1",{cancel_anytime:B}])}</p>
            <p>${V("delete_account_info_2")}</p>
            ${u()}
        `}function u(){return o.isPayPalSubscriber?ee`
            <p>${V("delete_account_paypal")}</p>
            <a href=${H()} class="button button--link my-account__button" target="_blank" rel="noopener">${V("open_paypal")}</a>
            `:o.isEmailVerified?ee`<button @click=${P} class="button button--link my-account__button my-account__button--delete">${V("delete_account")}</button>`:ee`
            <p>${V("delete_account_verify_email")}</p>
            <button @click=${E} class="button button--link my-account__button">${V("send_verification_email")}</button>
            `}function s(C){return C.then(({data:B})=>{let L=B.PaymentPlatform==="paypal_subscr",R=B.PaymentPlatform==="payflow",S=B.PaymentPlatform==="google_play_store",x=["monthly","monthly_premium_2017"];r({hasCancelledSubscription:B.iscancelled===1,canResubscribe:B.iscancelled===1&&!S,isPayPalSubscriber:L&&BeFunky.isPlus(),isPayflowSubscriber:R&&BeFunky.isPlus(),isGooglePlaySubscriber:S&&BeFunky.isPlus(),billingCycle:B.billingCycle||"",nextBillingDate:B.nextbillingdate_timestamp||"",packageName:B.packageName,monthlyPriceIdForUpgradeToYearly:B.billingCycle==="Monthly"&&!x.includes(B.price_id)?B.price_id:"",userPriceId:B.price_id||""});let U=L?`PayPal Account: ${B.SubscrEmai}`:ee`Card Number: ${B.last4} <br><string>${V("expiration_date")}</string> ${j(B.exp_month,B.exp_year)}`;r({paymentInfo:U}),window.location.href.includes("openThanks=1")&&BeFunky.openThankYouPanel();let M=B.can_apply_coupon&&B.can_apply_coupon!==B.coupon_applied&&BeFunky.User.subscription_status!=="trialing"?B.can_apply_coupon:"";M&&X().then(Z=>{Z.includes(M)||r({monthlyCouponCode:M})})}).catch(B=>{BeFunky.isPlus()?B!=="user_not_plus"&&(B!=="request_failed"&&BeFunky.throwError("Unable to get customer data for Plus user",B),BeFunky.showNotification({message:["error_account_info",{contact_support:BeFunky.toLinkHTML("SUPPORT",!0)}],button:{text:"try_again",onClick:()=>window.location.reload()}})):r({packageName:"Free"})}).then(()=>{r({canUpgrade:!BeFunky.isPlus()})})}function c(){let C=T("username"),{teardown:B,setFormState:L}=Ye(C,{title:"change_username",notification:"username_change_warning",fields:[{name:"username",label:"new_username",maxLength:100,errorMessage:"username_length",validate:R=>R.length>=4&&R.length<=100,sanitize:R=>R.replace(/[^a-zA-Z0-9_-]/g,"")}],button:"update_username",onSubmit:({username:R})=>{_e(R).then(()=>{r({username:R,canChangeUsername:!1}),window.updateUserStatus(Object.assign(window.latestUserData,{user_name:R})),BeFunky.closeModal(C)}).catch(S=>{BeFunky.logError(`Unable to change username to "${R}"`,S),L({submissionErrors:[BeFunky.failureReason(S)]})})}});$(C,B)}function d(){let C=T("email"),{teardown:B,setFormState:L}=Ye(C,{title:"change_email",fields:[{name:"email",label:"new_email",errorMessage:"error_invalid_email",validate:window.isEmailAddress,sanitize:R=>R.trim()},{name:"email_confirmed",label:"confirm_email",errorMessage:"error_email_mismatch",validate:(R,{email:S})=>R===S,sanitize:R=>R.trim()},{name:"password",label:"password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:R=>R.length>=6}],button:"update_email",onSubmit:({email:R,password:S})=>{he(R,S).then(({requiresEmailVerification:x})=>{r({email:R,isEmailVerified:!x}),x&&window.setCookie("mailVerificationSend","",-1),window.updateUserStatus(Object.assign(window.latestUserData,{email:R})),BeFunky.closeModal(C)}).catch(x=>{BeFunky.logError(`Unable to change email to "${R}"`,x),L({submissionErrors:[BeFunky.failureReason(x)]})})}});$(C,B)}function p(){let C=T("password"),B={name:"current_password",label:"current_password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:x=>x.length>=6},L=[{name:"new_password",label:"new_password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:x=>x.length>=6},{name:"new_password_confirmed",label:"confirm_password",type:"password",maxLength:100,errorMessage:"error_password_mismatch",validate:(x,{new_password:U})=>x===U}],{teardown:R,setFormState:S}=Ye(C,{title:"change_password",fields:o.isSocialUser?L:[B,...L],button:"change_password",onSubmit:({new_password:x,current_password:U})=>{se(x,U).then(()=>{BeFunky.closeModal(C)}).catch(M=>{BeFunky.logError("Unable to change password",M),S({submissionErrors:[BeFunky.failureReason(M)]})})}});$(C,R)}function m(){BeFunky.openPricingModal()}function g(){BeFunky.promptUserToUpgradeToYearly(o.monthlyPriceIdForUpgradeToYearly)}function f(){BeFunky.requestAPI("transaction/re-subscribe",{},{showLoadScreen:!0}).then(C=>{if(C.data!=="success")throw"invalid_response";r({hasCancelledSubscription:!1}),window.updateUserStatus(Object.assign(window.latestUserData,{pl:"1"})),BeFunky.acknowledge("my_account_resubscribed")}).catch(C=>{BeFunky.logError("Unable to resubscribe user:",C)})}function _(){BeFunky.openPaymentPanel("year",o.isPayflowSubscriber?"update_from_payflow":"update")}function y(){De().then(C).catch(S=>{if(S==="no_invoices")return C([]);BeFunky.throwError("Unable to fetch invoices",S)});function C(S){BeFunky.openModal(B(S),{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0})}function B(S){return Co`
                <div id="invoices" class="form-modal statement-panel modal">
                    <h3 data-lang="billing_history" class="h5">Your Billing History</h3>
                    ${L(S)}
                </div>
            `}function L(S){return S.length?ee`
                <ul class="statement-panel__invoice-list">
                ${S.map(x=>ee`
                    <li class="statement-panel__list-item">
                        <span class="title">${N(x.date_timestamp)}</span>
                        <button class="button button--link" @click=${R(x)}>${V("view")}</button>
                    </li>
                `)}
                </ul>`:ee`<p>${V("no_receipts")}</p>`}function R(S){return()=>J(Object.assign(S,{email:o.email}))}}function h(){let{monthlyCouponCode:C}=o;BeFunky.confirm("keep_subscription_body",{heading:"keep_subscription_heading",confirmText:"keep_subscription",cancelText:"cancel_anyway",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/gift.jpg`,onConfirm:()=>{pe(C).then(()=>{B(),BeFunky.acknowledge("keep_subscription_confirmation",{heading:"keep_subscription_thank_you",imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/peace.jpg`})}).catch(L=>{BeFunky.throwError(`Unable to apply coupon: ${L}`,L),BeFunky.acknowledge(BeFunky.failureReason(L))})},onCancel:L=>{!L||(B(),F())}});function B(){r({monthlyCouponCode:""}),X().then(L=>{L.includes(C)||BeFunky.SettingsService.updateSetting("dismissed_messages",[...L,C])})}}function w(){if(o.monthlyCouponCode==="monthly_retention_30_percent_discount")return h();let C=()=>ee`
            <div>
                <p>${V(["cancellation_prompt",{next_billing_date:N(o.nextBillingDate)}])}</p>
                ${B()}
                ${o.isPayPalSubscriber?ee`<p>${V("cancel_via_paypal")}</p>`:""}
            </div>
        `;BeFunky.confirm(C,{heading:"thank_you_befunky_titlecase",confirmText:o.isPayPalSubscriber?"open_paypal":"cancel_subscription",cancelText:"dont_cancel_subscription",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/gift.jpg`,onConfirm:F});function B(){if(BeFunky.platform==="play_store")return"";let L=o.userPriceId?BeFunky.Params.prices.find(M=>M.id===o.userPriceId):"";if(!L)return"";let{recurring:R}=L,S=br()[R];if(L.unit_amount>=S.unit_amount)return"";let x=BeFunky.LanguageManager.language.site,U=[R==="month"?"cancellation_monthly_new_price":"cancellation_yearly_new_price",{user_price:qe(L,x),current_price:qe(S,x)}];return ee`<p>${V(U)}</p>`}}function F(){if(o.isPayPalSubscriber)return window.open(H(),"_blank");Q().then(()=>{r({hasCancelledSubscription:!0}),BeFunky.acknowledge(["my_account_unsubscribed",{my_account_link:`<a href="${BeFunky.Params.siteUrl}my-account/">My Account</a>`,plan_expiration_date:N(o.nextBillingDate)}])}).catch(C=>{BeFunky.throwError("Unable to cancel subscription",C),BeFunky.acknowledge(BeFunky.failureReason(C))})}function b(){let C=document.getElementById("email_subscribe_newsletters"),B=document.getElementById("email_notifications_modal");C.checked=o.isEmailSubscriber,BeFunky.openModal(B,{addLightThemeClass:!0,addCloseButton:!0,size:"small"});let L=B.querySelector("form");L.submitHandled||(L.submitHandled=!0,L.addEventListener("submit",R=>{R.preventDefault();let S=C.checked;ce(S).then(()=>{BeFunky.closeModal(B.id),r({isEmailSubscriber:S})}).catch(x=>{BeFunky.throwError("Unable to update email subscription",x)})}))}function E(){ri()}function P(){let C=Co`
            <div>
                <p>${V(["delete_account_first_paragraph",{email:'<a href="mailto:support@befunky.com">support@befunky.com</a>'}])}</p>
                <p>${V("delete_account_second_paragraph")}</p>
                <p>${V("delete_account_thanks")}</p>
            </div>
        `;BeFunky.confirm(C,{heading:"sorry_to_see_you_go",confirmText:"yes_delete_account",imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/dog.jpg`,cancelText:"cancel",focusConfirmButton:!1,size:"medium",onConfirm:()=>{fe().then(()=>{BeFunky.acknowledge(Co`<div>
                            <p>${V("delete_account_email_sent")}</p>
                            <p>${V("thank_you_befunky")}</p>
                        </div>`,{heading:"sorry_to_see_you_go",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`})}).catch(B=>{BeFunky.acknowledge(BeFunky.failureReason(B)),BeFunky.throwError("Unable to send close account email",B)})}})}function T(C){let B=document.createElement("div").setClass("modal form-modal");return B.id=`modal_form_${C}`,B}function $(C,B){BeFunky.openModal(C,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:B})}function N(C){return typeof C=="number"&&(C=new Date(C*1e3)),C instanceof Date?C.toLocaleDateString(BeFunky.LanguageManager.language.site,{day:"numeric",month:"long",year:"numeric"}):C}function j(C,B){return`${C<10?`0${C}`:C} / ${B}`}function G(){BeFunky.showNotification({message:"please_verify_email",button:{text:"send_verification_email",onClick:ri},type:"warning"})}function H(){return`https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&alias=${encodeURIComponent("tekin2@befunky.com")}`}function z(C){let{date_timestamp:B,period_start_timestamp:L,period_end_timestamp:R,name:S,package_name:x,billing_cycle:U,charge:M,id:Z,last4:Y,email:oe}=C,Be=700,Pe=Math.round(11/8.5*Be),$e=`
            .invoice {
                position: relative;
                max-width: 100%;
                width: ${Be}px;
                min-height: ${Pe}px;
                margin: 0 auto;
                background: var(--secondary-000);
                padding: 4rem;
            }
            .print-button {
                position: absolute;
                top: 2rem;
                right: 2rem;
            }
            @media print {
                .print-button { display: none; }
            }
        `,Se=document.createElement("style");Se.appendChild(document.createTextNode($e));let mt=document.createElement("style");mt.appendChild(document.createTextNode([...document.getElementById("inline-fonts").sheet.cssRules].reduce((A,O)=>A+O.cssText.replace(/url\("\//g,`url("${BeFunky.Params.siteUrl}`),"")));let Ke=document.querySelector('link[rel="stylesheet"][href*="screen"]').cloneNode();return Ke.href=Ke.href.replace(/^\//,BeFunky.Params.siteUrl),Co`
            <div class="invoice">
                ${Ke}
                ${mt}
                ${Se}

                <img src="${BeFunky.Params.globalImagesPath}site/logo-dark1.svg" alt="BeFunky" style="margin: 0 auto; width: 320px; display: block;">
                <hr style="border-top: 1px solid #EDEDED; margin: 2rem 0">
                <h2>Invoice</h2>
                <p>
                    <strong>Date:</strong> ${N(B)}<br>
                    ${L===R?"":ee`<strong>Billing Period:</strong> ${N(L)} - ${N(R)}`}
                </p>

                <br>
                <h6>Billed To</h6>
                <p>
                    ${S}<br>
                    ${oe}<br>
                    **** **** **** ${Y}
                </p>

                <br>
                <h6>Invoice Number</h6>
                <p>${Z}</p>

                <br>
                <h6>Description</h6>
                <p>
                    Plan: BeFunky ${x} ${U}<br>
                    Charge: ${M}
                </p>

                <br>
                <p style="text-align: right"><strong>Total Amount Paid:</strong> ${M}</p>

                ${""}
                <button onclick="window.print()" class="button button--blue print-button">Print</button>
            </div>
        `}function J(C){let B=`Invoice${BeFunky.randomString(10)}`,L=window.open("about:blank",B),R=z(C);BeFunky.isFirefox?(L.document.title=`BeFunky - ${N(C.date_timestamp)} Invoice`,L.document.write(R.outerHTML),L.document.close()):(L.document.title=`BeFunky - ${N(C.date_timestamp)} Invoice`,L.document.body.appendChild(R))}function X(){return new Promise((C,B)=>{BeFunky.SettingsService.getUserSettings(({error:L,settings:R})=>{if(L)return B(L);C(R.dismissed_messages||[])})})}function ue(){return BeFunky.requestAPI("transaction/customer")}function Q(){return BeFunky.requestAPI("transaction/cancel-subscr",{plan_expiration_date:N(o.nextBillingDate)},{showLoadScreen:!0}).then(C=>{if(C.data!=="success")throw"invalid_response"})}function pe(C){return BeFunky.requestAPI("transaction/apply-coupon",{coupon:C},{showLoadScreen:!0}).then(B=>{if(B.data!=="success")throw"invalid_response"})}function ne(C){return BeFunky.requestAPI("auth/verify-email",{mv:C},{showLoadScreen:!0}).then(B=>{if(B.data!=="success")throw"invalid_response";return ve("email_successfully_verified")}).catch(B=>{if(B==="logged_out_reload_page")return window.location.reload();if(B==="already_verified")return ve("email_already_verified");BeFunky.throwError("Unable to verify email:",B)})}function ve(C){BeFunky.showNotification({message:C,type:"success"}),r({isEmailVerified:!0}),de("/my-account/")}function _e(C){return BeFunky.requestAPI("auth/update-username",{newName:C},{showLoadScreen:!0}).then(B=>{if(B.data!=="success")throw"invalid_response"})}function he(C,B){let L={e:C,ea:C,pa:B};return BeFunky.requestAPI("auth/update-email",L,{showLoadScreen:!0}).then(R=>{if(R.data!=="success")throw"invalid_response";return{requiresEmailVerification:R.social!=="1"}})}function se(C,B){let L={npBa:btoa(encodeURIComponent(C)),npaBa:btoa(encodeURIComponent(C))};return B&&(L.opBa=btoa(encodeURIComponent(B))),BeFunky.requestAPI("auth/update-pwd",L,{showLoadScreen:!0}).then(R=>{if(R.data!=="success")throw"invalid_response"})}function ce(C){let B={em:"effects",is_:C?"0":"1"};return BeFunky.requestAPI("auth/update-email-pref",B,{showLoadScreen:!0}).then(L=>{if(L.data!=="success")throw"invalid_response"})}function fe(){return BeFunky.requestAPI("auth/close-account-request",{},{showLoadScreen:!0}).then(C=>{if(C.data!=="success")throw"invalid_response"})}let me;function De(){return me?Promise.resolve(me):BeFunky.requestAPI("transaction/invoices",{},{showLoadScreen:!0}).then(C=>{if(!Array.isArray(C.data))throw"invalid_response";return me=C.data,C.data})}}function ri(){let e=!!window.getCookie("mailVerificationSend");if(BeFunky.Params.IS_LC&&(e=!0),e)return BeFunky.confirm("confirm_resend_verification_email",{onConfirm:t,confirmText:"resend_email"});t();function t(){BeFunky.requestAPI("auth/send-verify-email",{},{showLoadScreen:!0}).then(n=>{if(!n.userEmail)throw"invalid_response";BeFunky.acknowledge("verification_email_sent",{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`})}).catch(n=>{BeFunky.logError("Unable to verify email",n),n==="not_user"?BeFunky.acknowledge("error_email_not_registered"):BeFunky.acknowledge(BeFunky.failureReason(n))})}}BeFunky.sendVerificationEmail=ri;var{html:vs,setupState:Bd,render:Pd,lang:Sd,elem:Ld}=BeFunky.lit,Fs=document.getElementById("close_account");Fs&&Cd(Fs);function Cd(e){let t={isLoading:!0},n=BeFunky.debounce(()=>Pd(a(),e),"raf"),[o,r]=Bd(t,n);BeFunky.LanguageManager.addLanguageUpdateListener(n);let i=BeFunky.getUrlParameter("q");window.initialUserStatus.then(()=>{if(!BeFunky.isLoggedIn()){window.location.href=`${BeFunky.Params.siteUrl}sign-in/?next=${encodeURIComponent(window.location.href)}`;return}d(i)});function a(){return o.isLoading?l():u()}function l(){return vs`
        <div class="section__no-grid">
            <div class="section__text section__text--centered">
                <div class="loading-spinner"></div>
            </div>
        </div>
        `}function u(){return vs`
        <div class="section__no-grid">
            <div class="section__text section__text--centered">
                <h1 class="close-account__heading h2">${p("permanently_close_account")}</h1>
                <p>${p("delete_your_account")}</p>
                <div class="close-account__buttons button-group">
                    <button id="close_account_no" class="button button--lg button--blue" @click=${s}>${p("no_close_account")}</button>
                    <button id="close_account_yes" class="button button--lg button--grey-300" @click=${c}>${p("yes_close_account")}</button>
                </div>
            </div>
        </div>
        `}function s(){BeFunky.acknowledge("thanks_for_staying",{onAcknowledge(){window.location.href=BeFunky.Params.siteUrl},imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/leap-yay.jpg`})}function c(){m(i)}function d(h){let w={closeKey:h};BeFunky.requestAPI("auth/close-account-key-control",w).then(F=>{if(F.data!=="success")throw"invalid_response";r({isLoading:!1})}).catch(F=>{F!=="request_failed"&&(BeFunky.throwError("Unable to process close account",F),window.location.href=BeFunky.Params.siteUrl)})}function p(h){return Sd(h,"site")}function m(h){let w={closeKey:h};BeFunky.requestAPI("auth/close-account",w,{showLoadScreen:!0}).then(F=>{if(F.data!=="success")throw"invalid_response";BeFunky.showLoadScreen({message:"closing_account",progress:0}),setTimeout(_,2555)}).catch(F=>{BeFunky.throwError("Unable to close account",JSON.stringify({error:F})),y()})}let g=!1,f=0;function _(){g||(g=!0,BeFunky.requestAPI("auth/close-account-status",{}).then(h=>{g=!1;let w=parseInt(h.data.stepPercentageComplete)||0;if(w?f=w:f<100&&f++,BeFunky.showLoadScreen({message:"closing_account",progress:f}),parseInt(h.data.isFinished)===1){BeFunky.hideLoadScreen(),BeFunky.acknowledge("account_deleted",{onAcknowledge:()=>{BeFunky.signOut()}});return}setTimeout(BeFunky.updateAccountCloseStatus,100)}).catch(h=>{g=!1,BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get account close status",JSON.stringify({error:h})),y()}))}function y(){let h=Ld`
        <div>
            <p>${p("error_close_account")}</p>
            <p>${p(["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}])}</p>
        </div>
        `;BeFunky.acknowledge(h)}}var{html:ii,setupState:Ed,render:xd,lang:$d}=BeFunky.lit,Id=document.getElementById("superstars");Id&&Td(document.getElementById("superstars_gallery"));function Td(e){let t={isLoading:!0,superStars:[]},n=BeFunky.debounce(()=>xd(i(),e),"raf"),[o,r]=Ed(t,n);s();function i(){return o.isLoading?a():l()}function a(){return ii`
        <div class="section__inner">
            <div class="section__text section__text--centered">
                <div class="loading-spinner"></div>
            </div>
        </div>
        `}function l(){return ii`
        ${o.superStars.map(c=>ii`
            <section class="section__no-grid">
                <div class="superstar grid-item">
                    <div class="superstar__header">
                        <a href="/gallery/${c.username}/" class="superstar__thumbnail">
                            <img src="${BeFunky.Params.globalImagesPath}app/default-avatar.jpg" alt="${c.username}">
                        </a>
                        <h5><a href="/gallery/${c.username}/">${c.username}</a></h5>
                    </div>
                    <div class="superstar__images">
                        <div class="superstar__left-column">
                            <img src="${c.images[0].url}" alt="${c.images[0].title}" title="${c.images[0].title}" data-id="${c.images[0].id}">
                        </div>
                        <div class="superstar__right-column">
                            <img src="${c.images[1].thumb_url}" alt="${c.images[1].title}" title="${c.images[1].title}" data-id="${c.images[1].id}">
                            <img src="${c.images[2].thumb_url}" alt="${c.images[2].title}" title="${c.images[2].title}" data-id="${c.images[2].id}">
                        </div>
                    </div>
                </div>
            </section>`)}`}function u(c){return $d(c,"site")}function s(){BeFunky.requestAPI("photo/superstars",{}).then(c=>{if(!Array.isArray(c.data))throw"invalid_request";let d=c.data;r({superStars:d,isLoading:!1})}).catch(c=>{c!=="request_failed"&&BeFunky.throwError("Unable to fetch Superstars",c)})}}var{html:ai,setupState:Ad,render:Rd,lang:Md,elem:Ud}=BeFunky.lit,Dd=document.getElementById("reset_password");Dd&&jd(document.getElementById("password_reset_content"));function jd(e){let t={linkIsValid:!0,hasBeenReset:!1,operationFailed:!1},n=BeFunky.debounce(()=>Rd(u(),e),"raf"),[o,r]=Ad(t,n);BeFunky.LanguageManager.addLanguageUpdateListener(n);let i=p();window.initialUserStatus.then(()=>{BeFunky.isLoggedIn()&&(window.location.href=`${BeFunky.Params.siteUrl}my-account/`)});let a=BeFunky.getUrlParameter("q"),l=/^[0-9a-f]{40}$/i;a.match(l)?m(a).catch(_=>{_==="invalid_key"?(r({linkIsValid:!1}),BeFunky.logWarning("Key is invalid")):_!=="request_failed"&&BeFunky.reportWarning(`Unable to validate reset pass key: ${_}`,{key:a})}):r({linkIsValid:!1});function u(){return o.hasBeenReset?d():o.linkIsValid?c():s()}function s(){let _=`${BeFunky.Params.siteUrl}sign-in/`,y=f(["reset_password_link_options",{send_new_link:BeFunky.toLinkHTML(`${_}?opn=fp`),sign_in:()=>`<a href="${_}">${BeFunky.LanguageManager.getString("sign_in").toLowerCase()}</a>`}]),h=f(["reset_password_support",{contact_support:BeFunky.toLinkHTML("SUPPORT")}]);return ai`
            <h1 class="reset-password__heading h5">${f("reset_password_link_invalid")}</h1>
            <p>${y}</p>
            <p>${h}</p>
        `}function c(){return ai`
            <h1 class="reset-password__heading h5">Reset Password</h1>
            ${i}
        `}function d(){return ai`
         <h1 class="reset-password__heading text-xl" style="text-align: center">${f("password_updated")}</h1>
         <a href=${`${BeFunky.Params.siteUrl}sign-in/`} class="button button--blue button--lg" style="margin: 0 auto; display: inline-block;">${f("sign_in")}</a>
        `}function p(){let _=Ud`<div></div>`,{setFormState:y}=Ye(_,{title:"",fields:[{name:"pass",label:"new_password",maxLength:100,errorMessage:"register_modal_password_error",type:"password",validate:h=>h.length>=6},{name:"passAgain",label:"confirm_password",maxLength:100,errorMessage:"error_password_mismatch",type:"password",validate:(h,{pass:w})=>h===w}],button:"reset_password",onSubmit:({pass:h,passAgain:w})=>{g(a,h,w).then(()=>{r({hasBeenReset:!0})}).catch(F=>{F==="invalid_key"?r({linkIsValid:!1}):y({submissionErrors:[BeFunky.failureReason(F)]}),F!=="request_failed"&&BeFunky.throwError(`Unable to reset password: ${F}`,{key:a})})}},{formClass:"reset-password__form"});return _}function m(_){let y={qKey:_,validateKey:!0};return BeFunky.requestAPI("auth/reset-pass",y).then(h=>{if(h.data!=="success")throw"invalid_response"})}function g(_,y,h){let w={qKey:_,passBa:btoa(encodeURIComponent(y)),passAgainBa:btoa(encodeURIComponent(h))};return BeFunky.requestAPI("auth/reset-pass",w,{showLoadScreen:!0}).then(F=>{if(F.data!=="success")throw"invalid_response"})}function f(_){return Md(_,"site")}}var{html:Od,useState:Eo,useEffect:Nd,useLanguageUpdate:Hd,defineCustomElement:qd}=BeFunky.lit;qd("dashboard-projects",Wd);function Wd(){let e=this,[t,n]=Eo(!1),[o,r]=Eo([]),[i,a]=Eo([]),[l,u]=Eo(Math.min(1136,window.innerWidth-96));return Nd(()=>{BeFunky.isLoggedIn()&&c(),window.addEventListener("resize",BeFunky.debounce(()=>_(!1),200));let y=BeFunky.isLoggedIn();window.onUserStatusChange(()=>{let h=BeFunky.isLoggedIn();!y&&h&&c(),y=h}),this.fetchProjects=c},[]),Hd("site"),s();function s(){return Od`
        <image-gallery
            .isLoading=${t}
            .images=${p()}
            .emptyState=${i}
            .rowHeight=${240}
            .currentWidth=${l}
            .singleRow=${!0}
            .onClickItem=${d}
            .borderWidth=${1}
        ></image-gallery>`}function c(){n(!0),BeFunky.SavedProjectFetcher.getFirst100Projects().then(y=>{r(y.slice(0,10))}).catch(y=>{r([]),a(y==="no_results"?{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-projects-dashboard.svg`,text:"no_saved_projects",linkText:"learn_more",linkHref:"https://support.befunky.com/hc/en-us/articles/360003279091-How-Do-I-Save-My-Project-So-I-Can-Edit-It-Later-"}:y==="not_logged_in"?{text:"error_not_logged_in_projects",buttonText:"sign_in",buttonAction:()=>BeFunky.openLoginPanel("SIGNIN")}:{text:BeFunky.failureReason(y),buttonText:"try_again",buttonAction:c})}).then(()=>{n(!1),_(!0)})}function d({id:y}){let h=o.find(w=>w.templateid===y);BeFunky.SavedProjectManager.openProjectFromOutsideOfApp(h)}function p(){return o.map(m)}function m(y){return{id:y.templateid,getImageURL:h=>g(y.thumburl,h*(BeFunky.isRetina()?1.5:1)),thumbWidth:y.width,thumbHeight:y.height,isTransparent:y.thumburl.includes(".png")}}function g(y,h){let w={auto:"webp",width:f(h)};return BeFunky.addParamsToURL(y,w)}function f(y){return Math.ceil(y/50)*50}function _(y){let h=e.querySelector("image-gallery");if(!h){y&&requestAnimationFrame(()=>_(!1));return}let{width:w}=h.getBoundingClientRect();if(!w){y&&requestAnimationFrame(()=>_(!1));return}u(w)}}var{html:Mt,useState:Kt,useEffect:Vd,useLanguageUpdate:Gd,siteLang:zd,defineCustomElement:Xd}=BeFunky.lit;function Yd(){let[e,t]=Kt(!1),[n,o]=Kt([]),[r,i]=Kt(""),[a,l]=Kt(1),[u,s]=Kt(1),[c,d]=Kt(void 0);this._hasInitialized||(this._hasInitialized=!0,Ce("/learn/search/:searchTerm/",j=>{i(j.searchTerm)}),Ce("/learn/search/",()=>{i()}));let p=Gd("site"),m=document.querySelector("#blog_search h1"),g=document.querySelector(".search-box__input");return Vd(()=>{let j=r?BeFunky.LanguageManager.getStringReplacements("search_results_for",{query:r}):BeFunky.LanguageManager.getString("search");if(document.title=`${j} | Learn BeFunky`,m.textContent=j,g.value=r,!r)return t(!1);b(1)},[r,p]),f();function f(){return c?w():e&&n.length===0?_():r?n.length===0&&!e?y():F():h()}function _(){let j=369+128;return Mt`
        <div class="section__text section__text--centered" style="margin-bottom: 2rem; display: flex; flex-direction: row; align-items: center; justify-content: center; min-height: ${j}px">
            <div class="loading-spinner"></div>
        </div>
        `}function y(){return Mt`
        <div class="section__text section__text--centered">
            <h3>${zd(["no_results_for",{query:`"${r}"`}])}</h3>
        </div>
        `}function h(){return Mt`
        <div class="section__text section__text--centered"></div>
        `}function w(){return Mt`
        <div class="section__text section__text--centered">
            <h3>${BeFunky.failureReason(c)}</h3>
        </div>
        `}function F(){return Mt`
        <div class="section section--bg-white">
            <div class="section__grid section__grid--cards">
                ${n.map(j=>{let G=Mt([N(j.excerpt.rendered)]);return Mt`
                <a href="${BeFunky.Params.siteUrl}learn/${j.slug}/" class="section__grid-item grid-item grid-item--3 grid-item--link">
                    <figure class="grid-item__figure">
                        <img src="${E(j["featured-image"].file)}" class="grid-item__image" alt="${j["featured-image"].alt}">
                    </figure>
                    <div class="grid-item__text">
                        <h3 class="grid-item__heading h6">${$(j.title.rendered)}</h3>
                        ${G}
                    </div>
                </a>`})}
            </div>
        </div>

        <div class="section__text section__text--centered blog__load-more-posts">
            <div class="section__buttons button-group">
                <button @click=${P} ?disabled="${e}"
                class="button button--grey-300 blog__view-more
                ${a>=u?"blog__view-more--hidden":""}
                ">View More</button>
            </div>
        </div>`}function b(j=1){t(!0),d(void 0);let G=j===1;G&&o([]),T(j).then(({response:H,totalPageCount:z})=>{t(!1),l(j),o(G?H:[...n,...H]),s(z)}).catch(H=>{t(!1),d(H),BeFunky.logError(`Error retrieving posts for ${r}`,H)})}function E(j){let G=BeFunky.Params.remoteImagesPath,[H,z,J]=j.split("/"),X=`wp/wp-${H}-${z}-${J}`,ue=G+X,Q=BeFunky.isRetina()?540:360,pe={auto:"webp",width:Q,crop:"16:9"};return BeFunky.addParamsToURL(ue,pe,!1)}function P(){b(a+1)}function T(j){return new Promise((G,H)=>{let J=`${BeFunky.Params.IS_LC?"https://editors.befunky.com/":BeFunky.Params.siteUrl}wp-json/wp/v2/posts?search=${r}&per_page=12&page=${j}`,X=BeFunky.request(J,{},({error:ue,response:Q})=>{if(ue)return H(ue);if(!Array.isArray(Q))return H("invalid_response");let pe=parseInt(X.getResponseHeader("X-WP-TotalPages"));G({response:Q,totalPageCount:pe})})})}function $(j){return new DOMParser().parseFromString(j,"text/html").documentElement.textContent}function N(j){let G=65,H=/<p>(.*?)<\/p>/,z=j.match(H);if(!z)return"";let J=z[1];if(J.length>G){let X=J.indexOf(" ",G);return X===-1?`<p>${J.substring(0,65)} ...</p>
`:`<p>${J.substring(0,X)} ...</p>
`}return`<p>${J} ...</p>
`}}Xd("blog-search-results",Yd);var Bs=document.getElementById("blog_search");Bs&&Jd.call(Bs);function Jd(){this.init=function(){this.initSearchForm()},this.initSearchForm=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.searchAutocomplete=this.querySelector(".blog__search-autocomplete"),this.searchForm.addEventListener("submit",this.submitSearch),this.searchButton.addEventListener("click",this.submitSearch),this.clearButton.addEventListener("click",()=>setTimeout(()=>this.searchInput.focus(),0)),BeFunky.autocomplete(this.searchAutocomplete,{inputElement:this.searchInput,options:window.wordpressTagData.map(e=>({label:e.name,slug:e.slug})),onSelect:({slug:e,label:t})=>{e?de(`/learn/tag/${encodeURIComponent(e)}`):de(`/learn/search/${encodeURIComponent(t)}`)},generateItem:e=>({html:BeFunky.LanguageManager.getStringReplacements("search_for",{query:BeFunky.escapeHTML(e)}),index:0})})},this.submitSearch=e=>{e.preventDefault();let t=this.searchInput.value;!t||de(`/learn/search/${encodeURIComponent(t)}`)},this.init()}window.rebuildGlobalVersion=5;})();
/*!
 * Fuse.js v3.6.1 - Lightweight fuzzy-search (http://fusejs.io)
 * 
 * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)
 * All Rights Reserved. Apache Software License 2.0
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Portions Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
//# sourceMappingURL=befunky.core.js.map
